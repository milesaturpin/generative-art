Springer Texts in Statistics
Series Editors:
G. Casella
S. Fienberg
I. Olkin

For other titles published in this series, go to
http://www.springer.com/series/417

Peter D. Hoff

A First Course in Bayesian
Statistical Methods

123

Peter D. Hoff
Department of Statistics
University of Washington
Seattle WA 98195-4322
USA
hoff@stat.washington.edu

ISSN 1431-875X
ISBN 978-0-387-92299-7
e-ISBN 978-0-387-92407-6
DOI 10.1007/978-0-387-92407-6
Springer Dordrecht Heidelberg London New York
Library of Congress Control Number: 2009929120
c Springer Science+Business Media, LLC 2009

All rights reserved. This work may not be translated or copied in whole or in part without the written
permission of the publisher (Springer Science+Business Media, LLC, 233 Spring Street, New York,
NY10013, USA), except for brief excerpts in connection with reviews or scholarly analysis. Use in
connection with any form of information storage and retrieval, electronic adaptation, computer software,
or by similar or dissimilar methodology now known or hereafter developed is forbidden.
The use in this publication of trade names, trademarks, service marks, and similar terms, even if they are
not identified as such, is not to be taken as an expression of opinion as to whether or not they are subject to
proprietary rights.
Printed on acid-free paper
Springer is part of Springer Science+Business Media (www.springer.com)

Preface

This book originated from a set of lecture notes for a one-quarter graduatelevel course taught at the University of Washington. The purpose of the course
is to familiarize the students with the basic concepts of Bayesian theory and
to quickly get them performing their own data analyses using Bayesian computational tools. The audience for this course includes non-statistics graduate
students who did well in their department’s graduate-level introductory statistics courses and who also have an interest in statistics. Additionally, first- and
second-year statistics graduate students have found this course to be a useful
introduction to statistical modeling. Like the course, this book is intended to
be a self-contained and compact introduction to the main concepts of Bayesian
theory and practice. By the end of the text, readers should have the ability to
understand and implement the basic tools of Bayesian statistical methods for
their own data analysis purposes. The text is not intended as a comprehensive handbook for advanced statistical researchers, although it is hoped that
this latter category of readers could use this book as a quick introduction to
Bayesian methods and as a preparation for more comprehensive and detailed
studies.
Computing
Monte Carlo summaries of posterior distributions play an important role in
the way data analyses are presented in this text. My experience has been
that once a student understands the basic idea of posterior sampling, their
data analyses quickly become more creative and meaningful, using relevant
posterior predictive distributions and interesting functions of parameters. The
open-source R statistical computing environment provides sufficient functionality to make Monte Carlo estimation very easy for a large number of statistical models, and example R-code is provided throughout the text. Much of
the example code can be run “as is” in R, and essentially all of it can be run
after downloading the relevant datasets from the companion website for this
book.

VI

Preface

Acknowledgments
The presentation of material in this book, and my teaching style in general,
have been heavily influenced by the diverse set of students taking CSSS-STAT
564 at the University of Washington. My thanks to them for improving my
teaching. I also thank Chris Hoffman, Vladimir Minin, Xiaoyue Niu and Marc
Suchard for their extensive comments, suggestions and corrections for this
book, and to Adrian Raftery for bibliographic suggestions. Finally, I thank
my wife Jen for her patience and support.

Seattle, WA

Peter Hoff
March 2009

Contents

1

Introduction and examples . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
1.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1
1.2 Why Bayes? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
1.2.1 Estimating the probability of a rare event . . . . . . . . . . . . 3
1.2.2 Building a predictive model . . . . . . . . . . . . . . . . . . . . . . . . . 8
1.3 Where we are going . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
1.4 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 12

2

Belief, probability and exchangeability . . . . . . . . . . . . . . . . . . . . .
2.1 Belief functions and probabilities . . . . . . . . . . . . . . . . . . . . . . . . . .
2.2 Events, partitions and Bayes’ rule . . . . . . . . . . . . . . . . . . . . . . . . .
2.3 Independence . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.4 Random variables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.4.1 Discrete random variables . . . . . . . . . . . . . . . . . . . . . . . . . .
2.4.2 Continuous random variables . . . . . . . . . . . . . . . . . . . . . . .
2.4.3 Descriptions of distributions . . . . . . . . . . . . . . . . . . . . . . . .
2.5 Joint distributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.6 Independent random variables . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.7 Exchangeability . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.8 de Finetti’s theorem . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.9 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . .

13
13
14
17
17
18
19
21
23
26
27
29
30

3

One-parameter models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.1 The binomial model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.1.1 Inference for exchangeable binary data . . . . . . . . . . . . . . .
3.1.2 Confidence regions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.2 The Poisson model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.2.1 Posterior inference . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.2.2 Example: Birth rates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.3 Exponential families and conjugate priors . . . . . . . . . . . . . . . . . . .
3.4 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . .

31
31
35
41
43
45
48
51
52

VIII

Contents

4

Monte Carlo approximation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4.1 The Monte Carlo method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4.2 Posterior inference for arbitrary functions . . . . . . . . . . . . . . . . . . .
4.3 Sampling from predictive distributions . . . . . . . . . . . . . . . . . . . . .
4.4 Posterior predictive model checking . . . . . . . . . . . . . . . . . . . . . . . .
4.5 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . .

53
53
57
60
62
65

5

The normal model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5.1 The normal model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
5.2 Inference for the mean, conditional on the variance . . . . . . . . . .
5.3 Joint inference for the mean and variance . . . . . . . . . . . . . . . . . . .
5.4 Bias, variance and mean squared error . . . . . . . . . . . . . . . . . . . . .
5.5 Prior specification based on expectations . . . . . . . . . . . . . . . . . . .
5.6 The normal model for non-normal data . . . . . . . . . . . . . . . . . . . . .
5.7 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . .

67
67
69
73
79
83
84
86

6

Posterior approximation with the Gibbs sampler . . . . . . . . . . 89
6.1 A semiconjugate prior distribution . . . . . . . . . . . . . . . . . . . . . . . . . 89
6.2 Discrete approximations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
6.3 Sampling from the conditional distributions . . . . . . . . . . . . . . . . . 92
6.4 Gibbs sampling . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93
6.5 General properties of the Gibbs sampler . . . . . . . . . . . . . . . . . . . . 96
6.6 Introduction to MCMC diagnostics . . . . . . . . . . . . . . . . . . . . . . . . 98
6.7 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 104

7

The multivariate normal model . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105
7.1 The multivariate normal density . . . . . . . . . . . . . . . . . . . . . . . . . . . 105
7.2 A semiconjugate prior distribution for the mean . . . . . . . . . . . . . 107
7.3 The inverse-Wishart distribution . . . . . . . . . . . . . . . . . . . . . . . . . . 109
7.4 Gibbs sampling of the mean and covariance . . . . . . . . . . . . . . . . . 112
7.5 Missing data and imputation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 115
7.6 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 123

8

Group comparisons and hierarchical modeling . . . . . . . . . . . . . 125
8.1 Comparing two groups . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125
8.2 Comparing multiple groups . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130
8.2.1 Exchangeability and hierarchical models . . . . . . . . . . . . . . 131
8.3 The hierarchical normal model . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132
8.3.1 Posterior inference . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133
8.4 Example: Math scores in U.S. public schools . . . . . . . . . . . . . . . . 135
8.4.1 Prior distributions and posterior approximation . . . . . . . 137
8.4.2 Posterior summaries and shrinkage . . . . . . . . . . . . . . . . . . 140
8.5 Hierarchical modeling of means and variances . . . . . . . . . . . . . . . 143
8.5.1 Analysis of math score data . . . . . . . . . . . . . . . . . . . . . . . . 145
8.6 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 146

Contents

9

IX

Linear regression . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
9.1 The linear regression model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
9.1.1 Least squares estimation for the oxygen uptake data . . . 153
9.2 Bayesian estimation for a regression model . . . . . . . . . . . . . . . . . . 154
9.2.1 A semiconjugate prior distribution . . . . . . . . . . . . . . . . . . . 154
9.2.2 Default and weakly informative prior distributions . . . . . 155
9.3 Model selection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 160
9.3.1 Bayesian model comparison . . . . . . . . . . . . . . . . . . . . . . . . . 163
9.3.2 Gibbs sampling and model averaging . . . . . . . . . . . . . . . . . 167
9.4 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 170

10 Nonconjugate priors and Metropolis-Hastings algorithms . . 171
10.1 Generalized linear models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 171
10.2 The Metropolis algorithm . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173
10.3 The Metropolis algorithm for Poisson regression . . . . . . . . . . . . . 179
10.4 Metropolis, Metropolis-Hastings and Gibbs . . . . . . . . . . . . . . . . . 181
10.4.1 The Metropolis-Hastings algorithm . . . . . . . . . . . . . . . . . . 182
10.4.2 Why does the Metropolis-Hastings algorithm work? . . . . 184
10.5 Combining the Metropolis and Gibbs algorithms . . . . . . . . . . . . 187
10.5.1 A regression model with correlated errors . . . . . . . . . . . . . 188
10.5.2 Analysis of the ice core data . . . . . . . . . . . . . . . . . . . . . . . . 191
10.6 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 192
11 Linear and generalized linear mixed effects models . . . . . . . . . 195
11.1 A hierarchical regression model . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195
11.2 Full conditional distributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 198
11.3 Posterior analysis of the math score data . . . . . . . . . . . . . . . . . . . 200
11.4 Generalized linear mixed effects models . . . . . . . . . . . . . . . . . . . . 201
11.4.1 A Metropolis-Gibbs algorithm for posterior
approximation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 202
11.4.2 Analysis of tumor location data . . . . . . . . . . . . . . . . . . . . . 203
11.5 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 207
12 Latent variable methods for ordinal data . . . . . . . . . . . . . . . . . . 209
12.1 Ordered probit regression and the rank likelihood . . . . . . . . . . . . 209
12.1.1 Probit regression . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 211
12.1.2 Transformation models and the rank likelihood . . . . . . . . 214
12.2 The Gaussian copula model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 217
12.2.1 Rank likelihood for copula estimation . . . . . . . . . . . . . . . . 218
12.3 Discussion and further references . . . . . . . . . . . . . . . . . . . . . . . . . . 223
Exercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 225
Common distributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 253
References . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 259
Index . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 267

1
Introduction and examples

1.1 Introduction
We often use probabilities informally to express our information and beliefs
about unknown quantities. However, the use of probabilities to express information can be made formal: In a precise mathematical sense, it can be shown
that probabilities can numerically represent a set of rational beliefs, that there
is a relationship between probability and information, and that Bayes’ rule
provides a rational method for updating beliefs in light of new information.
The process of inductive learning via Bayes’ rule is referred to as Bayesian
inference.
More generally, Bayesian methods are data analysis tools that are derived
from the principles of Bayesian inference. In addition to their formal interpretation as a means of induction, Bayesian methods provide:
•
•
•
•

parameter estimates with good statistical properties;
parsimonious descriptions of observed data;
predictions for missing data and forecasts of future data;
a computational framework for model estimation, selection and validation.

Thus the uses of Bayesian methods go beyond the formal task of induction
for which the methods are derived. Throughout this book we will explore
the broad uses of Bayesian methods for a variety of inferential and statistical
tasks. We begin in this chapter with an introduction to the basic ingredients
of Bayesian learning, followed by some examples of the different ways in which
Bayesian methods are used in practice.
Bayesian learning
Statistical induction is the process of learning about the general characteristics
of a population from a subset of members of that population. Numerical values
of population characteristics are typically expressed in terms of a parameter θ,
and numerical descriptions of the subset make up a dataset y. Before a dataset
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 1,
c Springer Science+Business Media, LLC 2009


2

1 Introduction and examples

is obtained, the numerical values of both the population characteristics and the
dataset are uncertain. After a dataset y is obtained, the information it contains
can be used to decrease our uncertainty about the population characteristics.
Quantifying this change in uncertainty is the purpose of Bayesian inference.
The sample space Y is the set of all possible datasets, from which a single
dataset y will result. The parameter space Θ is the set of possible parameter
values, from which we hope to identify the value that best represents the true
population characteristics. The idealized form of Bayesian learning begins with
a numerical formulation of joint beliefs about y and θ, expressed in terms of
probability distributions over Y and Θ.
1. For each numerical value θ ∈ Θ, our prior distribution p(θ) describes our
belief that θ represents the true population characteristics.
2. For each θ ∈ Θ and y ∈ Y, our sampling model p(y|θ) describes our belief
that y would be the outcome of our study if we knew θ to be true.
Once we obtain the data y, the last step is to update our beliefs about θ:
3. For each numerical value of θ ∈ Θ, our posterior distribution p(θ|y) describes our belief that θ is the true value, having observed dataset y.
The posterior distribution is obtained from the prior distribution and sampling
model via Bayes’ rule:
p(θ|y) = R

p(y|θ)p(θ)
.
˜ θ)
˜ dθ˜
p(y|
θ)p(
Θ

It is important to note that Bayes’ rule does not tell us what our beliefs should
be, it tells us how they should change after seeing new information.

1.2 Why Bayes?
Mathematical results of Cox (1946, 1961) and Savage (1954, 1972) prove that
if p(θ) and p(y|θ) represent a rational person’s beliefs, then Bayes’ rule is an
optimal method of updating this person’s beliefs about θ given new information y. These results give a strong theoretical justification for the use of
Bayes’ rule as a method of quantitative learning. However, in practical data
analysis situations it can be hard to precisely mathematically formulate what
our prior beliefs are, and so p(θ) is often chosen in a somewhat ad hoc manner
or for reasons of computational convenience. What then is the justification of
Bayesian data analysis?
A famous quote about sampling models is that “all models are wrong,
but some are useful” (Box and Draper, 1987, pg. 424). Similarly, p(θ) might
be viewed as “wrong” if it does not accurately represent our prior beliefs.
However, this does not mean that p(θ|y) is not useful. If p(θ) approximates our
beliefs, then the fact that p(θ|y) is optimal under p(θ) means that it will also

1.2 Why Bayes?

3

generally serve as a good approximation to what our posterior beliefs should
be. In other situations it may not be our beliefs that are of interest. Rather,
we may want to use Bayes’ rule to explore how the data would update the
beliefs of a variety of people with differing prior opinions. Of particular interest
might be the posterior beliefs of someone with weak prior information. This
has motivated the use of “diffuse” prior distributions, which assign probability
more or less evenly over large regions of the parameter space.
Finally, in many complicated statistical problems there are no obvious
non-Bayesian methods of estimation or inference. In these situations, Bayes’
rule can be used to generate estimation procedures, and the performance of
these procedures can be evaluated using non-Bayesian criteria. In many cases
it has been shown that Bayesian or approximately Bayesian procedures work
very well, even for non-Bayesian purposes.
The next two examples are intended to show how Bayesian inference, using prior distributions that may only roughly represent our or someone else’s
prior beliefs, can be broadly useful for statistical inference. Most of the mathematical details of the calculations are left for later chapters.
1.2.1 Estimating the probability of a rare event
Suppose we are interested in the prevalence of an infectious disease in a small
city. The higher the prevalence, the more public health precautions we would
recommend be put into place. A small random sample of 20 individuals from
the city will be checked for infection.
Parameter and sample spaces
Interest is in θ, the fraction of infected individuals in the city. Roughly speaking, the parameter space includes all numbers between zero and one. The
data y records the total number of people in the sample who are infected.
The parameter and sample spaces are then as follows:
Θ = [0, 1]

Y = {0, 1, . . . , 20} .

Sampling model
Before the sample is obtained the number of infected individuals in the sample
is unknown. We let the variable Y denote this to-be-determined value. If
the value of θ were known, a reasonable sampling model for Y would be a
binomial(20, θ) probability distribution:
Y |θ ∼ binomial(20, θ) .
The first panel of Figure 1.1 plots the binomial(20, θ) distribution for θ equal
to 0.05, 0.10 and 0.20. If, for example, the true infection rate is 0.05, then the
probability that there will be zero infected individuals in the sample (Y = 0)
is 36%. If the true rate is 0.10 or 0.20, then the probabilities that Y = 0 are
12% and 1%, respectively.

1 Introduction and examples

15

0.4

4

p(θ
θ)
p(θ
θ|y)
10
0

0.0

0.1

5

probability
0.2
0.3

θ=0.05
θ=0.10
θ=0.20

0

5
10
15
number infected in the sample

20

0.0
0.2
0.4
0.6
0.8
1.0
percentage infected in the population

Fig. 1.1. Sampling model, prior and posterior distributions for the infection rate
example. The plot on the left-hand side gives binomial(20, θ) distributions for three
values of θ. The right-hand side gives prior (gray) and posterior (black) densities of
θ.

Prior distribution
Other studies from various parts of the country indicate that the infection rate
in comparable cities ranges from about 0.05 to 0.20, with an average prevalence
of 0.10. This prior information suggests that we use a prior distribution p(θ)
that assigns a substantial amount of probability to the interval (0.05, 0.20),
and that the expected value of θ under p(θ) is close to 0.10. However, there are
infinitely many probability distributions that satisfy these conditions, and it
is not clear that we can discriminate among them with our limited amount of
prior information. We will therefore use a prior distribution p(θ) that has the
characteristics described above, but whose particular mathematical form is
chosen for reasons of computational convenience. Specifically, we will encode
the prior information using a member of the family of beta distributions. A
beta distribution has two parameters which we denote as a and b. If θ has a
beta(a, b) distribution, then the expectation of θ is a/(a + b) and the most
probable value of θ is (a − 1)/(a − 1 + b − 1). For our problem where θ is
the infection rate, we will represent our prior information about θ with a
beta(2,20) probability distribution. Symbolically, we write
θ ∼ beta(2, 20).
This distribution is shown in the gray line in the second panel of Figure 1.1.
The expected value of θ for this prior distribution is 0.09. The curve of the
prior distribution is highest at θ = 0.05 and about two-thirds of the area
under the curve occurs between 0.05 and 0.20. The prior probability that the
infection rate is below 0.10 is 64%.

1.2 Why Bayes?

5

E[θ] = 0.09
mode[θ] = 0.05
Pr(θ < 0.10) = 0.64
Pr(0.05 < θ < 0.20) = 0.66 .
Posterior distribution
As we will see in Chapter 3, if Y |θ ∼ binomial(n, θ) and θ ∼ beta(a, b),
then if we observe a numeric value y of Y , the posterior distribution is a
beta(a + y, b + n − y) distribution. Suppose that for our study a value of Y = 0
is observed, i.e. none of the sample individuals are infected. The posterior
distribution of θ is then a beta(2, 40) distribution.
θ|{Y = 0} ∼ beta(2, 40)
The density of this distribution is given by the black line in the second panel
of Figure 1.1. This density is further to the left than the prior distribution,
and more peaked as well. It is to the left of p(θ) because the observation
that Y = 0 provides evidence of a low value of θ. It is more peaked than p(θ)
because it combines information from the data and the prior distribution, and
thus contains more information than in p(θ) alone. The peak of this curve is
at 0.025 and the posterior expectation of θ is 0.048. The posterior probability
that θ < 0.10 is 93%.
E[θ|Y = 0] = 0.048
mode[θ|Y = 0] = 0.025
Pr(θ < 0.10|Y = 0) = 0.93.
The posterior distribution p(θ|Y = 0) provides us with a model for learning
about the city-wide infection rate θ. From a theoretical perspective, a rational individual whose prior beliefs about θ were represented by a beta(2,20)
distribution now has beliefs that are represented by a beta(2,40) distribution.
As a practical matter, if we accept the beta(2,20) distribution as a reasonable
measure of prior information, then we accept the beta(2,40) distribution as a
reasonable measure of posterior information.
Sensitivity analysis
Suppose we are to discuss the results of the survey with a group of city health
officials. A discussion of the implications of our study among a diverse group of
people might benefit from a description of the posterior beliefs corresponding
to a variety of prior distributions. Suppose we were to consider beliefs represented by beta(a, b) distributions for values of (a, b) other than (2,20). As
mentioned above, if θ ∼ beta(a, b), then given Y = y the posterior distribution
of θ is beta(a + y, b + n − y). The posterior expectation is

6

1 Introduction and examples

a+y
a+b+n
n
y
a+b
a
=
+
a+b+nn a+b+na+b
n
w
=
y¯ +
θ0 ,
w+n
w+n

E[θ|Y = y] =

6

0.4

0.24
0.22

0.5

0.2

0.4

0.5

where θ0 = a/(a + b) is the prior expectation of θ and w = a + b. From
this formula we see that the posterior expectation is a weighted average of
the sample mean y¯ and the prior expectation θ0 . In terms of estimating θ,
θ0 represents our prior guess at the true value of θ and w represents our
confidence in this guess, expressed on the same scale as the sample size. If

0.2

0.16

0.1

0.3

0.3

0.18

0.2

0.12
0.1

0.3

0.2

θ0

0.14

0.5

0.7

0.1

0.06
0.04

0.1

0.08

0.9
0.975

0.0

0.0

0.02

5

10

15
w

20

25

5

10

15

20

25

w

Fig. 1.2. Posterior quantities under different beta prior distributions. The left- and
right-hand panels give contours of E[θ|Y = 0] and Pr(θ < 0.10|Y = 0), respectively,
for a range of prior expectations and levels of confidence.

someone provides us with a prior guess θ0 and a degree of confidence w, then
we can approximate their prior beliefs about θ with a beta distribution having
parameters a = wθ0 and b = w(1−θ0 ). Their approximate posterior beliefs are
then represented with a beta(wθ0 + y, w(1 − θ0 ) + n − y) distribution. We can
compute such a posterior distribution for a wide range of θ0 and w values to
perform a sensitivity analysis, an exploration of how posterior information is
affected by differences in prior opinion. Figure 1.2 explores the effects of θ0 and
w on the posterior distribution via contour plots of two posterior quantities.
The first plot gives contours of the posterior expectation E[θ|Y = 0], and
the second gives the posterior probabilities Pr(θ < 0.10|Y = 0). This latter
plot may be of use if, for instance, the city officials would like to recommend
a vaccine to the general public unless they were reasonably sure that the
current infection rate was less than 0.10. The plot indicates, for example, that

1.2 Why Bayes?

7

people with weak prior beliefs (low values of w) or low prior expectations are
generally 90% or more certain that the infection rate is below 0.10. However,
a high degree of certainty (say 97.5%) is only achieved by people who already
thought the infection rate was lower than the average of the other cities.
Comparison to non-Bayesian methods
A standard estimate of a population proportion θ is the sample mean y¯ =
y/n, the fraction of infected people in the sample. For our sample in which
y = 0 this of course gives an estimate of zero, and so by using y¯ we would be
estimating that zero people in the city are infected. If we were to report this
estimate to a group of doctors or health officials we would probably want to
include the caveat that this estimate is subject to sampling uncertainty. One
way to describe the sampling uncertainty of an estimate is with a confidence
interval. A popular 95% confidence interval for a population proportion θ is
the Wald interval , given by
p
y¯ ± 1.96 y¯(1 − y¯)/n.
This interval has correct asymptotic frequentist coverage, meaning that if n
is large, then with probability approximately equal to 95%, Y will take on
a value y such that the above interval contains θ. Unfortunately this does
not hold for small n: For an n of around 20 the probability that the interval
contains θ is only about 80% (Agresti and Coull, 1998). Regardless, for our
sample in which y¯ = 0 the Wald confidence interval comes out to be just a
single point: zero. In fact, the 99.99% Wald interval also comes out to be zero.
Certainly we would not want to conclude from the survey that we are 99.99%
certain that no one in the city is infected.
People have suggested a variety of alternatives to the Wald interval in
hopes of avoiding this type of behavior. One type of confidence interval that
performs well by non-Bayesian criteria is the “adjusted” Wald interval suggested by Agresti and Coull (1998), which is given by
q
ˆ − θ)/n
ˆ
θˆ ± 1.96 θ(1
, where
n
4 1
θˆ =
y¯ +
.
n+4
n+42
While not originally motivated as such, this interval is clearly related to
Bayesian inference: The value of θˆ here is equivalent to the posterior mean for
θ under a beta(2,2) prior distribution, which represents weak prior information
centered around θ = 1/2.
General estimation of a population mean
Given a random sample of n observations from a population, a standard estimate of the population mean θ is the sample mean y¯. While y¯ is generally

8

1 Introduction and examples

a reliable estimate for large sample sizes, as we saw in the example it can be
statistically unreliable for small n, in which case it serves more as a summary
of the sample data than as a precise estimate of θ.
If our interest lies more in obtaining an estimate of θ than in summarizing
our sample data, we may want to consider estimators of the form
n
w
θˆ =
y¯ +
θ0 ,
n+w
n+w
where θ0 represents a “best guess” at the true value of θ and w represents a
degree of confidence in the guess. If the sample size is large, then y¯ is a reliable
estimate of θ. The estimator θˆ takes advantage of this by having its weights
on y¯ and θ0 go to one and zero, respectively, as n increases. As a result, the
statistical properties of y¯ and θˆ are essentially the same for large n. However,
for small n the variability of y¯ might be more than our uncertainty about θ0 .
In this case, using θˆ allows us to combine the data with prior information to
stabilize our estimation of θ.
These properties of θˆ for both large and small n suggest that it is a useful
estimate of θ for a broad range of n. In Section 5.4 we will confirm this by
showing that, under some conditions, θˆ outperforms y¯ as an estimator of θ for
all values of n. As we saw in the infection rate example and will see again in
later chapters, θˆ can be interpreted as a Bayesian estimator using a certain
class of prior distributions. Even if a particular prior distribution p(θ) does not
exactly reflect our prior information, the corresponding posterior distribution
p(θ|y) can still be a useful means of providing stable inference and estimation
for situations in which the sample size is low.
1.2.2 Building a predictive model
In Chapter 9 we will discuss an example in which our task is to build a predictive model of diabetes progression as a function of 64 baseline explanatory
variables such as age, sex and body mass index. Here we give a brief synopsis of
that example. We will first estimate the parameters in a regression model using a “training” dataset consisting of measurements from 342 patients. We will
then evaluate the predictive performance of the estimated regression model
using a separate “test” dataset of 100 patients.
Sampling model and parameter space
Letting Yi be the diabetes progression of subject i and xi = (xi,1 , . . . , xi,64 )
be the explanatory variables, we will consider linear regression models of the
form
Yi = β1 xi,1 + β2 xi,2 + · · · + β64 xi,64 + σi .
The sixty-five unknown parameters in this model are the vector of regression
coefficients β = (β1 , . . . , β64 ) as well as σ, the standard deviation of the error
term. The parameter space is 64-dimensional Euclidean space for β and the
positive real line for σ.

1.2 Why Bayes?

9

Prior distribution
In most situations, defining a joint prior probability distribution for 65 parameters that accurately represents prior beliefs is a near-impossible task. As
an alternative, we will use a prior distribution that only represents some aspects of our prior beliefs. The main belief that we would like to represent is
that most of the 64 explanatory variables have little to no effect on diabetes
progression, i.e. most of the regression coefficients are zero. In Chapter 9 we
will discuss a prior distribution on β that roughly represents this belief, in
that each regression coefficient has a 50% prior probability of being equal to
zero.
Posterior distribution

0.2

Pr(β
βj ≠ 0|y,X)
0.4
0.6
0.8

1.0

Given data y = (y1 , . . . , y342 ) and X = (x1 , . . . , x342 ), the posterior distribution p(β|y, X) can be computed and used to obtain Pr(βj 6= 0|y, X) for each
regression coefficient j. These probabilities are plotted in the first panel of
Figure 1.3. Even though each of the sixty-four coefficients started out with a
50-50 chance of being non-zero in the prior distribution, there are only six βj ’s
for which Pr(βj 6= 0|y, X) ≥ 0.5. The vast majority of the remaining coefficients have high posterior probabilities of being zero. This dramatic increase
in the expected number of zero coefficients is a result of the information in the
data, although it is the prior distribution that allows for such zero coefficients
in the first place.

0

10

20

30
40
regressor index

50

60

Fig. 1.3. Posterior probabilities that each coefficient is non-zero.

10

1 Introduction and examples

Predictive performance and comparison to non-Bayesian methods
We can evaluate how well this model performs by using it to predict the test
ˆ
data: Let β
Bayes = E[β|y, X] be the posterior expectation of β, and let Xtest
be the 100 × 64 matrix giving the data for the 100 patients in the test dataset.
We can compute a predicted value for each of the 100 observations in the test
ˆ
ˆ test = Xβ
set using the equation y
Bayes . These predicted values can then be
ˆ test appears
compared to the actual observations y test . A plot of y test versus y
ˆ
in the first panel of Figure 1.4, and indicates how well β
is
able
to predict
Bayes
diabetes progression from the baseline variables.
How does this Bayesian estimate of β compare to a non-Bayesian approach? The most commonly used estimate of a vector of regression coefficients is the ordinary least squares (OLS) estimate, provided in most if not all
ˆ of
statistical software packages. The OLS regression estimate is the value β
ols
β that minimizes the sum of squares of the residuals (SSR) for the observed
data,
n
X
SSR(β) =
(yi − β T xi )2 ,
i=1
T
−1 T
ˆ
and is given by the formula β
X y. Predictions for the test
ols = (X X)
ˆ and are plotted against the
data based on this estimate are given by Xβ
ols
ˆ
observed values in the second panel of Figure 1.4. Notice that using β
ols
gives a weaker relationship between observed and predicted values than using
ˆ
β
by computing the average squared
Bayes . This can be
Pquantified numerically
prediction error,
(ytest,i − yˆtest,i )2 /100, for both sets of predictions. The
prediction error for OLS is 0.67, about 50% higher than the value of 0.45 we
obtain using the Bayesian estimate. In this problem, even though our ad hoc
prior distribution for β only captures the basic structure of our prior beliefs
(namely, that many of the coefficients are likely to be zero), this is enough to
provide a large improvement in predictive performance over the OLS estimate.
The poor performance of the OLS method is due to its inability to recognize when the sample size is too small to accurately estimate the regression
coefficients. In such situations, the linear relationship between the values of
ˆ , is often an inaccurate represeny and X in the dataset, quantified by β
ols
tation of the relationship in the entire population. The standard remedy to
this problem is to fit a “sparse” regression model, in which some or many
of the regression coefficients are set to zero. One method of choosing which
coefficients to set to zero is the Bayesian approach described above. Another
popular method is the “lasso,” introduced by Tibshirani (1996) and studied
ˆ
extensively by many others. The lasso estimate is the value β
lasso of β that
minimizes SSR(β : λ), a modified version of the sum of squared residuals:

SSR(β : λ) =

n
X
i=1

(yi − xTi β)2 + λ

p
X
j=1

|βj | .

1.3 Where we are going

11

2

2

●

●

●

●

0

1

●●
●

1
y^test

●
●

2

y test

●

●

●

0

0

−1

●

●
●
●
●

−1

1
y^test

●
●● ●●● ●●
● ●
● ●●
●
●
●
●
●●● ●●
●
●
●
●
●● ● ●
● ●●
●
●
●●
●● ● ●●
●
●
●●
●
●●
●
●
●● ●●
●
● ● ●●
●
●●
●
●
●● ●
●
●
●● ●
●●
●●
●
●●

−1

●

●

●

●
● ●

●

●
● ●
●
●
●
●
● ●● ●
●
●●
●
●●
●
● ● ●
●
●
●
●
●
●
●
●● ● ●
●● ●● ● ●
● ●
●
●●●
●● ●
● ●
●
●
●
●
●● ● ● ● ●
●
●
●
● ●
● ●
●● ● ● ●
●●
● ●
●
●
●
●
●
●
●
●●

−1

0

1

●●
●

●
●●

●

●

●

2

y test

Fig. 1.4. Observed versus predicted diabetes progression values using the Bayes
estimate (left panel) and the OLS estimate (right panel).

In other words, the lasso procedure penalizes large values of |βj |. Depending
ˆ
on the size of λ, this penalty can make some elements of β
lasso equal to
zero. Although the lasso procedure has been motivated by and studied in
a non-Bayesian context, in fact it corresponds to a Bayesian estimate using
a particular prior distribution: The lasso estimate is equal to the posterior
mode of β in which the prior distribution for each βj is a double-exponential
distribution, a probability distribution that has a sharp peak at βj = 0.

1.3 Where we are going
As the above examples indicate, the uses of Bayesian methods are quite broad.
We have seen how the Bayesian approach provides
• models for rational, quantitative learning;
• estimators that work for small and large sample sizes;
• methods for generating statistical procedures in complicated problems.
An understanding of the benefits and limits of Bayesian methods comes with
experience. In the chapters that follow, we will become familiar with these
methods by applying them to a large number of statistical models and data
analysis examples. After a review of probability in Chapter 2, we will learn
the basics of Bayesian data analysis and computation in the context of some
simple one-parameter statistical models in Chapters 3 and 4. Chapters 5, 6
and 7 discuss Bayesian inference with the normal and multivariate normal
models. While important in their own right, normal models also provide the

12

1 Introduction and examples

building blocks of more complicated modern statistical methods, such as hierarchical modeling, regression, variable selection and mixed effects models.
These advanced topics and others are covered in Chapters 8 through 12.

1.4 Discussion and further references
The idea of probability as a measure of uncertainty about unknown but deterministic quantities is an old one. Important historical works include Bayes’
“An essay towards solving a Problem in the Doctrine of Chances” (Bayes,
1763) and Laplace’s “A Philosophical Essay on Probabilities,” published in
1814 and currently published by Dover (Laplace, 1995).
The role of prior opinion in statistical inference was debated for much of
the 20th century. Most published articles on this debate take up one side or another, and include mischaracterizations of the other side. More informative are
discussions among statisticians of different viewpoints: Savage (1962) includes
a short introduction by Savage, followed by a discussion among Bartlett,
Barnard, Cox, Pearson and Smith, among others. Little (2006) considers the
strengths and weaknesses of Bayesian and frequentist statistical criteria. Efron
(2005) briefly discusses the role of different statistical philosophies in the last
two centuries, and speculates on the interplay between Bayesian and nonBayesian methods in the future of statistical science.

2
Belief, probability and exchangeability

We first discuss what properties a reasonable belief function should have, and
show that probabilities have these properties. Then, we review the basic machinery of discrete and continuous random variables and probability distributions. Finally, we explore the link between independence and exchangeability.

2.1 Belief functions and probabilities
At the beginning of the last chapter we claimed that probabilities are a way
to numerically express rational beliefs. We do not prove this claim here (see
Chapter 2 of Jaynes (2003) or Chapters 2 and 3 of Savage (1972) for details),
but we do show that several properties we would want our numerical beliefs
to have are also properties of probabilities.
Belief functions
Let F , G, and H be three possibly overlapping statements about the world.
For example:
F = { a person votes for a left-of-center candidate }
G = { a person’s income is in the lowest 10% of the population }
H = { a person lives in a large city }
Let Be() be a belief function, that is, a function that assigns numbers to
statements such that the larger the number, the higher the degree of belief.
Some philosophers have tried to make this more concrete by relating beliefs
to preferences over bets:
• Be(F ) > Be(G) means we would prefer to bet F is true than G is true.
We also want Be() to describe our beliefs under certain conditions:
• Be(F |H) > Be(G|H) means that if we knew that H were true, then we
would prefer to bet that F is also true than bet G is also true.
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 2,
c Springer Science+Business Media, LLC 2009


14

2 Belief, probability and exchangeability

• Be(F |G) > Be(F |H) means that if we were forced to bet on F , we would
prefer to do it under the condition that G is true rather than H is true.
Axioms of beliefs
It has been argued by many that any function that is to numerically represent
our beliefs should have the following properties:
B1 Be(not H|H) ≤ Be(F |H) ≤ Be(H|H)
B2 Be(F or G|H) ≥ max{Be(F |H), Be(G|H)}
B3 Be(F and G|H) can be derived from Be(G|H) and Be(F |G and H)
How should we interpret these properties? Are they reasonable?
B1 says that the number we assign to Be(F |H), our conditional belief in F
given H, is bounded below and above by the numbers we assign to complete
disbelief (Be(not H|H)) and complete belief (Be(H|H)).
B2 says that our belief that the truth lies in a given set of possibilities should
not decrease as we add to the set of possibilities.
B3 is a bit trickier. To see why it makes sense, imagine you have to decide
whether or not F and G are true, knowing that H is true. You could do this
by first deciding whether or not G is true given H, and if so, then deciding
whether or not F is true given G and H.
Axioms of probability
Now let’s compare B1, B2 and B3 to the standard axioms of probability.
Recall that F ∪ G means “F or G,” F ∩ G means “F and G” and ∅ is the
empty set.
P1 0 = Pr(not H|H) ≤ Pr(F |H) ≤ Pr(H|H) = 1
P2 Pr(F ∪ G|H) = Pr(F |H) + Pr(G|H) if F ∩ G = ∅
P3 Pr(F ∩ G|H) = Pr(G|H) Pr(F |G ∩ H)
You should convince yourself that a probability function, satisfying P1, P2
and P3, also satisfies B1, B2 and B3. Therefore if we use a probability
function to describe our beliefs, we have satisfied the axioms of belief.

2.2 Events, partitions and Bayes’ rule
Definition 1 (Partition) A collection of sets {H1 , . . . , HK } is a partition
of another set H if
1. the events are disjoint, which we write as Hi ∩ Hj = ∅ for i 6= j;
2. the union of the sets is H, which we write as ∪K
k=1 Hk = H.
In the context of identifying which of several statements is true, if H is the
set of all possible truths and {H1 , . . . , HK } is a partition of H, then exactly
one out of {H1 , . . . , HK } contains the truth.

2.2 Events, partitions and Bayes’ rule

15

Examples
• Let H be someone’s religious orientation. Partitions include
– {Protestant, Catholic, Jewish, other, none};
– {Christian, non-Christian};
– {atheist, monotheist, multitheist}.
• Let H be someone’s number of children. Partitions include
– {0, 1, 2, 3 or more};
– {0, 1, 2, 3, 4, 5, 6, . . . }.
• Let H be the relationship between smoking and hypertension in a given
population. Partitions include
– {some relationship, no relationship};
– {negative correlation, zero correlation, positive correlation}.
Partitions and probability
Suppose {H1 , . . . , HK } is a partition of H, Pr(H) = 1, and E is some specific
event. The axioms of probability imply the following:
Rule of total probability :

K
X

Pr(Hk ) = 1

k=1

Rule of marginal probability :

Pr(E) =

K
X

Pr(E ∩ Hk )

k=1

=

K
X

Pr(E|Hk ) Pr(Hk )

k=1

Bayes’ rule :

Pr(E|Hj ) Pr(Hj )
Pr(E)
Pr(E|Hj ) Pr(Hj )
= PK
k=1 Pr(E|Hk ) Pr(Hk )

Pr(Hj |E) =

Example
A subset of the 1996 General Social Survey includes data on the education level
and income for a sample of males over 30 years of age. Let {H1 , H2 , H3 , H4 } be
the events that a randomly selected person in this sample is in, respectively,
the lower 25th percentile, the second 25th percentile, the third 25th percentile
and the upper 25th percentile in terms of income. By definition,
{Pr(H1 ), Pr(H2 ), Pr(H3 ), Pr(H4 )} = {.25, .25, .25, .25}.

16

2 Belief, probability and exchangeability

Note that {H1 , H2 , H3 , H4 } is a partition and so these probabilities sum to 1.
Let E be the event that a randomly sampled person from the survey has a
college education. From the survey data, we have
{Pr(E|H1 ), Pr(E|H2 ), Pr(E|H3 ), Pr(E|H4 )} = {.11, .19, .31, .53}.
These probabilities do not sum to 1 - they represent the proportions of people
with college degrees in the four different income subpopulations H1 , H2 , H3
and H4 . Now let’s consider the income distribution of the college-educated
population. Using Bayes’ rule we can obtain
{Pr(H1 |E), Pr(H2 |E), Pr(H3 |E), Pr(H4 |E)} = {.09, .17, .27, .47} ,
and we see that the income distribution for people in the college-educated
population differs markedly from {.25, .25, .25, .25}, the distribution for the
general population. Note that these probabilities do sum to 1 - they are the
conditional probabilities of the events in the partition, given E.
In Bayesian inference, {H1 , . . . , HK } often refer to disjoint hypotheses or
states of nature and E refers to the outcome of a survey, study or experiment.
To compare hypotheses post-experimentally, we often calculate the following
ratio:
Pr(Hi |E)
Pr(E|Hi ) Pr(Hi )/ Pr(E)
=
Pr(Hj |E)
Pr(E|Hj ) Pr(Hj )/ Pr(E)
Pr(E|Hi ) Pr(Hi )
=
Pr(E|Hj ) Pr(Hj )
Pr(E|Hi )
Pr(Hi )
=
×
Pr(E|Hj ) Pr(Hj )
= “Bayes factor” × “prior beliefs” .
This calculation reminds us that Bayes’ rule does not determine what our
beliefs should be after seeing the data, it only tells us how they should change
after seeing the data.
Example
Suppose we are interested in the rate of support for a particular candidate for
public office. Let
H = { all possible rates of support for candidate A };
H1 = { more than half the voters support candidate A };
H2 = { less than or equal to half the voters support candidate A };
E = { 54 out of 100 people surveyed said they support candidate A }.
Then {H1 , H2 } is a partition of H. Of interest is Pr(H1 |E), or Pr(H1 |E)/ Pr(H2 |E).
We will learn how to obtain these quantities in the next chapter.

2.4 Random variables

17

2.3 Independence
Definition 2 (Independence) Two events F and G are conditionally independent given H if Pr(F ∩ G|H) = Pr(F |H) Pr(G|H).
How do we interpret conditional independence? By Axiom P3, the following
is always true:
Pr(F ∩ G|H) = Pr(G|H) Pr(F |H ∩ G).
If F and G are conditionally independent given H, then we must have
always

independence

Pr(G|H) Pr(F |H ∩ G) = Pr(F ∩ G|H)
=
Pr(F |H) Pr(G|H)
Pr(G|H) Pr(F |H ∩ G)
=
Pr(F |H) Pr(G|H)
Pr(F |H ∩ G)
=
Pr(F |H).
Conditional independence therefore implies that Pr(F |H ∩ G) = Pr(F |H). In
other words, if we know H is true and F and G are conditionally independent
given H, then knowing G does not change our belief about F .
Examples
Let’s consider the conditional dependence of F and G when H is assumed to
be true in the following two situations:
F = { a hospital patient is a smoker }
G = { a hospital patient has lung cancer }
H = { smoking causes lung cancer}
F = { you are thinking of the jack of hearts }
G = { a mind reader claims you are thinking of the jack of hearts }
H = { the mind reader has extrasensory perception }
In both of these situations, H being true implies a relationship between F
and G. What about when H is not true?

2.4 Random variables
In Bayesian inference a random variable is defined as an unknown numerical quantity about which we make probability statements. For example, the
quantitative outcome of a survey, experiment or study is a random variable
before the study is performed. Additionally, a fixed but unknown population
parameter is also a random variable.

18

2 Belief, probability and exchangeability

2.4.1 Discrete random variables
Let Y be a random variable and let Y be the set of all possible values of Y .
We say that Y is discrete if the set of possible outcomes is countable, meaning
that Y can be expressed as Y = {y1 , y2 , . . .}.
Examples
• Y = number of churchgoers in a random sample from a population
• Y = number of children of a randomly sampled person
• Y = number of years of education of a randomly sampled person
Probability distributions and densities
The event that the outcome Y of our survey has the value y is expressed as
{Y = y}. For each y ∈ Y, our shorthand notation for Pr(Y = y) will be p(y).
This function of y is called the probability density function (pdf) of Y , and it
has the following properties:
1. 0P≤ p(y) ≤ 1 for all y ∈ Y;
2.
y∈Y p(y) = 1.
General probability statements
about Y can be derived from the pdf. For
P
example, Pr(Y ∈ A) = y∈A p(y). If A and B are disjoint subsets of Y, then
Pr(Y ∈ A or Y ∈ B) ≡ Pr(Y ∈ A ∪ B) = Pr(Y ∈ A) + Pr(Y ∈ B)
X
X
=
p(y) +
p(y).
y∈A

y∈B

Example: Binomial distribution
Let Y = {0, 1, 2, . . . , n} for some positive integer n. The uncertain quantity
Y ∈ Y has a binomial distribution with probability θ if
 
n y
Pr(Y = y|θ) = dbinom(y, n, θ) =
θ (1 − θ)n−y .
y
For example, if θ = .25 and n = 4, we have:
 
4
Pr(Y = 0|θ = .25) =
(.25)0 (.75)4
0
 
4
Pr(Y = 1|θ = .25) =
(.25)1 (.75)3
1
 
4
Pr(Y = 2|θ = .25) =
(.25)2 (.75)2
2
 
4
Pr(Y = 3|θ = .25) =
(.25)3 (.75)1
3
 
4
Pr(Y = 4|θ = .25) =
(.25)4 (.75)0
4

= .316
= .422
= .211
= .047
= .004 .

2.4 Random variables

19

Example: Poisson distribution
Let Y = {0, 1, 2, . . .}. The uncertain quantity Y ∈ Y has a Poisson distribution
with mean θ if
Pr(Y = y|θ) = dpois(y, θ) = θy e−θ /y!.
For example, if θ = 2.1 (the 2006 U.S. fertility rate),
= 0|θ
= 1|θ
= 2|θ
= 3|θ
..
.

= 2.1) = (2.1)0 e−2.1 /(0!) =
= 2.1) = (2.1)1 e−2.1 /(1!) =
= 2.1) = (2.1)2 e−2.1 /(2!) =
= 2.1) = (2.1)3 e−2.1 /(3!) =
..
.

6

8

.12
.26
.27
.19
..
.

0.00

0.00

0.05

0.02

p(y|θ
θ = 21)
0.04
0.06

p(y|θ
θ = 2.1)
0.10 0.15 0.20

0.08

0.25

Pr(Y
Pr(Y
Pr(Y
Pr(Y

0

2

4

10

y

0

20

40

60

80

100

y

Fig. 2.1. Poisson distributions with means of 2.1 and 21.

2.4.2 Continuous random variables
Suppose that the sample space Y is roughly equal to
PR, the set of all real
numbers. We cannot define Pr(Y ≤ 5) as equal to
y≤5 p(y) because the
sum does not make sense (the set of real numbers less than or equal to 5 is
“uncountable”). So instead of defining probabilities of events in terms of a pdf
p(y), courses in mathematical statistics often define probability distributions
for random variables in terms of something called a cumulative distribution
function, or cdf:
F (y) = Pr(Y ≤ y) .
Note that F (∞) = 1, F (−∞) = 0, and F (b) ≤ F (a) if b < a. Probabilities of
various events can be derived from the cdf:

20

2 Belief, probability and exchangeability

• Pr(Y > a) = 1 − F (a)
• Pr(a < Y ≤ b) = F (b) − F (a)
If F is continuous (i.e. lacking any “jumps”), we say that Y is a continuous
random variable. A theorem from mathematics says that for every continuous
cdf F there exists a positive function p(y) such that
Z a
F (a) =
p(y) dy.
−∞

This function is called the probability density function of Y , and its properties
are similar to those of a pdf for a discrete random variable:
1. 0R ≤ p(y) for all y ∈ Y;
2. y∈R p(y) dy = 1.
As in the discrete case,R probability statements about Y can be derived from
the pdf: Pr(Y ∈ A) = y∈A p(y) dy, and if A and B are disjoint subsets of Y,
then
Pr(Y ∈ A or Y ∈ B) ≡ Pr(Y ∈ A ∪ B) = Pr(Y ∈ A) + Pr(Y ∈ B)
Z
Z
=
p(y) dy +
p(y) dy.
y∈A

y∈B

Comparing these properties to the analogous properties in the discrete case,
we see that integration for continuous distributions behaves similarly to summation for discrete distributions. In fact, integration can be thought of as a
generalization of summation for situations in which the sample space is not
countable. However, unlike a pdf in the discrete case, the pdf for a continuous
random variable is not necessarily less than 1, and p(y) is not “the probability
that Y = y.” However, if p(y1 ) > p(y2 ) we will sometimes informally say that
y1 “has a higher probability” than y2 .
Example: Normal distribution
Suppose we are sampling from a population on Y = (−∞, ∞), and we know
that the mean of the population is µ and the variance is σ 2 . Among all probability distributions having a mean of µ and a variance of σ 2 , the one that is
the most “spread out” or “diffuse” (in terms of a measure called entropy), is
the normal(µ, σ 2 ) distribution, having a cdf given by
(

2 )
Z y
1 y−µ
1
2
√
exp −
dy.
Pr(Y ≤ y|µ, σ ) = F (y) =
2
σ
2πσ
−∞
Evidently,
(

2 )
1
1 y−µ
p(y|µ, σ ) = dnorm(y, µ, σ) = √
exp −
.
2
σ
2πσ
2

2.4 Random variables

21

0.0

0.0

0.2

0.1

F(y)
0.4
0.6

p(y)
0.2
0.3

0.8

0.4

1.0

0.5

Letting µ = 10.75 and σ = .8 (σ 2 = .64) gives the cdf and density in Figure
2.2. This mean and standard deviation make the median value of eY equal
to about 46,630, which is about the median U.S. household income in 2005.
Additionally, Pr(eY > 100000) = Pr(Y > log 100000) = 0.17, which roughly
matches the fraction of households in 2005 with incomes exceeding $100,000.

8

9

10

11
y

12

13

14

8

9

10

11
y

12

13

14

Fig. 2.2. Normal distribution with mean 10.75 and standard deviation 0.8.

2.4.3 Descriptions of distributions
The mean or expectation of an unknown quantity Y is given by
P
E[Y ] = y∈Y yp(y) if Y is discrete;
R
E[Y ] = y∈Y yp(y) dy if Y is continuous.
The mean is the center of mass of the distribution. However, it is not in general
equal to either of
the mode: “the most probable value of Y ,” or
the median: “the value of Y in the middle of the distribution.”
In particular, for skewed distributions (like income distributions) the mean
can be far from a “typical” sample value: see, for example, Figure 2.3. Still,
the mean is a very popular description of the location of a distribution. Some
justifications for reporting and studying the mean include the following:
1. The mean of {Y1 , . . . , Yn } is a scaled version of the total, and the total is
often a quantity of interest.
2. Suppose you are forced to guess what the value of Y is, and you are
penalized by an amount (Y − yguess )2 . Then guessing E[Y ] minimizes your
expected penalty.

22

2 Belief, probability and exchangeability

mode
median
mean

0.0

0.0

0.1

0.5

105p(y)

p(y)
0.2
0.3

1.0

0.4

0.5

1.5

3. In some simple models that we shall see shortly, the sample mean contains
all of the information about the population that can be obtained from the
data.

8

9

10

11
y

12

13

0

50000

150000
y

250000

Fig. 2.3. Mode, median and mean of the normal and lognormal distributions, with
parameters µ = 10.75 and σ = 0.8.

In addition to the location of a distribution we are often interested in how
spread out it is. The most popular measure of spread is the variance of a
distribution:
Var[Y ] = E[(Y − E[Y ])2 ]
= E[Y 2 − 2Y E[Y ] + E[Y ]2 ]
= E[Y 2 ] − 2E[Y ]2 + E[Y ]2
= E[Y 2 ] − E[Y ]2 .
The variance is the average squared distance that a sample value Y will be
from the population mean E[Y ]. The standard deviation is the square root of
the variance, and is on the same scale as Y .
Alternative measures of spread are based on quantiles. For a continuous,
strictly increasing cdf F , the α-quantile is the value yα such that F (yα ) ≡
Pr(Y ≤ yα ) = α. The interquartile range of a distribution is the interval
(y.25 , y.75 ), which contains 50% of the mass of the distribution. Similarly, the
interval (y.025 , y.975 ) contains 95% of the mass of the distribution.

2.5 Joint distributions

23

2.5 Joint distributions
Discrete distributions
Let
• Y1 , Y2 be two countable sample spaces;
• Y1 , Y2 be two random variables, taking values in Y1 , Y2 respectively.
Joint beliefs about Y1 and Y2 can be represented with probabilities. For example, for subsets A ⊂ Y1 and B ⊂ Y2 , Pr({Y1 ∈ A} ∩ {Y2 ∈ B}) represents
our belief that Y1 is in A and that Y2 is in B. The joint pdf or joint density
of Y1 and Y2 is defined as
pY1 Y2 (y1 , y2 ) = Pr({Y1 = y1 } ∩ {Y2 = y2 }), for y1 ∈ Y1 , y2 ∈ Y2 .
The marginal density of Y1 can be computed from the joint density:
pY1 (y1 ) ≡ Pr(Y1 = y1 )
X
=
Pr({Y1 = y1 } ∩ {Y2 = y2 })
y2 ∈Y2

≡

X

pY1 Y2 (y1 , y2 ) .

y2 ∈Y2

The conditional density of Y2 given {Y1 = y1 } can be computed from the joint
density and the marginal density:
Pr({Y1 = y1 } ∩ {Y2 = y2 })
Pr(Y1 = y1 )
pY1 Y2 (y1 , y2 )
=
.
pY1 (y1 )

pY2 |Y1 (y2 |y1 ) =

You should convince yourself that
{pY1 , pY2 |Y1 } can be derived from pY1 Y2 ,
{pY2 , pY1 |Y2 } can be derived from pY1 Y2 ,
pY1 Y2 can be derived from {pY1 , pY2 |Y1 },
pY1 Y2 can be derived from {pY2 , pY1 |Y2 },
but
pY1 Y2 cannot be derived from {pY1 , pY2 }.
The subscripts of density functions are often dropped, in which case the type
of density function is determined from the function argument: p(y1 ) refers to
pY1 (y1 ), p(y1 , y2 ) refers to pY1 Y2 (y1 , y2 ), p(y1 |y2 ) refers to pY1 |Y2 (y1 |y2 ), etc.

24

2 Belief, probability and exchangeability

Example: Social mobility
Logan (1983) reports the following joint distribution of occupational categories
of fathers and sons:
son’s occupation
father’s occupation farm operatives craftsmen sales professional
farm
0.018 0.035
0.031 0.008
0.018
operatives
0.002 0.112
0.064 0.032
0.069
craftsmen
0.001 0.066
0.094 0.032
0.084
sales
0.001 0.018
0.019 0.010
0.051
professional
0.001 0.029
0.032 0.043
0.130
Suppose we are to sample a father-son pair from this population. Let Y1 be
the father’s occupation and Y2 the son’s occupation. Then
Pr(Y2 = professional ∩ Y1 = farm)
Pr(Y1 = farm)
.018
=
.018 + .035 + .031 + .008 + .018
= .164 .

Pr(Y2 = professional|Y1 = farm) =

Continuous joint distributions
If Y1 and Y2 are continuous we start with a cumulative distribution function.
Given a continuous joint cdf FY1 Y2 (a, b) ≡ Pr({Y1 ≤ a} ∩ {Y2 ≤ b}), there is
a function pY1 Y2 such that
Z

a

Z

b

FY1 Y2 (a, b) =

pY1 Y2 (y1 , y2 ) dy2 dy1 .
−∞

−∞

The function pY1 Y2 is the joint density of Y1 and Y2 . As in the discrete case,
we have
R∞
• pY1 (y1 ) = −∞ pY1 Y2 (y2 , y2 ) dy2 ;
• pY2 |Y1 (y2 |y1 ) = pY1 Y2 (y1 , y2 )/pY1 (y1 ) .
You should convince yourself that pY2 |Y1 (y2 |y1 ) is an actual probability density, i.e. for each value of y1 it is a probability density for Y2 .
Mixed continuous and discrete variables
Let Y1 be discrete and Y2 be continuous. For example, Y1 could be occupational category and Y2 could be personal income. Suppose we define
• a marginal density pY1 from our beliefs Pr(Y1 = y1 );
• a conditional density pY2 |Y1 (y2 |y1 ) from Pr(Y2 ≤ y2 |Y1 = y1 ) ≡ FY2 |Y1 (y2 |y1 )
as above.

2.5 Joint distributions

25

The joint density of Y1 and Y2 is then
pY1 Y2 (y1 , y2 ) = pY1 (y1 ) × pY2 |Y1 (y2 |y1 ),
and has the property that
Z
Pr(Y1 ∈ A, Y2 ∈ B) =
y2 ∈B


X


y1 ∈A



pY1 Y2 (y1 , y2 ) dy2 .


Bayes’ rule and parameter estimation
Let
θ = proportion of people in a large population who have a certain characteristic.
Y = number of people in a small random sample from the population who
have the characteristic.
Then we might treat θ as continuous and Y as discrete. Bayesian estimation
of θ derives from the calculation of p(θ|y), where y is the observed value of Y .
This calculation first requires that we have a joint density p(y, θ) representing
our beliefs about θ and the survey outcome Y . Often it is natural to construct
this joint density from
• p(θ), beliefs about θ;
• p(y|θ), beliefs about Y for each value of θ.
Having observed {Y = y}, we need to compute our updated beliefs about θ:
p(θ|y) = p(θ, y)/p(y) = p(θ)p(y|θ)/p(y) .
This conditional density is called the posterior density of θ. Suppose θa and
θb are two possible numerical values of the true value of θ. The posterior
probability (density) of θa relative to θb , conditional on Y = y, is
p(θa |y)
p(θa )p(y|θa )/p(y)
=
p(θb |y)
p(θb )p(y|θb )/p(y)
p(θa )p(y|θa )
=
.
p(θb )p(y|θb )
This means that to evaluate the relative posterior probabilities of θa and θb ,
we do not need to compute p(y). Another way to think about it is that, as a
function of θ,
p(θ|y) ∝ p(θ)p(y|θ).
The constant of proportionality is 1/p(y), which could be computed from
Z
Z
p(y) =
p(y, θ) dθ =
p(y|θ)p(θ) dθ
Θ

Θ

26

2 Belief, probability and exchangeability

giving
p(θ|y) = R

p(θ)p(y|θ)
.
p(θ)p(y|θ) dθ
θ

As we will see in later chapters, the numerator is the critical part.

2.6 Independent random variables
Suppose Y1 , . . . , Yn are random variables and that θ is a parameter describing
the conditions under which the random variables are generated. We say that
Y1 , . . . , Yn are conditionally independent given θ if for every collection of n
sets {A1 , . . . , An } we have
Pr(Y1 ∈ A1 , . . . , Yn ∈ An |θ) = Pr(Y1 ∈ A1 |θ) × · · · × Pr(Yn ∈ An |θ).
Notice that this definition of independent random variables is based on our
previous definition of independent events, where here each {Yj ∈ Aj } is an
event. From our previous calculations, if independence holds, then
Pr(Yi ∈ Ai |θ, Yj ∈ Aj ) = Pr(Yi ∈ Ai |θ),
so conditional independence can be interpreted as meaning that Yj gives no
additional information about Yi beyond that in knowing θ. Furthermore, under
independence the joint density is given by
p(y1 , . . . , yn |θ) = pY1 (y1 |θ) × · · · × pYn (yn |θ) =

n
Y

pYi (yi |θ),

i=1

the product of the marginal densities.
Suppose Y1 , . . . , Yn are generated in similar ways from a common process.
For example, they could all be samples from the same population, or runs
of an experiment performed under similar conditions. This suggests that the
marginal densities are all equal to some common density giving
p(y1 , . . . , yn |θ) =

n
Y

p(yi |θ).

i=1

In this case, we say that Y1 , . . . , Yn are conditionally independent and identically distributed (i.i.d.). Mathematical shorthand for this is
Y1 , . . . , Yn |θ ∼ i.i.d. p(y|θ).

2.7 Exchangeability

27

2.7 Exchangeability
Example: Happiness
Participants in the 1998 General Social Survey were asked whether or not
they were generally happy. Let Yi be the random variable associated with this
question, so that

1 if participant i says that they are generally happy,
Yi =
0 otherwise.
In this section we will consider the structure of our joint beliefs about
Y1 , . . . , Y10 , the outcomes of the first 10 randomly selected survey participants. As before, let p(y1 , . . . , y10 ) be our shorthand notation for Pr(Y1 =
y1 , . . . , Y10 = y10 ), where each yi is either 0 or 1.
Exchangeability
Suppose we are asked to assign probabilities to three different outcomes:
p(1, 0, 0, 1, 0, 1, 1, 0, 1, 1) = ?
p(1, 0, 1, 0, 1, 1, 0, 1, 1, 0) = ?
p(1, 1, 0, 0, 1, 1, 0, 0, 1, 1) = ?
Is there an argument for assigning them the same numerical value? Notice
that each sequence contains six ones and four zeros.
Definition 3 (Exchangeable) Let p(y1 , . . . , yn ) be the joint density of Y1 ,
. . ., Yn . If p(y1 , . . . , yn ) = p(yπ1 , . . . , yπn ) for all permutations π of {1, . . . , n},
then Y1 , . . . , Yn are exchangeable.
Roughly speaking, Y1 , . . . , Yn are exchangeable if the subscript labels convey
no information about the outcomes.
Independence versus dependence
Consider the following two probability assignments:
Pr(Y10 = 1) = a
Pr(Y10 = 1|Y1 = Y2 = · · · = Y8 = Y9 = 1) = b
Should we have a < b, a = b, or a > b? If a 6= b then Y10 is NOT independent
of Y1 , . . . , Y9 .

28

2 Belief, probability and exchangeability

Conditional independence
Suppose someone told you the numerical value of θ, the rate of happiness
among the 1,272 respondents to the question. Do the following probability
assignments seem reasonable?
?

Pr(Y10 = 1|θ) ≈ θ
?

Pr(Y10 = 1|Y1 = y1 , . . . , Y9 = y9 , θ) ≈ θ
?

Pr(Y9 = 1|Y1 = y1 , . . . , Y8 = y8 , Y10 = y10 , θ) ≈ θ
If these assignments are reasonable, then we can consider the Yi ’s as conditionally independent and identically distributed given θ, or at least approximately
so: The population size of 1,272 is much larger than the sample size of 10, in
which case sampling without replacement is approximately the same as i.i.d.
sampling with replacement. Assuming conditional independence,
Pr(Yi = yi |θ, Yj = yj , j 6= i) = θyi (1 − θ)1−yi
Pr(Y1 = y1 , . . . , Y10 = y10 |θ) =

10
Y
i=1
P

=θ

θyi (1 − θ)1−yi
yi

P

(1 − θ)10−

yi

.

If θ is uncertain to us, we describe our beliefs about it with p(θ), a prior
distribution. The marginal joint distribution of Y1 , . . . , Y10 is then
Z 1
Z 1 P
P
p(y1 , . . . , y10 ) =
p(y1 , . . . , y10 |θ)p(θ) dθ =
θ yi (1 − θ)10− yi p(θ) dθ.
0

0

Now consider our probabilities for the three binary sequences given above:
R
p(1, 0, 0, 1, 0, 1, 1, 0, 1, 1) = R θ6 (1 − θ)4 p(θ) dθ
p(1, 0, 1, 0, 1, 1, 0, 1, 1, 0) = R θ6 (1 − θ)4 p(θ) dθ
p(1, 1, 0, 0, 1, 1, 0, 0, 1, 1) = θ6 (1 − θ)4 p(θ) dθ
It looks like Y1 , . . . , Yn are exchangeable under this model of beliefs.
Claim:
If θ ∼ p(θ) and Y1 , . . . , Yn are conditionally i.i.d. given θ, then marginally
(unconditionally on θ), Y1 , . . . , Yn are exchangeable.
Proof:
Suppose Y1 , . . . , Yn are conditionally i.i.d. given some unknown parameter θ.
Then for any permutation π of {1, . . . , n} and any set of values (y1 , . . . , yn ) ∈
Y n,

2.8 de Finetti’s theorem

29

Z
p(y1 , . . . , yn |θ)p(θ) dθ
)
Z (Y
n
=
p(yi |θ) p(θ) dθ

p(y1 , . . . , yn ) =

Z
=

i=1
( n
Y

(definition of marginal probability)
(Yi ’s are conditionally i.i.d.)

)
p(yπi |θ) p(θ) dθ

(product does not depend on order)

i=1

= p(yπ1 , . . . yπn )

(definition of marginal probability) .

2.8 de Finetti’s theorem
We have seen that
Y1 , . . . , Yn |θ i.i.d
θ ∼ p(θ)


⇒ Y1 , . . . , Yn are exchangeable.

What about an arrow in the other direction? Let {Y1 , Y2 , . . .} be a potentially
infinite sequence of random variables all having a common sample space Y.
Theorem 1 (de Finetti) Let Yi ∈ Y for all i ∈ {1, 2, . . .}. Suppose that, for
any n, our belief model for Y1 , . . . , Yn is exchangeable:
p(y1 , . . . , yn ) = p(yπ1 , . . . , yπn )
for all permutations π of {1, . . . , n}. Then our model can be written as
)
Z (Y
n
p(y1 , . . . , yn ) =
p(yi |θ) p(θ) dθ
1

for some parameter θ, some prior distribution on θ and some sampling model
p(y|θ). The prior and sampling model depend on the form of the belief model
p(y1 , . . . , yn ).
The probability distribution p(θ) represents our beliefs about the outcomes of
{Y1 , Y2 , . . .}, induced by our belief model p(y1 , y2 , . . .). More precisely,
P
p(θ) represents our beliefs about limn→∞ PYi /n in the binary case;
p(θ) represents our beliefs about limn→∞ (Yi ≤ c)/n for each c in the
general case.
The main ideas of this and the previous section can be summarized as follows:

Y1 , . . . , Yn |θ are i.i.d.
⇔ Y1 , . . . , Yn are exchangeable for all n .
θ ∼ p(θ)
When is the condition “Y1 , . . . , Yn are exchangeable for all n” reasonable?
For this condition to hold, we must have exchangeability and repeatability.
Exchangeability will hold if the labels convey no information. Situations in
which repeatability is reasonable include the following:

30

2 Belief, probability and exchangeability

Y1 , . . . , Yn are outcomes of a repeatable experiment;
Y1 , . . . , Yn are sampled from a finite population with replacement;
Y1 , . . . , Yn are sampled from an infinite population without replacement.
If Y1 , . . . , Yn are exchangeable and sampled from a finite population of size
N >> n without replacement, then they can be modeled as approximately
being conditionally i.i.d. (Diaconis and Freedman, 1980).

2.9 Discussion and further references
The notion of subjective probability in terms of a coherent gambling strategy
was developed by de Finetti, who is of course also responsible for de Finetti’s
theorem (de Finetti, 1931, 1937). Both of these topics were studied further by
many others, including Savage (Savage, 1954; Hewitt and Savage, 1955).
The concept of exchangeability goes beyond just the concept of an infinitely exchangeable sequence considered in de Finetti’s theorem. Diaconis
and Freedman (1980) consider exchangeability for finite populations or sequences, and Diaconis (1988) surveys some other versions of exchangeability.
Chapter 4 of Bernardo and Smith (1994) provides a guide to building statistical models based on various types of exchangeability. A very comprehensive
and mathematical review of exchangeability is given in Aldous (1985), which
in particular provides an excellent survey of exchangeability as applied to
random matrices.

3
One-parameter models

A one-parameter model is a class of sampling distributions that is indexed
by a single unknown parameter. In this chapter we discuss Bayesian inference
for two one-parameter models: the binomial model and the Poisson model. In
addition to being useful statistical tools, these models also provide a simple
environment within which we can learn the basics of Bayesian data analysis,
including conjugate prior distributions, predictive distributions and confidence
regions.

3.1 The binomial model
Happiness data
Each female of age 65 or over in the 1998 General Social Survey was asked
whether or not they were generally happy. Let Yi = 1 if respondent i reported
being generally happy, and let Yi = 0 otherwise. If we lack information distinguishing these n = 129 individuals we may treat their responses as being
exchangeable. Since 129 is much smaller than the total size N of the female
senior citizen population, the results of the last chapter indicate that our joint
beliefs about Y1 , . . . , Y129 are well approximated by
PN
• our beliefs about θ = i=1 Yi /N ;
• the model that, conditional on θ, the Yi ’s are i.i.d. binary random variables
with expectation θ.
The last item says that the probability for any potential outcome {y1 , . . . , y129 },
conditional on θ, is given by
p(y1 , . . . , y129 |θ) = θ

P129

i=1

yi

P129

(1 − θ)129−

i=1

What remains to be specified is our prior distribution.

P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 3,
c Springer Science+Business Media, LLC 2009


yi

.

32

3 One-parameter models

A uniform prior distribution
The parameter θ is some unknown number between 0 and 1. Suppose our
prior information is such that all subintervals of [0, 1] having the same length
also have the same probability. Symbolically,
Pr(a ≤ θ ≤ b) = Pr(a + c ≤ θ ≤ b + c) for 0 ≤ a < b < b + c ≤ 1.
This condition implies that our density for θ must be the uniform density:
p(θ) = 1 for all θ ∈ [0, 1].
For this prior distribution and the above sampling model, Bayes’ rule gives
p(θ|y1 , . . . , y129 ) =

p(y1 , . . . , y129 |θ)p(θ)
p(y1 , . . . , y129 )

= p(y1 , . . . , y129 |θ) ×

1
p(y1 , . . . , y129 )

∝ p(y1 , . . . , y129 |θ) .
The last line says that in this particular case p(θ|y1 , . . . , y129 ) and p(y1 , . . .,
y129 |θ) are proportional to each other as functions of θ. This is because the
posterior distribution is equal to p(y1 , . . . , y129 |θ) divided by something that
does not depend on θ. This means that these two functions of θ have the same
shape, but not necessarily the same scale.
Data and posterior distribution
• 129 individuals surveyed;
• 118 individuals report being generally happy (91%);
• 11 individuals do not report being generally happy (9%).
The probability of these data for a given value of θ is
p(y1 , . . . , y129 |θ) = θ118 (1 − θ)11 .
A plot of this probability as a function of θ is shown in the first plot of Figure
3.1. Our result above about proportionality says that the posterior distribution
p(θ|y1 , . . . , y129 ) will have the same shape as this function, and so we know
that the true value of θ is very likely to be near 0.91, and almost certainly
above 0.80. However, we will often want to be more precise than this, and
we will need to know the scale of p(θ|y1 , . . . , yn ) as well as the shape. From
Bayes’ rule, we have
p(θ|y1 , . . . , y129 ) = θ118 (1 − θ)11 × p(θ)/p(y1 , . . . , y129 )
= θ118 (1 − θ)11 × 1/p(y1 , . . . , y129 ).

33

1027p(y 1,...,y 129|θ
θ)
0 1 2 3 4

3.1 The binomial model

0.0

0.2

0.4

0.6

0.8

1.0

0.6

0.8

1.0

p(θ
θ|y 1,...,y 129)
0
5
10 15

θ

0.0

0.2

0.4
θ

Fig. 3.1. Sampling probability of the data as a function of θ, along with the
posterior distribution. Note that a uniform prior distribution (plotted in gray in
the second panel) gives a posterior distribution that is proportional to the sampling
probability.

It turns out that we can calculate the scale or “normalizing constant”
1/p(y1 , . . . , y129 ) using the following result from calculus:
Z
0

1

θa−1 (1 − θ)b−1 dθ =

Γ (a)Γ (b)
.
Γ (a + b)

(the value of the gamma function Γ (x) for any number x > 0 can be looked
up in a table, or with R using the gamma() function). How does the calculus
result help us compute p(θ|y1 , . . . , y129 )? Let’s recall what we know about
p(θ|y1 , . . . , y129 ):
R1
(a) 0 p(θ|y1 , . . . , y129 ) dθ = 1, since all probability distributions integrate or
sum to 1;
(b) p(θ|y1 , . . . , y129 ) = θ118 (1 − θ)11 /p(y1 , . . . , y129 ), from Bayes’ rule.
Therefore,

34

3 One-parameter models

Z

1

1=

p(θ|y1 , . . . , y129 ) dθ

using (a)

θ118 (1 − θ)11 /p(y1 , . . . , y129 ) dθ

using (b)

0

Z
1=

1

0

Z 1
1
θ118 (1 − θ)11 dθ
p(y1 , . . . , y129 ) 0
1
Γ (119)Γ (12)
1=
using the calculus result, and so
p(y1 , . . . , y129 )
Γ (131)
1=

p(y1 , . . . , y129 ) =

Γ (119)Γ (12)
.
Γ (131)

You should convince yourself that this result holds for any sequence {y1 , . . . , y129 }
that contains 118 ones and 11 zeros. Putting everything together, we have
Γ (131)
θ118 (1 − θ)11 , which we will write as
Γ (119)Γ (12)
Γ (131)
=
θ119−1 (1 − θ)12−1 .
Γ (119)Γ (12)

p(θ|y1 , . . . , y129 ) =

This density for θ is called a beta distribution with parameters a = 119 and
b = 12, which can be calculated, plotted and sampled from in R using the
functions dbeta() and rbeta() .
The beta distribution
An uncertain quantity θ, known to be between 0 and 1, has a beta(a, b) distribution if
p(θ) = dbeta(θ, a, b) =

Γ (a + b) a−1
θ
(1 − θ)b−1
Γ (a)Γ (b)

for 0 ≤ θ ≤ 1.

For such a random variable,
mode[θ] = (a − 1)/[(a − 1) + (b − 1)] if a > 1 and b > 1;
E[θ] = a/(a + b);
Var[θ] = ab/[(a + b + 1)(a + b)2 ] = E[θ] × E[1 − θ]/(a + b + 1).
For our data on happiness in which we observed (Y1 , . . . , Y129 ) = (y1 , . . . , y129 )
P129
with i=1 yi = 118,
mode[θ|y1 , . . . , y129 ] = 0.915;
E[θ|y1 , . . . , y129 ] = 0.908;
sd[θ|y1 , . . . , y129 ] = 0.025.

3.1 The binomial model

35

3.1.1 Inference for exchangeable binary data
Posterior inference under a uniform prior
If Y1 , . . . , Yn |θ are i.i.d. binary(θ), we showed that
p(θ|y1 , . . . , yn ) = θ

P

yi

P

(1 − θ)n−

yi

× p(θ)/p(y1 , . . . , yn ).

If we compare the relative probabilities of any two θ-values, say θa and θb , we
see that
P

y

P

p(θa |y1 , . . . , yn )
θa i (1 − θa )n− yi × p(θa )/p(y1 , . . . , yn )
= Py
P
p(θb |y1 , . . . , yn )
θb i (1 − θb )n− yi × p(θb )/p(y1 , . . . , yn )
 P y i 
n−P yi
θa
1 − θa
p(θa )
=
.
θb
1 − θb
p(θb )
This shows that the probability
Pn density at θa relative to that at θb depends
on y1 , . . . , yn only through i=1 yi . From this, you can show that
!
n
n
X
X
Pr(θ ∈ A|Y1 = y1 , . . . , Yn = yn ) = Pr θ ∈ A|
Yi =
yi .
i=1

i=1

Pn

We interpret this as meaning that i=1 Yi P
contains all the information about
n
θ available from the data, and we say that i=1 Yi is a sufficient statistic for
θ and P
p(y1 , . . . , yn |θ). The word “sufficient” is used because it is “sufficient” to
know
Yi in order to make inference about θ. In this case where P
Y1 , . . . , Yn |θ
n
are i.i.d. binary(θ) random variables, the sufficient statistic Y = i=1 Yi has
a binomial distribution with parameters (n, θ).
The binomial distribution
A random variable Y ∈ {0, 1, . . . , n} has a binomial(n, θ) distribution if
 
n y
Pr(Y = y|θ) = dbinom(y, n, θ) =
θ (1 − θ)n−y , y ∈ {0, 1, . . . , n}.
y
Binomial distributions with different values of n and θ are plotted in Figures
3.2 and 3.3. For a binomial(n, θ) random variable,
E[Y |θ] = nθ;
Var[Y |θ] = nθ(1 − θ).

Pr(Y=y|θ
θ = 0.8, n=10)
0.10
0.20
0.00

0.00

Pr(Y=y|θ
θ = 0.2, n=10)
0.10
0.20

0.30

3 One-parameter models
0.30

36

0

2

4

6

8

10

0

2

4

y

6

8

10

80

100

y

0.10
Pr(Y=y|θ
θ = 0.8, n=100)
0.02 0.04 0.06 0.08
0.00

0.00

Pr(Y=y|θ
θ = 0.2, n=100)
0.02 0.04 0.06 0.08

0.10

Fig. 3.2. Binomial distributions with n = 10 and θ ∈ {0.2, 0.8}.

0

20

40

60

80

100

0

20

y

40

60
y

Fig. 3.3. Binomial distributions with n = 100 and θ ∈ {0.2, 0.8}.

Posterior inference under a uniform prior distribution
Having observed Y = y our task is to obtain the posterior distribution of θ:
p(θ|y) =
=

p(y|θ)p(θ)
p(y)

n y
n−y
p(θ)
y θ (1 − θ)

p(y)
= c(y)θ (1 − θ)n−y p(θ)
y

3.1 The binomial model

37

where c(y) is a function of y and not of θ. For the uniform distribution with
p(θ) = 1, we can find out what c(y) is using our calculus trick:
Z 1
1=
c(y)θy (1 − θ)n−y dθ
0

Z
1 = c(y)

1

θy (1 − θ)n−y dθ

0

1 = c(y)

Γ (y + 1)Γ (n − y + 1)
.
Γ (n + 2)

The normalizing constant c(y) is therefore equal to Γ (n + 2)/{Γ (y + 1)Γ (n −
y + 1)}, and we have
Γ (n + 2)
θy (1 − θ)n−y
Γ (y + 1)Γ (n − y + 1)
Γ (n + 2)
=
θ(y+1)−1 (1 − θ)(n−y+1)−1
Γ (y + 1)Γ (n − y + 1)
= beta(y + 1, n − y + 1).
P
Recall the happiness example, where we observed that Y ≡ Yi = 118:
X
n = 129, Y ≡
Yi = 118 ⇒ θ|{Y = 118} ∼ beta(119, 12).
p(θ|y) =

This confirms the
P sufficiency result for this model and prior distribution, by
showing that if
yi = y = 118,
p(θ|y1 , . . . , yn ) = p(θ|y) = beta(119, 12).
In other words, the information contained in {Y1 = y1 , . P
. . , Yn = yn } is
Pthe
same as the information contained in {Y = y}, where Y = Yi and y = yi .
Posterior distributions under beta prior distributions
The uniform prior distribution has p(θ) = 1 for all θ ∈ [0, 1]. This distribution
can be thought of as a beta prior distribution with parameters a = 1, b = 1:
p(θ) =

Γ (2)
1
θ1−1 (1 − θ)1−1 =
1 × 1 = 1.
Γ (1)Γ (1)
1×1

Note that Γ (x + 1) = x! = x × (x − 1) · · · × 1 if x is a positive integer, and
Γ (1) = 1 by convention. In the previous paragraph, we saw that


θ ∼ beta(1, 1) (uniform)
if
, then {θ|Y = y} ∼ beta(1 + y, 1 + n − y),
Y ∼ binomial(n, θ)
and so to get the posterior distribution when our prior distribution is beta(a =
1, b = 1), we can simply add the number of 1’s to the a parameter and the

38

3 One-parameter models

number of 0’s to the b parameter. Does this result hold for arbitrary beta priors? Let’s find out: Suppose θ ∼ beta(a, b) and Y |θ ∼ binomial(n, θ). Having
observed Y = y,
p(θ)p(y|θ)
p(y)
 
1
Γ (a + b) a−1
n y
=
×
θ
(1 − θ)b−1 ×
θ (1 − θ)n−y
p(y) Γ (a)Γ (b)
y

p(θ|y) =

= c(n, y, a, b) × θa+y−1 (1 − θ)b+n−y−1
= dbeta(θ, a + y, b + n − y) .
It is important to understand the last two lines above: The second to last line
says that p(θ|y) is, as a function of θ, proportional to θa+y−1 ×(1−θ)b+n−y−1 .
This means that it has the same shape as the beta density dbeta(θ, a+y, b+n−
y). But we also know that p(θ|y) and the beta density must both integrate to 1,
and therefore they also share the same scale. These two things together mean
that p(θ|y) and the beta density are in fact the same function. Throughout the
book we will use this trick to identify posterior distributions: We will recognize
that the posterior distribution is proportional to a known probability density,
and therefore must equal that density.
Conjugacy
We have shown that a beta prior distribution and a binomial sampling model
lead to a beta posterior distribution. To reflect this, we say that the class of
beta priors is conjugate for the binomial sampling model.
Definition 4 (Conjugate) A class P of prior distributions for θ is called
conjugate for a sampling model p(y|θ) if
p(θ) ∈ P ⇒ p(θ|y) ∈ P.
Conjugate priors make posterior calculations easy, but might not actually
represent our prior information. However, mixtures of conjugate prior distributions are very flexible and are computationally tractable (see Exercises 3.4
and 3.5).
Combining information
If θ|{Y = y} ∼ beta(a + y, b + n − y), then
E[θ|y] =

a+y
a+y−1
E[θ|y]E[1 − θ|y]
, mode[θ|y] =
, Var[θ|y] =
.
a+b+n
a+b+n−2
a+b+n+1

The posterior expectation E[θ|y] is easily recognized as a combination of prior
and data information:

3.1 The binomial model
beta(1,1) prior, n=5

∑ y i =1

beta(3,2) prior, n=5

p( θ|y)
1.0

2.0

∑ y i =1

0.0

0.0

p( θ|y)
1.0

2.0

prior
posterior

39

0.2

0.4

0.6
θ

1.0

0.0

0.2

0.4

0.6
θ

∑ y i =20

beta(3,2) prior, n=100

0.8

1.0

∑ y i =20

0

0

2

2

p(θ
θ|y)
4 6

p(θ
θ|y)
4
6

8

8

10

beta(1,1) prior, n=100

0.8

10

0.0

0.0

0.2

0.4

0.6

0.8

θ

1.0

0.0

0.2

0.4

0.6

0.8

1.0

θ

Fig. 3.4. Beta posterior distributions under two different sample sizes and two different prior distributions. Look across a row to see the effect of the prior distribution,
and down a column to see the effect of the sample size.

a+y
a+b+n
a+b
a
n
y
=
+
a+b+na+b a+b+nn
a+b
n
=
× prior expectation +
× data average .
a+b+n
a+b+n

E[θ|y] =

For this model and prior distribution, the posterior expectation (also known
as the posterior mean) is a weighted average of the prior expectation and the
sample average, with weights proportional to a + b and n respectively. This
leads to the interpretation of a and b as “prior data”:
a ≈ “prior number of 1’s,”
b ≈ “prior number of 0’s,”
a + b ≈ “prior sample size.”
If our sample size n is larger than our prior sample size a + b, then it seems
reasonable that a majority of our information about θ should be coming from
the data as opposed to the prior distribution. This is indeed the case: For
example, if n >> a + b, then
a+b
y
1y
y
≈ 0 , E[θ|y] ≈ , Var[θ|y] ≈
1−
.
a+b+n
n
nn
n

40

3 One-parameter models

Prediction
An important feature of Bayesian inference is the existence of a predictive
distribution for new observations. Reverting for the moment to our notation
for binary data, let y1 , . . . , yn be the outcomes from a sample of n binary
random variables, and let Y˜ ∈ {0, 1} be an additional outcome from the same
population that has yet to be observed. The predictive distribution of Y˜ is the
conditional distribution of Y˜ given {Y1 = y1 , . . . , Yn = yn }. For conditionally
i.i.d. binary variables this distribution can be derived from the distribution of
Y˜ given θ and the posterior distribution of θ:
Z
˜
Pr(Y = 1|y1 , . . . , yn ) = Pr(Y˜ = 1, θ|y1 , . . . , yn ) dθ
Z
= Pr(Y˜ = 1|θ, y1 , . . . , yn )p(θ|y1 , . . . , yn ) dθ
Z
= θp(θ|y1 , . . . , yn ) dθ
Pn
a + i=1 yi
= E[θ|y1 , . . . , yn ] =
a+b+n
Pn
b + i=1 (1 − yi )
Pr(Y˜ = 0|y1 , . . . , yn ) = 1 − E[θ|y1 , . . . , yn ] =
.
a+b+n
You should notice two important things about the predictive distribution:
1. The predictive distribution does not depend on any unknown quantities.
If it did, we would not be able to use it to make predictions.
2. The predictive distribution depends on our observed data. In this distribution, Y˜ is not independent of Y1 , . . . , Yn (recall Section 2.7). This
is because observing Y1 , . . . , Yn gives information about θ, which in turn
gives information about Y˜ . It would be bad if Y˜ were independent of
Y1 , . . . , Yn - it would mean that we could never infer anything about the
unsampled population from the sample cases.
Example
The uniform prior distribution, or beta(1,1) prior, can be thought of as equivalent to the information in a prior dataset consisting of a single “1” and a
single “0”. Under this prior distribution,
Pr(Y˜ = 1|Y = y) = E[θ|Y = y] =
mode(θ|Y = y) =

2 1
n y
+
,
2+n2 2+nn

y
,
n

Pn
where Y = i=1 Yi . Does the discrepancy between these two posterior summaries of our information make sense? Consider the case in which Y = 0, for
which mode(θ|Y = 0) = 0 but Pr(Y˜ = 1|Y = 0) = 1/(2 + n).

3.1 The binomial model

41

3.1.2 Confidence regions
It is often desirable to identify regions of the parameter space that are likely
to contain the true value of the parameter. To do this, after observing the
data Y = y we can construct an interval [l(y), u(y)] such that the probability
that l(y) < θ < u(y) is large.
Definition 5 (Bayesian coverage) An interval [l(y), u(y)], based on the
observed data Y = y, has 95% Bayesian coverage for θ if
Pr(l(y) < θ < u(y)|Y = y) = .95.
The interpretation of this interval is that it describes your information about
the location of the true value of θ after you have observed Y = y. This is
different from the frequentist interpretation of coverage probability, which
describes the probability that the interval will cover the true value before the
data are observed:
Definition 6 (frequentist coverage) A random interval [l(Y ), u(Y )] has
95% frequentist coverage for θ if, before the data are gathered,
Pr(l(Y ) < θ < u(Y )|θ) = .95.
In a sense, the frequentist and Bayesian notions of coverage describe pre- and
post-experimental coverage, respectively.
You may recall your introductory statistics instructor belaboring the following point: Once you observe Y = y and you plug this data into your
confidence interval formula [l(y), u(y)], then

0 if θ 6∈ [l(y), u(y)];
Pr(l(y) < θ < u(y)|θ) =
1 if θ ∈ [l(y), u(y)].
This highlights the lack of a post-experimental interpretation of frequentist
coverage. Although this may make the frequentist interpretation seem somewhat lacking, it is still useful in many situations. Suppose you are running a
large number of unrelated experiments and are creating a confidence interval
for each one of them. If your intervals each have 95% frequentist coverage
probability, you can expect that 95% of your intervals contain the correct
parameter value.
Can a confidence interval have the same Bayesian and frequentist coverage
probability? Hartigan (1966) showed that, for the types of intervals we will
construct in this book, an interval that has 95% Bayesian coverage additionally
has the property that
Pr(l(Y ) < θ < u(Y )|θ) = .95 + n
where |n | < na for some constant a. This means that a confidence interval
procedure that gives 95% Bayesian coverage will have approximately 95% frequentist coverage as well, at least asymptotically. It is important to keep in

42

3 One-parameter models

mind that most non-Bayesian methods of constructing 95% confidence intervals also only achieve this coverage rate asymptotically. For more discussion of
the similarities between intervals constructed by Bayesian and non-Bayesian
methods, see Severini (1991) and Sweeting (2001).
Quantile-based interval
Perhaps the easiest way to obtain a confidence interval is to use posterior
quantiles. To make a 100 × (1 − α)% quantile-based confidence interval, find
numbers θα/2 < θ1−α/2 such that
1. Pr(θ < θα |Y = y) = α/2;
2. Pr(θ > θ1−α/2 |Y = y) = α/2.
The numbers θα/2 , θ1−α/2 are the α/2 and 1 − α/2 posterior quantiles of θ,
and so
Pr(θ ∈ [θα/2 , θ1−α/2 ]|Y = y) = 1 − Pr(θ 6∈ [θα/2 , θ1−α/2 ]|Y = y)
= 1 − [Pr(θ < θα/2 |Y = y) + Pr(θ > θ1−α/2 |Y = y)]
= 1 − α.
Example: Binomial sampling and uniform prior
Suppose out of n = 10 conditionally independent draws of a binary random
variable we observe Y = 2 ones. Using a uniform prior distribution for θ,
the posterior distribution is θ|{Y = 2} ∼ beta(1 + 2, 1 + 8). A 95% posterior
confidence interval can be obtained from the .025 and .975 quantiles of this
beta distribution. These quantiles are 0.06 and 0.52 respectively, and so the
posterior probability that θ ∈ [0.06, 0.52] is 95%.
> a<−1 ; b<−1
> n<−10 ; y<−2

#p r i o r
#data

> q b e t a ( c ( . 0 2 5 , . 9 7 5 ) , a+y , b+n−y )
[ 1 ] 0.06021773 0.51775585

Highest posterior density (HPD) region
Figure 3.5 shows the posterior distribution and a 95% confidence interval for θ
from the previous example. Notice that there are θ-values outside the quantilebased interval that have higher probability (density) than some points inside
the interval. This suggests a more restrictive type of interval:
Definition 7 (HPD region) A 100 × (1 − α)% HPD region consists of a
subset of the parameter space, s(y) ⊂ Θ such that
1. Pr(θ ∈ s(y)|Y = y) = 1 − α ;

43

0.0

0.5

1.0

p( θ|y)
1.5 2.0

2.5

3.0

3.2 The Poisson model

0.0

0.2

0.4

0.6

0.8

1.0

θ

Fig. 3.5. A beta posterior distribution, with vertical bars indicating a 95% quantilebased confidence interval.

2. If θa ∈ s(y), and θb 6∈ s(y), then p(θa |Y = y) > p(θb |Y = y).
All points in an HPD region have a higher posterior density than points outside the region. However, an HPD region might not be an interval if the
posterior density is multimodal (having multiple peaks). Figure 3.6 gives the
basic idea behind the construction of an HPD region: Gradually move a horizontal line down across the density, including in the HPD region all θ-values
having a density above the horizontal line. Stop moving the line down when
the posterior probability of the θ-values in the region reaches (1 − α). For the
binomial example above, the 95% HPD region is [0.04, 0.048], which is narrower (more precise) than the quantile-based interval, yet both contain 95%
of the posterior probability.

3.2 The Poisson model
Some measurements, such as a person’s number of children or number of
friends, have values that are whole numbers. In these cases our sample space
is Y = {0, 1, 2, . . .}. Perhaps the simplest probability model on Y is the Poisson
model.
Poisson distribution
Recall from Chapter 2 that a random variable Y has a Poisson distribution
with mean θ if
Pr(Y = y|θ) = dpois(y, θ) = θy e−θ /y! for y ∈ {0, 1, 2, . . .} .
For such a random variable,

3 One-parameter models

2.5

3.0

44

0.0

0.5

1.0

p( θ|y)
1.5 2.0

50% HPD
75% HPD
95% HPD
95% quantile−based

0.0

0.2

0.4

0.6

0.8

1.0

θ

Fig. 3.6. Highest posterior density regions of varying probability content. The
dashed line is the 95% quantile-based interval.

• E[Y |θ] = θ;
• Var[Y |θ] = θ.

Pr(∑ Y i = y|θ
θ = 1.83)
0.02 0.04 0.06 0.08

0.30

People sometimes say that the Poisson family of distributions has a “meanvariance relationship” because if one Poisson distribution has a larger mean
than another, it will have a larger variance as well.

0.00

0.00

Pr(Y i = y i )
0.10
0.20

Poisson model
empirical distribution

0

2
4
6
number of children

8

0

10

20
30
40
number of children

50

Fig. 3.7. Poisson distributions. The first panel shows a Poisson distribution with
mean of 1.83, along with the empirical distribution of the number of children of
women of age 40 from the GSS during the 1990s. The second panel shows the
distribution of the sum of 10 i.i.d. Poisson random variables with mean 1.83. This
is the same as a Poisson distribution with mean 18.3

3.2 The Poisson model

45

3.2.1 Posterior inference
If we model Y1 , . . . , Yn as i.i.d. Poisson with mean θ, then the joint pdf of our
sample data is as follows:
Pr(Y1 = y1 , . . . , Yn = yn |θ) =
=

n
Y

p(yi |θ)

i=1
n
Y

1 yi −θ
θ e
y!
i=1 i

= c(y1 , . . . , yn )θ

P

yi −nθ

e

.

Comparing two values of θ a posteriori, we have
P

y

p(θa |y1 , . . . , yn )
c(y1 , . . . , yn ) e−nθa θa i p(θa )
P
=
p(θb |y1 , . . . , yn )
c(y1 , . . . , yn ) e−nθb θ yi p(θb )
b
P

y

e−nθa θa i p(θa )
= −nθ P y
.
e b θ i p(θb )
b
Pn
As in the case of the i.i.d. binary model, i=1 Yi contains all theP
information
n
about θ that is available in the data,
and
again
we
say
that
i=1 Yi is a
Pn
sufficient statistic. Furthermore, { i=1 Yi |θ} ∼ Poisson(nθ).
Conjugate prior
For now we will work with a class of conjugate prior distributions that will
make posterior calculations simple. Recall that a class of prior densities is
conjugate for a sampling model p(y1 , . . . , yn |θ) if the posterior distribution is
also in the class. For the Poisson sampling model, our posterior distribution
for θ has the following form:
p(θ|y1 , . . . , yn ) ∝ p(θ) × p(y1 , . . . , yn |θ)
P
∝ p(θ) × θ yi e−nθ .
This means that whatever our conjugate class of densities is, it will have
to include terms like θc1 e−c2 θ for numbers c1 and c2 . The simplest class of
such densities includes only these terms, and their corresponding probability
distributions are known as the family of gamma distributions.
Gamma distribution
An uncertain positive quantity θ has a gamma(a, b) distribution if
p(θ) = dgamma(θ, a, b) =
For such a random variable,

ba a−1 −bθ
θ
e ,
Γ (a)

for θ, a, b > 0.

46

3 One-parameter models

• E[θ] = a/b;
2
• Var[θ] = a/b
;
(a − 1)/b if a > 1
• mode[θ] =
.
0
if a ≤ 1

a=4 b=4
0.8

a=2 b=2

4

6

8

10

p( θ)
0.4
0.6
0.2
4

6

8

10

0

2

4

6
θ

a=2 b=1

a=8 b=4

a=32 b=16

4

6

8

10

0

θ

8

10

8

10

p( θ)
0.0 0.2 0.4 0.6 0.8 1.0

p( θ)
0.2
0.1

2

2

θ

0.0
0

0

θ
p( θ)
0.0 0.1 0.2 0.3 0.4 0.5 0.6

2

0.3

0

0.0

0.0

0.0

0.2

0.2

p( θ)
0.4

p( θ)
0.4 0.6

0.8

0.6

1.0

a=1 b=1

2

4

6

8

10

0

2

4

θ

6
θ

Fig. 3.8. Gamma densities.

Posterior distribution of θ
Suppose Y1 , . . . , Yn |θ ∼ i.i.d. Poisson(θ) and p(θ)=dgamma(θ, a, b). Then
p(θ|y1 , . . . , yn ) = p(θ) × p(y1 , . . . , yn |θ)/p(y1 , . . . , yn )
o

	 n P
= θa−1 e−bθ × θ yi e−nθ × c(y1 , . . . , yn , a, b)
n
o
P
= θa+ yi −1 e−(b+n)θ × c(y1 , . . . , yn , a, b).
This is evidently a gamma distribution, and we have confirmed the conjugacy
of the gamma family for the Poisson sampling model:

n
X
θ ∼ gamma(a, b)
⇒ {θ|Y1 , . . . , Yn } ∼ gamma(a +
Yi , b + n) .
Y1 , . . . , Yn |θ ∼ Poisson(θ)
i=1

Estimation and prediction proceed in a manner similar to that in the binomial
model. The posterior expectation of θ is a convex combination of the prior
expectation and the sample average:

3.2 The Poisson model

47

P

a + yi
b+n
P
b a
n
yi
=
+
b+n b
b+n n

E[θ|y1 , . . . , yn ] =

• b is interpreted as the number of prior observations;
• a is interpreted as the sum of counts from b prior observations.
For large n, the information from the data dominates the prior information:
n >> b ⇒ E[θ|y1 , . . . , yn ] ≈ y¯, Var[θ|y1 , . . . , yn ] ≈ y¯/n .
Predictions about additional data can be obtained with the posterior predictive distribution:
Z ∞
p(˜
y |y1 , . . . , yn ) =
p(˜
y |θ, y1 , . . . , yn )p(θ|y1 , . . . , yn ) dθ
0
Z
= p(˜
y |θ)p(θ|y1 , . . . , yn ) dθ
Z
X
= dpois(˜
y , θ)dgamma(θ, a +
yi , b + n) dθ
P


Z 
1 y˜ −θ
(b + n)a+ yi a+P yi −1 −(b+n)θ
P
=
θ e
θ
e
dθ
y˜!
Γ (a + yi )
P
Z
∞
P
(b + n)a+ yi
P
=
θa+ yi +˜y−1 e−(b+n+1)θ dθ .
Γ (˜
y + 1)Γ (a + yi ) 0
Evaluation of this complicated integral looks daunting, but it turns out that
it can be done without any additional calculus. Let’s use what we know about
the gamma density:
Z ∞ a
b
1=
θa−1 e−bθ dθ for any values a, b > 0 .
Γ
(a)
0
This means that
Z ∞
0

θa−1 e−bθ dθ =

Γ (a)
ba

for any values a, b > 0 .

P
Now substitute in a + yi + y˜ instead of a and b + n + 1 instead of b to get
P
Z ∞
P
Γ (a + yi + y˜)
P
.
θa+ yi +˜y−1 e−(b+n+1)θ dθ =
(b + n + 1)a+ yi +˜y
0
After simplifying some of the algebra, this gives
P

a+P yi 
y˜
Γ (a + yi + y˜)
b+n
1
P
p(˜
y |y1 , . . . , yn ) =
Γ (˜
y + 1)Γ (a + yi ) b + n + 1
b+n+1

48

3 One-parameter models

for y˜ P
∈ {0, 1, 2, . . .}. This is a negative binomial distribution with parameters
(a + yi , b + n), for which
P
a + yi
˜
E[Y |y1 , . . . , yn ] =
= E[θ|y1 , . . . , yn ];
b +Pn
a + yi b + n + 1
Var[Y˜ |y1 , . . . , yn ] =
= Var[θ|y1 , . . . yn ] × (b + n + 1)
b+n
b+n
b+n+1
= E[θ|y1 , . . . , yn ] ×
.
b+n
Let’s try to obtain a deeper understanding of this formula for the predictive
variance. Recall, the predictive variance is to some extent a measure of our
posterior uncertainty about a new sample Y˜ from the population. Uncertainty
about Y˜ stems from uncertainty about the population and the variability
in sampling from the population. For large n, uncertainty about θ is small
((b + n + 1)/(b + n) ≈ 1) and uncertainty about Y˜ stems primarily from
sampling variability, which for the Poisson model is equal to θ. For small n,
uncertainty in Y˜ also includes the uncertainty in θ, and so the total uncertainty
is larger than just the sampling variability ((b + n + 1)/(b + n) > 1).
3.2.2 Example: Birth rates

Bachelor's or higher

0

0

2

10

4

n 1(y )
20

n 2(y )
6
8

10

30

12

Less than bachelor's

0

1

2

3
y

4

5

6

0

1

2
y

3

4

Fig. 3.9. Numbers of children for the two groups.

Over the course of the 1990s the General Social Survey gathered data on
the educational attainment and number of children of 155 women who were 40
years of age at the time of their participation in the survey. These women were
in their 20s during the 1970s, a period of historically low fertility rates in the

3.2 The Poisson model

49

United States. In this example we will compare the women with college degrees
to those without in terms of their numbers of children. Let Y1,1 . . . , Yn1 ,1
denote the numbers of children for the n1 women without college degrees and
Y1,2 . . . , Yn2 ,2 be the data for women with degrees. For this example, we will
use the following sampling models:
Y1,1 . . . , Yn1 ,1 |θ1 ∼ i.i.d. Poisson(θ1 )
Y1,2 . . . , Yn2 ,2 |θ2 ∼ i.i.d. Poisson(θ2 )
The appropriateness of the Poisson model for these data will be examined in
the next chapter.
Empirical distributions for the data are displayed in Figure 3.9, and group
sums and means are as follows:
Pn1
Less than bachelor’s: n1 = 111, P i=1
Yi,1 = 217, Y¯1 = 1.95
n2
¯
Bachelor’s or higher: n2 = 44,
i=1 Yi,2 = 66, Y2 = 1.50
In the case where {θ1 , θ2 } ∼ i.i.d. gamma(a = 2, b = 1), we have the following
posterior distributions:
X
θ1 |{n1 = 111,
Yi,1 = 217} ∼ gamma(2 + 217, 1 + 111) = gamma(219, 112)
X
θ2 |{n2 = 44,
Yi,2 = 66} ∼ gamma(2 + 66, 1 + 44) = gamma(68, 45)
Posterior means, modes and 95% quantile-based confidence intervals for θ1
and θ2 can be obtained from their gamma posterior distributions:
> a<−2 ; b<−1
> n1<−111 ; sy1 <−217
> n2<−44 ; sy2 <−66

# p r i o r parameters
# data i n group 1
# data i n group 2

> ( a+sy1 ) / ( b+n1 )
# p o s t e r i o r mean
[ 1 ] 1.955357
> ( a+sy1 −1)/(b+n1 )
# p o s t e r i o r mode
[ 1 ] 1.946429
> qgamma( c ( . 0 2 5 , . 9 7 5 ) , a+sy1 , b+n1 )
# p o s t e r i o r 95% CI
[ 1 ] 1.704943 2.222679
> ( a+sy2 ) / ( b+n2 )
[ 1 ] 1.511111
> ( a+sy2 −1)/(b+n2 )
[ 1 ] 1.488889
> qgamma( c ( . 0 2 5 , . 9 7 5 ) , a+sy2 , b+n2 )
[ 1 ] 1.173437 1.890836

Posterior densities for the population means of the two groups are shown in
the first panel of Figure 3.10. The posterior
substantial evidence
P indicatesP
that θ1 > θ2 . For example, Pr(θ1 > θ2 | Yi,1 = 217, Yi,2 = 66) = 0.97.
Now consider two randomly sampled individuals, one from each of the two

3 One-parameter models
3.0

50

0.0

0.00

0.5

p( yn++1|y1...yn)
0.10
0.20

p( θ|y1...yn)
1.0 1.5 2.0

2.5

0.30

Less than bachelor's
Bachelor's or higher

0

1

2

3
θ

4

5

0

2

4

6
y n++1

8

10

12

Fig. 3.10. Posterior distributions of mean birth rates (with the common prior
distribution given by the dashed line), and posterior predictive distributions for
number of children.

populations. To what extent do we expect the one without the bachelor’s
degree to have more children than the other? We can calculate the relevant
probabilities exactly: The posterior predictive distributions for Y˜1 and Y˜2 are
both negative binomial distributions and are plotted in the second panel of
Figure 3.10.
> y<− 0 : 1 0
> dnbinom ( y , s i z e =(a+sy1 ) , mu=(a+sy1 ) / ( b+n1 ) )
[ 1 ] 1 . 4 2 7 4 7 3 e −01 2 . 7 6 6 5 1 8 e −01 2 . 6 9 3 0 7 1 e −01 1 . 7 5 5 6 6 0 e −01
[ 5 ] 8 . 6 2 2 9 3 0 e −02 3 . 4 0 3 3 8 7 e −02 1 . 1 2 4 4 2 3 e −02 3 . 1 9 8 4 2 1 e −03
[ 9 ] 7 . 9 9 6 0 5 3 e −04 1 . 7 8 4 7 6 3 e −04 3 . 6 0 1 1 1 5 e −05
> dnbinom ( y , s i z e =(a+sy2 ) , mu=(a+sy2 ) / ( b+n2 ) )
[ 1 ] 2 . 2 4 3 4 6 0 e −01 3 . 3 1 6 4 2 0 e −01 2 . 4 8 7 3 1 5 e −01 1 . 2 6 1 6 8 1 e −01
[ 5 ] 4 . 8 6 8 4 4 4 e −02 1 . 5 2 4 0 3 5 e −02 4 . 0 3 0 9 6 1 e −03 9 . 2 6 3 7 0 0 e −04
[ 9 ] 1 . 8 8 7 9 8 2 e −04 3 . 4 6 5 8 6 1 e −05 5 . 8 0 1 5 5 1 e −06

Notice that there is much more overlap between these two distributions than
˜
between
the posterior
distributions of θ1 and θ2 . For
P
P
P example, Pr(
P Y1 >
˜
˜
˜
Y2 | Yi,1 = 217, Yi,2 = 66) = .48 and Pr(Y1 = Y2 | Yi,1 = 217, Yi,2 =
66) = .22. The distinction between the events {θ1 > θ2 } and {Y˜1 > Y˜2 } is
extremely important: Strong evidence of a difference between two populations
does not mean that the difference itself is large.

3.3 Exponential families and conjugate priors

51

3.3 Exponential families and conjugate priors
The binomial and Poisson models discussed in this chapter are both instances of one-parameter exponential family models. A one-parameter exponential family model is any model whose densities can be expressed as
p(y|φ) = h(y)c(φ)eφt(y) , where φ is the unknown parameter and t(y) is the
sufficient statistic. Diaconis and Ylvisaker (1979) study conjugate prior distributions for general exponential family models, and in particular prior distributions of the form p(φ|n0 , t0 ) = κ(n0 , t0 )c(φ)n0 en0 t0 φ . Combining such
prior information with information from Y1 , . . . , Yn ∼ i.i.d. p(y|φ) gives the
following posterior distribution:
p(φ|y1 , . . . , yn ) ∝ p(φ)p(y1 , . . . , yn |φ)
(
"
n0 +n

∝ c(φ)

exp φ × n0 t0 +

n
X

#)
t(yi )

i=1

∝ p(φ|n0 + n, n0 t0 + nt¯(y)),
P
where t¯(y) =
t(yi )/n. The similarity between the posterior and prior distributions suggests that n0 can be interpreted as a “prior sample size” and t0
as a “prior guess” of t(Y ). This interpretation can be made a bit more precise:
Diaconis and Ylvisaker (1979) show that
E[t(Y )] = E[ E[t(Y )|φ] ]
= E[−c0 (φ)/c(φ)] = t0
(see also Exercise 3.6), so t0 represents the prior expected value of t(Y ). The
parameter n0 is a measure of how informative the prior is. There are a variety
of ways of quantifying this, but perhaps the simplest is to note that, as a function of φ, p(φ|n0 , t0 ) has the same shape as a likelihood
p(˜
y1 , . . . , y˜n0 |φ) based
P
on n0 “prior observations” y˜1 , . . . , y˜n0 for which t(˜
yi )/n0 = t0 . In this sense
the prior distribution p(φ|n0 , t0 ) contains the same amount of information that
would be obtained from n0 independent samples from the population.
Example: Binomial model
The exponential family representation of the binomial(θ) model can be obtained from the density function for a single binary random variable:
p(y|θ) = θy (1 − θ)1−y
y

θ
(1 − θ)
=
1−θ
= eφy (1 + eφ )−1 ,
where φ = log[θ/(1−θ)] is the log-odds. The conjugate prior for φ is thus given
by p(φ|n0 , t0 ) ∝ (1 + eφ )−n0 en0 t0 φ , where t0 represents the prior expectation

52

3 One-parameter models

of t(y) = y, or equivalently, t0 represents our prior probability that Y = 1. Using the change of variables formula (Exercise 3.10), this translates into a prior
distribution for θ such that p(θ|n0 , t0 ) ∝ θn0 t0 −1 (1 − θ)n0 (1−t0 )−1 , which is a
beta(n0 t0 , n0 (1−t0 )) distribution. A weakly informative prior distribution can
be obtained by setting t0 equal to our prior expectation and n0 = 1. If our prior
expectation is 1/2, the resulting prior is a beta(1/2,1/2) distribution, which is
equivalent to Jeffreys’ prior distribution (Exercise 3.11) for the binomial sampling model. Under the weakly informative beta(t0P
, (1−t0 )) prior distribution,
P
the posterior would be {θ|y1 , . . . , yn } ∼ beta(t0 + yi , (1 − t0 ) + (1 − yi )).
Example: Poisson model
The Poisson(θ) model can be shown to be an exponential family model with
• t(y) = y;
• φ = log θ;
• c(φ) = exp(e−φ ).
The conjugate prior distribution for φ is thus p(φ|n0 , t0 ) = exp(n0 e−φ )en0 t0 y
where t0 is the prior expectation of the population mean of Y . This translates
into a prior density for θ of the form p(θ|n0 , t0 ) ∝ θn0 t0 −1 e−n0 θ , which is
a gamma(n0 t0 , n0 ) density. A weakly informative prior distribution can be
obtained with t0 set to the prior expectation of Y and n0 = 1, giving a
gamma(t0 , 1) prior distribution. The posterior
distribution under such a prior
P
would be {θ|y1 , . . . , yn } ∼ gamma(t0 + yi , 1 + n).

3.4 Discussion and further references
The notion of conjugacy for classes of prior distributions was developed in
Raiffa and Schlaifer (1961). Important results on conjugacy for exponential
families appear in Diaconis and Ylvisaker (1979) and Diaconis and Ylvisaker
(1985). The latter shows that any prior distribution may be approximated by
a mixture of conjugate priors.
Most authors refer to intervals of high posterior probability as “credible
intervals” as opposed to confidence intervals. Doing so fails to recognize that
Bayesian intervals do have frequentist coverage probabilities, often being very
close to the specified Bayesian coverage level (Welch and Peers, 1963; Hartigan, 1966; Severini, 1991). Some authors suggest that accurate frequentist
coverage can be a guide for the construction of prior distributions (Tibshirani,
1989; Sweeting, 1999, 2001). See also Kass and Wasserman (1996) for a review
of formal methods for selecting prior distributions.

4
Monte Carlo approximation

In the last chapter we saw examples in which a conjugate prior distribution for
an unknown parameter θ led to a posterior distribution for which there were
simple formulae for posterior means and variances. However, often we will
want to summarize other aspects of a posterior distribution. For example, we
may want to calculate Pr(θ ∈ A|y1 , . . . , yn ) for arbitrary sets A. Alternatively,
we may be interested in means and standard deviations of some function of θ,
or the predictive distribution of missing or unobserved data. When comparing
two or more populations we may be interested in the posterior distribution
of |θ1 − θ2 |, θ1 /θ2 , or max{θ1 , . . . , θm }, all of which are functions of more
than one parameter. Obtaining exact values for these posterior quantities can
be difficult or impossible, but if we can generate random sample values of
the parameters from their posterior distributions, then all of these posterior
quantities of interest can be approximated to an arbitrary degree of precision
using the Monte Carlo method.

4.1 The Monte Carlo method
In the last chapter we obtained the following posterior distributions for
birthrates of women without and with bachelor’s degrees, respectively:
p(θ1 |

111
X

Yi,1 = 217) = dgamma(θ1 , 219, 112)

i=1

p(θ2 |

44
X

Yi,2 = 66) = dgamma(θ2 , 68, 45)

i=1

Additionally, we modeled θ1 and θ2 as
P conditionally
P independent given the
data. It was claimed that Pr(θ1 > θ2 | Yi,1 = 217, Yi,2 = 66) = 0.97. How
was this probability calculated? From Chapter 2, we have
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 4,
c Springer Science+Business Media, LLC 2009


54

4 Monte Carlo approximation

Pr(θ1 > θ2 |y1,1 , . . . , yn2 ,2 )
Z ∞ Z θ1
=
p(θ1 , θ2 |y1,1 , . . . , yn2 ,2 ) dθ2 dθ1
0

Z

0
∞

Z

θ1

dgamma(θ1 , 219, 112) × dgamma(θ2 , 68, 45) dθ2 dθ1

=
0

=

0
219

112 4568
Γ (219)Γ (68)

Z
0

∞

Z

θ1

θ1218 θ267 e−112θ1 −45θ2 dθ2 dθ1 .

0

There are a variety of ways to calculate this integral. It can be done with
pencil and paper using results from calculus, and it can be calculated numerically in many mathematical software packages. However, the feasibility
of these integration methods depends heavily on the particular details of this
model, prior distribution and the probability statement that we are trying to
calculate. As an alternative, in this text we will use an integration method for
which the general principles and procedures remain relatively constant across
a broad class of problems. The method, known as Monte Carlo approximation, is based on random sampling and its implementation does not require a
deep knowledge of calculus or numerical analysis.
Let θ be a parameter of interest and let y1 , . . . , yn be the numerical values
of a sample from a distribution p(y1 , . . . , yn |θ). Suppose we could sample some
number S of independent, random θ-values from the posterior distribution
p(θ|y1 , . . . , yn ):
θ(1) , . . . , θ(S) ∼ i.i.d p(θ|y1 , . . . , yn ).
Then the empirical distribution of the samples {θ(1) , . . . , θ(S) } would approximate p(θ|y1 , . . . , yn ), with the approximation improving with increasing S.
The empirical distribution of {θ(1) , . . . , θ(S) } is known as a Monte Carlo approximation to p(θ|y1 , . . . , yn ). Many computer languages and computing environments have procedures for simulating this sampling process. For example,
R has built-in functions to simulate i.i.d. samples from most of the distributions we will use in this book.
Figure 4.1 shows successive Monte Carlo approximations to the density
of the gamma(68,45) distribution, along with the true density function for
comparison. As we see, the empirical distribution of the Monte Carlo samples
provides an increasingly close approximation to the true density as S gets
larger. Additionally, let g(θ) be (just about) any function. The law of large
numbers says that if θ(1) , . . . , θ(S) are i.i.d. samples from p(θ|y1 , . . . , yn ), then
Z
S
1X
g(θ(s) ) → E[g(θ)|y1 , . . . , yn ] = g(θ)p(θ|y1 , . . . , yn ) dθ as S → ∞ .
S s=1
This implies that as S → ∞,
PS
• θ¯ = s=1 θ(s) /S → E[θ|y1 , . . . , yn ];
PS
(s)
¯ 2 /(S − 1) → Var[θ|y1 , . . . , yn ];
•
− θ)
s=1 (θ

4.1 The Monte Carlo method

1.0

1.5
θ

2.0

1.5

2.0

1.0

1.5
θ

2.0

1.0

1.5

2.0

1.0

1.5
θ

2.0

1.0
0.0

1.0
0.0

1.0
0.0

2.0
1.0

1.0

2.0

2.0

2.0

1.5

2.0

1.0

S=1000

0.0

1.0

2.0

S=100

0.0

0.0

1.0

2.0

S =10

55

Fig. 4.1. Histograms and kernel density estimates of Monte Carlo approximations
to the gamma(68,45) distribution, with the true density in gray.

•
•
•
•

#(θ(s) ≤ c)/S → Pr(θ ≤ c|y1 , . . . , yn );
the empirical distribution of {θ(1) , . . . , θ(S) } → p(θ|y1 , . . . , yn );
the median of {θ(1) , . . . , θ(S) } → θ1/2 ;
the α-percentile of {θ(1) , . . . , θ(S) } → θα .

Just about any aspect of a posterior distribution we may be interested in can
be approximated arbitrarily exactly with a large enough Monte Carlo sample.
Numerical evaluation
We will first gain some familiarity and confidence with the Monte Carlo procedure by comparing its approximations to a few posterior quantities that
we can compute exactly (or nearly so) by other methods. Suppose we model
Y1 , . . . , Yn |θ as i.i.d. Poisson(θ), and have a gamma(a, b) prior distribution for
θ. Having
observed Y1 = y1 , . . . , Yn = yn , the posterior distribution is gamma
P
(a+ yi , b+n). ForP
the college-educated population in the birthrate example,
(a = 2, b = 1) and ( yi = 66, n = 44).
P
Expectation: The posterior mean is (a+ yi )/(b+n) = 68/45 = 1.51. Monte
Carlo approximations to this for S ∈ {10, 100, 1000} can be obtained in R
as follows:
a<−2
; b<−1
sy <−66 ; n<−44
t h e t a . mc10<−rgamma ( 1 0 , a+sy , b+n )
t h e t a . mc100<−rgamma ( 1 0 0 , a+sy , b+n )
t h e t a . mc1000<−rgamma ( 1 0 0 0 , a+sy , b+n )

56

4 Monte Carlo approximation
> mean ( t h e t a . mc10 )
[ 1 ] 1.532794
> mean ( t h e t a . mc100 )
[ 1 ] 1.513947
> mean ( t h e t a . mc1000 )
[ 1 ] 1.501015

Results will vary depending on the seed of the random number generator.
Probabilities: The posterior probability that {θ < 1.75} can be obtained to a
high degree of precision in R with the command pgamma(1.75,a+sy,b+n) ,
which yields 0.8998. Using the simulated values of θ from above, the corresponding Monte Carlo approximations were:
> mean ( t h e t a . mc10 <1.75)
[ 1 ] 0.9
> mean ( t h e t a . mc100 <1.75)
[ 1 ] 0.94
> mean ( t h e t a . mc1000 <1.75)
[ 1 ] 0.899

Quantiles: A 95% quantile-based confidence region can be obtained with
qgamma(c(.025,.975),a+sy,b+n) , giving an interval of (1.173,1.891). Approximate 95% confidence regions can also be obtained from the Monte
Carlo samples:
> q u a n t i l e ( t h e t a . mc10 , c ( . 0 2 5 , . 9 7 5 ) )
2.5%
97.5%
1.260291 1.750068
> q u a n t i l e ( t h e t a . mc100 , c ( . 0 2 5 , . 9 7 5 ) )
2.5%
97.5%
1.231646 1.813752
> q u a n t i l e ( t h e t a . mc1000 , c ( . 0 2 5 , . 9 7 5 ) )
2.5%
97.5%
1.180194 1.892473

Figure 4.2 shows the convergence of the Monte Carlo estimates to the correct values graphically, based on cumulative estimates from a sequence of
S = 1000 samples from the gamma(68,45) distribution. Such plots can help
indicate when enough Monte Carlo samples have been made. Additionally,
Monte Carlo standard errors can be obtained
PSto assess the accuracy of approximations to posterior means: Letting θ¯ = s=1 θ(s) /S be the sample mean of
the Monte Carlo samples, the Central Limit Theorem says that θ¯ is approximately normally p
distributed with expectation E[θ|y1 , . . . , yn ] and standard deviation equal to Var[θ|y1 , . . . yn ]/S. The Monte Carlo P
standard error is the
¯ 2 /(S − 1)
approximation to this standard deviation: Letting σ
ˆ 2 = (θ(s) − θ)
be the Monte
Carlo estimate of Var[θ|y1 , . . . , yn ], the Monte Carlo standard
p
error is σ
ˆ 2 /S. An approximate 95% Monte Carlo confidence interval for the

cumulative cdf at 1.75
0.90
0.94
0.98

cumulative mean
1.45
1.50
1.40
0 200
600
1000
# of Monte Carlo samples

57

cumulative 97.5% quantile
1.4 1.5 1.6 1.7 1.8 1.9

4.2 Posterior inference for arbitrary functions

0 200
600
1000
# of Monte Carlo samples

0 200
600
1000
# of Monte Carlo samples

Fig. 4.2. Estimates of the posterior mean, Pr(θ < 1.75|y1 , . . . , yn ) and the 97.5%
posterior quantile as a function of the number of Monte Carlo samples. Horizontal
gray lines are the true values.

p
posterior mean of θ is θˆ ± 2 σ
ˆ 2 /S. Standard practice is to choose S to be
large enough so that the Monte Carlo standard error is less than the precision to which you want to report E[θ|y1 , . . . , yn ]. For example, suppose you
had generated a Monte Carlo sample of size S = 100 for which the estimate
of Var[θ|y1 , . . . , p
yn ] was 0.024. The approximate Monte Carlo standard error
would then be 0.024/100 = 0.015. If you wanted the difference between
E[θ|y1 , . . . , yn ] and its Monte Carlo estimate to be less than 0.01 with high
probability,
you would need to increase your Monte Carlo sample size so that
p
2 0.024/S < 0.01, i.e. S > 960.

4.2 Posterior inference for arbitrary functions
Suppose we are interested in the posterior distribution of some computable
function g(θ) of θ. In the binomial model, for example, we are sometimes
interested in the log odds:
log odds(θ) = log

θ
=γ.
1−θ

The law of large numbers says that if we generate a sequence {θ(1) , θ(2) , . . .}
θ (s)
from the posterior distribution of θ, then the average value of log 1−θ
(s) conθ
verges to E[log 1−θ |y1 , . . . , yn ]. However, we may also be interested in other
θ
aspects of the posterior distribution of γ = log 1−θ
. Fortunately, these too can
be computed using a Monte Carlo approach:

sample θ(1) ∼ p(θ|y1 , . . . , yn ), compute γ (1) = g(θ(1) ) 


sample θ(2) ∼ p(θ|y1 , . . . , yn ), compute γ (2) = g(θ(2) ) 
independently .
..

.



sample θ(S) ∼ p(θ|y1 , . . . , yn ), compute γ (S) = g(θ(S) )

58

4 Monte Carlo approximation

The sequence {γ (1) , . . . , γ (S) } constitutes S independent samples from p(γ|y1 ,. . .,
yn ), and so as S → ∞
PS
• γ¯ = s=1 γ (s) /S → E[γ|y1 , . . . , yn ],
PS
(s)
•
− γ¯ )2 /(S − 1) → Var[γ|y1 , . . . , yn ],
s=1 (γ
• the empirical distribution of {γ (1) , . . . , γ (S) } → p(γ|y1 , . . . , yn ),
as before.
Example: Log-odds
Fifty-four percent of the respondents in the 1998 General Social Survey reported their religious preference as Protestant, leaving non-Protestants in the
minority. Respondents were also asked if they agreed with a Supreme Court
ruling that prohibited state or local governments from requiring the reading
of religious texts in public schools. Of the n = 860 individuals in the religious
minority (non-Protestant), y = 441 (51%) said they agreed with the Supreme
Court ruling, whereas 353 of the 1011 Protestants (35%) agreed with the
ruling.
Let θ be the population proportion agreeing with the ruling in the minority
population. Using a binomial sampling model and a uniform prior distribution,
the posterior distribution of θ is beta(442, 420). Using the Monte Carlo algorithm described above, we can obtain samples of the log-odds γ = log[θ/(1−θ)]
from both the prior distribution and the posterior distribution of γ. In R, the
Monte Carlo algorithm involves only a few commands:
a<−1 ; b<−1
t h e t a . p r i o r . mc<−r b e t a ( 1 0 0 0 0 , a , b )
gamma . p r i o r . mc<− l o g ( t h e t a . p r i o r . mc/(1− t h e t a . p r i o r . mc) )
n0<−860−441 ; n1<−441
t h e t a . p o s t . mc<−r b e t a ( 1 0 0 0 0 , a+n1 , b+n0 )
gamma . p o s t . mc<− l o g ( t h e t a . p o s t . mc/(1− t h e t a . p o s t . mc) )

Using the density() function in R , we can plot smooth kernel density approximations to these distributions, as shown in Figure 4.3.
Example: Functions of two parameters
Based on the prior distributions and the data in the birthrate example, the
posterior distributions for the two educational groups are
{θ1 |y1,1 , . . . , yn1 ,1 } ∼ gamma(219, 112) (women without bachelor’s degrees)
{θ2 |y1,2 , . . . , yn2 ,2 } ∼ gamma(68, 45) (women with bachelor’s degrees).
There are a variety of ways to describe our knowledge about the difference
between θ1 and θ2 . For example, we may be interested in the numerical value

59

0

0.00

1

0.05

p (γ)
0.10 0.15

p( γ|y1...yn)
2
3
4

0.20

5

4.2 Posterior inference for arbitrary functions

−4

−2

0
γ

2

4

−4

−2

0
γ

2

4

Fig. 4.3. Monte Carlo approximations to the prior and posterior distributions of
the log-odds.

of Pr(θ1 > θ2 |Y1,1 = y1,1 , . . . , Yn2 ,2 = yn2 ,2 ), or in the posterior distribution of
θ1 /θ2 . Both of these quantities can be obtained with Monte Carlo sampling:
P111
P44
(1)
(1)
sample θ1 ∼ p(θ1 | i=1 Yi,1 = 217), sample θ2 ∼ p(θ2 | i=1 Yi,2 = 66)
P
P44
(2)
(2)
111
sample θ1 ∼ p(θ1 | i=1 Yi,1 = 217), sample θ2 ∼ p(θ2 | i=1 Yi,2 = 66)
..
..
.
.
P
P44
(S)
(S)
111
sample θ1 ∼ p(θ1 | i=1 Yi,1 = 217), sample θ2 ∼ p(θ2 | i=1 Yi,2 = 66) .
(1)

(1)

(S)

(S)

The sequence {(θ1 , θ2 ), . . . , (θ1 , θ2 )} consists of S independent samples from the joint posterior distribution of θ1 and θ2 , and can be used to
make Monte Carlo approximations
to P
posterior quantities of interest. For
P111
44
example, Pr(θ1 > θ2 | i=1 Yi,1 = 217, i=1 Yi,2 = 66) is approximated by
P
(s)
(s)
S
1
s=1 1(θ1 > θ2 ), where 1(x > y) is the indicator function which is 1 if
S
x > y and zero otherwise. The approximation can be calculated in R with the
following commands:
> a<−2 ; b<−1
> sy1 <−217 ; n1<−111
> sy2 <−66 ; n2<−44
> t h e t a 1 . mc<−rgamma ( 1 0 0 0 0 , a+sy1 , b+n1 )
> t h e t a 2 . mc<−rgamma ( 1 0 0 0 0 , a+sy2 , b+n2 )
> mean ( t h e t a 1 . mc>t h e t a 2 . mc)
[ 1 ] 0.9708

60

4 Monte Carlo approximation

0.0

0.5

p( γ|y1,y2)
1.0
1.5

2.0

Additionally, if we were interested in the ratio of the means of the two groups,
(1) (1)
(S) (S)
we could use the empirical distribution of {θ1 /θ2 , . . . , θ1 /θ2 } to approximate the posterior distribution of θ1 /θ2 . A Monte Carlo estimate of this
posterior density is given in Figure 4.4.

1.0

1.5
γ = θ1 θ2

2.0

Fig. 4.4. Monte Carlo estimate to the posterior predictive distribution of γ = θ1 /θ2 .

4.3 Sampling from predictive distributions
As described in Section 3.1, the predictive distribution of a random variable
Y˜ is a probability distribution for Y˜ such that
• known quantities have been conditioned on;
• unknown quantities have been integrated out.
For example, let Y˜ be the number of children of a person who is sampled from
the population of women aged 40 with a college degree. If we knew the true
mean birthrate θ of this population, we might describe our uncertainty about
Y˜ with a Poisson(θ) distribution:
Sampling model:

Pr(Y˜ = y˜|θ) = p(˜
y |θ) = θy˜e−θ /˜
y!

We cannot make predictions from this model, however, because we do not
actually know θ. If we did not have any sample data from the population, our
predictive distribution would be obtained by integrating out θ:
R
Predictive model: Pr(Y˜ = y˜) = p(˜
y |θ)p(θ)dθ
In the case where θ ∼ gamma(a, b), we showed in the last chapter that this
predictive distribution is the negative binomial(a, b) distribution. A predictive

4.3 Sampling from predictive distributions

61

distribution that integrates over unknown parameters but is not conditional
on observed data is called a prior predictive distribution. Such a distribution
can be useful in evaluating if a prior distribution for θ actually translates
into reasonable prior beliefs for observable data Y˜ (see Exercise 7.4). After we
have observed a sample Y1 , . . . , Yn from the population, the relevant predictive
distribution for a new observation becomes
Z
˜
Pr(Y = y˜|Y1 = y1 , . . . , Yn = yn ) = p(˜
y |θ, y1 , . . . , yn )p(θ|y1 , . . . , yn ) dθ
Z
= p(˜
y |θ)p(θ|y1 , . . . , yn ) dθ.
This is called a posterior predictive distribution, because it conditions on an
observed dataset. In the case of a Poisson model with a gamma prior distribution, we showed in Chapter
3 that the posterior predictive distribution is
P
negative binomial(a + yi , b + n).
In many modeling situations, we will be able to sample from p(θ|y1 , . . . , yn )
and p(y|θ), but p(˜
y |y1 , . . . , yn ) will be too complicated to sample from directly. In this situation we can sample from the posterior predictive distribution
indirectly using a Monte Carlo procedure. Since p(˜
y |y1 , . . . , yn ) =
R
p(˜
y |θ)p(θ|y1 , . . . , yn ) dθ, we see that p(˜
y |y1 , . . . , yn ) is the posterior expectation of p(˜
y |θ). To obtain the posterior predictive probability that Y˜ is equal
to some specific value y˜, we could just apply the Monte Carlo method of
the previous section: Sample θ(1) , . . . , θ(S) ∼ i.i.d. p(θ|y1 , . . . , yn ), and then
PS
approximate p(˜
y |y1 , . . . , yn ) with s=1 p(˜
y |θ(s) )/S. This procedure will work
well if p(y|θ) is discrete and we are interested in quantities that are easily computed from p(y|θ). However, it will generally be useful to have a set of samples
of Y˜ from its posterior predictive distribution. Obtaining these samples can
be done quite easily as follows:
sample θ(1) ∼ p(θ|y1 , . . . , yn ), sample y˜(1) ∼ p(˜
y |θ(1) )
(2)
(2)
sample θ ∼ p(θ|y1 , . . . , yn ), sample y˜ ∼ p(˜
y |θ(2) )
..
.
sample θ(S) ∼ p(θ|y1 , . . . , yn ), sample y˜(S) ∼ p(˜
y |θ(S) ) .
The sequence {(θ, y˜)(1) , . . . , (θ, y˜)(S) } constitutes S independent samples from
the joint posterior distribution of (θ, Y˜ ), and the sequence {˜
y (1) , . . . , y˜(S) }
constitutes S independent samples from the marginal posterior distribution
of Y˜ , which is the posterior predictive distribution.
Example: Poisson model
At the end of Chapter 3 it was reported that the predictive probability that
an age-40 woman without a college degree would have more children than an
age-40 woman with a degree was 0.48. To arrive at this answer exactly we
would have to do the following doubly infinite sum:

62

4 Monte Carlo approximation

Pr(Y˜1 > Y˜2 |
∞
X

X

∞
X

Yi,1 = 217,

X

Yi,2 = 66) =

dnbinom(˜
y1 , 219, 112) × dnbinom(˜
y2 , 68, 45) .

y˜2 =0 y˜1 =˜
y2 +1

Alternatively, this sum can be approximated with Monte Carlo sampling.
Since Y˜1 and Y˜2 are a posteriori independent, samples from their joint posterior distribution can be made by sampling values of each variable separately
from their individual posterior distributions. Posterior predictive samples from
the conjugate Poisson model can be generated as follows:
P
sample θ(1) ∼ gamma(a + P yi , b + n), sample y˜(1) ∼ Poisson(θ(1) )
sample θ(2) ∼ gamma(a + yi , b + n), sample y˜(2) ∼ Poisson(θ(2) )
..
.
P
sample θ(S) ∼ gamma(a + yi , b + n) sample y˜(S) ∼ Poisson(θ(S) ) .
Monte Carlo samples from the posterior predictive distributions of our two
educational groups can be obtained with just a few commands in R:
> a<−2 ; b<−1
> sy1 <−217 ; n1<−111
> sy2 <−66 ; n2<−44
>
>
>
>

t h e t a 1 . mc<−rgamma ( 1 0 0 0 0 , a+sy1 , b+n1 )
t h e t a 2 . mc<−rgamma ( 1 0 0 0 0 , a+sy2 , b+n2 )
y1 . mc<−r p o i s ( 1 0 0 0 0 , t h e t a 1 . mc)
y2 . mc<−r p o i s ( 1 0 0 0 0 , t h e t a 2 . mc)

> mean ( y1 . mc>y2 . mc)
[ 1 ] 0.4823

Once we have generated these Monte Carlo samples from the posterior predictive distribution, we can use them again to calculate other posterior quantities
of interest. For example, Figure 4.5 shows the Monte Carlo approximation to
the posterior distribution of D = (Y˜1 −Y˜2 ), the difference in number of children
between two individuals, one sampled from each of the two groups.

4.4 Posterior predictive model checking
Let’s consider for the moment the sample of 40-year-old women without a
college degree. The empirical distribution of the number of children of these
women, along with the corresponding posterior predictive distribution, is
shown in the first panel of Figure 4.6. In this sample of n = 111 women,
the number of women with exactly two children is 38, which is twice the
number of women in the sample with one child. In contrast, this group’s posterior predictive distribution, shown in gray, suggests that the probability of

63

0

500

p(D|y1,y2)
1000
1500

2000

4.4 Posterior predictive model checking

−10

−5

0
~ ~
D = Y1 − Y2

5

10

Fig. 4.5. The posterior predictive distribution of D = Y˜1 − Y˜2 , the difference in
the number of children of two randomly sampled women, one from each of the two
educational populations.

0.0

0.00

0.10

0.5

Pr(Y i = y i )
0.20

1.0

0.30

empirical distribution
predictive distribution

1.5

sampling a woman with two children is slightly less probable than sampling
a woman with one (probabilities of 0.27 and 0.28, respectively). These two
distributions seem to be in conflict. If the observed data have twice as many
women with two children than one, why should we be predicting otherwise?

0

2

4
6
number of children

8

0.5

1.0

1.5
~
t(Y)

2.0

2.5

Fig. 4.6. Evaluation of model fit. The first panel shows the empirical and posterior
predictive distributions of the number of children of women without a bachelor’s
degree. The second panel shows the posterior predictive distribution of the empirical
odds of having two children versus one child in a dataset of size n = 111. The
observed odds are given in the short vertical line.

64

4 Monte Carlo approximation

One explanation for the large number of women in the sample with two
children is that it is a result of sampling variability: The empirical distribution
of sampled data does not generally match exactly the distribution of the
population from which the data were sampled, and in fact may look quite
different if the sample size is small. A smooth population distribution can
produce sample empirical distributions that are quite bumpy. In such cases,
having a predictive distribution that smoothes over the bumps of the empirical
distribution may be desirable.
An alternative explanation for the large number of women in the sample
with two children is that this is indeed a feature of the population, and the
data are correctly reflecting this feature. In contrast, the Poisson model is
unable to represent this feature of the population because there is no Poisson
distribution that has such a sharp peak at y = 2.
These explanations for the discrepancy between the empirical and predictive distributions can be assessed numerically with Monte Carlo simulation.
For every vector y of length n = 111, let t(y) be the ratio of the number
of 2’s in y to the number of 1’s, so for our observed data y obs , t(y obs ) = 2.
Now suppose we were to sample a different set of 111 women, obtaining a
data vector Y˜ of length 111 recording their number of children. What sort
of values of t(Y˜ ) would we expect? Monte Carlo samples from the posterior
predictive distribution of t(Y˜ ) can be obtained with the following procedure
and R-code:
For each s ∈ {1, . . . , S},
1. sample θ(s) ∼ p(θ|Y = y obs )
(s)
(s)
(s)
2. sample Y˜
= (˜
y1 , . . . , y˜n ) ∼ i.i.d. p(y|θ(s) )
(s)
3. compute t(s) = t(Y˜ ).
a<−2 ; b<−1
t . mc<−NULL
for ( s in 1:10000) {
t h e t a 1 <−rgamma ( 1 , a+sy1 , b+n1 )
y1 . mc<−r p o i s ( n1 , t h e t a 1 )
t . mc<−c ( t . mc , sum ( y1 . mc==2)/sum ( y1 . mc==1))
}

In this Monte Carlo sampling scheme,
{θ(1) , . . . , θ(S) } are samples from the posterior distribution of θ;
(1)
(S)
{Y˜ , . . . , Y˜ } are posterior predictive datasets, each of size n;
(1)
(S)
˜
{t , . . . , t } are samples from the posterior predictive distribution of t(Y).
A Monte Carlo approximation to the distribution of t(Y˜ ) is shown in the
second panel of Figure 4.6, with the observed value t(yobs ) indicated with a
short vertical line. Out of 10,000 Monte Carlo datasets, only about a half of
a percent had values of t(y) that equaled or exceeded t(y obs ). This indicates

4.5 Discussion and further references

65

that our Poisson model is flawed: It predicts that we would hardly ever see a
dataset that resembled our observed one in terms of t(y). If we were interested
in making inference on the true probability distribution ptrue (y) for each value
of y, then the Poisson model would be inadequate, and we would have to
consider a more complicated model (for example, a multinomial sampling
model). However, a simple Poisson model may suffice if we are interested only
in certain aspects of ptrue . For example, the predictive distribution generated
by the Poisson model will have a mean that approximates the true population
mean, even though ptrue may not be a Poisson distribution. Additionally, for
these data the sample mean and variance are similar, being 1.95 and 1.90
respectively, suggesting that the Poisson model can represent both the mean
and variance of the population.
In terms of data description, we should at least make sure that our model
generates predictive datasets Y˜ that resemble the observed dataset in terms
of features that are of interest. If this condition is not met, we may want to
consider using a more complex model. However, an incorrect model can still
provide correct inference for some aspects of the true population (White, 1982;
Bunke and Milhaud, 1998; Kleijn and van der Vaart, 2006). For example, the
Poisson model provides consistent estimation of the population mean, as well
as accurate confidence intervals if the population mean is approximately equal
to the variance.

4.5 Discussion and further references
The use of Monte Carlo methods is widespread in statistics and science in
general. Rubinstein and Kroese (2008) cover Monte Carlo methods for a wide
variety of statistical problems, and Robert and Casella (2004) include more
coverage of Bayesian applications (and cover Markov chain Monte Carlo methods as well).
Using the posterior predictive distribution to assess model fit was suggested by Guttman (1967) and Rubin (1984), and is now common practice.
In some problems, it is useful to evaluate goodness-of-fit using functions that
depend on parameters as well as predicted data. This is discussed in Gelman
et al (1996) and more recently in Johnson (2007). These types of posterior
predictive checks have given rise to a notion of posterior predictive p-values,
which despite their name, do not generally share the same frequentist properties as p-values based on classical goodness-of-fit tests. This distinction is
discussed in Bayarri and Berger (2000), who also consider alternative types of
Bayesian goodness of fit probabilities to serve as a replacement for frequentist
p-values.

5
The normal model

Perhaps the most useful (or utilized) probability model for data analysis is the
normal distribution. There are several reasons for this, one being the central
limit theorem, and another being that the normal model is a simple model
with separate parameters for the population mean and variance - two quantities that are often of primary interest. In this chapter we discuss some of
the properties of the normal distribution, and show how to make posterior
inference on the population mean and variance parameters. We also compare
the sampling properties of the standard Bayesian estimator of the population
mean to those of the unbiased sample mean. Lastly, we discuss the appropriateness of the normal model when the underlying data are not normally
distributed.

5.1 The normal model
A random variable Y is said to be normally distributed with mean θ and
variance σ 2 > 0 if the density of Y is given by
p(y|θ, σ 2 ) = √

1
2πσ 2

1

e− 2 (

y−θ 2
σ )

, −∞ < y < ∞.

Figure 5.1 shows normal density curves for a few values of θ and σ 2 . Some
important things to remember about this distribution include that
• the distribution is symmetric about θ, and the mode, median and mean
are all equal to θ;
• about 95% of the population lies within two standard deviations of the
mean (more precisely, 1.96 standard deviations);
• if X ∼ normal(µ, τ 2 ), Y ∼ normal(θ, σ 2 ) and X and Y are independent,
then aX + bY ∼ normal(aµ + bθ, a2 τ 2 + b2 σ 2 );
• the dnorm, rnorm, pnorm, and qnorm commands in R take the standard
deviation σ as their argument, not the variance σ 2 . Be very careful about
this when using R - confusing σ with σ 2 can drastically change your results.
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 5,
c Springer Science+Business Media, LLC 2009


68

5 The normal model

0.8

> dnorm
f u n c t i o n ( x , mean = 0 , sd = 1 , l o g = FALSE)
. I n t e r n a l ( dnorm ( x , mean , sd , l o g ) )

0.0

0.2

p(y|θ
θ,σ
σ2)
0.4

0.6

θ = 2,σ
σ2 = 0.25
θ = 5,σ
σ2 = 4
θ = 7,σ
σ2 = 1

0

2

4

6

8

10

y

Fig. 5.1. Some normal densities.

The importance of the normal distribution stems primarily from the central limit theorem, which says that under very general conditions, the sum (or
mean) of a set of random variables is approximately normally distributed. In
practice, this means that the normal sampling model will be appropriate for
data that result from the additive effects of a large number of factors.
Example: women’s height
A study of 1,100 English families from 1893 to 1898 gathered height data
on n = 1375 women over the age of 18. A histogram of these data is shown
in Figure 5.2. The sample mean of these data is y¯ = 63.75 and the sample
standard deviation is s = 2.62 inches. One explanation for the variability in
heights among these women is that the women were heterogeneous in terms of
a number of factors controlling human growth, such as genetics, diet, disease,
stress and so on. Variability in these factors among the women results in
variability in their heights. Letting yi be the height in inches of woman i, a
simple additive model for height might be
y1 = a + b × gene1 + c × diet1 + d × disease1 + · · ·
y2 = a + b × gene2 + c × diet2 + d × disease2 + · · ·
..
.
yn = a + b × genen + c × dietn + d × diseasen + · · ·

5.2 Inference for the mean, conditional on the variance

69

0.00

0.05

0.10

0.15

where genei might denote the presence of a particular height-promoting gene,
dieti might measure some aspect of woman i’s diet, and diseasei might indicate
if woman i had ever had a particular disease. Of course, there may be a
large number of genes, diseases, dietary and other factors that contribute to a
woman’s height. If the effects of these factors are approximately additive, then
each height measurement yi is roughly equal to a linear combination of a large
number of terms. For such situations, the central limit theorem says that the
empirical distribution of y1 , . . . , yn will look like a normal distribution, and
so the normal model provides an appropriate sampling model for the data.

55

60

65
height in inches

70

Fig. 5.2. Height data and a normal density with θ = 63.75 and σ = 2.62.

5.2 Inference for the mean, conditional on the variance
Suppose our model is {Y1 , . . . , Yn |θ, σ 2 } ∼ i.i.d. normal (θ, σ 2 ). Then the joint
sampling density is given by
p(y1 , . . . , yn |θ, σ 2 ) =
=

n
Y
i=1
n
Y
i=1

p(yi |θ, σ 2 )
√

1
2πσ 2

− 12

e



yi −θ
σ

(

2 −n/2

= (2πσ )

2

1X
exp −
2



yi − θ
σ

2 )
.

Expanding the quadratic term in the exponent, we see that p(y1 , . . . , yn |θ, σ 2 )
depends on y1 , . . . , yn through

70

5 The normal model

2
n 
X
yi − θ
i=1

σ

=

1 X 2
θ X
θ2
yi − 2 2
yi + n 2 .
2
σ
σ
σ

P
P
From this you can show that { yi2 , yi } make up a two-dimensional sufficient statistic. Knowing
the values of
knowing
P
Pthese quantities is equivalent to
the values of y¯ = yi /n and s2 = (yi − y¯)2 /(n − 1), and so {¯
y , s2 } are also
a sufficient statistic.
Inference for this two-parameter model can be broken down into two oneparameter problems. We will begin with the problem of making inference for
θ when σ 2 is known, and use a conjugate prior distribution for θ. For any
(conditional) prior distribution p(θ|σ 2 ), the posterior distribution will satisfy
1

p(θ|y1 , . . . , yn , σ 2 ) ∝ p(θ|σ 2 ) × e− 2σ2

P

(yi −θ)2
2

∝ p(θ|σ 2 ) × ec1 (θ−c2 ) .
Recall that a class of prior distributions is conjugate for a sampling model if
the resulting posterior distribution is in the same class. From the calculation
above, we see that if p(θ|σ 2 ) is to be conjugate, it must include quadratic
2
terms like ec1 (θ−c2 ) . The simplest such class of probability densities on R
is the normal family of densities, suggesting that if p(θ|σ 2 ) is normal and
y1 , . . . , yn are i.i.d. normal(θ, σ 2 ), then p(θ|y1 , . . . , yn , σ 2 ) is also a normal
density. Let’s evaluate this claim: If θ ∼ normal (µ0 , τ02 ), then
p(θ|y1 , . . . , yn , σ 2 ) = p(θ|σ 2 )p(y1 , . . . , yn |θ, σ 2 )/p(y1 , . . . , yn |σ 2 )
∝ p(θ|σ 2 )p(y1 , . . . , yn |θ, σ 2 )
1
1 X
∝ exp{− 2 (θ − µ0 )2 } exp{− 2
(yi − θ)2 }.
2τ0
2σ
Adding the terms in the exponents and ignoring the -1/2 for the moment, we
have
X
1 2
1 X 2
(θ − 2θµ0 + µ20 ) + 2 (
yi − 2θ
yi + nθ2 ) = aθ2 − 2bθ + c, where
2
τ0
σ
P
1
n
µ0
yi
a = 2 + 2 , b = 2 + 2 , and c = c(µ0 , τ02 , σ 2 , y1 , . . . , yn ).
τ0
σ
τ0
σ
Now let’s see if p(θ|σ 2 , y1 , . . . , yn ) takes the form of a normal density:
1
p(θ|σ 2 , y1 , . . . , yn ) ∝ exp{− (aθ2 − 2bθ)}
2
1
1
= exp{− a(θ2 − 2bθ/a + b2 /a2 ) + b2 /a}
2
2
1
2
∝ exp{− a(θ − b/a) }
( 2 
2 )
1 θ − b/a
√
= exp −
.
2
1/ a

5.2 Inference for the mean, conditional on the variance

71

This
√ function has exactly the same shape as a normal density curve, with
1/ a playing the role of the standard deviation and b/a playing the role of
the mean. Since probability distributions are determined by their shape, this
means that p(θ|σ 2 , y1 , . . . , yn ) is indeed a normal density. We refer to the mean
and variance of this density as µn and τn2 , where
τn2

1
= =
a

1
τ02

1
+

n
σ2

and

b
µn = =
a

1
µ + σn2 y¯
τ02 0
.
1
+ σn2
τ02

Combining information
The (conditional) posterior parameters τn2 and µn combine the prior parameters τ02 and µ0 with terms from the data.
• Posterior variance and precision: The formula for 1/τn2 is
1
1
n
= 2 + 2,
2
τn
τ0
σ

(5.1)

and so the prior inverse variance is combined with the inverse of the data
variance. Inverse variance is often referred to as the precision. For the
normal model let,
σ
˜ 2 = 1/σ 2 = sampling precision, i.e. how close the yi ’s are to θ;
τ˜02 = 1/τ02 = prior precision;
τ˜n2 = 1/τn2 = posterior precision.
It is convenient to think about precision as the quantity of information on
an additive scale. For the normal model, Equation 5.1 implies that
τ˜n2 = τ˜02 + n˜
σ2 ,
and so posterior information = prior information + data information.
• Posterior mean: Notice that
µn =

τ˜02

τ˜02
n˜
σ2
µ0 + 2
y¯,
2
+ n˜
σ
τ˜0 + n˜
σ2

and so the posterior mean is a weighted average of the prior mean and
the sample mean. The weight on the sample mean is n/σ 2 , the sampling
precision of the sample mean. The weight on the prior mean is 1/τ02 , the
prior precision. If the prior mean were based on κ0 prior observations from
the same (or similar) population as Y1 , . . . , Yn , then we might want to set
τ02 = σ 2 /κ0 , the variance of the mean of the prior observations. In this
case, the formula for the posterior mean reduces to
µn =

κ0
n
µ0 +
y¯.
κ0 + n
κ0 + n

72

5 The normal model

Prediction
Consider predicting a new observation Y˜ from the population after having
observed (Y1 = y1 , . . . , Yn = yn ). To find the predictive distribution, let’s use
the following fact:
{Y˜ |θ, σ 2 } ∼ normal(θ, σ 2 ) ⇔ Y˜ = θ + ˜, {˜
|θ, σ 2 } ∼ normal(0, σ 2 ) .
In other words, saying that Y˜ is normal with mean θ is the same as saying
Y˜ is equal to θ plus some mean-zero normally distributed noise. Using this
result, let’s first compute the posterior mean and variance of Y˜ :
E[Y˜ |y1 , . . . , yn , σ 2 ] = E[θ + ˜|y1 , . . . , yn , σ 2 ]
= E[θ|y1 , . . . , yn , σ 2 ] + E[˜
|y1 , . . . , yn , σ 2 ]
= µn + 0 = µn
Var[Y˜ |y1 , . . . , yn , σ 2 ] = Var[θ + ˜|y1 , . . . , yn , σ 2 ]
= Var[θ|y1 , . . . , yn , σ 2 ] + Var[˜
|y1 , . . . , yn , σ 2 ]
= τn2 + σ 2 .
Recall from the beginning of the chapter that the sum of independent normal
random variables is also normal. Therefore, since both θ and ˜, conditional on
y1 , . . . , yn and σ 2 , are normally distributed, so is Y˜ = θ + ˜. The predictive
distribution is therefore
Y˜ |σ 2 , y1 , . . . , yn ∼ normal(µn , τn2 + σ 2 ) .
It is worthwhile to have some intuition about the form of the variance of Y˜ : In
general, our uncertainty about a new sample Y˜ is a function of our uncertainty
about the center of the population (τn2 ) as well as how variable the population
is (σ 2 ). As n → ∞ we become more and more certain about where θ is, and
the posterior variance τn2 of θ goes to zero. But certainty about θ does not
reduce the sampling variability σ 2 , and so our uncertainty about Y˜ never goes
below σ 2 .
Example: Midge wing length
Grogan and Wirth (1981) provide data on the wing length in millimeters of
nine members of a species of midge (small, two-winged flies). From these nine
measurements we wish to make inference on the population mean θ. Studies
from other populations suggest that wing lengths are typically around 1.9
mm, and so we set µ0 = 1.9. We also know that lengths must be positive,
implying that θ > 0. Therefore, ideally we would use a prior distribution for
θ that has mass only on θ > 0. We can approximate this restriction with a
normal prior distribution for θ as follows: Since for any normal distribution

5.3 Joint inference for the mean and variance

73

most of the probability is within two standard deviations of the mean, we
choose τ02 so that µ0 − 2 × τ0 > 0, or equivalently τ0 < 1.9/2 = 0.95. For now,
we take τ0 = 0.95, which somewhat overstates our prior uncertainty about θ.
The observations in order of increasing magnitude are (1.64, 1.70, 1.72,
1.74, 1.82, 1.82, 1.82, 1.90, 2.08), giving y¯ = 1.804. Using the formulae above
for µn and τn2 , we have {θ|y1 , . . . , y9 , σ 2 } ∼ normal (µn , τn2 ), where
µn =
τn2 =

1
µ + σn2 y¯
τ02 0
1
+ σn2
τ02
1
τ02

1
+

n
σ2

=

=

1.11 × 1.9 + σ92 1.804
1.11 + σ92

1
1.11 +

9
σ2

.

0

p( θ|y 1...y n ,σ
σ2 = 0.017)
2
4
6
8

If σ 2 = s2 = 0.017, then {θ|y1 , . . . , y9 , σ 2 = 0.017} ∼ normal (1.805, 0.002).
A 95% quantile-based confidence interval for θ based on this distribution is
(1.72, 1.89). However, this interval assumes that we are certain that σ 2 = s2 ,
when in fact s2 is only a rough estimate of σ 2 based on only nine observations.
To get a more accurate representation of our information we need to account
for the fact that σ 2 is not known.

0

1

2

3

θ

Fig. 5.3. Prior and conditional posterior distributions for the population mean wing
length in the midge example.

5.3 Joint inference for the mean and variance
Bayesian inference for two or more unknown parameters is not conceptually
different from the one-parameter case. For any joint prior distribution p(θ, σ 2 )
for θ and σ 2 , posterior inference proceeds using Bayes’ rule:

74

5 The normal model

p(θ, σ 2 |y1 , . . . , yn ) = p(y1 , . . . , yn |θ, σ 2 )p(θ, σ 2 )/p(y1 , . . . , yn ) .
As before, we will begin by developing a simple conjugate class of prior distributions which make posterior calculations easy.
Recall from our axioms of probability that a joint distribution for two
quantities can be expressed as the product of a conditional probability and a
marginal probability:
p(θ, σ 2 ) = p(θ|σ 2 )p(σ 2 ) .
In the last section, we saw that if σ 2 were known, then a conjugate prior
distribution for θ was normal(µ0 , τ02 ). Let’s consider the particular case in
which τ02 = σ 2 /κ0 :
√
p(θ, σ 2 ) = p(θ|σ 2 )p(σ 2 ) = dnorm(θ, µ0 , τ0 = σ/ κ0 ) × p(σ 2 ) .
In this case, the parameters µ0 and κ0 can be interpreted as the mean and
sample size from a set of prior observations.
For σ 2 we need a family of prior distributions that has support on (0, ∞).
One such family of distributions is the gamma family, as we used for the
Poisson sampling model. Unfortunately, this family is not conjugate for the
normal variance. However, the gamma family does turn out to be a conjugate
class of densities for 1/σ 2 (the precision). When using such a prior distribution
we say that σ 2 has an inverse-gamma distribution:
precision = 1/σ 2 ∼ gamma(a, b)
variance = σ 2 ∼ inverse-gamma(a, b)
For interpretability later on, instead of using a and b we will parameterize this
prior distribution as
1/σ 2 ∼ gamma (

ν0 ν0 2
, σ ).
2 2 0

Under this parameterization,
0 /2
• E[σ 2 ] = σ02 ν0ν/2−1
;
0 /2
• mode[σ 2 ] = σ02 ν0ν/2+1
,
so mode[σ 2 ] < σ02 < E[σ 2 ];
• Var[σ 2 ] is decreasing in ν0 .

As we will see in a moment, we can interpret the prior parameters (σ02 , ν0 ) as
the sample variance and sample size of prior observations.
Posterior inference
Suppose our prior distributions and sampling model are as follows:
1/σ 2 ∼ gamma(ν0 /2, ν0 σ02 /2)
θ|σ 2 ∼ normal(µ0 , σ 2 /κ0 )
Y1 , . . . , Yn |θ, σ 2 ∼ i.i.d. normal (θ, σ 2 ) .

5.3 Joint inference for the mean and variance

75

Just as the prior distribution for θ and σ 2 can be decomposed as p(θ, σ 2 ) =
p(θ|σ 2 )p(σ 2 ), the posterior distribution can be similarly decomposed:
p(θ, σ 2 |y1 , . . . , yn ) = p(θ|σ 2 , y1 , . . . , yn )p(σ 2 |y1 , . . . , yn ) .
The conditional distribution of θ given the data and σ 2 can be obtained using
the results of the previous section: Plugging in σ 2 /κ0 for τ02 , we have
{θ|y1 , . . . , yn , σ 2 } ∼ normal(µn , σ 2 /κn ), where
(κ0 /σ 2 )µ0 + (n/σ 2 )¯
y
κ0 µ0 + n¯
y
κn = κ0 + n and µn =
=
.
κ0 /σ 2 + n/σ 2
κn
Therefore, if µ0 is the mean of κ0 prior observations, then E[θ|y1 , . . . , yn , σ 2 ] is
the sample mean of the current and prior observations, and Var[θ|y1 , . . . , yn , σ 2 ]
is σ 2 divided by the total number of observations, both prior and current.
The posterior distribution of σ 2 can be obtained by performing an integration over the unknown value of θ:
p(σ 2 |y1 , . . . , yn ) ∝ p(σ 2 )p(y1 , . . . , yn |σ 2 )
Z
= p(σ 2 ) p(y1 , . . . , yn |θ, σ 2 )p(θ|σ 2 ) dθ .
This integral can be done without much knowledge of calculus, but it is somewhat tedious and is left as an exercise (Exercise 5.3). The result is that
{1/σ 2 |y1 , . . . , yn } ∼ gamma(νn /2, νn σn2 /2), where
νn = ν0 + n
1
κ0 n
σn2 =
[ν0 σ02 + (n − 1)s2 +
(¯
y − µ0 )2 ].
νn
κn
These formulae suggest an interpretation of ν0 as a prior sample size, from
2
which
that s2 =
Pn a prior2 sample variance of σ0 has been obtained. Recall
2
¯) /(n − 1) is the sample variance, and (n − 1)s is the sum of
i=1 (yi − y
squared observations from the sample mean, which is often called the “sum
of squares.” Similarly, we can think of ν0 σ02 and νn σn2 as prior and posterior
sums of squares, respectively. Multiplying both sides of the last equation by
νn almost gives us “posterior sum of squares equals prior sum of squares plus
data sum of squares.” However, the third term in the last equation is a bit
harder to understand - it says that a large value of (¯
y − µ0 )2 increases the
2
posterior probability of a large σ . This makes sense for our particular joint
prior distribution for θ and σ 2 : If we want to think of µ0 as the sample mean of
n
(¯
y −µ0 )2 is an estimate of σ 2
κ0 prior observations with variance σ 2 , then κκ00+n
and so we want to use the information that this term provides. For situations
in which µ0 should not be thought of as the mean of prior observations, we
will develop an alternative prior distribution in the next chapter.

76

5 The normal model

Example
Returning to the midge data, studies of other populations suggest that the true
mean and standard deviation of our population under study should not be too
far from 1.9 mm and 0.1 mm respectively, suggesting µ0 = 1.9 and σ02 = 0.01.
However, this population may be different from the others in terms of wing
length, and so we choose κ0 = ν0 = 1 so that our prior distributions are only
weakly centered around these estimates from other populations.
The sample mean and variance of our observed data are y¯ = 1.804 and
s2 = 0.0169 (s = 0.130). From these values and the prior parameters, we
compute µn and σn2 :
κ0 µ0 + n¯
y
1.9 + 9 × 1.804
=
= 1.814
κn
1+9
1
κ0 n
σn2 =
[ν0 σ02 + (n − 1)s2 +
(¯
y − µ0 )2 ]
νn
κn
0.010 + 0.135 + 0.008
=
= 0.015 .
10

µn =

These calculations can be done with the following commands in R:
# prior
mu0<−1.9 ; k0<−1
s20 <−.010 ; nu0<−1
# data
y<−c ( 1 . 6 4 , 1 . 7 0 , 1 . 7 2 , 1 . 7 4 , 1 . 8 2 , 1 . 8 2 , 1 . 8 2 , 1 . 9 0 , 2 . 0 8 )
n<−l e n g t h ( y ) ; ybar<−mean ( y ) ; s2<−var ( y )
# posterior inference
kn<−k0+n ; nun<−nu0+n
mun<− ( k0 ∗mu0 + n∗ ybar ) / kn
s2n<− ( nu0∗ s 2 0 +(n−1)∗ s 2 +k0 ∗n ∗ ( ybar−mu0 ) ˆ 2 / ( kn ) ) / ( nun )
> mun
[ 1 ] 1.814
> s2n
[ 1 ] 0.015324
> s q r t ( s2n )
[ 1 ] 0.1237901

Our joint posterior distribution is completely determined by the values µn =
1.814, κn = 10, σn2 = 0.015, νn = 10, and can be expressed as
{θ|y1 , . . . , yn , σ 2 } ∼ normal(1.814, σ 2 /10),
{1/σ 2 |y1 , . . . , yn } ∼ gamma(10/2, 10 × 0.015/2).
Letting σ
˜ 2 = 1/σ 2 , a contour plot of the bivariate posterior density of (θ, σ
˜2)
appears in the first panel of Figure 5.4. This plot was obtained by computing

5.3 Joint inference for the mean and variance

77

20

40

0.01

60

σ2
0.02

~2
σ
80 100

0.03

140

0.04

p
dnorm(θk , µn , 1/ 10˜
σl2 ) × dgamma(˜
σl2 , 10/2, 10σn2 /2) for each pair of values
2
(θk , σ
˜l ) on a grid. Similarly, the second panel plots the joint posterior density
of (θ, σ 2 ). Notice that the contours are more peaked as a function of θ for low
values of σ 2 than high values.

1.6

1.7

1.8
θ

1.9

2.0

1.6

1.7

1.8
θ

1.9

2.0

Fig. 5.4. Joint posterior distributions of (θ, σ
˜ 2 ) and (θ, σ 2 ).

Monte Carlo sampling
For many data analyses, interest primarily lies in estimating the population mean θ, and so we would like to calculate quantities like E[θ|y1 , . . . , yn ],
sd[θ|y1 , . . . , yn ], Pr(θ1 < θ2 | y1,1 ,. . ., yn2 ,2 ), and so on. These quantities are
all determined by the marginal posterior distribution of θ given the data. But
all we know (so far) is that the conditional distribution of θ given the data
and σ 2 is normal, and that σ 2 given the data is inverse-gamma. If we could
generate marginal samples of θ, from p(θ|y1 , . . . , yn ), then we could use the
Monte Carlo method to approximate the above quantities of interest. It turns
out that this is quite easy to do by generating samples of θ and σ 2 from their
joint posterior distribution. Consider simulating parameter values using the
following Monte Carlo procedure:
σ 2(1) ∼ inverse gamma(νn /2, σn2 νn /2),
..
.

θ(1) ∼ normal(µn , σ 2(1) /κn )
..
.

σ 2(S) ∼ inverse gamma(νn /2, σn2 νn /2),

θ(S) ∼ normal(µn , σ 2(S) /κn ) .

Note that each θ(s) is sampled from its conditional distribution given the data
and σ 2 = σ 2(s) . This Monte Carlo procedure can be implemented in R with
only two lines of code:

78

5 The normal model

s 2 . p o s t s a m p l e <− 1/rgamma ( 1 0 0 0 0 , nun / 2 , s2n ∗nun /2 )
t h e t a . p o s t s a m p l e <− rnorm ( 1 0 0 0 0 , mun , s q r t ( s 2 . p o s t s a m p l e /kn ) )

A sequence of pairs {(σ 2(1) , θ(1) ), . . . , (σ 2(S) , θ(S) )} simulated using this procedure are independent samples from the joint posterior distribution of
p(θ, σ 2 |y1 , . . . , yn ). Additionally, the simulated sequence {θ(1) , . . . , θ(S) } can
be seen as independent samples from the marginal posterior distribution of
p(θ|y1 , . . . , yn ), and so we use this sequence to make Monte Carlo approximations to functions involving p(θ|y1 , . . . , yn ), as described in Chapter 4. It
may seem confusing that each θ(s) -value is referred to both as a sample from
the conditional posterior distribution of θ given σ 2 and as a sample from
the marginal posterior distribution of θ given only the data. To alleviate this
confusion, keep in mind that while θ(1) , . . . , θ(S) are indeed each conditional
samples, they are each conditional on different values of σ 2 . Taken together,
they constitute marginal samples of θ.
Figure 5.5 shows samples from the joint posterior distribution of (θ, σ 2 ),
as well as kernel density estimates of the marginal posterior distributions.
Any posterior quantities of interest can be approximated from these Monte
Carlo samples. For example, a 95% confidence interval can be obtained in R
with quantile(theta.postsample,c (.025,.975)) , which gives an interval of (1.73,
1.90). This is extremely close to (1.70, 1.90), a frequentist 95% confidence
interval obtained from the t-test. There is a reason for this: It turns out that
p(θ|y1 , . . . , yn ), the marginal posterior distribution of θ, can be obtained in a
closed form. From this form, it can be shown that the posterior distribution
)
√n , given y
of t(θ) = σ(θ−µ
¯ and s2 , has a t-distribution with ν0 + n degrees of
n / κn
freedom. If κ0 and ν0 are small, then the posterior distribution of t(θ) will be
very close to the tn−1 distribution. How small can κ0 and ν0 be?
Improper priors
What if you want to “be Bayesian” so you can talk about things like Pr(θ <
c|y1 , . . . , yn ) but want to “be objective” by not using any prior information?
Since we have referred to κ0 and ν0 as prior sample sizes, it might seem that
the smaller these parameters are, the more objective the estimates will be. So
it is natural to wonder what happens to the posterior distribution as κ0 and
ν0 get smaller and smaller. The formulae for µn and σn2 are
κ0 µ0 + n¯
y
κ0 + n
1
κ0 n
σn2 =
[ν0 σ02 + (n − 1)s2 +
(¯
y − µ0 )2 ],
ν0 + n
κ0 + n

µn =

and so as κ0 , ν0 → 0,
µn → y¯, and
n−1 2
1X
σn2 →
s =
(yi − y¯)2 .
n
n

5.4 Bias, variance and mean squared error

79

This has led some to suggest the following “posterior distribution”:
n n1X
{1/σ 2 |y1 , . . . , yn } ∼ gamma( ,
(yi − y¯)2 )
2 2n
σ2
{θ|σ 2 , y1 , . . . , yn } ∼ normal(¯
y, ) .
n
Somewhat more formally, if we let p˜(θ, σ 2 ) = 1/σ 2 (which is not a probability
2
density) and set p(θ, σ 2 |y) ∝ p(y|θ, σ 2 ) × p˜(θ, σP
), we get the same “condin−1 1
tional distribution” for θ but a gamma( 2 , 2 (yi − y¯)2 ) distribution for
1/σ 2 (Gelman et al (2004), Chapter 3). You can integrate this latter joint
distribution over σ 2 to show that
θ − y¯
√ |y1 , . . . , yn ∼ tn−1 .
s/ n
It is interesting to compare this result to the sampling distribution of the
t-statistic, conditional on θ but unconditional on the data:
Y¯ − θ
√ |θ ∼ tn−1 .
s/ n
The second statement says that, before you sample the data, your uncertainty
about the scaled deviation of the sample mean Y¯ from the population mean θ
is represented with a tn−1 distribution. The first statement says that after you
sample your data, your uncertainty is still represented with a tn−1 distribution.
The difference is that before you sample your data, both Y¯ and θ are unknown.
After you sample your data, then Y¯ = y¯ is known and this provides us with
information about θ.
There are no proper prior probability distributions on (θ, σ 2 ) that will lead
to the above tn−1 posterior distribution for θ, and so inference based on this
posterior distribution is not formally Bayesian. However, sometimes taking
limits like this leads to sensible answers: Theoretical results in Stein (1955)
show that from a decision-theoretic point of view, any reasonable estimator is
a Bayesian estimator or a limit of a sequence of Bayesian estimators, and that
any Bayesian estimator is reasonable (the technical term here is admissible;
see also Berger (1980)).

5.4 Bias, variance and mean squared error
A point estimator of an unknown parameter θ is a function that converts
your data into a single element of the parameter space Θ. For example, in the
case of a normal sampling model and conjugate prior distribution of the last
section, the posterior mean estimator of θ is
θˆb (y1 , . . . , yn ) = E[θ|y1 , . . . , yn ] =

n
κ0
y¯ +
µ0 = w¯
y + (1 − w)µ0 .
κ0 + n
κ0 + n

5 The normal model

0.01

0.02

0.03

σ2
0.04

0.05

0.06

0.07

80

1.7

1.8
θ

1.9

2.0

0

0

10

2

p( σ2|y 1...y n )
20
30

p( θ|y 1...y n )
4
6

40

8

50

1.6

0.00

0.02

0.04
σ2

0.06

1.6

1.7

1.8
θ

1.9

2.0

Fig. 5.5. Monte Carlo samples from and estimates of the joint and marginal distributions of the population mean and variance. The vertical lines in the third plot give
a 95% quantile-based posterior interval for θ (gray), as well as the 95% confidence
interval based on the t-statistic (black).

The sampling properties of an estimator such as θˆb refer to its behavior under
hypothetically repeatable surveys or experiments. Let’s compare the sampling
properties of θˆb to θˆe (y1 , . . . , yn ) = y¯, the sample mean, when the true value
of the population mean is θ0 :
E[θˆe |θ = θ0 ] = θ0 , and we say that θˆe is “unbiased,”
E[θˆb |θ = θ0 ] = wθ0 + (1 − w)µ0 , and if µ0 6= θ0 we say that θˆb is “biased.”
Bias refers to how close the center of mass of the sampling distribution of an
estimator is to the true value. An unbiased estimator is an estimator with
zero bias, which sounds desirable. However, bias does not tell us how far away

5.4 Bias, variance and mean squared error

81

an estimate might be from the true value. For example, y1 is an unbiased
estimator of the population mean θ0 , but will generally be farther away from
θ0 than y¯. To evaluate how close an estimator θˆ is likely to be to the true
ˆ 0 ],
value θ0 , we might use the mean squared error (MSE). Letting m = E[θ|θ
the MSE is
ˆ 0 ] = E[(θˆ − θ0 )2 |θ0 ]
MSE[θ|θ
= E[(θˆ − m + m − θ0 )2 |θ0 ]
= E[(θˆ − m)2 |θ0 ] + 2E[(θˆ − m)(m − θ0 )|θ0 ] + E[(m − θ0 )2 |θ0 ].
ˆ 0 ] it follows that E[θˆ − m|θ0 ] = 0 and so the second term is
Since m = E[θ|θ
zero. The first term is the variance of θˆ and the third term is the square of
the bias and so
ˆ 0 ] = Var[θ|θ
ˆ 0 ] + Bias2 [θ|θ
ˆ 0 ].
MSE[θ|θ
This means that, before the data are gathered, the expected distance from
the estimator to the true value depends on how close θ0 is to the center of the
distribution of θˆ (the bias), as well as how spread out the distribution is (the
variance). Getting back to our comparison of θˆb to θˆe , the bias of θˆe is zero,
but
σ2
, whereas
n
σ2
σ2
Var[θˆb |θ = θ0 , σ 2 ] = w2 ×
<
,
n
n

Var[θˆe |θ = θ0 , σ 2 ] =

and so θˆb has lower variability. Which one is better in terms of MSE?
σ2
MSE[θˆe |θ0 ] = E[(θˆe − θ0 )2 |θ0 ] =
n
2
ˆ
ˆ
MSE[θb |θ0 ] = E[(θb − θ0 ) |θ0 ] = E[{w(¯
y − θ0 ) + (1 − w)(µ0 − θ0 )}2 |θ0 ]
σ2
= w2 ×
+ (1 − w)2 (µ0 − θ0 )2
n
With some algebra, you can show that MSE[θˆb |θ0 ] < MSE[θˆe |θ0 ] if
σ2 1 + w
n 1−w


1
2
= σ2
+
.
n κ0

(µ0 − θ0 )2 <

Some argue that if you know even just a little bit about the population you
are about to sample from, you should be able to find values of µ0 and κ0
such that this inequality holds. In this case, you can construct a Bayesian
estimator that will have a lower average squared distance to the truth than
does the sample mean. For example, if you are pretty sure that your best

82

5 The normal model

prior guess µ0 is within two standard deviations of the true population mean,
then if you pick κ0 = 1 you can be pretty sure that the Bayes estimator has a
lower MSE. To make some of this more clear, let’s take a look at the sampling
distributions of a few different estimators in the context of an example.
Example: IQ scores
Scoring on IQ tests is designed to produce a normal distribution with a mean
of 100 and a standard deviation of 15 (a variance of 225) when applied to
the general population. Now suppose we are to sample n individuals from a
particular town in the United States and then estimate θ, the town-specific
mean IQ score, based on the sample of size n. For Bayesian estimation, if
we lack much information about the town in question, a natural choice of µ0
would be µ0 = 100.
Suppose that unknown to us the people in this town are extremely exceptional and the true mean and standard deviation of IQ scores in the town are
θ = 112 and σ = 13 (σ 2 = 169). The MSEs of the estimators θˆe and θˆb are
then
MSE[θˆe |θ0 ] = Var[θˆe ] =
MSE[θˆb |θ0 ] = w2

σ2
169
=
n
n

169
+ (1 − w)2 144,
n

0.08

0.12

relative MSE
0.4 0.5 0.6 0.7 0.8 0.9 1.0 1.1

where w = n/(κ0 + n). The ratio MSE[θˆb |θ0 ]/MSE[θˆe |θ0 ] is plotted in the first
panel of Figure 5.6 as a function of n, for κ0 = 1, 2 and 3.

0.00

0.04

κ0 = 0
κ0 = 1
κ0 = 2
κ0 = 3

0

10

20
30
sample size

40

50

95

100 105 110 115 120 125
IQ

Fig. 5.6. Mean squared errors and sampling distributions of different estimators of
the population mean IQ score.

5.5 Prior specification based on expectations

83

Notice that when κ0 = 1 or 2 the Bayes estimate has lower MSE than
the sample mean, especially when the sample size is low. This is because even
though the prior guess µ0 = 100 is seemingly way off, it is not actually that far
off when considering the uncertainty in our sample data. A choice of κ0 = 3 on
the other hand puts more weight on the value of 100, and the corresponding
estimator has a generally higher MSE than the sample mean. As n increases,
the bias of each of the estimators shrinks to zero, and the MSEs converge to
the common value of σ 2 /n. The second panel of Figure 5.6 shows the sampling
distributions of the sample mean when n = 10, as well as those of the three
Bayes estimators corresponding to κ0 = 1, 2 and 3. This plot highlights the
relative contributions of the bias and variance to the MSE. The sampling
distribution of the sample mean is centered around the true value of 112, but
is more spread out than any of the other distributions. The distribution of the
κ0 = 1 estimator is not quite centered around the true mean, but its variance
is low and so this estimator is closer on average to the truth than the sample
mean.

5.5 Prior specification based on expectations
A p-dimensional exponential family model is a model whose densities can be
written as p(y|φ) = h(y)c(φ) exp{φT t(y)}, where φ is the parameter to be
estimated and t(y) = {t1 (y), . . . , tp (y)} is the sufficient statistic. The normal
model is a two-dimensional exponential family model, where
• t(y) = (y, y 2 ),
• φ = (θ/σ 2 , −(2σ 2 )−1 ) and
• c(φ) = |φ2 |1/2 exp{φ21 /(2φ2 )}.
As was the case for one-parameter exponential family models in Section
3.3, a conjugate prior distribution can be written in terms of φ, giving
p(φ|n0 , t0 ) ∝ c(φ)n0 exp(n0 tT0 φ), where t0 = (t01 , t02 ) = (E[Y ], E[Y 2 ]), the
prior expectations of Y and Y 2 . If we reparameterize in terms of (θ, σ 2 ), we
get



−n0 (θ − t01 )2
2
2 −1/2
p(θ, σ |n0 , t0 ) ∝ (σ )
exp
×
2σ 2



−n0 (t02 − t201 )
2 −(n0 +5)/2
(σ )
exp
.
2σ 2
The first term in the big braces is proportional to a normal(t01 , σ 2 /n0 ) density,
and the second is proportional to an inverse-gamma((n0 + 3)/2, n0 (t2 − t21 )/2)
density. To see how our prior parameters t01 and t02 should be determined,
let’s consider the case where we have a prior expectation µ0 for the population
mean (so E[Y ] = E[E[Y |θ]] = E[θ] = µ0 ), and a prior expectation σ02 for the

84

5 The normal model

population variance (so that E[Var[Y |θ, σ 2 ]] = E[σ 2 ] = σ02 ). Then we would
set t01 equal to µ0 , and determine t02 from
t02 = E[Y 2 ] = E[E[Y 2 |θ, σ 2 ]]
= E[σ 2 + θ2 ]
= σ02 + σ02 /n0 + µ20 = σ02 (n0 + 1)/n0 + µ20 ,
so n0 (t02 − t201 ) = (n0 + 1)σ02 . Thus our joint prior distribution for (θ, σ 2 )
would be
θ|σ 2 ∼ normal(µ0 , σ 2 /n0 ), and
σ 2 ∼ inverse-gamma((n0 + 3)/2, (n0 + 1)σ02 /2).
For example, if our prior information is weak we might set n0 = 1, giving
θ|σ 2 ∼ normal(µ0 , σ 2 ) and 1/σ 2 ∼ inverse-gamma(2, σ02 ). It is easy to check
that under this prior distribution the prior expectation of Y is µ0 , and the
prior expectation of Var[Y |θ, σ 2 ] is σ02 , as desired. Given n i.i.d samples from
the population, our posterior distribution under this prior would be


µ0 /σ 2 + n¯
y σ2
,
{θ|σ 2 , y1 , . . . , yn } ∼ normal
1/σ 2 + n n + 1


n
{σ 2 |y1 , . . . , yn } ∼ 2 + n/2, σ02 + (n − 1)s2 +
(¯
y − µ0 )2 .
n+1

5.6 The normal model for non-normal data
People use the normal model all the time in situations where the data are not
even close to being normally distributed. The justification of this is generally
that while the sampling distribution of a single data point is not normal, the
sampling distribution of the sample mean is close to normal. Let’s explore this
distinction via a Monte Carlo sampling experiment: The 1998 General Social
Survey (GSS) recorded the number of children for 921 women over the age of
40. Let’s take these 921 women as our population, and consider estimating the
mean number of children for this population (which is 2.42) based on random
samples Y1 , . . . , Yn of different sizes n.
The true population distribution is plotted in the first panel of Figure 5.7,
and is clearly not normal. For example, the distribution is discrete, bounded
and skewed, whereas a normal distribution is continuous, unbounded and
symmetric.
PnNow let’s consider the sampling distribution of the sample mean
Y¯n = n1 i=1 Yi for n ∈ {5, 15, 45}. This can be done using a Monte Carlo
approximation as follows: For each n and some large value of S, simulate
(1)
(S)
(s)
{¯
yn , . . . , y¯n }, where each y¯n is the sample mean of n samples taken without
replacement from the 921 values in the population. The second panel of Figure
5.7 shows the Monte Carlo approximations to the sampling distributions of

0 1 2 3 4 5 6 7 8
y=number of children

6
1

0.0

0.00

2

0.5

3

s2

4

p (y )
1.0

p (y )
0.10
0.20

85

5

n=5
n=15
n=45

1.5

0.30

5.6 The normal model for non-normal data

0

1 2 3 4 5
number of children

6

1.5

2.0

2.5

3.0

y

Fig. 5.7. A non-normal distribution and the distribution of its sample mean for
n ∈ {5, 15, 45}. The third panel shows a contour plot of the joint sampling density
of {¯
y , s2 } for the case n = 45.

Y¯5 ,Y¯15 and Y¯45 . While the distribution of Y¯5 looks a bit skewed, the sampling
distributions of Y¯15 and Y¯45 are hard to distinguish from normal distributions.
This should not be too much of a surprise, as the central limit theorem tells
us that
p
p(¯
y |θ, σ 2 ) ≈ dnorm(¯
y , θ, σ 2 /n),
with the approximation becoming increasingly good as n gets larger. If the
population variance σ 2 were known, then an approximate posterior distribution of the population mean, conditional on the sample mean, could be
obtained as
p(θ|¯
y , σ 2 ) ∝ p(θ) × p(¯
y |θ, σ 2 )
≈ p(θ) × dnorm(¯
y , θ,

p
σ 2 /n).

Of course σ 2 is generally not known, but it is estimated by s2 . The approximate posterior distribution of (θ, σ 2 ) conditional on the estimates (¯
y , s2 ) is
given by
p(θ, σ 2 |¯
y , s2 ) ∝ p(θ, σ 2 ) × p(¯
y , s2 |θ, σ 2 )
= p(θ, σ 2 ) × p(¯
y |θ, σ 2 ) × p(s2 |¯
y , θ, σ 2 )
p
≈ p(θ, σ 2 ) × dnorm(¯
y , θ, σ 2 /n) × p(s2 |¯
y , θ, σ 2 ).

(5.2)

Again, for large n, the approximation of p(¯
y |θ, σ 2 ) by the normal density
is generally a good one even if the population is not normally distributed.
However, it is not clear what to put for p(s2 |¯
y , θ, σ 2 ). If we knew that the
data were actually sampled from a normal distribution, then results from
statistical theory would say that
n−1 n−1
,
).
2
2σ 2
Note that this result says that, for normal populations, Y¯ and s2 are independent. Using this sampling model for s2 in Equation 5.2 results in exactly
p(s2 |¯
y , θ, σ 2 ) = dgamma(s2 ,

86

5 The normal model

the same conditional distribution for (θ, σ 2 ) as p(θ, σ 2 |y1 , . . . , yn ) assuming
that the data are normally distributed. However, if the data are not normally
distributed, then s2 is not necessarily gamma-distributed or independent of
y¯. For example, the third panel of Figure 5.7 shows the joint sampling distribution of {Y¯ , s2 } for the GSS population. Notice that Y¯ and s2 are positively
correlated for this population, as is often the case for positively skewed populations. This suggests that the use of the posterior distribution in Equation
5.2 for non-normal data could give misleading results about the joint distribution of {θ, σ 2 }. However, the marginal posterior distribution of θ based on
5.2 can be remarkably accurate, even for non-normal data. The reasoning is
as follows: The central limit theorem says that for large n
√ Y¯ − θ ·
n
∼ normal(0, 1),
σ
·

where ∼ means “approximately distributed as.” Additionally, if n is sufficiently large, then s2 ≈ σ 2 and so
√ Y¯ − θ ·
n
∼ normal(0, 1).
s
This should
seem familiar: Recall from introductory statistics that for normal
√
data, n(Y¯ − θ)/s has a t-distribution with n − 1 degrees of freedom. For
large n, s2 is very close to σ 2 and the tn−1 distribution is very close to a
normal(0, 1) distribution.
Even though the posterior distribution based on a normal model may provide good inference for the population mean, the normal model can provide
misleading results for other sample quantities. For example, every normal density is symmetric and has a skew of zero, whereas our true population in the
above example has a skew of E[(Y − θ)3 ]/σ 3 = 0.89. Normal-model inference
for samples from this population will underestimate the number of people in
the right tail of the distribution, and so will provide poor estimates of the percentage of people with large numbers of children. In general, using the normal
model for non-normal data is reasonable if we are only interested in obtaining a posterior distribution for the population mean. For other population
quantities the normal model can provide misleading results.

5.7 Discussion and further references
The normal sampling model can be justified in many different ways. For example, Lukacs (1942) shows that a characterizing feature of the normal distribution is that the sample mean and the sample variance are independent (see
also Rao (1958)). From a subjective probability perspective, this suggests that
if your beliefs about the sample mean are independent from those about the
sample variance, then a normal model is appropriate. Also, among all distributions with a given mean θ and variance σ 2 , the normal(θ, σ 2 ) distribution

5.7 Discussion and further references

87

is the most diffuse in terms of a measure known as entropy (see Jaynes, 2003,
Chap.7, Chap.11).
From a data analysis perspective, one justification of the normal sampling
model is that, as described in Section 5.6, the sample mean will generally be
approximately normally distributed due to the central limit theorem. Thus
the normal model provides a reasonable sampling model for the sample mean,
if not the sample data. Additionally, the normal model is a simple exponential
family model with sufficient statistics equivalent to the sample mean and variance. As a result, it will provide consistent estimation of the population mean
and variance even if the underlying population is not normal. Additionally,
confidence intervals for the population mean based on the normal model will
generally be asymptotically correct (these results can be derived from those
in White (1982)). However, the normal model may give inaccurate inference
for other population quantities.

6
Posterior approximation with the Gibbs
sampler

For many multiparameter models the joint posterior distribution is nonstandard and difficult to sample from directly. However, it is often the case
that it is easy to sample from the full conditional distribution of each parameter. In such cases, posterior approximation can be made with the Gibbs
sampler, an iterative algorithm that constructs a dependent sequence of parameter values whose distribution converges to the target joint posterior distribution. In this chapter we outline the Gibbs sampler in the context of the
normal model with a semiconjugate prior distribution, and discuss how well
the method is able to approximate the posterior distribution.

6.1 A semiconjugate prior distribution
In the previous chapter we modeled our uncertainty about θ as depending on
σ2 :
√
p(θ|σ 2 ) = dnorm (θ, µ0 , σ/ κ0 ) .
This prior distribution relates the prior variance of θ to the sampling variance
of our data in such a way that µ0 can be thought of as κ0 prior samples
from the population. In some situations this makes sense, but in others we
may want to specify our uncertainty about θ as being independent of σ 2 ,
so that p(θ, σ 2 ) = p(θ) × p(σ 2 ). One such joint distribution is the following
“semiconjugate” prior distribution:
θ ∼ normal(µ0 , τ02 )
1/σ 2 ∼ gamma(ν0 /2, ν0 σ02 /2) .
If {Y1 , . . . , Yn |θ, σ 2 } ∼ i.i.d. normal(θ, σ 2 ), we showed in Section 5.2 that
{θ|σ 2 , y1 , . . . , yn } ∼ normal(µn , τn2 ) with

−1
1
n
µ0 /τ02 + n¯
y /σ 2
2
µn =
and τn =
+ 2
.
1/τ02 + n/σ 2
τ02
σ
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 6,
c Springer Science+Business Media, LLC 2009


90

6 Posterior approximation with the Gibbs sampler

In the conjugate case where τ02 was proportional to σ 2 , we showed that
p(σ 2 |y1 , . . . , yn ) was an inverse-gamma distribution, and that a Monte Carlo
sample of {θ, σ 2 } from their joint posterior distribution could be obtained by
sampling
1. a value σ 2(s) from p(σ 2 |y1 , . . . , yn ), an inverse-gamma distribution, then
2. a value θ(s) from p(θ|σ 2(s) , y1 , . . . , yn ), a normal distribution.
However, in the case where τ02 is not proportional to σ 2 , the marginal density
of 1/σ 2 is not a gamma distribution, or any other standard distribution from
which we can easily sample.

6.2 Discrete approximations
Letting σ
˜ 2 = 1/σ 2 be the precision, recall that the posterior distribution
2
of {θ, σ
˜ } is equal to the joint distribution of {θ, σ 2 , y1 , . . . , yn }, divided by
p(y1 , . . . , yn ), which does not depend on the parameters. Therefore the relative posterior probabilities of one set of parameter values {θ1 , σ
˜12 } to another
2
{θ2 , σ
˜2 } is directly computable:
p(θ1 , σ
˜12 |y1 , . . . , yn )
p(θ1 , σ
˜12 , y1 , . . . , yn )/p(y1 , . . . , yn )
=
2
p(θ2 , σ
˜2 |y1 , . . . , yn )
p(θ2 , σ
˜22 , y1 , . . . , yn )/p(y1 , . . . , yn )
p(θ1 , σ
˜12 , y1 , . . . , yn )
=
.
p(θ2 , σ
˜22 , y1 , . . . , yn )
The joint distribution is easy to compute as it was built out of standard prior
and sampling distributions:
p(θ, σ
˜ 2 , y1 , . . . , yn ) = p(θ, σ
˜ 2 ) × p(y1 , . . . , yn |θ, σ
˜2)
= dnorm(θ, µ0 , τ0 ) × dgamma(˜
σ 2 , ν0 /2, ν0 σ02 /2) ×
n
Y
√
dnorm(yi , θ, 1/ σ
˜ 2 ).
i=1

A discrete approximation to the posterior distribution makes use of these
facts by constructing a posterior distribution over a grid of parameter values, based on relative posterior probabilities. This is done by evaluating
p(θ, σ
˜ 2 , y1 , . . . , yn ) on a two-dimensional grid of values of {θ, σ
˜ 2 }. Letting
2
2
{θ1 , . . . , θG } and {˜
σ1 , . . . , σ
˜H } be sequences of evenly spaced parameter values, the discrete approximation to the posterior distribution assigns a posterior probability to each pair {θk , σ
˜l2 } on the grid, given by

6.2 Discrete approximations

91

p(θk , σ
˜l2 |y1 , . . . , yn )
PH
˜h2 |y1 , . . . , yn )
g=1
h=1 p(θg , σ

pD (θk , σ
˜l2 |y1 , . . . , yn ) = PG

p(θk , σ
˜l2 , y1 , . . . , yn )/p(y1 , . . . , yn )
PH
˜h2 , y1 , . . . , yn )/p(y1 , . . . , yn )
g=1
h=1 p(θg , σ

= PG

p(θk , σ
˜l2 , y1 , . . . , yn )
.
PH
˜h2 , y1 , . . . , yn )
g=1
h=1 p(θg , σ

= PG

This is a real joint probability distribution for θ ∈ {θ1 , . . . , θG } and σ
˜2 ∈
2
2
{˜
σ1 , . . . , σ
˜H }, in the sense that it sums to 1. In fact, it is the actual posterior
distribution of {θ, σ
˜ 2 } if the joint prior distribution for these parameters is
discrete on this grid.
Let’s try the approximation for the midge data from the previous chapter.
Recall that our data were {n = 9, y¯ = 1.804, s2 = 0.017}. The conjugate prior
distribution on θ and σ 2 of Chapter 5 required that the prior variance on θ be
σ 2 /κ0 , i.e. proportional to the sampling variance. A small value of the sampling variance then has the possibly undesirable effect of reducing the nominal
prior uncertainty for θ. In contrast, the semiconjugate prior distribution frees
us from this constraint. Recall that we first suggested that the prior mean
and standard deviation of θ should be µ0 = 1.9 and τ0 = .95, as this would
put most of the prior mass on θ > 0, which we know to be true. For σ 2 , let’s
use prior parameters of ν0 = 1 and σ02 = 0.01.
The R -code below evaluates p(θ, σ
˜ 2 |y1 , . . . , yn ) on a 100×100 grid of evenly
spaced parameter values, with θ ∈ {1.505, 1.510, . . . , 1.995, 2.00} and σ
˜2 ∈
{1.75, 3.5, . . . , 173.25, 175.0}. The first panel of Figure 6.1 gives the discrete
approximation to the joint distribution of {θ, σ
˜ 2 }. Marginal and conditional
posterior distributions for θ and σ
˜ 2 can be obtained from the approximation
to the joint distribution with simple arithmetic. For example,
pD (θk |y1 , . . . , yn ) =

H
X

pD (θk , σ
˜h2 |y1 , . . . , yn ).

h=1

The resulting discrete approximations to the marginal posterior distributions
of θ and σ
˜ 2 are shown in the second and third panels of Figure 6.1.
mu0<−1.9 ; t20 <−0.95ˆ2 ; s20 <−.01 ; nu0<−1
y<−c ( 1 . 6 4 , 1 . 7 0 , 1 . 7 2 , 1 . 7 4 , 1 . 8 2 , 1 . 8 2 , 1 . 8 2 , 1 . 9 0 , 2 . 0 8 )
G<−100 ; H<−100
mean . g r i d <−s e q ( 1 . 5 0 5 , 2 . 0 0 , l e n g t h=G)
p r e c . g r i d <−s e q ( 1 . 7 5 , 1 7 5 , l e n g t h=H)
p o s t . g r i d <−ma t r i x ( nrow=G, n c o l=H)
f o r ( g i n 1 :G) {

92

6 Posterior approximation with the Gibbs sampler

f o r ( h i n 1 :H) {
p o s t . g r i d [ g , h]<−
dnorm ( mean . g r i d [ g ] , mu0 , s q r t ( t 2 0 ) ) ∗
dgamma( p r e c . g r i d [ h ] , nu0 / 2 , s 2 0 ∗nu0 /2 ) ∗
prod ( dnorm ( y , mean . g r i d [ g ] , 1 / s q r t ( p r e c . g r i d [ h ] ) ) )
}
}

~ 2|y ...y )
p( σ
1
n
0.010
0.020
0.000

0.00

50

~2
σ
100

150

p( θ|y 1...y n )
0.02
0.04

p o s t . g r i d <−p o s t . g r i d /sum ( p o s t . g r i d )

1.6 1.7 1.8 1.9 2.0
θ

1.5 1.6 1.7 1.8 1.9 2.0
θ

0

50

100
~2
σ

150

Fig. 6.1. Joint and marginal posterior distributions based on a discrete approximation.

Evaluation of this two-parameter posterior distribution at 100 values of
each parameter required a grid of size 100×100 = 1002 . In general, to construct
a similarly fine approximation for a p-dimensional posterior distribution we
would need a p-dimensional grid containing 100p posterior probabilities. This
means that discrete approximations will only be feasible for densities having
a small number of parameters.

6.3 Sampling from the conditional distributions
Suppose for the moment you knew the value of θ. The conditional distribution
of σ
˜ 2 given θ and {y1 , . . . , yn } is
p(˜
σ 2 |θ, y1 , . . . , yn ) ∝ p(y1 , . . . , yn , θ, σ
˜2)
= p(y1 , . . . , yn |θ, σ
˜ 2 )p(θ|˜
σ 2 )p(˜
σ2 ) .
If θ and σ
˜ 2 are independent in the prior distribution, then p(θ|˜
σ 2 ) = p(θ) and

6.4 Gibbs sampling

93

p(˜
σ 2 |θ, y1 , . . . , yn ) ∝ p(y1 , . . . , yn |θ, σ
˜ 2 )p(˜
σ2 )
!
n
X
∝ (˜
σ 2 )n/2 exp{−˜
σ2
(yi − θ)2 /2} ×
i=1



2 ν0 /2−1

(˜
σ )

exp{−˜
σ 2 ν0 σ02 /2}



= (˜
σ 2 )(ν0 +n)/2−1 × exp{−˜
σ 2 × [ν0 σ02 +

X

(yi − θ)2 ]/2}.

This is the form of a gamma density, and so evidently {σ 2 |θ, y1 , . . . , yn } ∼
inverse-gamma(νn /2, νn σn2 (θ)/2), where
νn = ν0 + n , σn2 (θ) =


1 
ν0 σ02 + ns2n (θ) ,
νn

P
and s2n (θ) = (yi − θ)2 /n, the unbiased estimate of σ 2 if θ were known. This
means that we can easily sample directly from p(σ 2 |θ, y1 , . . . , yn ), as well as
from p(θ|σ 2 , y1 , . . . , yn ) as shown at the beginning of the chapter. However,
we do not yet have a way to sample directly from p(θ, σ 2 |y1 , . . . , yn ). Can
we use the full conditional distributions to sample from the joint posterior
distribution?
Suppose we were given σ 2(1) , a single sample from the marginal posterior
distribution p(σ 2 |y1 , . . . , yn ). Then we could sample
θ(1) ∼ p(θ|σ 2(1) , y1 , . . . , yn )
and {θ(1) , σ 2(1) } would be a sample from the joint distribution of {θ, σ 2 }.
Additionally, θ(1) can be considered a sample from the marginal distribution
p(θ|y1 , . . . , yn ). From this θ-value, we can generate
σ 2(2) ∼ p(σ 2 |θ(1) , y1 , . . . , yn ).
But since θ(1) is a sample from the marginal distribution of θ, and σ 2(2) is
a sample from the conditional distribution of σ 2 given θ(1) , then {θ(1) , σ 2(2) }
is also a sample from the joint distribution of {θ, σ 2 }. This in turn means
that σ 2(2) is a sample from the marginal distribution p(σ 2 |y1 , . . . , yn ), which
then could be used to generate a new sample θ(2) , and so on. It seems that
the two conditional distributions could be used to generate samples from the
joint distribution, if only we had a σ 2(1) from which to start.

6.4 Gibbs sampling
The distributions p(θ|σ 2 , y1 , . . . , yn ) and p(σ 2 |θ, y1 , . . . , yn ) are called the full
conditional distributions of θ and σ 2 respectively, as they are each a conditional distribution of a parameter given everything else. Let’s make the iterative sampling idea described in the previous paragraph more precise. Given
a current state of the parameters φ(s) = {θ(s) , σ
˜ 2(s) }, we generate a new state
as follows:

94

6 Posterior approximation with the Gibbs sampler

1. sample θ(s+1) ∼ p(θ|˜
σ 2(s) , y1 , . . . , yn );
2(s+1)
2. sample σ
˜
∼ p(˜
σ 2 |θ(s+1) , y1 , . . . , yn );
(s+1)
(s+1)
3. let φ
= {θ
,σ
˜ 2(s+1) }.
This algorithm is called the Gibbs sampler, and generates a dependent sequence of our parameters {φ(1) , φ(2) , . . . , φ(S) }. The R-code to perform this
sampling scheme for the normal model with the semiconjugate prior distribution is as follows:
### data
mean . y<−mean ( y ) ; var . y<−var ( y ) ; n<−l e n g t h ( y )
###
### s t a r t i n g v a l u e s
S<−1000
PHI<−m at r i x ( nrow=S , n c o l =2)
PHI[1 ,] < − phi<−c ( mean . y , 1/ var . y )
###
### Gibbs s a m p l i n g
set . seed (1)
for ( s in 2: S) {
# g e n e r a t e a new t h e t a v a l u e from i t s f u l l c o n d i t i o n a l
mun<− ( mu0/ t 2 0 + n∗mean . y∗ p h i [ 2 ] ) / ( 1/ t 2 0 + n∗ p h i [ 2 ] )
t2n<− 1 / ( 1/ t 2 0 + n∗ p h i [ 2 ] )
p h i [1]< − rnorm ( 1 , mun , s q r t ( t2n ) )
# g e n e r a t e a new 1/ sigma ˆ2 v a l u e from i t s f u l l c o n d i t i o n a l
nun<− nu0+n
s2n<− ( nu0∗ s 2 0 + ( n−1)∗ var . y + n ∗ ( mean . y−p h i [ 1 ] ) ˆ 2 ) /nun
p h i [2]< − rgamma ( 1 , nun / 2 , nun∗ s2n / 2 )
PHI [ s ,]<− p h i
###

}

In this code, we have used the identity
ns2n (θ) =

n
X

(yi − θ)2 =

i=1

n
X

(yi − y¯ + y¯ − θ)2

i=1

=

n
X

[(yi − y¯)2 + 2(yi − y¯)(¯
y − θ) + (¯
y − θ)2 ]

i=1

=

n
X

(yi − y¯)2 + 0 +

i=1
2

n
X
i=1
2

= (n − 1)s + n(¯
y − θ) .

(¯
y − θ)2

6.4 Gibbs sampling

95

The reason for writing the code this way is because s2 and y¯ do not change
with each new θ-value,
(n − 1)s2 + n(¯
y − θ)2 is faster than
Pnand computing
2
having to recompute i=1 (yi − θ) at each iteration.

25

40

40

8

1.70

1.80
θ

1.90

13
11
10

1
7
4

14

20

20

4

~2
σ
60 80 100

9

40

1

15

20

25

3 6

~2
σ
60 80 100

~2
σ
60 80 100

3

12
1.70

1.80
θ

1.90

49
98
5888
3 6
85
1594
67
4869 939
13
80 59
56
282611
60
10
27
53
16
66
40
19
37
32 45
96 2297
235
72
5
57
34
131
63
91
86
81
9
2
76
33
23
30
43
20
71
68 838
70
99
24
10093
83
54
87
41
36
784
738918
74 62
47
78
46
29
4
44 5042
64 25 8290
65552114
51
61 95
17 77 79
52 75
12
1.70

1.80
θ

1.90

Fig. 6.2. The first 5, 15 and 100 iterations of a Gibbs sampler.

Using the midge data from the previous chapter and the prior distributions described above, a Gibbs sampler consisting of 1,000 iterations was constructed. Figure 6.2 plots the first 5, 15 and 100 simulated values, and the
first panel of Figure 6.3 plots the 1,000 values over the contours of the discrete
approximation to p(θ, σ
˜ 2 |y1 , . . . , yn ). The second and third panels of Figure
6.3 give density estimates of the distributions of the simulated values of θ and
σ
˜ 2 . Finally, let’s find some empirical quantiles of our Gibbs samples:
### CI f o r p o p u l a t i o n mean
> q u a n t i l e ( PHI [ , 1 ] , c ( . 0 2 5 , . 5 , . 9 7 5 ) )
2.5%
50%
97.5%
1.707282 1.804348 1.901129
### CI f o r p o p u l a t i o n p r e c i s i o n
> q u a n t i l e ( PHI [ , 2 ] , c ( . 0 2 5 , . 5 , . 9 7 5 ) )
2.5%
50%
97.5%
17.48020 53.62511 129.20020

### CI f o r p o p u l a t i o n s t a n d a r d d e v i a t i o n
> q u a n t i l e ( 1 / s q r t ( PHI [ , 2 ] ) , c ( . 0 2 5 , . 5 , . 9 7 5 ) )
2.5%
50%
97.5%
0.08797701 0.13655763 0.23918408

The empirical distribution of these Gibbs samples very closely resembles the
discrete approximation to their posterior distribution, as can be seen by comparing Figures 6.1 and 6.3. This gives some indication that the Gibbs sampling
procedure is a valid method for approximating p(θ, σ 2 |y1 , . . . , yn ).

0

2

50

~2
σ
100

p( θ|y 1...y n )
4
6

~ 2|y ...y )
p( σ
1
n
0.000 0.004 0.008 0.012

8

6 Posterior approximation with the Gibbs sampler

150

96

1.6

1.7

1.8

1.9

1.6 1.7 1.8 1.9 2.0
θ

θ

0

50 100
~2
σ

200

Fig. 6.3. The first panel shows 1,000 samples from the Gibbs sampler, plotted over
the contours of the discrete approximation. The second and third panels give kernel
density estimates to the distributions of Gibbs samples of θ and σ
˜ 2 . Vertical gray
bars on the second plot indicate 2.5% and 97.5% quantiles of the Gibbs samples
of θ, while nearly identical black vertical bars indicate the 95% confidence interval
based on the t-test.

6.5 General properties of the Gibbs sampler
Suppose you have a vector of parameters φ = {φ1 , . . . , φp }, and your information about φ is measured with p(φ) = p(φ1 , . . . , φp ). For example, in
the normal model φ = {θ, σ 2 }, and the probability measure of interest is
(0)
(0)
p(θ, σ 2 |y1 , . . . , yn ). Given a starting point φ(0) = {φ1 , . . . , φp }, the Gibbs
sampler generates φ(s) from φ(s−1) as follows:
(s)

(s−1)

(s)

(s)

(s−1)

(s−1)

1. sample φ1 ∼ p(φ1 |φ2
, φ3
, . . . , φp
)
(s)
(s)
(s−1)
(s−1)
2. sample φ2 ∼ p(φ2 |φ1 , φ3
, . . . , φp
)
..
.
(s)

(s)

p. sample φp ∼ p(φp |φ1 , φ2 , . . . , φp−1 ) .
This algorithm generates a dependent sequence of vectors:
(1)

φ(1) = {φ1 , . . . , φ(1)
p }
(2)

φ(2) = {φ1 , . . . , φ(2)
p }
..
.
(S)
φ(S) = {φ1 , . . . , φ(S)
p }.
In this sequence, φ(s) depends on φ(0) , . . . , φ(s−1) only through φ(s−1) , i.e.
φ(s) is conditionally independent of φ(0) , . . . , φ(s−2) given φ(s−1) . This is
called the Markov property, and so the sequence is called a Markov chain.
Under some conditions that will be met for all of the models discussed in this
text,

6.5 General properties of the Gibbs sampler

Pr(φ(s) ∈ A) →

97

Z
p(φ) dφ

as s → ∞.

A

In words, the sampling distribution of φ(s) approaches the target distribution
as s → ∞, no matter what the starting value φ(0) is (although some starting
values will get you to the target sooner than others). More importantly, for
most functions g of interest,
Z
S
1X
(s)
g(φ ) → E[g(φ)] = g(φ)p(φ) dφ
S s=1

as S → ∞.

(6.1)

This means we can approximate E[g(φ)] with the sample average of {g(φ(1) ),
. . ., g(φ(S) )}, just as in Monte Carlo approximation. For this reason, we call
such approximations Markov chain Monte Carlo (MCMC) approximations,
and the procedure an MCMC algorithm. In the context of the semiconjugate
normal model, Equation 6.1 implies that the joint distribution of {(θ(1) , σ 2(1) ),
. . ., (θ(1000) , σ 2(1000) )} is approximately equal to p(θ, σ 2 | y1 ,. . ., yn ) , and that
1000
1 X (s)
E[θ|y1 , . . . , yn ] ≈
θ = 1.804, and
1000 s=1

Pr(θ ∈ [1.71, 1.90]|y1 , . . . , yn ) ≈ 0.95.
We will discuss practical aspects of MCMC in the context of specific models
in the next section and in the next several chapters.
Distinguishing parameter estimation from posterior approximation
A Bayesian data analysis using Monte Carlo methods often involves a confusing array of sampling procedures and probability distributions. With this in
mind it is helpful to distinguish the part of the data analysis which is statistical from that which is numerical approximation. Recall from Chapter 1 that
the necessary ingredients of a Bayesian data analysis are
1. Model specification: a collection of probability distributions {p(y|φ), φ ∈
Φ} which should represent the sampling distribution of your data for some
value of φ ∈ Φ;
2. Prior specification: a probability distribution p(φ), ideally representing
someone’s prior information about which parameter values are likely to
describe the sampling distribution.
Once these items are specified and the data have been gathered, the posterior
p(φ|y) is completely determined. It is given by
p(φ|y) =

p(φ)p(y|φ)
p(φ)p(y|φ)
=R
,
p(y)
p(φ)p(y|φ) dφ

and so in a sense there is no more modeling or estimation. All that is left is

98

6 Posterior approximation with the Gibbs sampler

3. Posterior summary: a description of the posterior distribution p(φ|y), done
in terms of particular quantities of interest such as posterior means, medians, modes, predictive probabilities and confidence regions.
For many models, p(φ|y) is complicated, hard to write down, and so on. In
these cases, a useful way to “look at” p(φ|y) is by studying Monte Carlo
samples from p(φ|y). Thus, Monte Carlo and MCMC sampling algorithms
• are not models,
• they do not generate “more information” than is in y and p(φ),
• they are simply “ways of looking at” p(φ|y).
For example, if we have Monte Carlo samples φ(1) , . . . , φ(S) that are approximate draws from p(φ|y), then these samples help describe p(φ|y):
P (s) R
1
≈ φp(φ|y) dφ
S Pφ
Rc
1
(s)
1(φ
≤ c) ≈ Pr(φ ≤ c|y) = −∞ p(φ|y) dφ.
S
and so on. To keep this distinction in mind, it is useful to reserve the word
estimation to describe how we use p(φ|y) to make inference about φ, and to
use the word approximation to describe the use of Monte Carlo procedures to
approximate integrals.

6.6 Introduction to MCMC diagnostics
The purpose of Monte Carlo or Markov chain Monte Carlo approximation is
to obtain a sequence of parameter values {φ(1) , . . . , φ(S) } such that
Z
S
1X
(s)
g(φ ) ≈ g(φ)p(φ) dφ,
S s=1
for any functions g of interest. In other words, we want the empirical average
of {g(φ(1) ), . . . , g(φ(S) )} to approximate the expected value of g(φ) under a
target probability distribution p(φ) (in Bayesian inference, the target distribution is usually the posterior distribution). In order for this to be a good
approximation for a wide range of functions g, we need the empirical distribution of the simulated sequence {φ(1) , . . . , φ(S) } to look like the target
distribution p(φ). Monte Carlo and Markov chain Monte Carlo are two ways
of generating such a sequence. Monte Carlo simulation, in which we generate independent samples from the target distribution, is in some sense the
“gold standard.” Independent MC samples automatically create a sequence
that
is representative of p(φ): The probability that φ(s) ∈ A for any set A is
R
p(φ) dφ. This is true for every s ∈ {1, . . . , S} and conditionally or unconA
ditionally on the other values in the sequence. This is not true for MCMC
samples, in which case all we are sure of is that

6.6 Introduction to MCMC diagnostics

lim Pr(φ(s) ∈ A) =

s→∞

99

Z
p(φ) dφ.
A

0.0

0.1

p( θ)
0.2

0.3

0.4

Let’s explore the differences between MC and MCMC with a simple example. Our target distribution will be the joint probability distribution of
two variables: a discrete variable δ ∈ {1, 2, 3} and a continuous variable
θ ∈ R. The target density for this example will be defined as {Pr(δ =
1), Pr(δ = 2), Pr(δ = 3)} = (.45, .10, .45) and p(θ|δ) = dnorm(θ, µδ , σδ ), where
(µ1 , µ2 , µ3 ) = (−3, 0, 3) and (σ12 , σ22 , σ32 ) = (1/3, 1/3, 1/3). This is a mixture
of three normal densities, where we might think of δ as being a group membership variable and (µδ , σδ2 ) as the population meanPand variance for group
δ. A plot of the exact marginal density of θ, p(θ) =
p(θ|δ)p(δ), appears in
the black lines of Figure 6.4. Notice that there are three modes representing
the three different group means.

−6

−4

−2

0
θ

2

4

6

Fig. 6.4. A mixture of normal densities and a Monte Carlo approximation.

It is very easy to obtain independent Monte Carlo samples from the joint
distribution of φ = (δ, θ). First, a value of δ is sampled from its marginal
distribution, then the value is plugged into p(θ|δ), from which a value of θ
is sampled. The sampled pair (δ, θ) represents a sample from the joint distribution of p(δ, θ) = p(δ)p(θ|δ). The empirical distribution of the
P θ-samples
provides an approximation to the marginal distribution p(θ) =
p(θ|δ)p(δ).
A histogram of 1,000 Monte Carlo θ-values generated in this way is shown in
Figure 6.4. The empirical distribution of the Monte Carlo samples looks a lot
like p(θ).
It is also straightforward to construct a Gibbs sampler for φ = (δ, θ). A
Gibbs sampler would alternately sample values of θ and δ from their full conditional distributions. The full conditional distribution of θ is already provided,

100

6 Posterior approximation with the Gibbs sampler

and using Bayes’ rule we can show that the full conditional distribution of δ
is given by
Pr(δ = d) × dnorm(θ, µd , σd )
Pr(δ = d|θ) = P3
, for d ∈ {1, 2, 3}.
d=1 Pr(δ = d) × dnorm(θ, µd , σd )

0.0

−4

−2

0.1

0

θ

p( θ)
0.2

2

0.3

4

0.4

The first panel of Figure 6.5 shows a histogram of 1,000 MCMC values of θ
generated with the Gibbs sampler. Notice that the empirical distribution of
the MCMC samples gives a poor approximation to p(θ). Values of θ near -3
are underrepresented, whereas values near zero and +3 are overrepresented.
What went wrong? A plot of the θ-values versus iteration number in the second
panel of the figure tells the story. The θ-values get “stuck” in certain regions,
and rarely move among the three regions represented by the three values of
µ. The technical term for this “stickiness” is autocorrelation, or correlation
between consecutive values of the chain. In this Gibbs sampler, if we have a
value of θ near 0 for example, then the next value of δ is likely to be 2. If δ is
2, then the next value of θ is likely to be near 0, resulting in a high degree of
positive correlation between consecutive θ-values in the chain.
Isn’t the Gibbs sampler guaranteed to eventually provide a good approximation to p(θ)? It is, but “eventually” can be a very long time in some
situations. The first panel of Figure 6.6 indicates that our approximation has
greatly improved after using 10,000 iterations of the Gibbs sampler, although
it is still somewhat inadequate.

−6

−4

−2

0
θ

2

4

6

●
●●
●
●
●
● ●
●
●
●
●● ● ● ●●
●●●●● ●●●●
●●
● ●
●
●
●
●●●●
●
●
●●●●
● ●●
●
●●●
●●
●●
●●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●●
●
●
●
●
●●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●●●
●●●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●●
●
●●●
●
●
●●
●
●●●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ● ● ●●● ● ● ● ●
●
● ●
●
●
● ●
●
●
●●
●
●
●
●
●●
●
●●
●
●
●●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
● ●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
● ●●
●
● ●●
●
●●
●● ●
●
●
●●
●
●●●●
●
●
●
●●
●
●
●
●
●●
●●
●
●
●
●●●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●● ●●
●●
●
●
●
●
●
●
●
●●
●●
●
●
●
●
●●
●
●●
●●
●
●
●
●
●●●
●
●
●
●
● ●
●

0

200

400
600
iteration

800

1000

Fig. 6.5. Histogram and traceplot of 1,000 Gibbs samples.

In the case of a generic parameter φ and target distribution p(φ), it is
helpful to think of the sequence {φ(1) , . . . , φ(S) } as the trajectory of a particle
φ moving around the parameter space. In terms of MCMC integral approxi-

0.0

−4

0.1

−2

θ
0

p( θ)
0.2

2

0.3

4

0.4

6.6 Introduction to MCMC diagnostics

−6

−4

−2

0
θ

2

4

6

101

●
●
●
●● ●
●
●●
●●
● ●● ●
● ●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
● ●
●
●
●
● ●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●
●●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
● ●
●
●● ●
●●●
● ●
●
●
●●
●
●
●
●
●
● ●
●
●●
●
●
●●●● ●
● ●
●
●
●
●●
●
●●
●
●●●
●●
●●
●●
●
●
●●
●
●●
●
● ●
●●
●●
●
● ●● ● ●
●
●● ●
●●
●
●
●
●
●● ●
●
●
●
●● ●● ●
●
●●●
●
●●
●
●●
●●
●
●●
●
●
●
●
●
● ●
●
● ●
●●
●●●
● ●
● ●
● ●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●● ●
● ●
●
●●
●
●●
● ●
●●
●
● ●●
●
●●
● ●
●
●● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●● ●
●
●
●
●●
●
●
●
●
●
● ●
●
●
●
●
● ●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●● ●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
● ●●
●
●
● ●●
●
●●
● ●
●
●●
●●
● ●
●●
● ●●
●
●●●
● ●
●
●●
●●●● ●
●●
●
● ●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●●
●
●
●●
●
●
● ●●
●●
● ●
●
●
●
● ● ●●
●● ●
●
●
●
●
●●
●●
●
●●
●
●
●
●
●
● ●
●● ●●
●
●
●●
●
●
●● ● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●● ●
●
●
●
●
●
● ●
●● ●
●●
●●
● ●●●●● ●
●
●
●
●● ●
●
●
●
●
●●
●
●● ●
●
● ●
●
●
●
●
●
●
●●
●
●●
●
● ●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
● ●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
● ●
●
●
● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●
●
●
●
● ●
●
●
●
●
●
●

0

2000

4000 6000
iteration

8000

Fig. 6.6. Histogram and traceplot of 10,000 Gibbs samples.

mation, the critical thing is that the amount of time Rthe particle spends in a
given set A is proportional to the target probability A p(φ) dφ.
Now suppose A1 , A2 and A3 are three disjoint subsets of the parameter
space, with Pr(A2 ) < Pr(A1 ) ≈ Pr(A3 ) (these could be, for example, the
regions near the three modes of the normal mixture distribution above). In
terms of the integral approximation, this means that we want the particle to
spend little time in A2 , and about the same amount of time in A1 as in A3 .
Since in general we do not know p(φ) (otherwise we would not be trying to
approximate it), it is possible that we would accidentally start our Markov
chain in A2 . In this case, it is critical that the number of iterations S is large
enough so that the particle has a chance to
1. move out of A2 and into higher probability regions, and
2. move between A1 and A3 , and any other sets of high probability.
The technical term for attaining item 1 is to say that the chain has achieved
stationarity or has converged . If your Markov chain starts off in a region of
the parameter space that has high probability, then convergence generally is
not a big issue. If you do not know if you are starting off in a good region,
assessing convergence is fraught with epistemological problems. In general,
you cannot know for sure if your chain has converged. But sometimes you
can know if your chain has not converged, so we at least check for this latter
possibility. One thing to check for is stationarity, or that samples taken in
one part of the chain have a similar distribution to samples taken in other
parts. For the normal model with semiconjugate prior distributions from the
previous section, stationarity is achieved quite quickly and is not a big issue.
However, for some highly parameterized models that we will see later on, the
autocorrelation in the chain is high, good starting values can be hard to find

102

6 Posterior approximation with the Gibbs sampler

and it can take a long time to get to stationarity. In these cases we need to
run the MCMC sampler for a very long time.
Item 2 above relates to how quickly the particle moves around the parameter space, which is sometimes called the speed of mixing. An independent
MC sampler has perfect mixing: It has zero autocorrelation and can jump between different regions of the parameter space in one step. As we have seen in
the example above, an MCMC sampler might have poor mixing, take a long
time between jumps to different parts of the parameter space and have a high
degree of autocorrelation. How does the correlation of the MCMC samples
affect posterior
approximation? Suppose we want to approximate the integral
R
E[φ] = φp(φ) dφ = φ0 using the empirical distribution of {φ(1) , . . . , φ(S) }.
If the φ-values P
are independent Monte Carlo samples from p(φ), then the
variance of φ¯ = φ(s) /S is
¯ = E[(φ¯ − φ0 )2 ] = Var[φ] ,
VarMC [φ]
S
R
where Var[φ] = φ2 p(φ) dφ − φ20 . Recall from Chapter 4 that the square
¯ is the Monte Carlo standard error, and is a measure of how
root of VarMC [φ]
R
well we expect φ¯ to approximate the integral φp(φ) dφ. If we were to rerun
the MC approximation procedure many times, perhaps with different starting
values or random number generators, we expect that φp
0 , the true value of the
¯ for roughly
integral, would be contained within the interval φ¯ ± 2 VarMC [φ]
p
¯
95% of the MC approximations. The width of this interval is 4 × VarMC [φ],
and we can make this as small as we want by generating more MC samples.
What if we use an MCMC algorithm such as the Gibbs sampler? As can
be seen in Figures 6.5 and 6.6, consecutive MCMC samples φ(s) and φ(s+1)
can be positively correlated. Assuming stationarity has been achieved, the
expected squared
difference from the MCMC integral approximation φ¯ to the
R
target φ0 = φp(φ) dφ is the MCMC variance, and is given by
¯ = E[(φ¯ − φ0 )2 ]
VarMCMC [φ]
1 X (s)
= E[{
(φ − φ0 )}2 ]
S
S
X
1 X
= 2 E[ (φ(s) − φ0 )2 +
(φ(s) − φ0 )(φ(t) − φ0 )]
S
s=1
s6=t

=

1
S2

S
X

E[(φ(s) − φ0 )2 ] +

s=1

1 X
E[(φ(s) − φ0 )(φ(t) − φ0 )]
S2
s6=t

X
¯ + 1
E[(φ(s) − φ0 )(φ(t) − φ0 )].
= VarMC [φ]
2
S
s6=t

So the MCMC variance is equal to the MC variance plus a term that depends
on the correlation of samples within the Markov chain. This term is generally

6.6 Introduction to MCMC diagnostics

103

positive and so the MCMC variance is higher than the MC variance, meaning
that we expect the MCMC approximation to be further away from φ0 than the
MC approximation is. The higher the autocorrelation in the chain, the larger
the MCMC variance and the worse the approximation is. To assess how much
correlation there is in the chain we often compute the sample autocorrelation
function. For a generic sequence of numbers {φ1 , . . . , φS }, the lag-t autocorrelation function estimates the correlation between elements of the sequence
that are t steps apart:
acf t (φ) =

1
S−t

PS−t

¯

s=1 (φs − φ)(φs+t −
PS
1
¯2
s=1 (φs − φ)
S−1

¯
φ)

,

which is computed by the R-function acf . For the sequence of 10,000 θ-values
plotted in Figure 6.6, the lag-10 autocorrelation is 0.93, and the lag-50 autocorrelation is 0.812. A Markov chain with such a high autocorrelation moves
around the parameter space slowly, taking a long time to achieve the correct
balance among the different regions of the parameter space. The higher the
autocorrelation, the more MCMC samples we need to attain a given level
of precision for our approximation. One way to measure this is to calculate the effective sample size for an MCMC sequence, using the R-command
effectiveSize in the “coda” package. The effective sample size function estimates the value Seff such that
¯ =
VarMCMC [φ]

Var[φ]
,
Seff

so that Seff can be interpreted as the number of independent Monte Carlo
samples necessary to give the same precision as the MCMC samples. For the
normal mixture density example above, the effective sample size of the 10,000
Gibbs samples of θ is 18.42, indicating that the precision of the MCMC approximation to E[θ] is as good as the precision that would have been obtained
by only about 18 independent samples of θ.
There is a large literature on the practical implementation and assessment
of Gibbs sampling and MCMC approximation. Much insight can be gained
by hands-on experience supplemented by reading books and articles. A good
article to start with is “Practical Markov chain Monte Carlo” (Geyer, 1992),
which includes a discussion by many researchers and a large variety of viewpoints on and techniques for MCMC approximation.
MCMC diagnostics for the semiconjugate normal analysis
We now assess the Markov chain of θ and σ 2 values generated by the Gibbs
sampler in Section 6.4. Figure 6.7 plots the values of these two parameters in sequential order, and seems to indicate immediate convergence and
a low degree of autocorrelation. The lag-1 autocorrelation for the sequence

104

6 Posterior approximation with the Gibbs sampler

0.10

1.9
1.8
θ

σ2
0.02

●
●

1.5

●

0

200

400
600
iteration

800

1000

●
●

●
●
●
●●

●

1.6

1.7

●

0.06

●
●
●
●
●
●
●
●● ●
●●
●
●●
●●
●
●
●
●
●
●●
●●
●
●
●
●● ●● ●●●
● ● ● ● ● ● ● ● ●●
●
●●
●
● ●
●●●●
●●
●
●●
●●● ● ●
●
●● ●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●
●● ●● ●●●● ●
●
●●
●●
●●●
●●
●●●
●
●
●
●●
●●●●
●●
●
●
●●
●●
●
●
●
●
●
●
●● ●●
●
●●●
●
●●●●
●●
●●
●
●
●
●
●
●
●
●●●●
●●
●●
●
●●
●●●
●●●
●
●
●
●●
●
●●
●
●
●
●
●
●●●
●●
●●
●
●
●
● ●●
●
●
●
●●
●
●
●●
●
●
●
●
●●
●
●
●
●●
●
●●
●
●●
●
●
●
●●●
●
●
●
●
●
●●
●
●
●
●
●●
●●●
●
●
●●●
●
●●●
●●●
●●●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●
●●
●●●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●●
●
●●
●
●
●
●
●●
●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●●●
●
●●●
●●
●●●
●
●●
●
●●
●
●●
●●
●
●●
●
●
●
●
●●
●
●●●
●●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●●
●
●
●●
●
●●
●
●●
●
●
●●
●
● ●●
●●
●●
●
●●
●
●
●●●
●●
●●
●
●
●●
●
●●
●
●●
●
●
●●
●
●●●
●
●
●●
●
●●
●
●●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●●
●●●●
●
●
●●
●
●●
●●
●●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●●
● ●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●●
●●
●
●●●
● ●●
● ● ● ●●● ●
●●
● ●
●●●
●
●● ● ●
●●●
●
●
●● ● ● ●
●●
● ●●●●
●●●●
●●
●●
●● ●
●●●
●●
●
●
●
●●
● ● ●●
●●
●●
●
● ●●●●
●● ●●●●
●●●
●
●
●
● ●
●●●
●
● ●●
●
●
●
●
●
●
●
●
●
●
●
● ● ●● ●● ● ●●● ● ●
●
●●
●●
●
● ●
● ●●●
●●
●
●
● ●
●
●
●
●

0.14

{θ(1) , . . . , θ(1000) } is 0.031, which is essentially zero for approximation purposes. The effective sample size for this sequence is computed in R to be 1,000.
The lag-1 autocorrelation for the σ 2 -values is 0.147, with an effective sample
size of 742. While not quite as good as an independently sampled sequence
of parameter values, the Gibbs sampler for this model and prior distribution
performs quite well.

●

●
●

●●
●

● ● ●
● ●
●
●
●
●
●
●
●
●
● ●●
●
●●
●●
●
●
●
●●
●
●
●
●●●●
● ●●●● ● ● ● ●●●●●
●
●●
●
●●
●● ●
● ●● ●●●
● ●●
●
●
●
●
●
●
●
●
●
●
●
●● ●
●●
● ● ●●
●● ● ● ● ● ● ●
●
●
●●
●
●
●
●
●
●
●
●●
●
●● ●●●
●●
●
●●
●●
●
●
●
●●
●
●
●
●●
●●● ●●
●● ●
●●
●●●
●●
●
●
●
●
●
●●
●●●
●●
●
●●
●●
●
●
●
●●
●
●
●
●●●
●●
●
●●
●
●
●●●
●
●
●
●
●
●●●
●
●
●
●
●
●●
●
●●
●●
●
●
●●
●
●●
●
●
●
●
●
●●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●●
●
●●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●
●●●
●●
● ●●
●
●●
●●
●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●●●
●
●
● ●
●
●●●
●
●

●

0

200

400
600
iteration

800

1000

Fig. 6.7. Traceplots for θ and σ 2 .

6.7 Discussion and further references
The term “Gibbs sampling” was coined by Geman and Geman (1984) in their
paper on image analysis, but the algorithm appears earlier in the context
of spatial statistics, for example, Besag (1974) or Ripley (1979). However,
the general utility of the Gibbs sampler for Bayesian data analysis was not
fully realized until the late 1980s (Gelfand and Smith, 1990). See Robert and
Casella (2008) for a historical review.
Assessing the convergence of the Gibbs sampler and the accuracy of the
MCMC approximation is difficult. Several authors have come up with convergence diagnostics (Gelman and Rubin, 1992; Geweke, 1992; Raftery and
Lewis, 1992), although these can only highlight problems and not guarantee
a good approximation (Geyer, 1992).

7
The multivariate normal model

Up until now all of our statistical models have been univariate models, that
is, models for a single measurement on each member of a sample of individuals
or each run of a repeated experiment. However, datasets are frequently multivariate, having multiple measurements for each individual or experiment. This
chapter covers what is perhaps the most useful model for multivariate data,
the multivariate normal model, which allows us to jointly estimate population
means, variances and correlations of a collection of variables. After first calculating posterior distributions under semiconjugate prior distributions, we
show how the multivariate normal model can be used to impute data that are
missing at random.

7.1 The multivariate normal density
Example: Reading comprehension
A sample of twenty-two children are given reading comprehension tests before
and after receiving a particular instructional method. Each student i will then
have two scores, Yi,1 and Yi,2 denoting the pre- and post-instructional scores
respectively. We denote each student’s pair of scores as a 2 × 1 vector Y i , so
that

 

Yi,1
score on first test
Yi=
=
.
Yi,2
score on second test
Things we might be interested in include the population mean θ,

  
E[Yi,1 ]
θ1
E[Y ] =
=
E[Yi,2 ]
θ2
and the population covariance matrix Σ,

  2

E[Y12 ] − E[Y1 ]2
E[Y1 Y2 ] − E[Y1 ]E[Y2 ]
σ1 σ1,2
Σ = Cov[Y ] =
=
,
E[Y1 Y2 ] − E[Y1 ]E[Y2 ]
E[Y22 ] − E[Y2 ]2
σ1,2 σ22
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 7,
c Springer Science+Business Media, LLC 2009


106

7 The multivariate normal model

where the expectations above represent the unknown population averages.
Having information about θ and Σ may help us in assessing the effectiveness
of the teaching method, possibly evaluated with θ2 − θ1 , or the consistency of
the reading comprehension
p test, which could be evaluated with the correlation
coefficient ρ1,2 = σ1,2 / σ12 σ22 .
The multivariate normal density
Notice that θ and Σ are both functions of population moments, or population
averages of powers of Y1 and Y2 . In particular, θ and Σ are functions of firstand second-order moments:
first-order moments: E[Y1 ], E[Y2 ]
second-order moments: E[Y12 ], E[Y1 Y2 ], E[Y22 ]
Recall from Chapter 5 that a univariate normal model describes a population
in terms of its mean and variance (θ, σ 2 ), or equivalently its first two moments
(E[Y ] = θ, E[Y 2 ] = σ 2 + θ2 ). The analogous model for describing first- and
second-order moments of multivariate data is the multivariate normal model.
We say a p-dimensional data vector Y has a multivariate normal distribution
if its sampling density is given by
p(y|θ, Σ) = (2π)−p/2 |Σ|−1/2 exp{−(y − θ)T Σ −1 (y − θ)/2}
where




y1
 y2 
 
y= . 
 .. 
yp




θ1
 θ2 
 
θ= . 
 .. 
θp


σ12 σ1,2 · · · σ1,p
 σ1,2 σ22 · · · σ2,p 


Σ= .
..
..  .
 ..
.
. 
σ1,p · · · · · · σp2


Calculating this density requires a few operations involving matrix algebra.
For a matrix A, the value of |A| is called the determinant of A, and measures
how “big” A is. The inverse of A is the matrix A−1 such that AA−1 is equal
to the identity matrix Ip , the p×p matrix that has ones for its diagonal entries
but is otherwise zero. For a p × 1 vector b, bT is its transpose, and is simply
T
the 1 × p vector of the same values.
Finally, the
Pp
Ppvector-matrix product b A
is equal to the 1 × p vector ( j=1 bj aj,1 , . . . , j=1 bj aj,p ), and the value of
Pp Pp
bT Ab is the single number j=1 k=1 bj bk aj,k . Fortunately, R can compute
all of these quantities for us, as we shall see in the forthcoming example code.
Figure 7.1 gives contour plots and 30 samples from each of three different
two-dimensional multivariate normal densities. In each one θ = (50, 50)T ,
σ12 = 64, σ22 = 144, but the value of σ1,2 varies from plot to plot, with σ1,2 =
−48 for the left density, 0 for the middle and +48 for the density on the right
(giving correlations of -.5, 0 and +.5 respectively). An interesting feature of
the multivariate normal distribution is that the marginal distribution of each
variable Yj is a univariate normal distribution, with mean θj and variance σj2 .

7.2 A semiconjugate prior distribution for the mean

107

x
x
x
xxx xx
xx x
x x x x xx
x xx
x xx
x xx
x x

x

20

40

60
y1

80

y2
20 30 40 50 60 70 80

y2
20 30 40 50 60 70 80

y2
20 30 40 50 60 70 80

This means that the marginal distributions for Y1 from the three populations
in Figure 7.1 are identical (the same holds for Y2 ). The only thing that differs
across the three populations is the relationship between Y1 and Y2 , which is
controlled by the covariance parameter σ1,2 .

xx x x
x x
x xxxx
xx x
x xxx x
xx x x x x xx
x
x
x

20

40

60

80

x
x
x
x
x xx
xxx x xx
x xxxxxxx x
x x
xx x

xx

20

40

y1

60

80

y1

Fig. 7.1. Multivariate normal samples and densities.

7.2 A semiconjugate prior distribution for the mean
Recall from Chapters 5 and 6 that if Y1 , . . . , Yn are independent samples from
a univariate normal population, then a convenient conjugate prior distribution
for the population mean is also univariate normal. Similarly, a convenient prior
distribution for the multivariate mean θ is a multivariate normal distribution,
which we will parameterize as
p(θ) = multivariate normal(µ0 , Λ0 ),
where µ0 and Λ0 are the prior mean and variance of θ, respectively. What is
the full conditional distribution of θ, given y 1 , . . . , y n and Σ? In the univariate
case, having normal prior and sampling distributions resulted in a normal full
conditional distribution for the population mean. Let’s see if this result holds
for the multivariate case. We begin by examining the prior distribution as a
function of θ:
1
p(θ) = (2π)−p/2 |Λ0 |−1/2 exp{− (θ − µ0 )T Λ−1
0 (θ − µ0 )}
2
1
1 T −1
T −1
= (2π)−p/2 |Λ0 |−1/2 exp{− θ T Λ−1
0 θ + θ Λ0 µ0 − µ0 Λ0 µ0 }
2
2
1 T −1
T −1
∝ exp{− θ Λ0 θ + θ Λ0 µ0 }
2
1
= exp{− θ T A1 θ + θ T b1 },
(7.1)
2

108

7 The multivariate normal model

where A0 = Λ−1
and b0 = Λ−1
0
0 µ0 . Conversely, Equation 7.1 says that if a
random vector θ has a density on Rp that is proportional to exp{−θ T Aθ/2 +
θ T b} for some matrix A and vector b, then θ must have a multivariate normal
distribution with covariance A−1 and mean A−1 b.
If our sampling model is that {Y 1 , . . . , Y n |θ, Σ} are i.i.d. multivariate
normal(θ, Σ), then similar calculations show that the joint sampling density
of the observed vectors y 1 , . . . , y n is
p(y 1 , . . . , y n |θ, Σ) =

n
Y

(2π)−p/2 |Σ|−1/2 exp{−(y i − θ)T Σ −1 (y i − θ)/2}

i=1
n

= (2π)−np/2 |Σ|−n/2 exp{−

1X
(y − θ)T Σ −1 (y i − θ)}
2 i=1 i

1
∝ exp{− θ T A1 θ + θ T b1 },
2

(7.2)

−1
¯ and y
¯ is the vector of variable-specific
where A1 = nΣP
, b1 = nΣ −1P
y
n
1
¯ = ( n i=1 yi,1 , . . . , n1 ni=1 yi,p )T . Combining Equations 7.1 and
averages y
7.2 gives

1
1
p(θ|y 1 , . . . , y n , Σ) ∝ exp{− θ T A0 θ + θ T b0 } × exp{− θ T A1 θ + θ T b1 }
2
2
1 T
T
= exp{− θ An θ + θ bn }, where
(7.3)
2
−1
An = A0 + A1 = Λ−1
and
0 + nΣ
−1
−1
¯.
bn = b0 + b1 = Λ0 µ0 + nΣ y
From the comments in the previous paragraph, Equation 7.3 implies that
the conditional distribution of θ therefore must be a multivariate normal
−1
distribution with covariance A−1
n and mean An bn , so
−1 −1
Cov[θ|y 1 , . . . , y n , Σ] = Λn = (Λ−1
)
(7.4)
0 + nΣ
−1
−1
−1 −1
−1
¯ ) (7.5)
E[θ|y 1 , . . . , y n , Σ] = µn = (Λ0 + nΣ ) (Λ0 µ0 + nΣ y
p(θ|y 1 , . . . , y n , Σ) = multivariate normal(µn , Λn ).
(7.6)

It looks a bit complicated, but can be made more understandable by analogy
with the univariate normal case: Equation 7.4 says that posterior precision, or
inverse variance, is the sum of the prior precision and the data precision, just as
in the univariate normal case. Similarly, Equation 7.5 says that the posterior
expectation is a weighted average of the prior expectation and the sample
mean. Notice that, since the sample mean is consistent for the population
mean, the posterior mean also will be consistent for the population mean
even if the true distribution of the data is not multivariate normal.

7.3 The inverse-Wishart distribution

109

7.3 The inverse-Wishart distribution
Just as a variance σ 2 must be positive, a variance-covariance matrix Σ must
be positive definite, meaning that
x0 Σx > 0 for all vectors x.
Positive definiteness guarantees that σj2 > 0 for all j and that all correlations
are between -1 and 1. Another requirement of our covariance matrix is that it
is symmetric, which means that σj,k = σk,j . Any valid prior distribution for
Σ must put all of its probability mass on this complicated set of symmetric,
positive definite matrices. How can we formulate such a prior distribution?
Empirical covariance matrices
The sum of squares matrix of a collection of multivariate vectors z 1 , . . . , z n
is given by
n
X
z i z Ti = ZT Z,
i=1

where Z is the n × p matrix whose ith row is z Ti . Recall from matrix algebra
that since z i can be thought of as a p × 1 matrix, z i z Ti is the following p × p
matrix:
 2

zi,1 zi,1 zi,2 · · · zi,1 zi,p
2
 zi,2 zi,1 zi,2
· · · zi,2 zi,p 


z i z Ti =  .
..  .
 ..
. 
2
zi,p zi,1 zi,p zi,2 · · · zi,p
If the z i ’s are samples from a population with zero mean, we can think of
the matrix z i z Ti /n as the contribution of vector z i to the estimate of the
covariance matrix of all of the observations. In this mean-zero case, if we
divide ZT Z by n, we get a sample covariance matrix, an unbiased estimator
of the population covariance matrix:
Pn
T
1
1
2
2
n [Z Z]j,j = n Pi=1 zi,j = sj,j = sj
n
T
1
1
i=1 zi,j zi,k = sj,k .
n [Z Z]j,k = n
If n > p and the z i ’s are linearly independent, then ZT Z will be positive
definite and symmetric. This suggests the following construction of a “random” covariance matrix: For a given positive integer ν0 and a p × p covariance
matrix Φ0 ,
1. sample z 1 , . . . , z νP
∼ i.i.d. multivariate normal(0, Φ0 );
0
ν0
2. calculate ZT Z = i=1
z i z Ti .
We can repeat this procedure over and over again, generating matrices
ZT1 Z1 ,. . .,ZTS ZS . The population distribution of these sum of squares matrices is called a Wishart distribution with parameters (ν0 , Φ0 ), which has the
following properties:

110

7 The multivariate normal model

• If ν0 > p, then ZT Z is positive definite with probability 1.
• ZT Z is symmetric with probability 1.
• E[ZT Z] = ν0 Φ0 .
The Wishart distribution is a multivariate analogue of the gamma distribution
(recall that if z is a mean-zero univariate normal random variable, then z 2 is a
gamma random variable). In the univariate normal model, our prior distribution for the precision 1/σ 2 is a gamma distribution, and our full conditional
distribution for the variance is an inverse-gamma distribution. Similarly, it
turns out that the Wishart distribution is a semi-conjugate prior distribution
for the precision matrix Σ −1 , and so the inverse-Wishart distribution is our
semi-conjugate prior distribution for the covariance matrix Σ. With a slight
reparameterization, to sample a covariance matrix Σ from an inverse-Wishart
distribution we perform the following steps:
1. sample z 1 , . . . , z νP
∼ i.i.d. multivariate normal(0, S−1
0
0 );
ν0
T
2. calculate Z Z = i=1
z i z Ti ;
3. set Σ = (ZT Z)−1 .
Under this simulation scheme, the precision matrix Σ −1 has a Wishart(ν0 , S−1
0 )
distribution and the covariance matrix Σ has an inverse-Wishart(ν0 , S−1
0 ) distribution. The expectations of Σ −1 and Σ are
E[Σ −1 ] = ν0 S−1
0
1
1
−1
E[Σ] =
(S−1
=
S0 .
0 )
ν0 − p − 1
ν0 − p − 1
If we are confident that the true covariance matrix is near some covariance
matrix Σ0 , then we might choose ν0 to be large and set S0 = (ν0 − p − 1)Σ0 ,
making the distribution of Σ concentrated around Σ0 . On the other hand,
choosing ν0 = p + 2 and S0 = Σ0 makes Σ only loosely centered around Σ0 .
Full conditional distribution of the covariance matrix
The inverse-Wishart(ν0 , S−1
0 ) density is given by

−1
p
Y
p
/2
p(Σ) = 2ν0 p/2 π (2) |S0 |−ν0 /2
Γ ([ν0 + 1 − j]/2) ×
j=1

|Σ|−(ν0 +p+1)/2 × exp{−tr(S0 Σ −1 )/2}.

(7.7)

The normalizing constant is quite intimidating. Fortunately we will only have
to work with the second line of the equation. The P
expression “tr” stands for
p
trace and for a square p × p matrix A, tr(A) = j=1 aj,j , the sum of the
diagonal elements.
We now need to combine the above prior distribution with the sampling
distribution for Y 1 , . . . , Y n :

7.3 The inverse-Wishart distribution

p(y 1 , . . . , y n |θ, Σ) = (2π)−np/2 |Σ|−n/2 exp{−

n
X

111

(y i − θ)T Σ −1 (y i − θ)/2} .

i=1

(7.8)
PK
T
An interesting result from matrix algebra is that the sum
b
Ab
k =
k=1 k
tr(BT BA), where B is the matrix whose kth row is bTk . This means that the
term in the exponent of Equation 7.8 can be expressed as
n
X

(y i − θ)T Σ −1 (y i − θ) = tr(Sθ Σ −1 ), where

i=1

Sθ =

n
X

(y i − θ)(y i − θ)T .

i=1

The matrix Sθ is the residual sum of squares matrix for the vectors y 1 , . . . , y n
if the population mean is presumed to be θ. Conditional on θ, n1 Sθ provides
an unbiased estimate of the true covariance matrix Cov[Y ] (more
generally,
P
¯ )(y i −
when θ is not conditioned on the sample covariance matrix is (y i − y
¯ )T /(n − 1) and is an unbiased estimate of Σ). Using the above result to
y
combine Equations 7.7 and 7.8 gives the conditional distribution of Σ:
p(Σ|y 1 , . . . , y n , θ)
∝ p(Σ) × p(y 1 , . . . y n |θ, Σ)

 

∝ |Σ|−(ν0 +p+1)/2 exp{−tr(S0 Σ −1 )/2} × |Σ|−n/2 exp{−tr(Sθ Σ −1 )/2}
= |Σ|−(ν0 +n+p+1)/2 exp{−tr([S0 + Sθ ]Σ −1 )/2} .
Thus we have
{Σ|y 1 , . . . , y n , θ} ∼ inverse-Wishart(ν0 + n, [S0 + Sθ ]−1 ).

(7.9)

Hopefully this result seems somewhat intuitive: We can think of ν0 + n as the
“posterior sample size,” being the sum of the “prior sample size” ν0 and the
data sample size. Similarly, S0 + Sθ can be thought of as the “prior” residual
sum of squares plus the residual sum of squares from the data. Additionally,
the conditional expectation of the population covariance matrix is
1
(S0 + Sθ )
ν0 + n − p − 1
ν0 − p − 1
1
n
1
=
S0 +
Sθ
ν0 + n − p − 1 ν0 − p − 1
ν0 + n − p − 1 n

E[Σ|y 1 , . . . , y n , θ] =

and so the conditional expectation can be seen as a weighted average of the
prior expectation and the unbiased estimator. Because it can be shown that Sθ
converges to the true population covariance matrix, the posterior expectation
of Σ is a consistent estimator of the population covariance, even if the true
population distribution is not multivariate normal.

112

7 The multivariate normal model

7.4 Gibbs sampling of the mean and covariance
In the last two sections we showed that
{θ|y 1 , . . . , y n , Σ} ∼ multivariate normal(µn , Λn )
{Σ|y 1 , . . . , y n , θ} ∼ inverse-Wishart(νn , S−1
n ),
where {Λn , µn } are defined in Equations 7.4 and 7.5, νn = ν0 + n and Sn =
S0 + Sθ . These full conditional distributions can be used to construct a Gibbs
sampler, providing us with an MCMC approximation to the joint posterior
distribution p(θ, Σ|y 1 , . . . , y n ). Given a starting value Σ (0) , the Gibbs sampler
generates {θ (s+1) , Σ (s+1) } from {θ (s) , Σ (s) } via the following two steps:
1. Sample θ (s+1) from its full conditional distribution:
a) compute µn and Λn from y 1 , . . . , y n and Σ (s) ;
b) sample θ (s+1) ∼ multivariate normal(µn , Λn ).
2. Sample Σ (s+1) from its full conditional distribution:
a) compute Sn from y 1 , . . . , y n and θ (s+1) ;
b) sample Σ (s+1) ∼ inverse-Wishart(ν0 + n, S−1
n ).
Steps 1.a and 2.a highlight the fact that {µn , Λn } depend on the value of Σ,
and that Sn depends on the value of θ, and so these quantities need to be
recalculated at every iteration of the sampler.
Example: Reading comprehension
Let’s return to the example from the beginning of the chapter in which each
of 22 children were given two reading comprehension exams, one before a
certain type of instruction and one after. We’ll model these 22 pairs of scores as
i.i.d. samples from a multivariate normal distribution. The exam was designed
to give average scores of around 50 out of 100, so µ0 = (50, 50)T would
be a good choice for our prior expectation. Since the true mean cannot be
below 0 or above 100, it is desirable to use a prior variance for θ that puts
little probability outside of this range. We’ll take the prior variances on θ1
and θ2 to be λ20,1 = λ20,2 = (50/2)2 = 625, so that the prior probability
Pr(θj 6∈ [0, 100]) is only 0.05. Finally, since the two exams are measuring
similar things, whatever the true values of θ1 and θ2 are it is probable that
they are close. We can reflect this with a prior correlation of 0.5, so that
λ1,2 = 312.5. As for the prior distribution on Σ, some of the same logic about
the range of exam scores applies. We’ll take S0 to be the same as Λ0 , but only
loosely center Σ around this value by taking ν0 = p + 2 = 4.
mu0<−c ( 5 0 , 5 0 )
L0<−ma t r i x ( c ( 6 2 5 , 3 1 2 . 5 , 3 1 2 . 5 , 6 2 5 ) , nrow=2 , n c o l =2)
nu0<−4
S0<−ma t r i x ( c ( 6 2 5 , 3 1 2 . 5 , 3 1 2 . 5 , 6 2 5 ) , nrow=2 , n c o l =2)

7.4 Gibbs sampling of the mean and covariance

113

The observed values y 1 , . . . , y 22 are plotted as dots in the second panel
¯ = (47.18, 53.86)T , the sample variances
of Figure 7.2. The sample mean is y
2
2
are s1 = 182.16 and s2 = 243.65, and the sample correlation is s1,2 /(s1 s2 ) =
0.70. Let’s use the Gibbs sampler described above to combine this sample
information with our prior distributions to obtain estimates and confidence
intervals for the population parameters. We begin by setting Σ (0) equal to the
sample covariance matrix, and iterating from there. In the R-code below, Y is
the 22 × 2 data matrix of the observed values.
data ( c h a p t e r 7 ) ; Y<−Y. r e a d i n g
n<−dim (Y ) [ 1 ] ; ybar<−a p p ly (Y, 2 , mean )
Sigma<−cov (Y) ; THETA<−SIGMA<−NULL
set . seed (1)
for ( s in 1:5000)
{
###update t h e t a
Ln<−s o l v e ( s o l v e ( L0 ) + n∗ s o l v e ( Sigma ) )
mun<−Ln%∗%( s o l v e ( L0)%∗%mu0 + n∗ s o l v e ( Sigma)%∗%ybar )
t h e t a <−rmvnorm ( 1 , mun , Ln )
###
###update Sigma
Sn<− S0 + ( t (Y)−c ( t h e t a ) )%∗%t ( t (Y)−c ( t h e t a ) )
Sigma<−s o l v e ( r w i s h ( 1 , nu0+n , s o l v e ( Sn ) ) )
###
### s a v e r e s u l t s
THETA<−r b i n d (THETA, t h e t a ) ; SIGMA<−r b i n d (SIGMA, c ( Sigma ) )
###
}

The above code generates 5,000 values ({θ (1) , Σ (1) }), . . . , {θ (5000) , Σ (5000) })
whose empirical distribution approximates p(θ, Σ|y 1 , . . . , y n ). It is left as an
exercise to assess the convergence and autocorrelation of this Markov chain.
From these samples we can approximate posterior probabilities and confidence
regions of interest.
> quantile (
THETA[ , 2 ] −THETA[ , 1 ] , prob=c ( . 0 2 5 , . 5 , . 9 7 5 ) )
2.5%
50%
97.5%
1.513573 6.668097 11.794824

> mean ( THETA[ , 2 ] >THETA[ , 1 ] )
[ 1 ] 0.9942

The posterior probability Pr(θ2 > θ1 |y 1 , . . . , y n ) = 0.99 indicates strong evidence that, if we were to give exams and instruction to a large population

114

7 The multivariate normal model

65

100

of children, then the average score on the second exam would be higher than
that on the first. This evidence is displayed graphically in the first panel of
Figure 7.2, which shows 97.5%, 75%, 50%, 25% and 2.5% highest posterior
density contours for the joint posterior distribution of θ = (θ1 , θ2 )T . A highest posterior density contour is a two-dimensional analogue of a confidence
interval. The contours for the posterior distribution of θ are all mostly above
the 45-degree line θ1 = θ2 .

80

●

60

● ●
●

θ2
55

60

●
●

y2

●
●

●

●
●

●

●
●
●

40

50

●
●

●

●●

●

0

40

45

20

●

35

40

45

50
θ1

55

60

0

20

40

60

80

100

y1

Fig. 7.2. Reading comprehension data and posterior distributions

Now let’s ask a slightly different question - what is the probability that
a randomly selected child will score higher on the second exam than on
the first? The answer to this question is a function of the posterior predictive distribution of a new sample (Y1 , Y2 )T , given the observed values.
The second panel of Figure 7.2 shows highest posterior density contours of
the posterior predictive distribution, which, while mostly being above the
line y2 = y1 , still has substantial overlap with the region below this line,
and in fact Pr(Y2 > Y1 |y 1 , . . . , y n ) = 0.71. How should we evaluate the
effectiveness of the between-exam instruction? On one hand, the fact that
Pr(θ2 > θ1 |y 1 , . . . , y n ) = 0.99 seems to suggest that there is a “highly
significant difference” in exam scores before and after the instruction, yet
Pr(Y2 > Y1 |y 1 , . . . , y n ) = 0.71 says that almost a third of the students will
get a lower score on the second exam. The difference between these two probabilities is that the first is measuring the evidence that θ2 is larger than θ1
without regard to whether or not the magnitude of the difference θ2 − θ1 is
large compared to the sampling variability of the data. Confusion over these
two different ways of comparing populations is common in the reporting of
results from experiments or surveys: studies with very large values of n often
result in values of Pr(θ2 > θ1 |y 1 , . . . , y n ) that are very close to 1 (or p-values

7.5 Missing data and imputation

115

that are very close to zero), suggesting a “significant effect,” even though
such results say nothing about how large of an effect we expect to see for a
randomly sampled individual.

7.5 Missing data and imputation

60

●

●

30

40

●

●

40
30
20

40
80 100

●
● ●
●
●
●
●
●●●●
●
● ●
● ●
●●
●
●
●● ●● ● ●
●
●
●●
● ● ● ●
●
●
●
● ●
●●
●
●
●
●
●
●
●
●
●
●● ●● ●●
●●●
●●
●
● ●
●● ●
●
●●●●● ●
●●●●●
● ● ●
● ● ●
●
●
●
●
● ● ● ●● ●●●
● ●
●
●
●
●
●
●●
●
●
●
●●●
●
●●●●
● ● ● ●●
●
●
● ●
●
●
●
● ●●
●
●
● ●

40

●

60

30

40
40

60

80
skin

●

20

●

100

40

60

80 100

●

●
●
●
●
●
●
●●
●
●
●
●
● ● ●●
●
●● ● ●
●
●
● ●●● ● ●●
● ●● ● ●●
● ●
●
●●●
●
● ●●
●
● ●●
● ●●
●
●
●
●● ●● ●●
● ●
● ●
● ● ●● ● ●
●
●
●
● ●● ● ●●
● ● ●●
●
● ●● ●
●●
● ●●
● ●
●●● ●●●
●● ●
●
●●●●
●●
●● ●●●
●
●● ●
●●●
● ●
●●
●
●
●
●
●
●
●
●
●
●

●

●

20

30

40

●
●
●
●

80

●
● ●

40
30
20

0 10
60

●

●

●
●
●
●●● ● ●
●● ● ●
● ●
● ●● ●●
●● ●● ● ●
●
●
●●● ●
●●●●
●●
●
●
●●● ● ●
●
●
●
●
●
●●●
● ●
●
●
●●
●●●●●
● ●
●●●
● ●
●
● ●
●
●
●
●
●
●●●●●
● ●
●●●
● ●●●
●●●● ●
● ●●● ●
●●●
●
●● ● ●●●●
●
●
●●●●
● ●
●●
●
●
●
●● ● ●
●● ●
●
●●
●

50
20

●

180

●

40

●

140
●
● ● ●

Frequency
30

●
●
● ● ●
●
●
●● ●
● ● ● ●●
●
● ●●●
●
●●
●●
● ●● ●
●
● ●● ●
●
●● ●● ●
●●
●● ●●
●● ● ●
● ●●
●
●●●
●
● ●
●●
●●
●
●
● ●● ●
●●●
● ●● ●
●
●
● ●
● ●●●
●
●●
●
●
●●●
●
●●
●
●●
●●
●
●
●● ●●
●
●
●
●● ●●●● ●
● ● ● ●●● ●
● ●
●
● ● ●●
●
● ●
●
●

80 100

● ●
●
●
● ●
●●
● ●
●●
● ●
●● ●
●●
●● ●●
●
● ● ● ● ●
●
●
● ●
●
●
●
● ●●
● ● ● ●● ● ●
●
●
●●
●
●
● ●● ●
●
● ●
●● ● ●●
●
●●
●
●
●
●
●
●
●
● ● ● ● ●
●● ●●●
●
●
●
●
●
●
● ●
●
●●
●
● ●●● ●● ●
●
●
●●
●●
●●
●
● ● ● ● ●●
● ● ●● ● ● ●
●●
●● ●●
●
●● ●
●
●
● ●● ●
●●
●
●
●
●
●

100

0

100

●

●
●
●
●
●
●
●●
● ●●
●
● ●●●●
●●●
●● ●
●●● ●
●● ●
●
●●
●
● ●
●
●
●
●
●
●
●
● ●
●
●
●● ●
●
●
●● ●
●
●
●● ●
●
●●
● ● ●●
●●
●●
●●
●
●
●●●●
● ●
●
●
● ● ●
●
●●●
● ●● ●
● ●●
●
● ● ●
● ●● ●
●
● ● ●●●●
●●●●●
●
●● ●
●
●●●
●
●●
●
● ●●
●●
●●
●
●●

20 40 60 80
Y[, j1]

20

40

●

●

60
bmi

80 100

●

●
●
●
●●
●
●
●● ● ●
●● ●● ●
●●
●●●●
●
●●● ●
●
●
●● ● ● ●● ● ●● ●
●
● ●●
●
●●●●●●
●
●
●● ● ●●●
●
●
●
●
●
●
●●●●●●●●
●●
●●
●●●
●●
●
●●
●● ●
●
● ●●
●
●
●●●●
●
● ●
●● ●
●
●●●
● ●● ●
● ●●●
●●
●
● ●
● ●
● ●● ●
●●
●● ● ● ●
●
● ●● ● ●
●
●
● ●

20

30

●
●
● ●

Frequency
30
50

●

60

0 10

●●

180

●
●

80 100

60

●

20

100

40

●

40

100

20

140

60

80
60

●

80

●

60 80
Y[, j1]

●
●

●

60

●

100

●

●

40

●
● ●
●
●●
●● ●●
●
● ●●
●●
●
●
●● ●
● ●
●●
● ●
●●
●
● ●
●●
●● ●●
● ● ●●● ●
●
● ●●
● ●
●
●
●● ●
●●●● ●
●
●
● ●●
●
● ●
●
● ●● ●●
● ●
●
●
●●
● ●
● ●●●●
● ●
●
●
● ●●●
●●●
●● ●
●
●
● ●● ●● ● ● ●
● ●● ● ●
●
●
●
●●
● ● ●● ●
●
● ●

●

●

20
40

●

●●

●● ●
● ●● ●
● ●
●● ● ●
●
● ● ●●●●●● ● ● ●● ●●● ●●
●
●
●
●● ●
●● ● ● ●●● ●
●●● ● ●●●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
● ● ●●● ●●
●
●●
● ● ●●●
●
● ●
●
●●
●
●●
●●● ●
●●
●
●
●
●
●●
●
● ●● ●●
● ●
●
●●
●
●
● ●● ●●●●
● ●●
●●
●
●
●
●●
●
●●
● ●●
●●
● ●● ●
●
●
●
●

●

100
100

●

80
●

●
● ●

● ●

● ● ●
●
●
●
●
●●● ● ●
●
●
●
● ●
● ● ●
●●
●
● ●●●● ●
●
● ● ●●
●●●
● ●
●●
● ●● ● ● ●
●
● ●
● ●●● ●● ●
●
●●
● ●●
● ●
●●
●
● ● ●●●
● ●
● ●●
●● ●● ● ●
● ●● ●●
●
● ● ●●
●
●● ●
● ● ● ●●
● ●
●
● ● ●
●
● ●● ●
●●●● ●
● ●
●
● ●
●
●
●
● ● ●
● ●
●●
● ● ●● ●●●
●●
●
● ●●
●
●●
●●
●
●
●
●

●
●

60

0 10

●
●

60
●

180

Frequency
30

●

●

140
bp

●

●
●

●

●

100

●

60

●
●
●

20

●

40

180
140
100

●

60

60

140
●

●

180

●

● ●
●
●
●●
●
●
●
●
● ●
● ● ●
●
● ●
●●
●
●●● ● ●● ●
●●●● ●
●●
●
● ●●
●●
●
●
●
● ●
●●●●
● ●
● ●
● ● ●
●●
●
●●●●
●●●
● ● ●
●●●●● ●
●
●● ●●●
● ● ●
●●●●
●
●● ●
●● ●
● ●● ● ●
●
● ●●● ●
●
● ● ●
●
●
●● ●
● ●●
●● ● ●
● ●
●
●
●
●●

40

140

●

200

●●

50

●

● ●
●
●
●

●

20

0
180

●

60

100

100
150
Y[, j1]

●

●
●
●●
●●
●● ●
●
●●●
●
●
●
●● ●
●●
●●●
● ● ●●●
●●
●
● ●●●
●
●● ●●●●● ●
●●● ●
●● ●
●
●●●
● ●
● ●
●
● ●●
●
●
●
●
● ●
●
●●
● ●
● ●●
● ●
●●
● ● ●● ●●●● ● ● ●
●
●
●●
● ●●●
●
●●
●● ●
●
●
●
●
●
● ●● ● ●● ● ●
● ●
● ●●● ●
●
●
● ●●● ●
●
●
●
●
●
●

●
●

40

10

60

80

Frequency
20 30

●

50

100

●
●

80 100

100

40

glu

40

15

25

35

45

Fig. 7.3. Physiological data on 200 women.

Figure 7.3 displays univariate histograms and bivariate scatterplots for
four variables taken from a dataset involving health-related measurements on
200 women of Pima Indian heritage living near Phoenix, Arizona (Smith et al,
1988). The four variables are glu (blood plasma glucose concentration), bp
(diastolic blood pressure), skin ( skin fold thickness) and bmi (body mass
index). The first ten subjects in this dataset have the following entries:

116

7 The multivariate normal model

1
2
3
4
5
6
7
8
9
10

glu
86
195
77
NA
107
97
NA
193
142
128

bp skin bmi
68
28 30.2
70
33
NA
82
NA 35.8
76
43 47.9
60
NA
NA
76
27
NA
58
31 34.3
50
16 25.9
80
15
NA
78
NA 43.3

The NA’s stand for “not available,” and so some data for some individuals
are “missing.” Missing data are fairly common in survey data: Sometimes
people accidentally miss a page of a survey, sometimes a doctor forgets to
write down a piece of medical data, sometimes the response is unreadable,
and so on. Many surveys (such as the General Social Survey) have multiple
versions with certain questions appearing in only a subset of the versions. As
a result, all the subjects may have missing data.
In such situations it is not immediately clear how to do
Qnparameter estimation. The posterior distribution for θ and Σ depends on i=1 p(y i |θ, Σ), but
p(y i |θ, Σ) cannot be computed if components of y i are missing. What can
we do? Unfortunately, many software packages either throw away all subjects
with incomplete data, or impute missing values with a population mean or
some other fixed value, then proceed with the analysis. The first approach is
bad because we are throwing away a potentially large amount of useful information. The second is statistically incorrect, as it says we are certain about
the values of the missing data when in fact we have not observed them.
Let’s carefully think about the information that is available from subjects
with missing data. Let O i = (O1 , . . . , Op )T be a binary vector of zeros and
ones such that Oi,j = 1 implies that Yi,j is observed and not missing, whereas
Oi,j = 0 implies Yi,j is missing. Our observed information about subject i
is therefore O i = oi and Yi,j = yi,j for variables j such that oi,j = 1. For
now, we’ll assume that missing data are missing at random, meaning that O i
and Y i are statistically independent and that the distribution of O i does not
depend on θ or Σ. In cases where the data are missing but not at random,
then sometimes inference can be made by modeling the relationship between
O i , Y i and the parameters (see Chapter 21 of Gelman et al (2004)).
In the case where data are missing at random, the sampling probability
for the data from subject i is
p(oi , {yi,j : oi,j = 1}|θ, Σ) = p(oi ) × p({yi,j : oi,j = 1}|θ, Σ)

Z 
= p(oi ) ×
p(yi,1 , . . . , yi,p |θ, Σ)


Y
yi,j :oi,j =0

dyi,j





.

7.5 Missing data and imputation

117

In words, our sampling probability for data from subject i is p(oi ) multiplied by the marginal probability of the observed variables, after integrating out the missing variables. To make this more concrete, suppose
y i = (yi,1 , NA, yi,3 , NA)T , so oi = (1, 0, 1, 0)T . Then
p(oi , yi,1 , yi,3 |θ, Σ) = p(oi ) × p(yi,1 , yi,3 |θ, Σ)
Z
= p(oi ) × p(y i |θ, Σ) dy2 dy4 .
So the correct thing to do when data are missing at random is to integrate over
the missing data to obtain the marginal probability of the observed data. In
this particular case of the multivariate normal model, this marginal probability is easily obtained: p(yi,1 , yi,3 |θ, Σ) is simply a bivariate normal density with
mean (θ1 , θ3 )T and a covariance matrix made up of (σ12 , σ1,3 , σ32 ). But combining marginal densities from subjects having different amounts of information
can be notationally awkward. Fortunately, our integration can alternatively
be done quite easily using Gibbs sampling.
Gibbs sampling with missing data
In Bayesian inference we use probability distributions to describe our information about unknown quantities. What are the unknown quantities for our
multivariate normal model with missing data? The parameters θ and Σ are
unknown as usual, but the missing data are also an unknown but key component of our model. Treating it as such allows us to use Gibbs sampling to
make inference on θ, Σ, as well as to make predictions for the missing values.
Let Y be the n × p matrix of all the potential data, observed and unobserved, and let O be the n × p matrix in which oi,j = 1 if Yi,j is observed and
oi,j = 0 if Yi,j is missing. The matrix Y can then be thought of as consisting
of two parts:
• Yobs = {yi,j : oi,j = 1}, the data that we do observe, and
• Ymiss = {yi,j : oi,j = 0}, the data that we do not observe.
From our observed data we want to obtain p(θ, Σ, Ymiss |Yobs ), the posterior distribution of unknown and unobserved quantities. A Gibbs sampling
scheme for approximating this posterior distribution can be constructed by
simply adding one step to the Gibbs sampler presented in the previous sec(0)
(s+1)
tion: Given starting values {Σ (0) , Ymiss }, we generate {θ (s+1) , Σ (s+1) , Ymiss }
(s)
from {θ (s) , Σ (s) , Ymiss } by
(s)

1. sampling θ (s+1) from p(θ|Yobs , Ymiss , Σ (s) ) ;
(s)
2. sampling Σ (s+1) from p(Σ|Yobs , Ymiss , θ (s+1) ) ;
(s+1)
3. sampling Ymiss from p(Ymiss |Yobs , θ (s+1) , Σ (s+1) ).
Note that in steps 1 and 2, the fixed value of Yobs combines with the current
(s)
value of Ymiss to form a current version of a complete data matrix Y(s) having

118

7 The multivariate normal model

no missing values. The n rows of the matrix of Y(s) can then be plugged into
formulae 7.6 and 7.9 to obtain the full conditional distributions of θ and Σ.
Step 3 is a bit more complicated:
p(Ymiss |Yobs , θ, Σ) ∝ p(Ymiss , Yobs |θ, Σ)
n
Y
=
p(y i,miss , y i,obs |θ, Σ)
∝

i=1
n
Y

p(y i,miss |y i,obs , θ, Σ),

i=1

so for each i we need to sample the missing elements of the data vector conditional on the observed elements. This is made possible via the following result
about multivariate normal distributions: Let y ∼ multivariate normal(θ, Σ),
let a be a subset of variable indices {1, . . . , p} and let b be the complement of
a. For example, if p = 4 then perhaps a = {1, 2} and b = {3, 4}. If you know
about inverses of partitioned matrices you can show that
{y [b] |y [a] , θ, Σ} ∼ multivariate normal(θ b|a , Σb|a ), where
θ b|a = θ [b] + Σ[b,a] (Σ[a,a] )−1 (y [a] − θ [a] )
−1

Σb|a = Σ[b,b] − Σ[b,a] (Σ[a,a] )

Σ[a,b] .

(7.10)
(7.11)

In the above formulae, θ [b] refers to the elements of θ corresponding to the
indices in b, and Σ[a,b] refers to the matrix made up of the elements that are
in rows a and columns b of Σ.
Let’s try to gain a little bit of intuition about what is going on in Equations
7.10 and 7.11. Suppose y is a sample from our population of four variables glu,
bp, skin and bmi. If we have glu and bp data for someone (a = {1, 2}) but are
missing skin and bmi measurements (b = {3, 4}), then we would be interested
in the conditional distribution of these missing measurements y [b] given the
observed information y [a] . Equation 7.10 says that the conditional mean of
skin and bmi start off at their unconditional mean θ [b] , but then are modified
by (y [a] −θ [a] ). For example, if a person had higher than average values of glu
and bp, then (y [a] − θ [a] ) would be a 2 × 1 vector of positive numbers. For our
data the 2×2 matrix Σ[b,a] (Σ[a,a] )−1 has all positive entries, and so θ b|a > θ [b] .
This makes sense: If all four variables are positively correlated, then if we
observe higher than average values of glu and bp, we should also expect
higher than average values of skin and bmi. Also note that Σb|a is equal to
the unconditional variance Σ[b,b] but with something subtracted off, suggesting
that the conditional variance is less than the unconditional variance. Again,
this makes sense: having information about some variables should decrease,
or at least not increase, our uncertainty about the others.
The R code below implements the Gibbs sampling scheme for missing data
described in steps 1, 2 and 3 above:

7.5 Missing data and imputation

119

data ( c h a p t e r 7 ) ; Y<−Y. pima . m i s s
### p r i o r p a r a m e t e r s
n<−dim (Y ) [ 1 ] ; p<−dim (Y ) [ 2 ]
mu0<−c ( 1 2 0 , 6 4 , 2 6 , 2 6 )
sd0 <−(mu0/ 2 )
L0<−ma t r i x ( . 1 , p , p ) ; d i a g ( L0)<−1 ; L0<−L0∗ o u t e r ( sd0 , sd0 )
nu0<−p+2 ; S0<−L0
###
### s t a r t i n g v a l u e s
Sigma<−S0
Y. f u l l <−Y
O<−1∗(! i s . na (Y) )
for ( j in 1: p)
{
Y. f u l l [ i s . na (Y. f u l l [ , j ] ) , j ]<−mean (Y. f u l l [ , j ] , na . rm=TRUE)
}
###
### Gibbs s a m p l e r
THETA<−SIGMA<−Y. MISS<−NULL
set . seed (1)
for ( s in 1:1000)
{
###update t h e t a
ybar<−a p p ly (Y. f u l l , 2 , mean )
Ln<−s o l v e ( s o l v e ( L0 ) + n∗ s o l v e ( Sigma ) )
mun<−Ln%∗%( s o l v e ( L0)%∗%mu0 + n∗ s o l v e ( Sigma)%∗%ybar )
t h e t a <−rmvnorm ( 1 , mun , Ln )
###
###update Sigma
Sn<− S0 + ( t (Y. f u l l )−c ( t h e t a ) )%∗%t ( t (Y. f u l l )−c ( t h e t a ) )
Sigma<−s o l v e ( r w i s h ( 1 , nu0+n , s o l v e ( Sn ) ) )
###
###update m i s s i n g data
for ( i in 1: n)
{
b <− ( O[ i ,]==0 )
a <− ( O[ i ,]==1 )
iSa <− s o l v e ( Sigma [ a , a ] )
b e t a . j <− Sigma [ b , a]%∗% i S a
Sigma . j
<− Sigma [ b , b ] − Sigma [ b , a]%∗% i S a%∗%Sigma [ a , b ]
t h e t a . j <− t h e t a [ b ] + b e t a . j %∗%(t (Y. f u l l [ i , a ]) − t h e t a [ a ] )
Y. f u l l [ i , b ] <− rmvnorm ( 1 , t h e t a . j , Sigma . j )
}

120

7 The multivariate normal model

### s a v e r e s u l t s
THETA<−r b i n d (THETA, t h e t a ) ; SIGMA<−r b i n d (SIGMA, c ( Sigma ) )
Y. MISS<−r b i n d (Y. MISS , Y. f u l l [O==0] )
###
}
###

The prior mean of µ0 = (120, 64, 26, 26)T was obtained from national averages,
and the prior variances were based primarily on keeping most of the prior
mass on values that are above zero. These prior distributions are likely much
more diffuse than more informed prior distributions that could be provided
by someone who is familiar with this population or these variables.
The Monte Carlo approximation of E[θ|y 1 , . . . , y n ] is (123.46, 71.03, 29.35,
32.18), obtained by averaging the 1,000 θ-values generated by the Gibbs sampler. Posterior confidence intervals and other quantities can additionally be
obtained in the usual way from the Gibbs samples. We can also average the
1,000 values of Σ to obtain E[Σ|y 1 , . . . , y n ], the posterior expectation of Σ.
However, when looking at associations among a set of variables, it is often the
correlations that are of interest and not the covariances. To each covariance
matrix Σ there corresponds a correlation matrix C, given by
q
n
o
C = cj,k : cj,k = Σ[j,k] / Σ[j,j] Σ[k,k] .
We can convert our 1,000 posterior samples of Σ into 1,000 posterior samples
of C using the following R-code:
COR <− a r r a y ( dim=c ( p , p , 1 0 0 0 ) )
for ( s in 1:1000)
{
Sig <−m at r i x ( SIGMA [ s , ] , nrow=p , n c o l=p )
COR[ , , s ] <− S i g / s q r t ( o u t e r ( d i a g ( S i g ) , d i a g ( S i g ) ) )
}

This code generates a 4×4×1000 array, where each “slice” is a 4×4 correlation
matrix generated from the posterior distribution. The posterior expectation
of C is


1.00 0.23 0.25 0.19
 0.23 1.00 0.25 0.24 

E[C|y 1 , . . . , y n ] = 
 0.25 0.25 1.00 0.65 
0.19 0.24 0.65 1.00
and marginal posterior 95% quantile-based confidence intervals can be obtained with the command apply(COR, c(1,2), quantile,prob=c(.025,.975) ) .
These are displayed graphically in the left panel of Figure 7.4.
Prediction and regression
Multivariate models are often used to predict one or more variables given the
others. Consider, for example, a predictive model of glu based on measurements of bp, skin and bmi. Using a = {2, 3, 4} and b = {1} in Equation 7.10,

glu
0.3
0.5

glu
0.2 0.4 0.6

0.7

7.5 Missing data and imputation

●

●

●

●
●

0.3

bp

0.5

bp
0.2 0.4 0.6

0.7

−0.2

0.1

●

●

●
●

●

●

●

●

●

●

●

bmi
0.2 0.4 0.6

0.7

−0.2

0.1

●

skin
0.2 0.4 0.6

0.7

−0.2

0.1

●

bmi
0.3
0.5

●

●

●

●

●

bmi

skin

glu

bmi

skin

bp

glu

−0.2

0.1

●

bp

skin
0.3
0.5

121

Fig. 7.4. Ninety-five percent posterior confidence intervals for correlations (left)
and regression coefficients (right).

the conditional mean of y [b] =glu, given numerical values of y [a] = {bp, skin,
bmi }, is given by
E[y [b] |θ, Σ, y [a] ] = θ [b] + β Tb|a (y [a] − θ [a] )
where β Tb|a = Σ[b,a] (Σ[a,a] )−1 . Since this takes the form of a linear regression
model, we call the value of β b|a the regression coefficient for y [b] given y [a]
based on Σ. Values of β b|a can be computed for each posterior sample of
Σ, allowing us to obtain posterior expectations and confidence intervals for
these regression coefficients. Quantile-based 95% confidence intervals for each
of {β 1|234 , β 2|134 , β 3|124 , β 4|123 } are shown graphically in the second column
of Figure 7.4. The regression coefficients often tell a different story than the
correlations: The bottom row of plots, for example, shows that while there

122

7 The multivariate normal model

is strong evidence that the correlations between bmi and each of the other
variables are all positive, the plots on the right-hand side suggest that bmi is
nearly conditionally independent of glu and bp given skin.

●

78

140

●

135

●
●

76

●
●

predictied bp
70
72
74

predictied glu
120 125 130

●
●

●
●

●
●
●

●

●
●
●

●

●

●

●

●

●

●

●

●●

115

●

68

●
●●

●

66

●

110

●

●

●
●

80

●

100

120
140
true glu

160

180

40

50

60

70
80
true bp

90

100

●

●

●

●
●

●
●

●

●
● ●
●
●
●

●

●
●

●

●
●

●

●

●
●

●

●
●

●

●

20

28

●

●

predictied bmi
30
32
34

predictied skin
25
30
35

●

●

●

●
●

●

●

●

36

40

●

●

●

●

10

20

30
true skin

●

26

15

●

40

25

●

●

30

35
true bmi

40

Fig. 7.5. True values of the missing data versus their posterior expectations.

Out-of-sample validation
Actually, the dataset we just analyzed was created by taking a complete data
matrix with no missing values and randomly replacing 10% of the entries with
NA’s. Since the original dataset is available, we can compare values predicted
by the model to the actual sample values. This comparison is made graphically
in Figure 7.5, which plots the true value of yi,j against its posterior mean for
each {i, j} such that oi,j = 0. It looks like we are able to do a better job

7.6 Discussion and further references

123

predicting missing values of skin and bmi than the other two variables. This
makes sense, as these two variables have the highest correlation. If skin is
missing, we can make a good prediction for it based on the observed value of
bmi, and vice-versa. Such a procedure, where we evaluate how well a model
does at predicting data that were not used to estimate the parameters, is
called out-of-sample validation, and is often used to quantify the predictive
performance of a model.

7.6 Discussion and further references
The multivariate normal model can be justified as a sampling model for reasons analogous to those for the univariate normal model (see Section 5.7): It is
characterized by independence between the sample mean and sample variance
(Rao, 1958), it is a maximum entropy distribution and it provides consistent
estimation of the population mean and variance, even if the population is not
multivariate normal.
The multivariate normal and Wishart distributions form the foundation
of multivariate data analysis. A classic text on the subject is Mardia et al
(1979), and one with more coverage of Bayesian approaches is Press (1982).
An area of much current Bayesian research involving the multivariate normal distribution is the study of graphical models (Lauritzen, 1996; Jordan,
1998). A graphical model allows elements of the precision matrix to be exactly equal to zero, implying some variables are conditionally independent of
each other. A generalization of the Wishart distribution, known as the hyperinverse-Wishart distribution, has been developed for such models (Dawid and
Lauritzen, 1993; Letac and Massam, 2007).

8
Group comparisons and hierarchical modeling

In this chapter we discuss models for the comparison of means across groups.
In the two-group case, we parameterize the two population means by their
average and their difference. This type of parameterization is extended to the
multigroup case, where the average group mean and the differences across
group means are described by a normal sampling model. This model, together with a normal sampling model for variability among units within a
group, make up a hierarchical normal model that describes both within-group
and between-group variability. We also discuss an extension to this normal
hierarchical model which allows for across-group heterogeneity in variances in
addition to heterogeneity in means.

8.1 Comparing two groups
The first panel of Figure 8.1 shows math scores from a sample of 10th grade
students from two public U.S. high schools. Thirty-one students from school
1 and 28 students from school 2 were randomly selected to participate in a
math test. Both schools have a total enrollment of around 600 10th graders
each, and both are in urban neighborhoods.
Suppose we are interested in estimating θ1 , the average score we would
obtain if all 10th graders in school 1 were tested, and possibly comparing it
to θ2 , the corresponding average from school 2. The results from the sample
data are y¯1 = 50.81 and y¯2 = 46.15, suggesting that θ1 is larger than θ2 .
However, if different students had been sampled from each of the two schools,
then perhaps y¯2 would have been larger than y¯1 . To assess whether or not the
observed mean difference of y¯1 − y¯2 = 4.66 is large compared to the sampling
variability it is standard practice to compute the t-statistic, which is the ratio
of the observed difference to an estimate of its standard deviation:

P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 8,
c Springer Science+Business Media, LLC 2009


126

8 Group comparisons and hierarchical modeling

t(y 1 , y 2 ) =

y¯1 − y¯2
sp

p

1/n1 + 1/n2
50.81 − 46.15
p
=
= 1.74,
10.44 1/31 + 1/28

0.0

30

40

0.1

score
50

density
0.2

60

0.3

70

0.4

where s2p = [(n1 − 1)s21 + (n2 − 1)s22 ]/(n1 + n2 − 2), the pooled estimate of
the population variance of the two groups. Is this value of 1.74 large? From
introductory statistics, we know that if the population of scores from the two
schools are both normally distributed with the same mean and variance, then
the sampling distribution of the t-statistic t(Y 1 , Y 2 ) is a t-distribution with
n1 + n2 − 2 = 57 degrees of freedom. The density of this distribution is plotted in the second panel of Figure 8.1, along with the observed value of the
t-statistic. If the two populations indeed follow the same normal population,
then the pre-experimental probability of sampling a dataset that would generate a value of t(Y 1 , Y 2 ) greater in absolute value than 1.74 is p = 0.087. You
may recall that this latter number is called the (two-sided) p-value. While
a small p-value is generally considered as indicating evidence that θ1 and θ2
are different, the p-value should not be confused with the probability that
θ1 = θ2 . Although not completely justified by statistical theory for this purpose, p-values are often used in parameter estimation and model selection.
For example, the following is a commonly taught data analysis procedure for
comparing the population means of two groups:

school 1

school 2

−4

−2

0
t

2

4

Fig. 8.1. Boxplots of samples of 10th grade math scores from two schools, and the
null distribution for testing equality of the population means. The gray line indicates
the observed value of the t-statistic.

8.1 Comparing two groups

127

Model selection based on p-values:
If
–
–
–
If
–
–
–

p < 0.05,
reject the model that the two groups have the same distribution;
conclude that θ1 6= θ2 ;
use the estimates θˆ1 = y¯1 , θˆ2 = y¯2 .
p > 0.05
accept the model that the two groups have the same distribution;
conclude that θ1 = θ2 ;
P
P
use the estimates θˆ1 = θˆ2 = ( yi,1 + yi,2 )/(n1 + n2 ).

This data analysis procedure results in either treating the two populations
as completely distinct or treating them as exactly identical. Do these rather
extreme alternatives make sense? For our math score data, the above procedure would take the p-value of 0.087 and tell us to treat the population means
of the two groups as being numerically equivalent, although there seems to
be some evidence of a difference. Conversely, it is not too hard to imagine
a scenario where the sample from school 1 might have included a few more
high-performing students, the sample from school 2 a few more low-performing
students, in which case we could have observed a p-value of 0.04 or 0.05. In
this latter case we would have treated each population separately, using only
data from school 1 to estimate θ1 and similarly for school 2. This latter approach seems somewhat inefficient: Since the two samples are both measuring
the same thing on similar populations of students, it might make sense to use
some of the information from one group to help estimate the mean in the
other.
The p-value-based procedure described above can be re-expressed as estimating θ1 as θˆ1 = w¯
y1 + (1 − w)¯
y2 , where w = 1 if p < 0.05 and
w = n1 /(n1 + n2 ) otherwise. Instead of using such an extreme procedure,
it might make more sense to allow w to vary continuously and have a value
that depends on such things as the relative sample sizes n1 and n2 , the sampling variability σ 2 and our prior information about the similarities of the two
populations. An estimator similar to this is produced by a Bayesian analysis that allows for information to be shared across the groups. Consider the
following sampling model for data from the two groups:
Yi,1 = µ + δ + i,1
Yi,2 = µ − δ + i,2
{i,j } ∼ i.i.d. normal(0, σ 2 ) .
Using this parameterization where θ1 = µ + δ and θ2 = µ − δ, we see that δ
represents half the population difference in means, as (θ1 − θ2 )/2 = δ, and µ
represents the pooled average, as (θ1 + θ2 )/2 = µ. Convenient conjugate prior
distributions for the unknown parameters are

128

8 Group comparisons and hierarchical modeling

p(µ, δ, σ 2 ) = p(µ) × p(δ) × p(σ 2 )
µ ∼ normal(µ0 , γ02 )
δ ∼ normal(δ0 , τ02 )
σ 2 ∼ inverse-gamma(ν0 /2, ν0 σ02 /2).
It is left as an exercise to show that the full conditional distributions of these
parameters are as follows:
2
{µ|y 1 , y 2 , δ, σ 2 } ∼ normal(µ
Pn1 n , γn ), where2 Pn2
2
2
µn = γn × [µ0 /γ0 + i=1 (yi,1 − δ)/σ + i=1 (yi,2 + δ)/σ 2 ]
γn2 = [1/γ02 + (n1 + n2 )/σ 2 ]−1
2
{δ|y 1 , y 2 , µ, σ 2 } ∼ normal(δ
P n , τn ), where
P
2
2
δn = τn × [δ0 /τ0 + (yi,1 − µ)/σ 2 − (yi,2 − µ)/σ 2 ]
τn2 = [1/τ02 + (n1 + n2 )/σ 2 ]−1

{σ 2 |y 1 , y 2 , µ, δ} ∼ inverse-gamma(νn /2, νn σn2 /2), where
νn = ν0 + n1 + P
n2
P
νn σn2 = ν0 σ02 + (yi,1 − [µ + δ])2 + (yi,2 − [µ − δ])2
Although these formulae seem quite involved, you should try to convince yourself that they make sense. One way to do this is to plug in extreme values for
the prior parameters. For example, if ν0 = 0 then
P
P
(yi,1 − [µ + δ])2 + (yi,2 − [µ − δ])2
σn2 =
n1 + n2
which is a pooled-sample estimate of the variance if the values of µ and δ were
known. Similarly, if µ0 = δ0 = 0 and γ02 = τ02 = ∞, then (defining 0/∞ = 0)
P
P
P
P
(yi,1 − δ) + (yi,2 + δ)
(yi,1 − µ) − (yi,2 − µ)
, δn =
µn =
n1 + n2
n1 + n2
and if you plug in µn for µ and δn for δ, you get y¯1 = µn +δn and y¯2 = µn −δn .
Analysis of the math score data
The math scores were based on results of a national exam in the United States,
standardized to produce a nationwide mean of 50 and a standard deviation
of 10. Unless these two schools were known in advance to be extremely exceptional, reasonable prior parameters can be based on this information. For
the prior distributions of µ and σ 2 , we’ll take µ0 = 50 and σ02 = 102 = 100,
although this latter value is likely to be an overestimate of the within-school
sampling variability. We’ll make these prior distributions somewhat diffuse,
with γ02 = 252 = 625 and ν0 = 1. For the prior distribution on δ, choosing
δ0 = 0 represents the prior opinion that θ1 > θ2 and θ2 > θ1 are equally
probable. Finally, since the scores are bounded between 0 an 100, half the

8.1 Comparing two groups

129

difference between θ1 and θ2 must be less than 50 in absolute value, so a value
of τ02 = 252 = 625 seems reasonably diffuse.
Using the full-conditional distributions given above, we can construct a
Gibbs sampler to approximate the posterior distribution p(µ, δ, σ 2 |y 1 , y 2 ). Rcode to do the approximation appears below:
data ( c h a p t e r 8 )
y1<−y . s c h o o l 1 ; n1<−l e n g t h ( y1 )
y2<−y . s c h o o l 2 ; n2<−l e n g t h ( y2 )
##### p r i o r p a r a m e t e r s
mu0<−50 ; g02 <−625
d e l 0 <−0 ; t02 <−625
s20 <−100; nu0<−1
#####
##### s t a r t i n g v a l u e s
mu<− ( mean ( y1 ) + mean ( y2 ) ) / 2
d e l <− ( mean ( y1 ) − mean ( y2 ) ) / 2
#####
##### Gibbs s a m p l e r
MU<−DEL<−S2<−NULL
set . seed (1)
for ( s in 1:5000)
{
##update s 2
s2 <−1/rgamma ( 1 , ( nu0+n1+n2 ) / 2 ,
( nu0∗ s 2 0+sum ( ( y1−mu−d e l )ˆ2)+sum ( ( y2−mu+d e l ) ˆ 2 ) ) / 2 )
##
##update mu
var . mu<− 1 / ( 1 / g02+ ( n1+n2 ) / s 2 )
mean . mu<−var . mu∗ (mu0/ g02+sum ( y1−d e l ) / s 2+sum ( y2+d e l ) / s 2 )
mu<−rnorm ( 1 , mean . mu, s q r t ( var . mu) )
##
##update d e l
var . d e l <− 1 / ( 1 / t 0 2+ ( n1+n2 ) / s 2 )
mean . d e l <−var . d e l ∗ ( d e l 0 / t 0 2+sum ( y1−mu) / s2−sum ( y2−mu) / s 2 )
d e l <−rnorm ( 1 , mean . d e l , s q r t ( var . d e l ) )
##
##s a v e parameter v a l u e s
MU<−c (MU, mu) ; DEL<−c (DEL, d e l ) ; S2<−c ( S2 , s 2 )
}
#####

130

8 Group comparisons and hierarchical modeling

density
0.00 0.05 0.10 0.15 0.20 0.25

density
0.00 0.05 0.10 0.15 0.20 0.25

Figure 8.2 shows the marginal posterior distributions of µ and δ, and how they
are much more concentrated than their corresponding prior distributions. In
particular, a 95% quantile-based posterior confidence interval for 2 × δ, the
difference in average scores between the two schools, is (−.61, 9.98). Although
this interval contains zero, the differences between the prior and posterior
distributions indicate that we have gathered substantial evidence that the
population mean for school 1 is higher than that of school 2. Additionally, the
posterior probability Pr(θ1 > θ2 |y 1 , y 2 ) = Pr(δ > 0|y 1 , y 2 ) ≈ 0.96, whereas
the corresponding prior probability was Pr(δ > 0) = 0.50. However, we should
be careful not to confuse this probability with the probability that a randomly
selected student from school 1 has a higher score than one sampled from school
2. This latter probability can be obtained from the joint posterior predictive
distribution, which gives Pr(Y1 > Y2 |y 1 , y 2 ) ≈ 0.62.

prior
posterior

30

40

50
µ

60

70

prior
posterior

−20

−10

0
δ

10

20

Fig. 8.2. Prior and posterior distributions for µ and δ.

8.2 Comparing multiple groups
The data in the previous section was part of the 2002 Educational Longitudinal Study (ELS), a survey of students from a large sample of schools across
the United States. This dataset includes a population of schools as well as a
population of students within each school. Datasets like this, where there is
a hierarchy of nested populations, are often called hierarchical or multilevel .
Other situations having the same sort of data structure include data on
• patients within several hospitals,
• genes within a group of animals, or

8.2 Comparing multiple groups

131

• people within counties within regions within countries.
The simplest type of multilevel data has two levels, in which one level consists
of groups and the other consists of units within groups. In this case we denote
yi,j as the data on the ith unit in group j.
8.2.1 Exchangeability and hierarchical models
Recall from Chapter 2 that a sequence of random variables Y1 , . . . , Yn is exchangeable if the probability density representing our information about the
sequence satisfies p(y1 , . . . , yn ) = p(yπ1 , . . . , yπn ) for any permutation π. Exchangeability is a reasonable property of p(y1 , . . . , yn ) if we lack information
distinguishing the random variables. For example, if Y1 , . . . , Yn were math
scores from n randomly selected students from a particular school, then in
the absence of other information about the students we might treat their
math scores as exchangeable. If exchangeability holds for all values of n, then
de Finetti’s theorem says that an equivalent formulation of our information
is that
φ ∼ p(φ)
{Y1 , . . . , Yn |φ} ∼ i.i.d. p(y|φ).
In other words, the random variables can be thought of as independent samples
from a population described by some fixed but unknown population feature
φ. In the normal model, for example, we take φ = {θ, σ 2 } and model the data
as conditionally i.i.d. normal(θ, σ 2 ).
Now let’s consider a model describing our information about a hierarchical
data {Y 1 , . . . , Y m }, where Y j = {Y1,j , . . . , Ynj ,j }. What properties should a
model p(y 1 , . . . , y m ) have? Let’s consider first p(y j ) = p(y1,j , . . . , ynj ,j ), the
marginal probability density of data from a single group j. The discussion
in the preceding paragraph suggests that we should not treat Y1,j , . . . , Ynj ,j
as being independent, as doing so would imply, for example, that p(ynj ,j |
y1,j ,. . .,ynj −1,j ) = p(ynj ,j ), and that the values of Y1,j , . . . , Ynj −1,j would
give us no information about Ynj ,j . However, if all that is known about
Y1,j , . . . , Ynj ,j is that they are random samples from group j, then treating
Y1,j , . . . , Ynj ,j as exchangeable makes sense. If group j is large compared to the
sample size nj , then de Finetti’s theorem and results of Diaconis and Freedman (1980) say that we can model the data within group j as conditionally
i.i.d. given some group-specific parameter φj :
{Y1,j , . . . , Ynj ,j |φj } ∼ i.i.d. p(y|φj ) .
But how should we represent our information about φ1 , . . . , φm ? As before,
we might not want to treat these parameters as independent, because doing
so would imply that knowing the values of φ1 , . . . , φm−1 does not change
our information about the value of φm . However, if the groups themselves

132

8 Group comparisons and hierarchical modeling

are samples from some larger population of groups, then exchangeability of
the group-specific parameters might be appropriate. Applying de Finetti’s
theorem a second time gives
{φ1 , . . . , φm |ψ} ∼ i.i.d. p(φ|ψ)
for some sampling model p(φ|ψ) and an unknown parameter ψ. This double
application of de Finetti’s theorem has led us to three probability distributions:
{y1,j , . . . , ynj ,j |φj } ∼ i.i.d. p(y|φj )
{φ1 , . . . , φm |ψ} ∼ i.i.d. p(φ|ψ)
ψ ∼ p(ψ)

(within-group sampling variability)
(between-group sampling variability)
(prior distribution)

It is important to recognize that the distributions p(y|φ) and p(φ|ψ) both
represent sampling variability among populations of objects: p(y|φ) represents
variability among measurements within a group and p(φ|ψ) represents variability across groups. In contrast, p(ψ) represents information about a single
fixed but unknown quantity. For this reason, we refer to p(y|φ) and p(φ|ψ)
as sampling distributions, and are conceptually distinct from p(ψ), which is a
prior distribution. In particular, the data will be used to estimate the withinand between-group sampling distributions p(y|φ) and p(φ|ψ), whereas the
prior distribution p(ψ) is not estimated from the data.

8.3 The hierarchical normal model
A popular model for describing the heterogeneity of means across several populations is the hierarchical normal model, in which the within- and betweengroup sampling models are both normal:
φj = {θj , σ 2 }, p(y|φj ) = normal(θj , σ 2 )
ψ = {µ, τ 2 }, p(θj |ψ) = normal(µ, τ 2 )

(within-group model) (8.1)
(between-group model) (8.2)

It might help to visualize this setup as in Figure 8.3. Note that p(φ|ψ) only
describes the heterogeneity across group means, and not any heterogeneity in
group-specific variances. In fact, the within-group sampling variability σ 2 is
assumed to be constant across groups. At the end of this chapter we will
eliminate this assumption by adding a component to the model that allows
for group-specific variances.
The fixed but unknown parameters in this model are µ, τ 2 and σ 2 . For
convenience we will use standard semiconjugate normal and inverse-gamma
prior distributions for these parameters:
1/σ 2 ∼ gamma (ν0 /2, ν0 σ02 /2)
1/τ 2 ∼ gamma (η0 /2, η0 τ02 /2)
µ ∼ normal (µ0 , γ02 )

8.3 The hierarchical normal model
µ, τ

133

2

θ1

θ2

···

θm−1

Y1

Y2

···

Y m−1 Y m

θm

σ2
Fig. 8.3. A graphical representation of the basic hierarchical normal model.

8.3.1 Posterior inference
The unknown quantities in our system include the group-specific means
{θ1 , . . . , θm }, the within-group sampling variability σ 2 and the mean and variance (µ, τ 2 ) of the population of group-specific means. Joint posterior inference for these parameters can be made by constructing a Gibbs sampler which
approximates the posterior distribution p(θ1 , . . . , θm , µ, τ 2 , σ 2 |y 1 , . . . , y m ).
The Gibbs sampler proceeds by iteratively sampling each parameter from
its full conditional distribution. Deriving the full conditional distributions in
this highly parameterized system may seem like a daunting task, but it turns
out that all of the necessary technical details have been covered in Chapters
5 and 6. All that is required of us at this point is that we recognize certain
analogies between the current model and the univariate normal model. Useful
for this will be the following factorization:
p(θ1 , . . . , θm , µ, τ 2 , σ 2 |y 1 , . . . , y m )
∝ p(µ, τ 2 , σ 2 ) × p(θ1 , . . . , θm |µ, τ 2 , σ 2 ) × p(y 1 , . . . , y m |θ1 , . . . , θm , µ, τ 2 , σ 2 )



nj
m
m Y
Y
 Y

= p(µ)p(τ 2 )p(σ 2 )
p(θj |µ, τ 2 )
p(yi,j |θj , σ 2 ) .
(8.3)



j=1

j=1 i=1

The term in the second pair of brackets is the result of an important conditional independence feature of our model. Conditionally on {θ1 , . . ., θm , µ, τ 2 ,
σ 2 }, the random variables Y1,j , . . . , Ynj ,j are independent with a distribution
that depends only on θj and σ 2 and not on µ or τ 2 . It is helpful to think about
this fact in terms of the diagram in Figure 8.3: The existence of a path from
(µ, τ 2 ) to each Y j indicates that while (µ, τ 2 ) provides information about Y j ,
it only does so indirectly through θj , which separates the two quantities in
the graph.
Full conditional distributions of µ and τ 2
As a function of µ and τ 2 , the term in Equation 8.3 is proportional to
p(µ)p(τ 2 )

m
Y
j=1

p(θj |µ, τ ),

134

8 Group comparisons and hierarchical modeling

and so the full conditional distributions of µ and τ 2 are also proportional to
this quantity. In particular, this must mean that
Y
p(µ|θ1 , . . . , θm , τ 2 , σ 2 , y 1 , . . . , y m ) ∝ p(µ)
p(θj |µ, τ 2 )
Y
p(τ 2 |θ1 , . . . , θm , µ, σ 2 , y 1 , . . . , y m ) ∝ p(τ 2 )
p(θj |µ, τ 2 ).
These distributions are exactly the full conditional distributions from the onesample normal problem in Chapter 6. In Chapter 6 we derived the full conditionals of the population mean and variance of a normal population, assuming
independent normal and inverse-gamma prior distributions. In our current situation, θ1 , . . . , θm are the i.i.d. samples from a normal population, and µ and
τ 2 are the unknown population mean and variance. In Chapter 6, we saw that
if y1 , . . . , yn were i.i.d. normal(θ, σ 2 ) and θ had a normal prior distribution,
then the conditional distribution of θ was also normal. Since our current situation is exactly analogous, the fact that θ1 , . . . , θm are i.i.d. normal(µ, τ 2 ) and
µ has a normal prior distribution implies that the conditional distribution of
µ must be normal as well. Similarly, just as σ 2 had an inverse-gamma conditional distribution in Chapter 6, τ 2 has an inverse-gamma distribution in
the current situation. Applying the results of Chapter 6 with the appropriate
symbolic replacements, we have
 ¯ 2

mθ/τ + µ0 /γ02
2
2
2 −1
{µ|θ1 , . . . , θm , τ } ∼ normal
, [m/τ + 1/γ0 ]
m/τ 2 + 1/γ02
P


η0 + m η0 τ02 + (θj − µ)2
{1/τ 2 |θ1 , . . . , θm , µ} ∼ gamma
,
.
2
2
Full conditional of θj
Collecting the terms in Equation 8.3 that depend on θj shows that the full
conditional distribution of θj must be proportional to
p(θj |µ, τ 2 , σ 2 , y 1 , . . . , y m ) ∝ p(θj |µ, τ 2 )

nj
Y

p(yi,j |θj , σ 2 ).

i=1

This says that, conditional on {µ, τ 2 , σ 2 , y j }, θj must be conditionally independent of the other θ’s as well as independent of the data from groups other
than j. Again, it is helpful to refer to Figure 8.3: While there is a path from
each θj to every other θk , the paths go through (µ, τ 2 ) or σ 2 . We can think
of this as meaning that the θ’s contribute no information about each other
beyond that contained in µ,τ 2 and σ 2 .
The terms in the above equation include a normal density for θj multiplied
by a product of normal densities where θj is the mean. Mathematically, this is
exactly the same setup as the one-sample normal model, in which p(θj |µ, τ 2 )
is the prior distribution instead of the sampling model for the θ’s. The full
conditional distribution is therefore

8.4 Example: Math scores in U.S. public schools

{θj |y1,j , . . . , ynj ,j , σ 2 } ∼ normal(

135

nj y¯j /σ 2 + 1/τ 2
, [nj /σ 2 + 1/τ 2 ]−1 ).
nj /σ 2 + 1/τ 2

Full conditional of σ 2
Using Figure 8.3 and the arguments in the previous two paragraphs, you
should convince yourself that σ 2 is conditionally independent of {µ, τ 2 } given
{y 1 , . . . , y m , θ1 , . . . , θm }. The derivation of the full conditional of σ 2 is similar
to that in the one-sample normal model, except now we have information
about σ 2 from m separate groups:
p(σ 2 |θ1 , . . . , θm , y 1 , . . . , y m ) ∝ p(σ 2 )

nj
m Y
Y

p(yi,j |θj , σ 2 )

j=1 i=1

∝ (σ 2 )−ν0 /2+1 e−

2
ν0 σ 0
2σ 2

PP

(σ 2 )−

P

nj /2 −

e

(yi,j −θj )2
2σ 2

.

Adding the powers of σ 2 and collecting the terms in the exponent, we recognize
this as proportional to an inverse-gamma density, giving
nj
m
m X
X
X
1
1
{1/σ 2 |θ, y 1 , . . . , y n } ∼ gamma( [ν0 +
nj ], [ν0 σ02 +
(yi,j − θj )2 ]).
2
2
j=1
j=1 i=1

PP
Note that
(yi,j − θj )2 is the sum of squared residuals across all groups,
conditional on the within-group means, and so the conditional distribution
concentrates probability around a pooled-sample estimate of the variance.

8.4 Example: Math scores in U.S. public schools
Let’s return to the 2002 ELS data described previously. This survey included
10th grade children from 100 different large urban public high schools, all
having a 10th grade enrollment of 400 or greater. Data from these schools are
shown in Figure 8.4, with scores from students within the same school plotted
along a common vertical bar.
A histogram of the sample averages is shown in the first panel of Figure 8.5.
The range of average scores is quite large, with the lowest average being 36.6
and the highest 65.0. The second panel of the figure shows the relationship
between the sample average and the sample size. This plot seems to indicate
that very extreme sample averages tend to be associated with schools with
small sample sizes. For example, the school with the highest sample average
has the lowest sample size, and many schools with low sample averages also
have low sample sizes. This relationship between sample averages and sample
size is fairly common in hierarchical datasets. To understand this phenomenon,
consider a situation in which all θj ’s were equal to some common value, say
θ0 , but the sample sizes were different. The expected value of each sample

136

8 Group comparisons and hierarchical modeling

●

80

●
●

●

●

●

●
●

●
●
●
●
●
●●
●
●●●● ●●
●
●
● ●
● ●
●
●●
●
●●
●
● ●●
●
●
●
●
●
● ●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●●
●
● ● ●
● ● ●
●
●
●
●● ●●
● ●●
●
● ●
● ●●● ● ●●
●
●●
●
●
●●
●
●
●
● ●●
●
●●
●●
●
●
●
●●●
● ●
● ● ●●
●●
● ●
●
●
●
●
●●●
● ●
●
●● ●
● ● ●●●●
●●
●
● ● ●●●
●●
●●●●
●
● ●
●
●● ●
●
●
●
●
● ●
●
●● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●●● ● ●●
●
●
●
●●
● ●
●●
●●●●
●
●
●
●
●
●
●●
● ● ●●●●●
●●●
●
● ● ●
●●●●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●● ●
●
●●
●●●
●●
● ●●
●
●●
●
●●● ● ●●
● ●●
●
●●●
●
●
●
● ●
● ●
● ●
●●
●
●
●●●
●
●●●
●
●
●●● ● ●
●
●
●
●
● ●
● ●●
●●●
●
●●●●
● ●●
● ●●
●
● ●●●●
●●
●
●●●
●●●●
●
●●
●
●● ●●
● ●
●● ●●
●●●
●●
●●●
●
●
●●● ●●●
●
●● ●●●● ●● ●●●
●●● ●●● ●
●●
●
●
●●
●●●●●●●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●●●
●
●●●●●●● ●
●●●
●● ●●
● ● ●● ●●●● ●
●
● ●
●
●●●●
●
●●
●
● ●
●●●
● ●●●●●●● ●
● ● ● ●●●
●●
●●●
● ●●
● ● ●
●●●
●●●
● ● ●● ● ●●●
●● ●●
●
●
●
●●●
●●
●● ●●
● ● ●
●
●●
●●●
●
●●
●●
●●
● ●●
●
●● ●●
● ●●
●●●●
●●●●●●
●●●
● ●
●
●
● ●●●
● ●●●●●●●●
●●
●●
●
●
●
●
●
●●
●
●
●
●●
●
●
●
●
●
● ●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
● ●●
●●●
●●
●●
● ●
●●●
●
●● ● ●
●●
●●●●●●● ●●●● ●
●●●
● ●●
●
●
●●●●●●●
●●
●
●●●●
●●
●
●
●
●●
●●●
●
●●●●●●● ●●●● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●●
● ● ●●●
●●
●●
●● ●●
● ●
● ●●●● ● ●
●
● ●
●
● ●●●●
● ●
●●●
●●
●
●●●●●
●●●
● ●●
●●●
● ●●●
●●
● ●●●● ● ●●●
● ●●●●●●● ●●
● ●
●●●●
● ●●●
●● ●
●●●
● ●●● ●
● ●
●
●●●●
●●
●
●
●
●
●● ●
●●●●
●●●●
●●●
●● ●
● ●
●●●●
●
●
●●
● ●
●
● ●●
●●
●
●
●●
●●●●
● ●●●
●●
● ● ●
●●
● ●
●● ●
● ● ●
● ●
●●
●
●
●
● ●
●
●●
●●●●●●●
●
●●●●
●●●
●● ●
●● ●
●●●
●
● ●
●●
● ●● ●
● ●
● ●
●
●●
●
●
●●
●●
●● ● ●
●● ●●●
● ●
●●●●
● ●● ●
●●●
● ●
●●
●●
●●●
●●●●
●
●●
●● ●●● ●
●
● ●
●
●●
●●● ●
● ●● ● ●
●●
●●
●
●● ●
● ●
●
● ●● ●
●●●
●
● ●
● ●
●
●
●●●●
●●
●
●●
●●
●●
●●●●
●●●
●
●
●●
●
●●
●● ●
● ●
● ●
● ●
●
●
● ●●●●●
●
● ●
●
●●
● ●●●●
●● ●●●
●
●
● ●● ●● ●
● ●●●●●
●
●● ●
●●
●
●●●●
●●● ●●●●
●●●
●
●● ●
●
●
●
●●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
● ●
●
●●
●●
●
● ●
●
●●●●●●●
●● ● ●● ●● ●
●●●●●
●●
●
●●
● ●●
● ●● ●
●●
●●●●●
●
●●●
● ●● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
● ●●●
● ●
●●
●
●
●●
●●●
●●
● ●
●
●
● ●
●
●●●
●●●
●● ●
● ●●
●
●● ●●
●
● ●● ● ●
● ●
●●
●●● ●●
●
●●
●●
●●
●●●●●●●
●
●●●
●
●●
●
●●●
●● ●● ●●
●●
●
● ●
● ●●
●●● ● ●●●
●
●●
●
●
●●● ●
● ●●
● ●● ● ● ●●
●●●
●●
● ●●
● ●
●●●●
●● ●●
●● ●● ●● ●●●●●
●
●●
● ●●
●●
●
●● ●
●
●
● ●●● ●
●●●
●●
● ●
●
●
●●
●
●
● ●
● ●
●
●●●
●●
● ●●
● ●
●
●● ●●
● ●
● ●
● ●
●●
●●
● ●
●
●
●●●●
●●
●
● ●● ●
●●
●
● ●●
●
●●
●●
●
●
●
●●●
●
●
●
●
●
● ●●
●
●
●●
●
● ●
●
●
●
●
●●
●●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●● ● ●
●
● ●
●
●
●
●
●
●
●
●
●● ●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

20

30

40

math score
50 60

70

●

0

20

40
60
80
rank of school−specific math score average

100

●

●

40

65

Fig. 8.4. A graphical representation of the ELS data.

60

●
●
●

●

●

0

40

10

sample mean
45
50
55

Frequency
20
30

●

35

40

45

50 55 60
sample mean

65

70

5

●

●

●

●
●

●
●
●●
●
●
●●● ●
●●
● ●
●
●●
● ●
●
●
● ● ●
●●●●
● ●
●
● ● ●
●●
●●●
●
●
●
●●
●
●
●
●●
● ●
●
●
●● ●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●

10

15
20
25
sample size

●
●●
●
●
● ●

30

Fig. 8.5. Empirical distribution of sample means, and the relationship between
sample mean and sample size.

average would then be E[Y¯j |θj , σ 2 ] = θj = θ0 , but the variances would depend
on the sample size, since Var[Y¯j |σj2 ] = σ 2 /nj . As a result, sample averages for
groups with large sample sizes would be very close to θ0 , whereas the sample
averages for groups with small sample sizes would be farther away, both less
than and greater than θ0 . For this reason, it is not uncommon that groups
with very high or very low sample averages are also those groups with low
sample sizes.

8.4 Example: Math scores in U.S. public schools

137

8.4.1 Prior distributions and posterior approximation
The prior parameters we need to specify are
(ν0 , σ02 ) for p(σ 2 ),
(η0 , τ02 ) for p(τ02 ) and
(µ0 , γ02 ) for p(µ).
As described above, the math exam was designed to give a nationwide variance
of 100. Since this variance includes both within-school and between-school
variance, the within-school variance should be at most 100, which we take as
σ02 . This is likely to be an overestimate, and so we only weakly concentrate the
prior distribution around this value by taking ν0 = 1. Similarly, the betweenschool variance should not be more than 100, and so we take τ02 = 100 and
η0 = 1. Finally, the nationwide mean over all schools is 50. Although the mean
for large urban public schools may be different than the nationwide average,
it should not differ by too much. We take µ0 = 50 and γ02 = 25, so that the
prior probability that µ is in the interval (40, 60) is about 95%.
Posterior approximation proceeds by iterative sampling of each unknown
quantity from its full conditional distribution. Given a current state of the
(s)
(s)
unknowns {θ1 , . . . , θm , µ(s) , τ 2(s) , σ 2(s) }, a new state is generated as follows:
1.
2.
3.
4.

(s)

(s)

sample µ(s+1) ∼ p(µ|θ1 , . . . , θm , τ 2(s) );
(s)
(s)
sample τ 2(s+1) ∼ p(τ 2 |θ1 , . . . , θm , µ(s+1) );
(s)
(s)
sample σ 2(s+1) ∼ p(σ 2 |θ1 , . . . , θm , y 1 , . . . , y m );
(s+1)
for each j ∈ {1, . . . , m}, sample θj
∼ p(θj |µ(s+1) , τ 2(s+1) , σ 2(s+1) , y j ).

The order in which the new parameters are generated does not matter. What
does matter is that each parameter is updated conditional upon the most
current value of the other parameters. This Gibbs sampling procedure can be
implemented in R with the code below:
data ( c h a p t e r 8 ) ; Y<−Y. s c h o o l . mathscore
### weakly i n f o r m a t i v e p r i o r s
nu0<−1 ; s20 <−100
eta0 <−1 ; t20 <−100
mu0<−50 ; g20<−25
###
### s t a r t i n g v a l u e s
m<−l e n g t h ( u n i q u e (Y [ , 1 ] ) )
n<−sv<−ybar<−r e p (NA,m)
f o r ( j i n 1 :m)
{
ybar [ j ]<−mean (Y[Y[ ,1]== j , 2 ] )
sv [ j ]<−var (Y[Y[ ,1]== j , 2 ] )
n [ j ]<−sum (Y[ ,1]== j )

138

8 Group comparisons and hierarchical modeling

}
t h e t a <−ybar ; sigma2<−mean ( sv )
mu<−mean ( t h e t a ) ; tau2<−var ( t h e t a )
###
### s e t u p MCMC
set . seed (1)
S<−5000
THETA<−ma t r i x ( nrow=S , n c o l=m)
SMT<−m at r i x ( nrow=S , n c o l =3)
###
### MCMC a l g o r i t h m
for ( s in 1: S)
{
# sample new v a l u e s o f t h e t h e t a s
f o r ( j i n 1 :m)
{
v t h e t a <−1/(n [ j ] / sigma2+1/tau2 )
e t h e t a <−v t h e t a ∗ ( ybar [ j ] ∗ n [ j ] / sigma2+mu/ tau2 )
t h e t a [ j ]<−rnorm ( 1 , e t h e t a , s q r t ( v t h e t a ) )
}
#sample new v a l u e o f sigma2
nun<−nu0+sum ( n )
s s <−nu0∗ s 2 0
f o r ( j i n 1 :m) { s s <−s s+sum ( (Y[Y[ ,1]== j ,2] − t h e t a [ j ] ) ˆ 2 ) }
sigma2 <−1/rgamma ( 1 , nun / 2 , s s / 2 )
#sample a new v a l u e o f mu
vmu<− 1 / (m/ tau2+1/g20 )
emu<− vmu∗ (m∗mean ( t h e t a ) / tau2 + mu0/ g20 )
mu<−rnorm ( 1 , emu , s q r t (vmu ) )
# sample a new v a l u e o f tau2
etam<−e t a 0+m
s s <− e t a 0 ∗ t 2 0 + sum ( ( t h e t a −mu) ˆ 2 )
tau2 <−1/rgamma ( 1 , etam / 2 , s s / 2 )
#s t o r e r e s u l t s
THETA[ s ,]<− t h e t a
SMT[ s ,]<− c ( sigma2 , mu, tau2 )
}
###

Running this algorithm produces an S × m matrix THETA, containing a value
of the within-school mean for each school at each iteration of the Markov

8.4 Example: Math scores in U.S. public schools

139

chain. Additionally, the S × 3 matrix SMT stores values of σ 2 , µ and τ 2 , representing approximate, correlated draws from the posterior distribution of these
parameters.
MCMC diagnostics

●
●
●

●

●

●
●

●

●
●
●

●
●
●
●

●
●
●

●
●

●
●
●

●
●

●

●
●
●
●

●

●
●
●
●

●
●

●
●

●
●
●

●

90

●

45

●
●
●

49

●

95

50

Before we make inference using these MCMC samples we should determine if
there might be any problems with the Gibbs sampler. The first thing we want
to do is to see if there are any indications that the chain is not stationary,
i.e. if the simulated parameter values are moving in a consistent direction.
One way to do this is with traceplots, or plots of the parameter values versus
iteration number. However, when the number of samples is large, such plots
can be difficult to read because of the high density of the plotted points (see,
for example, Figure 6.6). Standard practice is to plot only a subsequence of
MCMC samples, such as every 100th sample. Another approach is to produce boxplots of sequential groups of samples, as is done in Figure 8.6. The
first boxplot in the first plot, for example, represents the empirical distribution of {µ(1) , . . . , µ(500) }, the second boxplot represents the distribution of
{µ(501) , . . . , µ(1000) }, and so on. Each of the 10 boxplots represents 1/10th of
the MCMC samples. If stationarity has been achieved, then the distribution
of samples in any one boxplot should be the same as that in any other. If
we were to see that the medians or interquartile ranges of the boxplots were
moving in a consistent direction with iteration number, then we would suspect
that stationarity had not been achieved and we would have to run the chain
longer.

●

●
●
●
●

●
●
●

●
●
●
●
●

●
●
●
●
●
●
●

●
●
●
●
●
●
●
●
●

●
●
●
●
●
●
●
●

●
●
●

25
●
●
●
●
●

●
●
●
●

●

●
●

●

●
●

●
●

●

500

●

2000 3500
iteration

5000

●
●

500

●

●

●
●
●

●

●
●

15

●
●

80

●
●

●

75

47
●

46

●
●

●
●
●
●

τ2

σ2
85

µ
48

35

●
●
●
●

●
●
●
●
●
●

●
●
●

2000 3500
iteration

5000

●

500

2000 3500
iteration

5000

Fig. 8.6. Stationarity plots of the MCMC samples of µ, σ 2 and τ 2 .

There does not seem to be any evidence that the chain has not achieved
stationarity, so we move on to see how quickly the Gibbs sampler is moving
around the parameter space. Lag-1 autocorrelations for the sequences of µ,
σ 2 and τ 2 are 0.15, 0.053 and 0.312, and the effective sample sizes are 3706,
4499 and 2503, respectively. Approximate Monte Carlo standard errors can be
obtained by dividing the approximated posterior standard deviations by the

140

8 Group comparisons and hierarchical modeling

square root of the effective sample sizes, giving values of (0.009, 0.04, 0.09) for
µ, σ 2 and τ 2 respectively. These are quite small compared to the scale of the
approximated posterior expectations of these parameters, (48.12, 84.85, 24.84).
Diagnostics should also be performed for the θ-parameters: The effective sample sizes for the 100 sequences of θ-values ranged between 3,627 and 5,927,
with Monte Carlo standard errors ranging between 0.02 and 0.05.
8.4.2 Posterior summaries and shrinkage

46 47 48 49 50
µ

p( τ2|y 1...y m )
0.04
0.00

0.0

0.00

p(µ
µ|y 1...y m )
0.2
0.4
0.6

p( σ2|y 1...y m )
0.04 0.08 0.12

0.08

Figure 8.7 shows Monte Carlo approximations to the posterior densities of
{µ, σ 2 , τ 2 }. The posterior means of µ, σ and τ are 48.12, 9.21 and 4.97 respec-

75

80

85 90
σ2

95

10

20

30
τ2

40

50

Fig. 8.7. Marginal posterior distributions, with 2.5%, 50% and 97.5% quantiles
given by vertical lines.

tively, indicating that roughly 95% of the scores within a classroom are within
4×9.21 ≈ 37 points of each other, whereas 95% of the average classroom scores
are within 4 × 4.97 ≈ 20 points of each other.
One of the motivations behind hierarchical modeling is that information
can be shared across groups. Recall that, conditional on µ, τ 2 , σ 2 and the
data, the expected value of θj is a weighted average of y¯j and µ:
E[θj |y j , µ, τ, σ] =

y¯j nj /σ 2 + µ/τ 2
.
nj /σ 2 + 1/τ 2

As a result, the expected value of θj is pulled a bit from y¯j towards µ by
an amount depending on nj . This effect is called shrinkage. The first panel
of Figure 8.8 plots y¯j versus θˆj = E[θj |y 1 , . . . , y m ] for each group. Notice
that the relationship roughly follows a line with a slope that is less than
one, indicating that high values of y¯j correspond to slightly less high values
of θˆj , and low values of y¯j correspond to slightly less low values of θˆj . The
second panel of the plot shows the amount of shrinkage as a function of the
group-specific sample size. Groups with low sample sizes get shrunk the most,

8.4 Example: Math scores in U.S. public schools

141

60

●

●
●

6
4
y − θ^
2

●
●
●
●●

40

45

50
y

0

●

55

60

65

●
●
●
●
●
●
●
●
●
●●● ●●
● ●
●
● ●●●●
●● ●
●●
●●
●
●
●
●
● ● ●●●●●●
● ●
● ●
●●● ●
● ●
●● ●
●●
●
●
●●
●
●
●
●
●
●●
●
●
●
● ●
●
●

−2

●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●●●●
● ●●●
●
● ●●
●
●

●

●

−4

40

45

θ^
50

55

●
●
●
●●
●●●
●

8

whereas groups with large sample sizes hardly get shrunk at all. This makes
sense: The larger the sample size for a group, the more information we have
for that group and the less information we need to “borrow” from the rest of
the population.

●

5

●

10

15
20
25
sample size

30

Fig. 8.8. Shrinkage as a function of sample size.

Suppose our task is to rank the schools according to what we think their
performances would be if every student in each school took the math exam.
In this case, it makes sense to rank the schools according to the schoolspecific posterior expectations {E[θ1 |y 1 , . . . , y m ], . . . , E[θm |y 1 , . . . , y m ]}. Alternatively, we could ignore the results of the hierarchical model and just use
the school-specific sample averages {¯
y1 , . . . , y¯m }. The two methods will give
similar but not exactly the same rankings. Consider the posterior distributions
of θ46 and θ82 , as shown in Figure 8.9. Both of these schools have exceptionally
low sample means, in the bottom 10% of all schools. The first thing to note
is that the posterior density for school 46 is more peaked than that of school
82. This is because the sample size for school 46 is 21 students, whereas that
of school 82 is only 5 students. Therefore, our degree of certainty for θ46 is
much higher than that for θ82 .
The raw data for the two schools are shown in dotplots below the posterior
densities, with the large dots representing the sample means y¯46 and y¯82 . Note
that while the posterior expectation for school 82 is higher than that of 46
(42.53 compared to 41.31), the sample mean for school 82 is lower than that of
46 (38.76 compared to 40.18). Does this make sense? Suppose on the day of the
exam the student who got the lowest exam score in school 82 did not come to
class. Then the sample mean for school 82 would have been 41.99 as opposed to
38.76, a change of more than three points. In contrast, if the lowest performing
student in school 46 had not shown up, y¯46 would have been 40.9 as opposed

142

8 Group comparisons and hierarchical modeling

0.2

to 40.18, a change of only three quarters of a point. In other words, the low
value of the sample mean for school 82 can be explained by either θ82 being
very low, or just the possibility that a few of the five sampled students were
among the poorer performing students in the school. In contrast, for school 46
this latter possibility cannot explain the low value of the sample mean: Even
if a few of the sampled students were unrepresentative of their school-specific
average, it would not affect the sample mean as much because of the larger
sample size. For this reason, it makes sense to shrink the expectation of school
82 towards the population expectation E[µ|y 1 , . . . , y n ] = 48.11 by a greater
amount than for the expectation of school 46.

0.0

0.1

school 46
school 82
E[µ
µ|y 1...y m ]

● ●

●

● ●●

●

●

30

●● ●
●

●●

●●

● ● ● ●●

●

● ●
●

40

●

●

●

50

60

math score

Fig. 8.9. Data and posterior distributions for two schools.

To some people this reversal of rankings may seem strange or “unfair:”
The performance by the sampled students in school 46 was better on average
than those sampled in school 82, so why should they be ranked lower? While
“fairness” may be debated, the hierarchical model reflects the objective fact
that there is more evidence that θ46 is exceptionally low than there is evidence
that θ82 is exceptionally low. There are many other real-life situations where
differing amounts of evidence results in a switch of a ranking. For example,
on any given basketball team there are “bench” players who play very few
minutes during any given game. As such, many bench players have taken
only a few free throws in their entire career, and many have an observed free
throw shooting percentage of 100%. Under certain circumstances during a
basketball game (a “technical foul”) the coach has the opportunity to choose
from among any of his or her players to take a free throw and hopefully score
a point. In practice, coaches always choose an experienced veteran player with
a percentage of around 87% over a bench player who has made, for example
three of three free throws in his career. While it may seem “unfair,” it is the

8.5 Hierarchical modeling of means and variances

143

right decision to make: The coaches recognize that it is very unlikely that the
bench player’s true free throw shooting percentage is anywhere near 100%.

8.5 Hierarchical modeling of means and variances
If the population means vary across groups, shouldn’t we allow for the
possibility that the population variances also vary across groups? Letting
σj2 be the variance for group j, our sampling model would then become
Y1,j , . . . , Ynj ,j ∼ i.i.d. normal(θj , σj2 ), and our full conditional distribution for
each θj would be
!
nj y¯j /σj2 + 1/τ 2
2
2
2 −1
{θj |y1,j , . . . , ynj ,j , σj } ∼ normal
, [nj /σj + 1/τ ]
.
nj /σj2 + 1/τ 2
How does σj2 get estimated? If we were to specify that
2
σ12 , . . . , σm
∼ i.i.d. gamma(ν0 /2, ν0 σ02 /2),

(8.4)

then as is shown in Chapter 6 the full conditional distribution of σj2 is


X
{1/σj2 |y1,j , . . . , ynj ,j , θj } ∼ gamma [ν0 + nj ]/2, [ν0 σ02 +
(yi,j − θj )2 ]/2 ,
2
and estimation for σ12 , . . . , σm
can proceed by iteratively sampling their values
along with the other parameters in a Gibbs sampler.
If ν0 and σ02 are fixed in advance at some particular values, then the
distribution in (8.4) represents a prior distribution on variances such that, for
2
2
2
|σ12 , . . . , σm−1
) = p(σm
), and so the information we may have
example, p(σm
2
2
2
about σ1 , . . . , σm−1 is not used to help us estimate σm
. This seems inefficient:
2
If the sample size in group m were small and we saw that σ12 , . . . , σm−1
were
tightly concentrated around a particular value, then we would want to use this
2
fact to improve our estimation of σm
. In other words, we want to be able to
learn about the sampling distribution of the σj2 ’s and use this information to
improve our estimation for groups that may have low sample sizes. This can be
done by treating ν0 and σ02 as parameters to be estimated, in which case (8.4)
is properly thought of as a sampling model for across-group heterogeneity in
population variances, and not as a prior distribution. Putting this together
with our model for heterogeneity in population means gives a hierarchical
model for both means and variances, which is depicted graphically in Figure
8.10.
2
The unknown parameters to be estimated include {(θ1 , σ12 ), . . . , (θm , σm
)}
2
representing the within-group sampling distributions, {µ, τ } representing
across-group heterogeneity in means and {ν0 , σ02 } representing across-group
heterogeneity in variances. As before, the joint posterior distribution for all of

144

8 Group comparisons and hierarchical modeling
µ, τ 2
θ1

θ2

···

θm−1

Y1

Y2

···

Y m−1 Y m

σ12

σ22

···

2
σm−1

θm

2
σm

ν0 , σ02
Fig. 8.10. A graphical representation of the hierarchical normal model with heterogeneous means and variances.

these parameters can be approximated by iteratively sampling each parameter from its full conditional distribution given the others. The full conditional
distributions for µ and τ 2 are unchanged from the previous section and the
full conditional distributions of θj and σj2 are given above. What remains to
do is to specify the prior distributions for ν0 and σ02 and obtain their full
conditional distributions. A conjugate class of prior densities for σ02 are the
gamma densities: If p(σ02 ) ∼ gamma(a, b), then it is straightforward to show
that
m

1
1X
2
(1/σj2 )).
p(σ02 |σ12 , . . . , σm
, ν0 ) = dgamma(a + mν0 , b +
2
2 j=1
Notice that for small values of a and b the conditional mean of σ02 is approxi2
mately the harmonic mean of σ12 , . . . , σm
.
A simple conjugate prior for ν0 does not exist, but if we restrict ν0 to be
a whole number, then it is easy to sample from its full conditional distribution. For example, if we let the prior on ν0 be the geometric distribution on
{1, 2, . . .} so that p(ν0 ) ∝ e−αν0 , then the full conditional distribution of ν0 is
proportional to
2
p(ν0 |σ02 , σ12 , . . . , σm
)
2
2
∝ p(ν0 ) × p(σ1 , . . . , σm
|ν0 , σ02 )

ν0 /2−1

m Y
m
1
1 X
(ν0 σ02 /2)ν0 /2


× exp{−ν0 (α + σ02
(1/σj2 ))}.
∝
2
Γ (ν0 /2)
σ
2
j=1 j

While not pretty, this unnormalized probability distribution can be computed
for a large range of ν0 -values and then sampled from. For example, the R-code
to sample from this distribution is as follows:

8.5 Hierarchical modeling of means and variances

145

# NUMAX, a l p h a must be s p e c i f i e d ,
# sigma2 . s c h o o l s i s t h e v e c t o r o f c u r r e n t v a l u e s
# of the s choo l s p e c i f i c population v a r i a n c e s .
x<−1:NUMAX
lpnu0<− m∗ ( . 5 ∗ x∗ l o g ( s 2 0 ∗x/2)−lgamma ( x / 2 ) ) +
( x/2 −1)∗sum ( l o g ( 1 / sigma2 . s c h o o l s ) )
+
−x ∗ ( a l p h a + . 5 ∗ s 2 0 ∗sum ( 1 / sigma2 . s c h o o l s ) )
nu0<−sample ( x , 1 , prob=exp ( lpnu0−max( lpnu0 ) ) )

8.5.1 Analysis of math score data

0.0

0.00

p(µ
µ|y 1...y m )
0.4

p(ττ2|y 1...y m )
0.04
0.08

Let’s re-analyze the math score data with our hierarchical model for schoolspecific means and variances. We’ll take the parameters in our prior distributions to be the same as in the previous section, with α = 1 and
{a = 1, b = 100} for the prior distributions on ν0 and σ02 . After running a
Gibbs sampler for 5,000 iterations, the posterior distributions of {µ, τ 2 , ν0 , σ02 }
are approximated and plotted in Figure 8.11. Additionally, the posterior distributions of µ and τ 2 under the hierarchical model with constant group variance
is shown in gray lines for comparison.

47

48
µ

49

50

10

20

30
τ2

40

50

0

0.00

p(ν
ν0|y 1...y m )
200
500

p(σ
σ20|y 1...y m )
0.04 0.08

46

7

9 11

14

17
ν0

20

23

26

60

65

70

75

80
σ20

85

90

95

Fig. 8.11. Posterior distributions of between-group heterogeneity parameters.

The hierarchical model of Section 8.3, in which all within-group variances
are forced to be equal, is equivalent to a value of ν0 = ∞ in this hierarchical

146

8 Group comparisons and hierarchical modeling

140

●

20
50

100
s2

10

●
●
● ●
●●
●
● ●
●
●● ●
●
●
●
●
●
●●●
●● ●
●
●●●●
●●●●
●●● ●
●●
●● ●
● ●
●●
●
●●● ●
●
● ●
●
●
●
●
●
●
●
●●
●
● ●●
●
●
●●
●
●
●
●
● ●
●
●
●
●

●
●

●

●

150

●

●

^
s2 − σ 2
−10 0

●● ●
●
●
●
●●
●
●●
●●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●
●
●
●
●●
●
●
●
●●
●●
●
●
●
●
●●
●
●●
●
●
●
● ●
●●
●●●●
●● ●
● ●
●
● ● ●●
●

●

●
●

●

−30

120
80
60

●●
●

●

●
●
●

^
σ2
100

30

model. In contrast, a low value of ν0 = 1 would indicate that the variances are
quite unequal, and little information about variances should be shared across
groups. Our hierarchical analysis indicates that neither of these extremes is
appropriate, as the posterior distribution of ν0 is concentrated around a moderate value of 14 or 15. This estimated distribution of σ12 , . . . , σn2 is used to
shrink extreme sample variances towards an across-group center, as is shown
in Figure 8.12. The relationship between sample size and the amount of variance shrinkage is shown in the second panel of the plot. As with estimation for
the group means, the larger amounts of shrinkage generally occur for groups
with smaller sample sizes.

5

10

15
20
25
sample size

30

Fig. 8.12. Shrinkage as a function of sample size.

8.6 Discussion and further references
Lindley and Smith (1972) laid the foundation for Bayesian hierarchical modeling, although the idea of shrinking the estimates of the individual group
means towards an across-group mean goes back at least to Kelley (1927) in
the context of educational testing. In the statistical literature, the benefits
of this type of estimation are referred to as the “Stein effect” (Stein, 1956,
1981). Estimators of this type generally take the form θˆj = wj y¯j + (1 − wj )¯
y,
where y¯ is an average over all groups and the wj ’s depend on nj , σ 2 and
τ 2 . So-called empirical Bayes procedures obtain estimates of σ 2 and τ 2 from
the data, then plug these values into the formula for θˆj (Efron and Morris,
1973; Casella, 1985). Such procedures often yield estimates of the θj ’s that
are nearly equivalent to those from Bayesian procedures, but ignore uncer-

8.6 Discussion and further references

147

tainty in the values of σ 2 and τ 2 . For a detailed treatment of empirical Bayes
methods, see Carlin and Louis (1996).
Terminology for hierarchical models is inconsistent in the literature. For
the simple hierarchical model yi,j = θj +i,j , θj = µ+γj , the θj ’s (or γj ’s) may
be referred to as either “fixed effects” or “random effects,” usually depending
on how they are estimated. The distribution of the θj ’s is unfortunately often
referred to as a prior distribution, which mischaracterizes Bayesian inference
and renders the distinction between prior information and population distribution somewhat meaningless. For a discussion of some of this confusion, see
Gelman and Hill (2007, pp. 245-246).
Hierarchical modeling of variances is not common, perhaps due to the
mean parameters being of greater interest. However, erroneously assuming a
common within-group variance could lead to improper pooling of information,
or to the shrinkage of group-specific parameters by inappropriate amounts.

9
Linear regression

Linear regression modeling is an extremely powerful data analysis tool, useful
for a variety of inferential tasks such as prediction, parameter estimation and
data description. In this section we give a very brief introduction to the linear regression model and the corresponding Bayesian approach to estimation.
Additionally, we discuss the relationship between Bayesian and ordinary least
squares regression estimates.
One difficult aspect of regression modeling is deciding which explanatory
variables to include in a model. This variable selection problem has a natural
Bayesian solution: Any collection of models having different sets of regressors
can be compared via their Bayes factors. When the number of possible regressors is small, this allows us to assign a posterior probability to each regression
model. When the number of regressors is large, the space of models can be
explored with a Gibbs sampling algorithm.

9.1 The linear regression model
Regression modeling is concerned with describing how the sampling distribution of one random variable Y varies with another variable or set of variables
x = (x1 , . . . , xp ). Specifically, a regression model postulates a form for p(y|x),
the conditional distribution of Y given x. Estimation of p(y|x) is made using
data y1 , . . . , yn that are gathered under a variety of conditions x1 , . . . , xn .
Example: Oxygen uptake (from Kuehl (2000))
Twelve healthy men who did not exercise regularly were recruited to take part
in a study of the effects of two different exercise regimen on oxygen uptake. Six
of the twelve men were randomly assigned to a 12-week flat-terrain running
program, and the remaining six were assigned to a 12-week step aerobics
program. The maximum oxygen uptake of each subject was measured (in
liters per minute) while running on an inclined treadmill, both before and
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 9,
c Springer Science+Business Media, LLC 2009


150

9 Linear regression

after the 12-week program. Of interest is how a subject’s change in maximal
oxygen uptake may depend on which program they were assigned to. However,
other factors, such as age, are expected to affect the change in maximal uptake
as well.

change in maximal oxygen uptake
−10 −5
0
5
10
15

●

●

●
●
●
●
●
●

●

●

●

●

aerobic
running

●
●

20

22

24

26

28

30

age

Fig. 9.1. Change in maximal oxygen uptake as a function of age and exercise
program.

How might we estimate the conditional distribution of oxygen uptake for
a given exercise program and age? One possibility would be to estimate a
population mean and variance for each age and program combination. For
example, we could estimate a mean and variance from the 22-year-olds in
the study who were assigned the running program, and a separate mean and
variance for the 22-year-olds assigned to the aerobics program. The data from
this study, shown in Figure 9.1, indicate that such an approach is problematic.
For example, there is only one 22-year-old assigned to the aerobics program,
which is not enough data to provide information about a population variance.
Furthermore, there are many age/program combinations for which there are
no data.
One solution to this problem is to assume that the conditional distribution
p(y|x) changes smoothly as a function of x, so that data we have at one value
of x can inform us about what might be going on at a different value. A linear
regression model is a particular type of smoothly changing model for p(y|x)
that specifies that the conditional expectation E[Y |x] has a form that is linear
in a set of parameters:
Z
yp(y|x) dy = E[Y |x] = β1 x1 + · · · + βp xp = β T x .

9.1 The linear regression model

151

It is important to note that such a model allows a great deal of freedom for
x1 , . . . , xp . For example, in the oxygen uptake example we could let x1 = age
and x2 = age2 if we thought there might be a quadratic relationship between
maximal uptake and age. However, Figure 9.1 does not indicate any quadratic
relationships, and so a reasonable model for p(y|x) could include two different
linear relationships between age and uptake, one for each group:
Yi
xi,1
xi,2
xi,3
xi,4

= β1 xi,1 + β2 xi,2 + β3 xi,3 + β4 xi,4 + i , where
= 1 for each subject i
= 0 if subject i is on the running program, 1 if on aerobic
= age of subject i
= xi,2 × xi,3

(9.1)

Under this model the conditional expectations of Y for the two different levels
of xi,1 are
E[Y |x] = β1 + β3 × age if x1 = 0, and
E[Y |x] = (β1 + β2 ) + (β3 + β4 ) × age if x1 = 1.
In other words, the model assumes that the relationship is linear in age for
both exercise groups, with the difference in intercepts given by β2 and the
difference in slopes given by β4 . If we assumed that β2 = β4 = 0, then we
would have an identical line for both groups. If we assumed β4 = 0 then
we would have a different line for each group but they would be parallel.
Allowing all coefficients to be non-zero gives us two unrelated lines. Some
different possibilities are depicted graphically in Figure 9.2.
We still have not specified anything about p(y|x) beyond E[Y |x]. The normal linear regression model specifies that, in addition to E[Y |x] being linear,
the sampling variability around the mean is i.i.d. from a normal distribution:
1 , . . . , n ∼ i.i.d. normal(0, σ 2 )
Yi = β T xi + i .
This model provides a complete specification of the joint probability density
of observed data y1 , . . . , yn conditional upon x1 , . . . , xn and values of β and
σ2 :
p(y1 , . . . , yn |x1 , . . . xn , β, σ 2 )
n
Y
=
p(yi |xi , β, σ 2 )

(9.2)

i=1

= (2πσ 2 )−n/2 exp{−

n
1 X
(yi − β T xi )2 }.
2σ 2 i=1

(9.3)

Another way to write this joint probability density is in terms of the multivariate normal distribution: Let y be the n-dimensional column vector

152

9 Linear regression

change in maximal oxygen uptake
−10 −5
0
5
10
15

β3 = 0 β4 = 0

β2 = 0 β4 = 0
●

●

●

●

●

●

●

●

●
●

●

●

●
●

●

●

●

●

●

●

●

●
●

●

change in maximal oxygen uptake
−10 −5
0
5
10
15

β4 = 0
●

●

●

●

●

●

●

●

●
●

●

●
●

●

●

●

●

●

●

●

●
●

20

●

22

●

24

26
age

28

30

20

22

24

26
age

28

30

Fig. 9.2. Least squares regression lines for the oxygen uptake data, under four
different models.

(y1 , . . . , yn )T , and let X be the n × p matrix whose ith row is xi . Then the
normal regression model is that
{y|X, β, σ 2 } ∼ multivariate normal (Xβ, σ 2 I),
where I is the p × p identity matrix and



 
x1 →   
β1 x1,1 + · · · + βp x1,p
E[Y1 |β, x1 ]
 x2 →  β1

  
 

..
..
Xβ =  .   ...  = 
=
.
.
.
 .. 
βp
β1 xn,1 + · · · + βp xn,p
E[Yn |β, xn ]
xn →
The density (9.3) depends on β through the residuals (yi − β T xi ). Given
the observed data, the term P
in the exponent is maximized when the sum of
n
squared residuals, SSR(β) = i=1 (yi −β T xi )2 is minimized. To find the value

9.1 The linear regression model

153

of β at which this minimum occurs it is helpful to rewrite SSR(β) in matrix
notation:
SSR(β) =

n
X

(yi − β T xi )2 = (y − Xβ)T (y − Xβ)

i=1

= y T y − 2β T XT y + β T XT Xβ .
Recall from calculus that
d
1. a minimum of a function g(z) occurs at a value z such that dz
g(z) = 0;
2. the derivative of g(z) = az is a and the derivative of g(z) = bz 2 is 2bz.

These facts translate over to the multivariate case, and can be used to obtain
the minimizer of SSR(β):

d
d  T
SSR(β) =
y y − 2β T XT y + β T XT Xβ
dβ
dβ
= −2XT y + 2XT Xβ , therefore
d
SSR(β) = 0 ⇔ −2XT y + 2XT Xβ = 0
dβ
⇔ XT Xβ = XT y
⇔ β = (XT X)−1 XT y .
ˆ = (XT X)−1 XT y is called the “ordinary least squares” (OLS)
The value β
ols
estimate of β, as it provides the value of β that minimizes the sum of squared
residuals. This value is unique as long as the inverse (XT X)−1 exists. The
ˆ also plays a role in Bayesian estimation, as we shall see in the next
value β
ols
section.
9.1.1 Least squares estimation for the oxygen uptake data
Let’s find the least squares regression estimates for the model in Equation 9.1,
and use the results to evaluate differences between the two exercise groups.
The ages of the 12 subjects, along with their observed changes in maximal
oxygen uptake, are
x3 = (23, 22, 22, 25, 27, 20, 31, 23, 27, 28, 22, 24)
y = (−0.87, −10.74, −3.27, −1.97, 7.50, −7.25, 17.05, 4.96, 10.40,
11.05, 0.26, 2.51) ,
with the first six elements of each vector corresponding to the subjects in
the running group and the latter six corresponding to subjects in the aerobics
group. After constructing the 12 × 4 matrix X out of the vectors x1 , x2 , x3 , x4
defined as in (9.1), the matrices XT X and XT y can be computed:

154

9 Linear regression



12

6
XT X = 
 294
155

6
6
155
155

294
155
7314
4063




155
29.63


155 
 XT y =  46.23  .
 978.81 
4063 
4063
1298.79

Inverting the XT X matrix and multiplying the result by XT y give the vector
ˆ = (−51.29, 13.11, 2.09, −.32)T . This means that the estimated linear relaβ
ols
tionship between uptake and age has an intercept and slope of -51.29 and 2.09
for the running group, and −51.29 + 13.11 = −38.18 and 2.09 − 0.32 = 1.77
for the aerobics group. These two lines are plotted in the fourth panel of Figˆ )/(n − p),
ure 9.2. An unbiased estimate of σ 2 can be obtained from SSR(β
ols
2
which for these data gives σ
ˆols = 8.54. The sampling variance of the vector
ˆ can be shown to be equal to (XT X)−1 σ 2 . We do not know the true value
β
ols
2
of σ 2 , but the value of σ
ˆols
can be plugged in to give standard errors for the
ˆols . These are 12.25, 15.76, 0.53 and 0.65 for the four regrescomponents of β
ˆols to their standard errors
sion coefficients in order. Comparing the values of β
suggests that the evidence for differences between the two exercise regimen is
not very strong. We will explore this further in the next few sections.

9.2 Bayesian estimation for a regression model
We begin with a simple semiconjugate prior distribution for β and σ 2 to be
used when there is information available about the parameters. In situations
where prior information is unavailable or difficult to quantify, an alternative
“default” class of prior distributions is given.
9.2.1 A semiconjugate prior distribution
The sampling density of the data (Equation 9.3), as a function of β, is
1
SSR(β)}
2σ 2
1
= exp{− 2 [y T y − 2β T XT y + β T XT Xβ]}.
2σ

p(y|X, β, σ 2 ) ∝ exp{−

The role that β plays in the exponent looks very similar to that played by
y, and the distribution of y is multivariate normal. This suggests that a
multivariate normal prior distribution for β is conjugate. Let’s see if this is
correct: If β ∼ multivariate normal(β 0 , Σ0 ), then
p(β|y, X, σ 2 )
∝ p(y|X, β, σ 2 ) × p(β)
1
1
∝ exp{− (−2β T XT y/σ 2 + β T XT Xβ/σ 2 ) − (−2β T Σ0−1 β 0 + β T Σ0−1 β)}
2
2
1 T −1
T
T
−1
2
= exp{β (Σ0 β 0 + X y/σ ) − β (Σ0 + XT X/σ 2 )β}.
2

9.2 Bayesian estimation for a regression model

155

Referring back to Chapter 7, we recognize this as being proportional to a
multivariate normal density, with
Var[β|y, X, σ 2 ] = (Σ0−1 + XT X/σ 2 )−1
E[β|y, X, σ 2 ] = (Σ0−1 + XT X/σ 2 )−1 (Σ0−1 β 0 + XT y/σ 2 ).

(9.4)
(9.5)

As usual, we can gain some understanding of these formulae by considering
some limiting cases. If the elements of the prior precision matrix Σ0−1 are small
in magnitude, then the conditional expectation E[β|y, X, σ 2 ] is approximately
equal to (XT X)−1 XT y, the least squares estimate. On the other hand, if the
measurement precision is very small (σ 2 is very large), then the expectation
is approximately β 0 , the prior expectation.
As in most normal sampling problems, the semiconjugate prior distribution
for σ 2 is an inverse-gamma distribution. Letting γ = 1/σ 2 be the measurement
precision, if γ ∼ gamma(ν0 /2, ν0 σ02 /2), then
p(γ|y, X, β) ∝ p(γ)p(y|X, β, γ)
h
i h
i
∝ γ ν0 /2−1 exp(−γ × ν0 σ02 /2) × γ n/2 exp(−γ × SSR(β)/2)
= γ (ν0 +n)/2−1 exp(−γ[ν0 σ02 + SSR(β)]/2),
which we recognize as a gamma density, so that
{σ 2 |y, X, β} ∼ inverse-gamma([ν0 + n]/2, [ν0 σ02 + SSR(β)]/2).
Constructing a Gibbs sampler to approximate the joint posterior distribution
p(β, σ 2 |y, X) is then straightforward: Given current values {β (s) , σ 2(s) }, new
values can be generated by
1. updating β:
a) compute V = Var[β|y, X, σ 2(s) ] and m = E[β|y, X, σ 2(s) ]
b) sample β (s+1) ∼ multivariate normal(m, V)
2. updating σ 2 :
a) compute SSR(β (s+1) )
b) sample σ 2(s+1) ∼ inverse-gamma([ν0 + n]/2, [ν0 σ02 + SSR(β (s+1) )]/2).
9.2.2 Default and weakly informative prior distributions
A Bayesian analysis of a regression model requires specification of the prior
parameters (β 0 , Σ0 ) and (ν0 , σ02 ). Finding values of these parameters that
represent actual prior information can be difficult. In the oxygen uptake experiment, for example, a quick scan of a few articles on exercise physiology
indicates that males in their 20s have an oxygen uptake of around 150 liters
per minute with a standard deviation of 15. If we take 150±2×15 = (120, 180)
as a prior expected range of the oxygen uptake distribution, then the changes
in oxygen uptake should lie within (-60,60) with high probability. Considering

156

9 Linear regression

our subjects in the running group, this means that the line β1 + β3 x should
produce values between -60 and 60 for all values of x between 20 and 30. A
little algebra then shows that we need a prior distribution on (β1 , β3 ) such
that −300 < β1 < 300 and −12 < β3 < 12 with high probability. This could
be done by taking Σ0,1,1 = 1502 and Σ0,2,2 = 62 , for example. However, we
would still need to specify the prior variances of the other parameters, as well
as the six prior correlations between the parameters. The task of constructing
an informative prior distribution only gets harder as the number
of regressors

increases, as the number of prior correlation parameters is p2 , which increases
quadratically in p.
Sometimes an analysis must be done in the absence of precise prior information, or information that is easily converted into the parameters of a conjugate prior distribution. In these situations one could stick to least squares
estimation, with the drawback that probability statements about β would be
unavailable. Alternatively, it is sometimes possible to justify a prior distribution with other criteria. One idea is that, if the prior distribution is not
going to represent real prior information about the parameters, then it should
be as minimally informative as possible. The resulting posterior distribution
would then represent the posterior information of someone who began with
little knowledge of the population being studied. To some, such an analysis
would give a “more objective” result than using an informative prior distribution, especially one that did not actually represent real prior information.
One type of weakly informative prior is the unit information prior (Kass and
Wasserman, 1995). A unit information prior is one that contains the same
amount of information as that would be contained in only a single observaˆ is its inverse variance, or (XT X)/σ 2 .
tion. For example, the precision of β
ols
Since this can be viewed as the amount of information in n observations, the
amount of information in one observation should be “one nth” as much, i.e.
(XT X)/(nσ 2 ). The unit information prior thus sets Σ0−1 = (XT X)/(nσ 2 ).
ˆ , thus centering
Kass and Wasserman (1995) further suggest setting β 0 = β
ols
the prior distribution of β around the OLS estimate. Such a distribution cannot be strictly considered a real prior distribution, as it requires knowledge of
y to be constructed. However, it only uses a small amount of the information
in y, and can be loosely thought of as the prior distribution of a person with
unbiased but weak prior information. In a similar way, the prior distribution
2
2
of σ 2 can be weakly centered around σ
ˆols
by taking ν0 = 1 and σ02 = σ
ˆols
.
Another principle for constructing a prior distribution for β is based on
the idea that the parameter estimation should be invariant to changes in the
scale of the regressors. For example, suppose someone were to analyze the
oxygen uptake data using x
˜i,3 = age in months, instead of xi,3 = age in years.
It makes sense that our posterior distribution for 12 × β˜3 in the model with
x
˜i,3 should be the same as the posterior distribution for β3 based on the model
with xi,3 . This condition requires, for example, that the posterior expected
change in y for a year change in age is the same, whether age is recorded in

9.2 Bayesian estimation for a regression model

157

terms of months or years. More generally, suppose X is a given set of regressors
˜ = XH for some p × p matrix H. If we obtain the posterior distribution
and X
˜ from y and X,
˜ then,
of β from y and X, and the posterior distribution of β
according to this principle of invariance, the posterior distributions of β and
˜ should be the same. Some linear algebra shows that this condition will
Hβ
be met if β 0 = 0 and Σ0 = k(XT X)−1 for any positive value k. A popular
specification of k is to relate it to the error variance σ 2 , so that k = gσ 2 for
some positive value g. These choices of prior parameters result in a version
of the so-called “g-prior” (Zellner, 1986), a widely studied and used prior
distribution for regression parameters (Zellner’s original g-prior allowed β 0 to
be non-zero). Under this invariant g-prior the conditional distribution of β
given (y, X, σ 2 ) is still multivariate normal, but Equations 9.4 and 9.5 reduce
to the following simpler forms:
Var[β|y, X, σ 2 ] = [XT X/(gσ 2 ) + XT X/σ 2 ]−1
g
=
σ 2 (XT X)−1
g+1
E[β|y, X, σ 2 ] = [XT X/(gσ 2 ) + XT X/σ 2 ]−1 XT y/σ 2
g
=
(XT X)−1 XT y .
g+1

(9.6)

(9.7)

Parameter estimation under the g-prior is simplified as well: It turns out that,
under this prior distribution, p(σ 2 |y, X) is an inverse-gamma distribution,
which means that we can directly sample (σ 2 , β) from their posterior distribution by first sampling from p(σ 2 |y, X) and then from p(β|σ 2 , y, X).
Derivation of p(σ 2 |y, X)
The marginal posterior density of σ 2 is proportional to p(σ 2 ) × p(y|X, σ 2 ).
Using the rules of marginal probability, the latter term in this product can be
expressed as the following integral:
Z
p(y|X, σ 2 ) = p(y|X, β, σ 2 )p(β|X, σ 2 ) dβ .
Writing out the two densities inside the integral, we have
1
(y − Xβ)T (y − Xβ)] ×
2σ 2
1
|2πgσ 2 (XT X)−1 |−1 exp[−
β T XT Xβ].
2gσ 2

p(y|X, β, σ 2 )p(β|X, σ 2 ) = (2πσ 2 )−n/2 exp[−

Combining the terms in the exponents gives
i
1 h
− 2 (y − Xβ)T (y − Xβ) + β T XT Xβ/g
2σ
i
1 h
= − 2 y T y − 2y T Xβ + β T XT Xβ(1 + 1/g)
2σ
1
1
1
= − 2 y T y − (β − m)T V−1 (β − m) + mT V−1 m ,
2σ
2
2

158

9 Linear regression

where
V=

g
g
σ 2 (XT X)−1 and m =
(XT X)−1 XT y.
g+1
g+1

This means that we can write p(y|β, X)p(β|X, z, σ 2 ) as

 

1 T
1 T −1
2 −n/2
−p/2
(2πσ )
exp(− 2 y y) × (1 + g)
exp( m V m) ×
2σ
2


1
−1/2
T −1
|2πV|
exp[− (β − m) V (β − m)] .
2
The third term in the product is the only term that depends on β. This term is
exactly the multivariate normal density with mean m and variance V, which
as a probability density must integrate to 1. This means that if we integrate
the whole thing with respect to β we are left with only the first two terms:
Z
2
p(y|X, σ ) = p(y|β, X)p(β|X, σ 2 ) dβ

 

1
1
= (2πσ 2 )−n/2 exp(− 2 y T y) × (1 + g)−p/2 exp( mT V−1 m) ,
2σ
2
which, after combining the terms in the exponents, is
p(y|X, σ 2 ) = (2π)−n/2 (1 + g)−p/2 (σ 2 )−n/2 exp(−

1
SSRg ),
2σ 2

where SSRg is defined as
SSRg = y T y − mT V−1 m = y T (I −

g
X(XT X)−1 XT )y.
g+1

P
ˆ xi )2 as g → ∞. The effect
The term SSRg decreases to SSRols = (yi − β
ols
of g is that it shrinks down the magnitude of the regression coefficients and
can prevent overfitting of the data.
The last step in identifying p(σ 2 |y, X) is to multiply p(y|X, σ 2 ) by the
prior distribution. Letting γ = 1/σ 2 ∼ gamma(ν0 /2, ν0 σ02 /2), we have
p(γ|y, X) ∝ p(γ)p(y|X, γ)
h
i h
i
∝ γ ν0 /2−1 exp(−γ × ν0 σ02 /2) × γ n/2 exp(−γ × SSRg /2)
= γ (ν0 +n)/2−1 exp[−γ × (ν0 σ02 + SSRg )/2]
∝ dgamma(γ, [ν0 + n]/2, [ν0 σ02 + SSRg ]/2) ,
and so {σ 2 |y, X} ∼ inverse-gamma([ν0 + n]/2, [ν0 σ02 + SSRg ]/2). These calculations, along with Equations 9.6 and 9.7, show that under this prior distribution, p(σ 2 |y, X) and p(β|y, X, σ 2 ) are inverse-gamma and multivariate
normal distributions respectively. Since we can sample from both of these distributions, samples from the joint posterior distribution p(σ 2 , β|y, X) can be
made with Monte Carlo approximation, and Gibbs sampling is unnecessary.
A sample value of (σ 2 , β) from p(σ 2 , β|y, X) can be made as follows:

9.2 Bayesian estimation for a regression model

159

1. sample 1/σ 2 ∼ gamma([ν0 + n]/2, [ν0 σ02 + SSRg ]/2);
g ˆ
g
2. sample β ∼ multivariate normal( g+1
β ols , g+1
σ 2 [XT X]−1 ).
R-code to generate multiple independent Monte Carlo samples from the posterior distribution is below:
data ( c h a p t e r 9 ) ; y<−yX . o2uptake [ , 1 ] ; X<−yX . o2uptake [ , − 1 ]
g<−l e n g t h ( y ) ; nu0<−1 ; s20 <−8.54
S<−1000
## data : y , X
## p r i o r p a r a m e t e r s : g , nu0 , s 2 0
## number o f i n d e p e n d e n t s a m p l e s t o g e n e r a t e : S
n<−dim (X ) [ 1 ] ; p<−dim (X ) [ 2 ]
Hg<− ( g / ( g +1)) ∗ X%∗%s o l v e ( t (X)%∗%X)%∗%t (X)
SSRg<− t ( y)%∗%( d i a g ( 1 , nrow=n ) − Hg ) %∗%y
s2 <−1/rgamma ( S , ( nu0+n ) / 2 , ( nu0 ∗ s 2 0+SSRg ) / 2 )
Vb<− g ∗ s o l v e ( t (X)%∗%X) / ( g+1)
Eb<− Vb%∗%t (X)%∗%y
E<−m at r i x ( rnorm ( S∗p , 0 , s q r t ( s 2 ) ) , S , p )
beta<−t ( t (E%∗%c h o l (Vb ) ) +c (Eb ) )

Bayesian analysis of the oxygen uptake data
We will use the invariant g-prior with g = n = 12, ν0 = 1 and σ02 =
2
σ
ˆols
= 8.54. The posterior mean of β can be obtained directly from Equation 9.7: Since E[β|y, X, σ 2 ] does not depend on σ 2 , we have E[β|y, X] =
g ˆ
E[β|y, X, σ 2 ] = g+1
β ols , so the posterior means of the four regression parameters are 12 × (−51.29, 13.11, 2.09, −0.32)/13 = (−47.35, 12.10, 1.93, −0.29).
Posterior standard deviations of these parameters are (14.41, 18.62, 0.62,
0.77), based on 1,000 independent Monte Carlo samples generated using the
R-code above. The marginal and joint posterior distributions for (β2 , β4 ) are
given in Figure 9.3, along with the (marginal) prior distributions for comparison. The posterior distributions seem to suggest only weak evidence of
a difference between the two groups, as the 95% quantile-based posterior intervals for β2 and β4 both contain zero. However, these parameters taken by
themselves do not quite tell the whole story. According to the model, the average difference in y between two people of the same age x but in different
exercise programs is β2 + β4 x. Thus the posterior distribution for the effect of
the aerobics program over the running program is obtained via the posterior
distribution of β2 + β4 x for each age x. Boxplots of these posterior distributions are shown in Figure 9.4, which indicates reasonably strong evidence of
a difference at young ages, and less evidence at the older ones.

9 Linear regression

−50

0
β2

50

2
1
β4
0
−1
−2

0.000

0.010

0.0 0.1 0.2 0.3 0.4 0.5

0.020

160

100

−2

0
β4

2

−60

−20

β2

20

60

−10

−5

β2 + β4age
0
5

10

15

Fig. 9.3. Posterior distributions for β2 and β4 , with marginal prior distributions in
the first two plots for comparison.

20

22

24

26

28

30

age

Fig. 9.4. Ninety-five percent confidence intervals for the difference in expected
change scores between aerobics subjects and running subjects.

9.3 Model selection
Often in regression analysis we are faced with a large number of possible regressor variables, even though we suspect that a majority of the regressors
have no true relationship to the variable Y . In these situations, including all
of the possible variables in a regression model can lead to poor statistical
performance. Standard statistical advice is that we should include in our regression model only those variables for which there is substantial evidence
of an association with y. Doing so not only produces simpler, more aesthetically pleasing data analyses, but also generally provides models with better
statistical properties in terms of prediction and estimation.

9.3 Model selection

161

Example: Diabetes
Baseline data for ten variables x1 , . . . , x10 on a group of 442 diabetes patients
were gathered, as well as a measure y of disease progression taken one year after the baseline measurements. From these data we hope to make a predictive
model for y based on the baseline measurements. While a regression model
with ten variables would not be overwhelmingly complex, it is suspected that
the relationship between y and the xj ’s may not be linear, and that including second-order terms like x2j and xj xk in the regression model might aid
in prediction. The regressors therefore include ten main effects x1 , . . . , x10 ,
10
= 45 interactions of the form xj xk and nine quadratic terms x2j (one
2
of the regressors, x2 = sex, is binary, so x2 = x22 , making it unnecessary to
include x22 ). This gives a total of p = 64 regressors. To help with the interpretation of the parameters and to put the regressors on a common scale, all
of the variables have been centered and scaled so that y and the columns of
X all have mean zero and variance one.
In this section we will build predictive regression models for y based on
the 64 regressor variables. To evaluate the models, we will randomly divide
the 442 diabetes subjects into 342 training samples and 100 test samples,
providing us with a training dataset (y, X) and a test dataset (y test , Xtest ).
We will fit the regression model using the training data and then use the
ˆ The performance
ˆ test = Xtest β.
estimated regression coefficients to generate y
ˆ test . Let’s
of the predictive model can then be evaluated by comparing y test to y
begin by building a predictive model with ordinary least squares regression
with all 64 variables. The first panel of Figure 9.5 plots the true values of the
ˆ where β
ˆ
ˆ test = Xtest β,
100 test samples y test versus their predicted values y
was estimated using the 342 training samples. While there is clearly a positive
relationship between the true values and the predictions,
there is quite a bit of
P
1
error: The average squared predictive error is 100
(ytest,i − yˆtest,i )2 = 0.67,
whereas if wePjust predicted each test case to be zero, our predictive error
1
2
would be 100
ytest,i
= 0.97.

2

2

5

●

●

●
●
●
● ●
● ●
● ●
●
●
●
●
●
● ●● ●
●
●
●●
●●
●
●
●
●● ●
●
● ●●
● ●●
● ●
● ●●
●
●
● ●●●
● ●
● ● ●
●●●
●
●
● ●
●● ●●●●
●
●
● ●
●
●●●
●
●
● ●● ●● ●
●
● ●
●●● ●● ● ●
●
●
●●
●

−0.5

0.5
y test

1.5

1
y^test
0

^
βols
0

−1

−5

y^test
1
0
−1

−1.5

● ●
●
●
●
●
●
●
● ● ●
●
●
● ●●
●● ● ●
●
●
●
●
● ●●
●
● ●
●●
● ●
●
●●● ●
●
●●
● ●● ● ●●
●
●
●
● ●
●
●
●
●●●●●
● ●●●
●
●
●
●●● ● ● ●
●●
●
●●●
●
●
●
●
●
● ●●● ●
●
●
●
●
●
● ●
●
●

●

0 10

30
50
regressor index

−1.5

−0.5

0.5
y test

1.5

Fig. 9.5. Predicted values and regression coefficients for the diabetes data.

162

9 Linear regression

The second panel of Figure 9.5 shows the estimated values of each of the 64
regression coefficients. Of note is that the majority of coefficients are estimated
to be quite small. Perhaps our predictions could be improved by removing from
the regression model those variables that show little evidence of being nonzero. By doing so, we hope to remove from the predictive model any regressors
that have spurious associations to Y (i.e. those associations specific only to
the training data), leaving only those regressors that would have associations
for any group of subjects (i.e. both the training and test data). One standard
way to assess the evidence that the true value of a regression coefficient βj is
not zero is with a t-statistic, which is obtained by dividing the OLS estimate
1/2
βˆj by its standard error, so tj = βˆj /[ˆ
σ 2 (XT X)−1
. We might then consider
j,j ]
removing from the model those regressor variables with small absolute values
of tj . For example, consider the following procedure:
ˆ = (XT X)−1 XT y and its t-statistics.
1. Obtain the estimator β
ols
2. If there are any regressors j such that |tj | < tcutoff ,
a) find the regressor jmin having the smallest value of |tj | and remove
column jmin from X.
b) return to step 1.
3. If |tj | > tcutoff for all variables j remaining in the model, then stop.
Such procedures, in which a potentially large set of regressors is reduced to
a smaller set, are called model selection procedures. The procedure defined in
steps 1, 2 and 3 above describes a type of backwards elimination procedure,
in which all regressors are initially included but then are iteratively removed
until the remaining regressors satisfy some criterion. A standard choice for
tcutoff is an upper quantile of a t or standard normal distribution. If we apply
the above procedure to the diabetes data with tcutoff = 1.65 (corresponding
roughly to a p-value of 0.10), then 44 of the 64 variables are eliminated,
leaving 20 variables in the regression model. The third plot of Figure 9.5
shows y test versus predicted values based on the reduced-model regression
coefficients. The plot indicates that the predicted values from this model are
more accurate than those
and indeed the average squared
P from the full model,
1
predictive error is 100
(ytest,i − yˆtest,i )2 = 0.53.
Backwards selection is not without its drawbacks, however. What sort of
model would this procedure produce if there were no association between Y
and any of the regressors? We can evaluate this by creating a new data vector
˜ by randomly permuting the values of y. Since in this case the value of xi has
y
˜ and the columns of X is zero.
no effect on y˜i , the “true” association between y
However, the OLS regression model will still pick up spurious associations:
The first panel of Figure 9.6 shows the t-statistics for one randomly generated
˜ of y. Initially, only one regressor has a t-statistic greater than
permutation y
1.65, but as we sequentially remove the columns of X the estimated variance of
the remaining regressors decreases and their t-statistics increase in value. With
tcutoff = 1.65, the procedure arrives at a regression model with 18 regressors,
17 of which have t-statistics greater than 2 in absolute value, and four of which

9.3 Model selection

163

4
t−statistic
0
2
−2
−4

−4

−2

t−statistic
0
2

4

˜ was generated without regard to
have statistics greater than 3. Even though y
X, the backwards selection procedure erroneously suggests that many of the
regressors do have an association. Such misleading results are fairly common
with backwards elimination and other sequential model selection procedures
(Berk, 1978).

0

10

20 30 40 50
regressor index

60

0

10

20 30 40 50
regressor index

60

Fig. 9.6. t-statistics for the regression of y˜ on X, before and after backwards elimination.

9.3.1 Bayesian model comparison
The Bayesian solution to the model selection problem is conceptually straightforward: If we believe that many of the regression coefficients are potentially
equal to zero, then we simply come up with a prior distribution that reflects
this possibility. This can be accomplished by specifying that each regression
coefficient has some non-zero probability of being exactly zero. A convenient
way to represent this is to write the regression coefficient for variable j as
βj = zj × bj , where zj ∈ {0, 1} and bj is some real number. With this parameterization, our regression equation becomes
yi = z1 b1 xi,1 + · · · + zp bp xi,p + i .
The zj ’s indicate which regression coefficients are non-zero. For example, in
the oxygen uptake problem,

164

9 Linear regression

E[Y |x, b, z = (1, 0, 1, 0)] = b1 x1 + b3 x3
= b1 + b3 × age
E[Y |x, b, z = (1, 1, 0, 0)] = b1 x1 + b2 x2
= b1 + b2 × group
E[Y |x, b, z = (1, 1, 1, 0)] = b1 x1 + b2 x2 + b3 x3
= b1 + b2 × group + b3 × age.
Each value of z = (z1 , . . . , zp ) corresponds to a different model, or more specifically, a different collection of variables having non-zero regression coefficients.
For example, we say that the model with z = (1, 0, 1, 0) is a linear regression
model for y as a function of age. The model with z = (1, 1, 1, 0) is referred
to as a regression model for y as a function of age, but with a group-specific
intercept. With this parameterization, choosing which variables to include in
a regression model is equivalent to choosing which zj ’s are 0 and which are 1.
Bayesian model selection proceeds by obtaining a posterior distribution
for z. Of course, doing so requires a joint prior distribution on {z, β, σ 2 }. It
turns out that a version of the g-prior described in the previous section allows
us to evaluate p(y|X, z) for each possible model z. Given a prior distribution
p(z) over models, this allows us to compute a posterior probability for each
regression model:
p(z)p(y|X, z)
p(z|y, X) = P
.
˜)
z )p(y|X, z
z˜ p(˜
Alternatively, we can compare the evidence for any two models with the posterior odds:
p(z a |y, X)
p(z a )
p(y|X, z a )
=
×
p(z b |y, X)
p(z b )
p(y|X, z b )
posterior odds = prior odds × “Bayes factor”

odds(z a , z b |y, X) =

The Bayes factor can be interpreted as how much the data favor model z a
over model z b . In order to obtain a posterior distribution over models, we will
have to compute p(y|X, z) for each model z under consideration.
Computing the marginal probability
The marginal probability is obtained from the integral
Z Z
p(y|X, z) =
p(y, β, σ 2 |X, z) dβdσ 2
Z Z
=
p(y|β, X)p(β|X, z, σ 2 )p(σ 2 ) dβ dσ 2 .

(9.8)

Using a version of the g-prior distribution for β, we will be able to compute
this integral without needing much calculus. For any given z with pz non-zero
entries, let Xz be the n × pz matrix corresponding to the variables j for which

9.3 Model selection

165

zj = 1, and similarly let β z be the pz × 1 vector consisting of the entries of
β for which zj = 1. Our modified g-prior distribution for β is that βj = 0 for
j’s such that zj = 0, and that
{β z |Xz , σ 2 } ∼ multivariate normal (0, gσ 2 [Xz T Xz ]−1 ).
If we integrate (9.8) with respect to β first, we have

Z Z
2
2
p(y|X, z) =
p(y|X, z, σ , β)p(β|X, z, σ ) dβ p(σ 2 ) dσ 2
Z
= p(y|X, z, σ 2 )p(σ 2 ) dσ 2 .
The form for the marginal probability p(y|X, z, σ 2 ) was computed in the last
section. Using those results, writing γ = 1/σ 2 and letting p(γ) be the gamma
density with parameters (ν0 /2, ν0 σ02 /2), we can show that conditional density
of (y, γ) given (X, z) is
h
i
z
p(y|X, z, γ) × p(γ) = (2π)−n/2 (1 + g)−pz /2 × γ n/2 e−γSSRg /2 ×
h
i
2
(ν0 σ02 /2)ν0 /2 Γ (ν0 /2)−1 γ ν0 /2−1 e−γν0 σ0 /2 , (9.9)
where SSRzg is as in the last section except based on the regressor matrix Xz :
SSRzg = y T (I −

g
Xz (XTz Xz )−1 Xz )y .
g+1

The part of Equation 9.9 that depends on γ is proportional to a gamma
density, but in this case the normalizing constant is the part that we need:
γ (ν0 +n)/2−1 exp[−γ × (ν0 σ02 + SSRzg )/2] =
Γ ([ν0 + n]/2)
× dgamma[γ, (ν0 + n)/2, (ν0 σ02 + SSRzg )/2] .
([ν0 σ02 + SSRzg ]/2)(ν0 +n)/2−1
Since the gamma density integrates to 1, the integral of the left-hand side of
the above equation must be equal to the constant on the right-hand side. Multiplying this constant by the other terms in Equation 9.9 gives the marginal
probability we are interested in:
p(y|X, z) = π −n/2

Γ ([ν0 + n]/2)
(ν0 σ02 )ν0 /2
(1 + g)−pz /2
.
Γ (ν0 /2)
(ν0 σ02 + SSRzg )(ν0 +n)/2

Now suppose we set g = n and use the unit information prior for p(σ 2 ) for each
model z, so that ν0 = 1 for all z, but σ02 is the estimated residual variance
under the least squares estimate for model z. In this case, the ratio of the
probabilities under any two models z a and z b is

166

9 Linear regression

p(y|X, z a )
= (1 + n)(pzb −pza )/2
p(y|X, z b )



s2za
s2zb

1/2
×

s2zb + SSRzgb
s2za + SSRzga

!(n+1)/2
.

Notice that the ratio of the marginal probabilities is essentially a balance
between model complexity and goodness of fit: A large value of pzb compared
to pza penalizes model z b , although a large value of SSRzga compared to SSRzgb
penalizes model z a .
Oxygen uptake example
Recall our regression model for the oxygen uptake data:
E[Yi |β, xi ] = β1 xi,1 +
β2 xi,2
+ β3 xi,3 +
β4 xi,4
= β1 + β2 × groupi + β3 × agei + β4 × groupi × agei .
The question of whether or not there is an effect of group translates into the
question of whether or not β2 and β4 are non-zero. Recall from our analyses
in the previous sections that the estimated magnitudes of β2 and β4 were
not large compared to their standard deviations, suggesting that maybe there
is not an effect of group. However, we also noticed from the joint posterior
distribution that β2 and β4 were negatively correlated, so whether or not β2
is zero affects our information about β4 .
z
(1,0,0,0)
(1,1,0,0)
(1,0,1,0)
(1,1,1,0)
(1,1,1,1)

model
log p(y|X, z) p(z|y, X)
β1
-44.33
0.00
β1 + β2 × groupi
-42.35
0.00
β1 + β3 × agei
-37.66
0.18
β1 + β2 × groupi + β3 × agei
-36.42
0.63
β1 + β2 × groupi + β3 × agei + β4 × groupi × agei
-37.60
0.19

Table 9.1. Marginal probabilities of the data under five different models.

We can formally evaluate whether β2 or β4 should be zero by computing the probability of the data under a variety of competing models. Table
9.1 lists five different regression models that we might like to consider for
these data. Using the g-prior for β with g = n, and a unit information prior
distribution for σ 2 for each value of z, the values of log p(y|X, z) can be computed for each of the five values of z we are considering. If we give each of
these models equal prior weight, then posterior probabilities for each model
can be computed as well. These calculations indicate that, among these five
models, the most probable model is the one corresponding z = (1, 1, 1, 0),
having a slope for age with a separate intercept for each group. The evidence
for an age effect is strong, as the posterior probabilities of the three models
that include age essentially sum to 1. The evidence for an effect of group is

9.3 Model selection

167

weaker, as the combined probability for the three models with a group effect is
0.00+0.63+0.19=0.82. However, this probability is substantially higher than
the corresponding prior probability of 0.20+0.20+0.20=0.60 for these three
models.
9.3.2 Gibbs sampling and model averaging
If we allow each of the p regression coefficients to be either zero or non-zero,
then there are 2p different models to consider. If p is large, then it will be
impractical for us to compute the marginal probability of each model. The
diabetes data, for example, has p = 64 possible regressors, so the total number
of models is 264 ≈ 1.8×1019 . In these situations our data analysis goals become
more modest: For example, we may be content with a decent estimate of β
from which we can make predictions, or a list of relatively high-probability
models. These items can be obtained with a Markov chain which searches
through the space of models for values of z with high posterior probability.
This can be done with a Gibbs sampler in which we iteratively sample each zj
from its full conditional distribution. Specifically, given a current value z =
(z1 , . . . , zp ), a new value of zj is generated by sampling from p(zj |y, X, z −j ),
where z −j refers to the values of z except the one corresponding to regressor
j. The full conditional probability that zj is 1 can be written as oj /(1 + oj ),
where oj is the conditional odds that zj is 1, given by
oj =

Pr(zj = 1|y, X, z −j )
Pr(zj = 1) p(y|X, z −j , zj = 1)
=
×
.
Pr(zj = 0|y, X, z −j )
Pr(zj = 0) p(y|X, z −j , zj = 0)

We may also want to obtain posterior samples of β and σ 2 . Using the results
of Section 9.2, values of these parameters can be sampled directly from their
conditional distributions given z, y and X: For each z in our MCMC sample,
we can construct the matrix Xz which consists of only those columns j corresponding to non-zero values of zj . Using this matrix of regressors, a value
of σ 2 can be sampled from p(σ 2 |X, y, z) (an inverse-gamma distribution) and
then a value of β can be sampled from p(β|X, y, z, σ 2 ) (a multivariate normal
distribution). Our Gibbs sampling scheme therefore looks something like the
following:
β (s)
z (s)
σ 2(s)
(s+1)
z (s+1) σ 2(s+1) β
(s+1)
More precisely, generating values of {z
, σ (s+1) , β (s+1) } from z (s) is
achieved with the following steps:

1. Set z = z (s) ;
2. For j ∈ {1, . . . , p} in random order, replace zj with a sample from
p(zj |z −j , y, X);
3. Set z (s+1) = z;

168

9 Linear regression

4. Sample σ 2(s+1) ∼ p(σ 2 |z (s+1) , y, X);
5. Sample β (s+1) ∼ p(β|z (s+1) , σ 2(s+1) , y, X).
Note that the entries of z (s+1) are not sampled from their full conditional distributions given σ 2(s) and β (s) . This is not a problem: The Gibbs sampler for z
ensures that the distribution of z (s) converges to the target posterior distribution p(z|y, X). Since (σ 2(s) , β (s) ) are direct samples from p(σ 2 , β|z (s) , y, X),
the distribution of (σ 2(s) , β (s) ) converges to p(σ 2 , β|y, X). R-code to implement the Gibbs sampling algorithm in z, along with a function lpy.X that
calculates the log of p(y|X), is below. This code can be combined with the
code in the previous section in order to generate samples of {z, σ 2 , β} from
the joint posterior distribution.
##### a f u n c t i o n t o compute t h e m a r g i n a l p r o b a b i l i t y
l p y . X<−f u n c t i o n ( y , X, g=l e n g t h ( y ) ,
nu0=1 , s 2 0=t r y ( summary ( lm ( y˜−1+X) ) $sigma ˆ 2 , s i l e n t=TRUE) )
{
n<−dim (X ) [ 1 ] ; p<−dim (X ) [ 2 ]
i f ( p==0) { Hg<−0 ; s20<−mean ( y ˆ 2 ) }
i f ( p>0) { Hg<−(g / ( g +1)) ∗ X%∗%s o l v e ( t (X)%∗%X)%∗%t (X) }
SSRg<− t ( y)%∗%( d i a g ( 1 , nrow=n ) − Hg )%∗%y
−.5∗( n∗ l o g ( p i )+p∗ l o g (1+g )+( nu0+n ) ∗ l o g ( nu0∗ s 2 0+SSRg)−
nu0∗ l o g ( nu0 ∗ s 2 0 ) ) +
lgamma ( ( nu0+n ) / 2 ) − lgamma ( nu0 / 2 )
}
#####
##### s t a r t i n g v a l u e s and MCMC s e t u p
z<−r e p ( 1 , dim (X ) [ 2 ] )
l p y . c<−l p y .X( y ,X[ , z==1,drop=FALSE ] )
S<−10000
Z<−m at r i x (NA, S , dim (X ) [ 2 ] )
#####
##### Gibbs s a m p l e r
for ( s in 1: S)
{
f o r ( j i n sample ( 1 : dim (X ) [ 2 ] ) )
{
zp<−z ; zp [ j ]<−1−zp [ j ]
l p y . p<−l p y .X( y ,X[ , zp==1,drop=FALSE ] )
r<− ( l p y . p − l p y . c )∗( −1)ˆ ( zp [ j ]==0)
z [ j ]<−rbinom ( 1 , 1 , 1 / ( 1 + exp(− r ) ) )
i f ( z [ j ]==zp [ j ] ) { l p y . c<−l p y . p}
}
Z [ s ,]<− z
}
#####

9.3 Model selection

169

Diabetes example
Using a uniform distribution on z, the Gibbs sampling scheme described above
was run for S = 10, 000 iterations, generating 10,000 samples of (z, σ 2 , β)
which we can use to approximate the posterior distribution p(z, σ 2 , β|y, X).
How good will our approximation be? Recall that with p = 64 the total number of models, or possible values of z, is 264 ≈ 1019 , which is 1015 times as
large as the number of approximate posterior samples we have. It should then
not be too much of a surprise that, in the 10,000 MCMC samples of z, only
32 of the possible models were sampled more than once: 28 models were sampled twice, two were sampled three times and two others were sampled five
and six times. This means that, for large p, the Gibbs sampling scheme provides a poor approximation to the posterior distribution of z. Nevertheless, in
many situations where most of the regressors have no effect the Gibbs sampler
can still provide reasonable estimates of the marginal posterior distributions
of individual zj ’s or βj ’s. The first panel of Figure 9.7 shows the estimated
posterior probabilities Pr(zj = 1|y, X) for each of the 64 regressors. There
are six regression coefficients having a posterior probability higher than 0.5
of being non-zero. These six regressors are a subset of the 20 that remained
after the backwards selection procedure described above. How well does this
Bayesian approach do in terms of prediction?
As usual, we can approximate
PS
(s)
ˆ
the posterior mean of β with β
=
β
/S. This parameter estimate
bma
s=1
is sometimes called the (Bayesian) model averaged estimate of β, because it
is an average of regression parameters from different values of z, i.e. over different regression models. This estimate, obtained by averaging the regression
coefficients from several high-probability models, often performs better than
the estimate of β obtained by considering only a single model. Returning to
the problem of predicting data from the diabetes test set, we can compute
ˆ
ˆ test = Xβ
model-averaged predicted values y
bma . These predicted values are
plotted against the true values y test in the second panel of Figure 9.7. These
predictions have an average squared error of 0.452, which is better than the
OLS estimates using either the full model or the one obtained from backwards
elimination.
Finally, we evaluate the Bayesian model selection procedure when there is
no relationship between Y and x. Recall from above that when the backwards
˜ , which was conelimination procedure was applied to the permuted vector y
structed independently of X, it erroneously returned 18 regressors. Running
the Gibbs sampler above on the same dataset (˜
y , X) for 10,000 iterations proP (s)
vides approximated posterior probabilities Pr(zj = 1|y, X) = zj /S, all of
which are less than 1/2, and all but two of which are less than 1/4. In contrast
to the backwards selection procedure, for these data the Bayesian approach
to model selection does not erroneously identify any regressors as having an
˜.
effect on the distribution of y

9 Linear regression

1.0

170

●

●

−1.0

0.2

y^test
0.0

1.0

Pr(z j = 1|y,X)
0.4 0.6 0.8

●

0

10

20

30
40
regressor index

50

60

●

● ●
●
● ●
●
●
●
●
●
●
●
● ●●
●
● ●●
●●
●
●●
● ●
● ● ●● ●
●●
●
●
● ● ●●●
●
●
●
●●
● ●●
● ●●
●●
●● ●●●
●
●
●●
●
●●
● ● ●
● ● ● ●●
●
●●
● ●●
●
●
●
●●
● ●● ●●
●●
●●

−1.5

−0.5

0.5
y test

1.5

Fig. 9.7. The first panel shows posterior probabilities that each coefficient is nonzero. The second panel shows ytest versus predictions based on the model averaged
estimate of β.

9.4 Discussion and further references
There are many approaches to Bayesian model selection that use prior distributions allowing elements of β to be identically zero. George and McCulloch
(1993) parameterize βj as bj × zj , where zj ∈ {0, 1}, and use Gibbs sampling
to do model selection. Liang et al (2008) review various types of g-priors in
terms of two types of asymptotic consistency: model consistency and predictive consistency. The former is concerned with selecting the “true model,”
and the latter with making accurate posterior predictions. As pointed out by
Leamer (1978), selecting a model and then acting as if it were true understates
the uncertainty in the model selection process, and can result in suboptimal
predictive performance. Predictive performance can be improved by Bayesian
model averaging, i.e. averaging the predictive distributions under the different
models according to their posterior probability (Madigan and Raftery, 1994;
Raftery et al, 1997).
Many have argued that in most situations none of the regression models
under consideration are actually true. Results of Bernardo and Smith (1994,
Section 6.1.6) and Key et al (1999) indicate that in this situation, Bayesian
model selection can still be meaningful in a decision-theoretic sense, where
the task is to select the model with the best predictive performance. In this
case, model selection proceeds using a modified Bayes factor that is similar to
a cross-validation criterion.

10
Nonconjugate priors and Metropolis-Hastings
algorithms

When conjugate or semiconjugate prior distributions are used, the posterior
distribution can be approximated with the Monte Carlo method or the Gibbs
sampler. In situations where a conjugate prior distribution is unavailable or
undesirable, the full conditional distributions of the parameters do not have
a standard form and the Gibbs sampler cannot be easily used. In this section
we present the Metropolis-Hastings algorithm as a generic method of approximating the posterior distribution corresponding to any combination of prior
distribution and sampling model. This section presents the algorithm in the
context of two examples: The first involves Poisson regression, which is a type
of generalized linear model. The second is a longitudinal regression model in
which the observations are correlated over time.

10.1 Generalized linear models
Example: Song sparrow reproductive success
A sample from a population of 52 female song sparrows was studied over
the course of a summer and their reproductive activities were recorded. In
particular, the age and number of new offspring were recorded for each sparrow
(Arcese et al, 1992). Figure 10.1 shows boxplots of the number of offspring
versus age. The figure indicates that two-year-old birds in this population
had the highest median reproductive success, with the number of offspring
declining beyond two years of age. This is not surprising from a biological
point of view: One-year-old birds are in their first mating season and are
relatively inexperienced compared to two-year-old birds. As birds age beyond
two years they experience a general decline in health and activity.
Suppose we wish to fit a probability model to these data, perhaps to understand the relationship between age and reproductive success, or to make
population forecasts for this group of birds. Since the number of offspring for
each bird is a non-negative integer {0,1,2,. . . }, a simple probability model
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 10,
c Springer Science+Business Media, LLC 2009


10 Nonconjugate priors and Metropolis-Hastings algorithms

0

1

2

offspring
3
4

5

6

7

172

1

2

3

4

5

6

age

Fig. 10.1. Number of offspring versus age.

for Y =number of offspring conditional on x=age would be a Poisson model,
{Y |x} ∼ Poisson(θx ). One possibility would be to estimate θx separately for
each age group. However, the number of birds of each age is small and so the
estimates of θx would be imprecise. To add stability to the estimation we will
assume that the mean number of offspring is a smooth function of age. We
will want to allow this function to be quadratic so that we can represent the
increase in mean offspring while birds mature and the decline they experience
thereafter. One possibility would be to express θx as θx = β1 + β2 x + β3 x2 .
However, such a parameterization might allow some values of θx to be negative, which is not physically possible. As an alternative, we will model the
log-mean of Y in terms of this regression, so that
log E[Y |x] = log θx = β1 + β2 x + β3 x2 ,
which means that E[Y |x] = exp(β1 + β2 x + β3 x2 ), which is always greater
than zero.
The resulting model, {Y |x} ∼ Poisson(exp[β T x]), is called a Poisson regression model . The term β T x is called the linear predictor . In this regression model the linear predictor is linked to E[Y |x] via the log function, and
so we say that this model has a log link . The Poisson regression model is
a type of generalized linear model , a model which relates a function of the
expectation to a linear predictor of the form β T x. Another common generalized linear model is the logistic regression model for binary data. Writing
Pr(Y = 1|x) = E[Y |x] = θx , the logistic regression model parameterizes θx as
exp(β T x)
, so that
1 + exp(β T x)
θx
β T x = log
.
1 − θx
θx =

10.2 The Metropolis algorithm

173

The function log θx /(1 − θx ) relating the mean to the linear predictor is called
the logit function, so the logistic regression model could be described as a
binary regression model with a logit link. Notice that the logit link forces θx
to be between zero and one, even though β T x can range over the whole real
line.
As in the case of ordinary regression, a natural class of prior distributions
for β is the class of multivariate normal distributions. However, for neither the
Poisson nor the logistic regression model would a prior distribution from this
class result in a multivariate normal posterior distribution for β. Furthermore,
standard conjugate prior distributions for generalized linear models do not
exist (except for the normal regression model).
One possible way to calculate the posterior distribution is to use a gridbased approximation, similar to the approach we used in Section 6.2: We
can evaluate p(y|X, β) × p(β) on a three-dimensional grid of β-values, then
normalize the result to obtain a discrete approximation to p(β|X, y). Figure
10.2 shows approximate marginal and joint distributions of β2 and β3 based on
the prior distribution β ∼ multivariate normal(0, 100 × I) and a grid having
100 values for each parameter. Computing these quantities for this threeparameter model required the calculation of p(y|X, β) × p(β) at 1 million
grid points. While feasible for this problem, a Poisson regression with only
two more regressors and the same grid density would require 10 billion grid
points, which is prohibitively large. Additionally, grid-based approximations
can be very inefficient: The third panel of Figure 10.2 shows a strong negative
posterior correlation between β2 and β3 , which means that the probability
mass is concentrated along a diagonal and so the vast majority of points of our
cubical grid have essentially zero probability. In contrast, an approximation of
p(β|X, y) based on Monte Carlo samples could be stored in a computer much
more efficiently, since our Monte Carlo sample would not include any points
that have essentially zero posterior probability. Although independent Monte
Carlo sampling from the posterior is not available for this Poisson regression
model, the next section will show how to construct a Markov chain that can
approximate p(β|X, y) for any prior distribution p(β).

10.2 The Metropolis algorithm
Let’s consider a very generic situation where we have a sampling model
Y ∼ p(y|θ) and a prior distribution p(θ). Although in most problems
p(y|θ) and Rp(θ) can be calculated for any values of y and θ, p(θ|y) =
p(θ)p(y|θ)/ p(θ0 )p(y|θ0 ) dθ0 is often hard to calculate due to the integral
in the denominator. If we were able to sample from p(θ|y), then we could
generate θ(1) , . . . , θ(S) ∼ i.i.d. p(θ|y) and obtain Monte Carlo approximations
to posterior quantities, such as

10 Nonconjugate priors and Metropolis-Hastings algorithms

β3
−0.2
−0.4

0

0.0

1

2

p( β2|y)
0.4
0.8

p( β3|y)
3 4 5

6

0.0

7

1.2

174

−1

0

β2

1

2

−0.6

−0.2
β3

0.2 0.4

−0.5

0.5

β2

1.5

Fig. 10.2. Grid-based approximations to p(β2 |X, y), p(β3 |X, y) and p(β2 , β3 |X, y).

E[g(θ)|y] ≈

S
1X
g(θ(s) ).
S s=1

But what if we cannot sample directly from p(θ|y)? In terms of approximating the posterior distribution, the critical thing is not that we have i.i.d.
samples from p(θ|y) but rather that we are able to construct a large collection
of θ-values, {θ(1) , . . . , θ(S) }, whose empirical distribution approximates p(θ|y).
Roughly speaking, for any two different values θa and θb we need
#{θ(s) ’s in the collection = θa }
p(θa |y)
≈
.
(s)
p(θb |y)
#{θ ’s in the collection = θb }
Let’s think intuitively about how we might construct such a collection.
Suppose we have a working collection {θ(1) , . . . , θ(s) } to which we would like
to add a new value θ(s+1) . Let’s consider adding a value θ∗ which is nearby
θ(s) . Should we include θ∗ in the set or not? If p(θ∗ |y) > p(θ(s) |y) then we
want more θ∗ ’s in the set than θ(s) ’s. Since θ(s) is already in the set, then it
seems we should include θ∗ as well. On the other hand, if p(θ∗ |y) < p(θ(s) |y)
then it seems we should not necessarily include θ∗ . So perhaps our decision
to include θ∗ or not should be based on a comparison of p(θ∗ |y) to p(θ(s) |y).
Fortunately, this comparison can be made even if we cannot compute p(θ|y):
r=

p(θ∗ |y)
p(y|θ∗ )p(θ∗ )
p(y)
p(y|θ∗ )p(θ∗ )
=
=
.
p(y)
p(θ(s) |y)
p(y|θ(s) )p(θ(s) )
p(y|θ(s) )p(θ(s) )

(10.1)

Having computed r, how should we proceed?
If r > 1:
Intuition: Since θ(s) is already in our set, we should include θ∗ as it
has a higher probability than θ(s) .
Procedure: Accept θ∗ into our set, i.e. set θ(s+1) = θ∗ .
If r < 1:

10.2 The Metropolis algorithm

175

Intuition: The relative frequency of θ-values in our set equal to θ∗
compared to those equal to θ(s) should be p(θ∗ |y)/p(θ(s) |y) = r. This
means that for every instance of θ(s) , we should have only a “fraction”
of an instance of a θ∗ value.
Procedure: Set θ(s+1) equal to either θ∗ or θ(s) , with probability r
and 1 − r respectively.
This is the basic intuition behind the famous Metropolis algorithm. The
Metropolis algorithm proceeds by sampling a proposal value θ∗ nearby the
current value θ(s) using a symmetric proposal distribution J(θ∗ |θ(s) ). Symmetric here means that J(θb |θa ) = J(θa |θb ), i.e. the probability of proposing
θ∗ = θb given that θ(s) = θa is equal to the probability of proposing θ∗ = θa
given that θ(s) = θb . Usually J(θ∗ |θ(s) ) is very simple, with samples from
J(θ∗ |θ(s) ) being near θ(s) with high probability. Examples include
• J(θ∗ |θ(s) ) = uniform(θ(s) − δ, θ(s) + δ) ;
• J(θ∗ |θ(s) ) = normal(θ(s) , δ 2 ) .
The value of the parameter δ is generally chosen to make the approximation
algorithm run efficiently, as will be discussed in more detail shortly.
Having obtained a proposal value θ∗ , we add either it or a copy of θ(s) to
our set, depending on the ratio r = p(θ∗ |y)/p(θ(s) |y). Specifically, given θ(s) ,
the Metropolis algorithm generates a value θ(s+1) as follows:
1. Sample θ∗ ∼ J(θ|θ(s) );
2. Compute the acceptance ratio
r=
3. Let
θ(s+1) =



p(θ∗ |y)
p(y|θ∗ )p(θ∗ )
=
.
(s)
p(θ |y)
p(y|θ(s) )p(θ(s) )
θ∗ with probability min(r, 1)
θ(s) with probability 1 − min(r, 1).

Step 3 can be accomplished by sampling u ∼ uniform(0, 1) and setting
θ(s+1) = θ∗ if u < r and setting θ(s+1) = θ(s) otherwise.
Example: Normal distribution with known variance
Let’s try out the Metropolis algorithm for the conjugate normal model with
a known variance, a situation where we know the correct posterior distribution. Letting θ ∼ normal(µ, τ 2 ) and {y1 , . . . , yn |θ} ∼ i.i.d. normal(θ, σ 2 ), the
posterior distribution of θ is normal(µn , τn2 ) where
µn = y¯

n/σ 2
1/τ 2
+
µ
n/σ 2 + 1/τ 2
n/σ 2 + 1/τ 2

τn2 = 1/(n/σ 2 + 1/τ 2 ).

176

10 Nonconjugate priors and Metropolis-Hastings algorithms

Suppose σ 2 = 1, τ 2 = 10, µ = 5, n = 5 and y = (9.37, 10.18, 9.16, 11.60, 10.33).
For these data, µn = 10.03 and τn2 = .20, and so p(θ|y) = dnorm(10.03, .44).
Now suppose that for some reason we were unable to obtain the formula for
this posterior distribution and needed to use the Metropolis algorithm to approximate it. Based on this model and prior distribution, the acceptance ratio
comparing a proposed value θ∗ to a current value θ(s) is
 Qn
 

∗
p(θ∗ |y)
dnorm(θ∗ , µ, τ )
i=1 dnorm(yi , θ , σ)
Q
r=
=
×
.
n
(s) , σ)
p(θ(s) |y)
dnorm(θ(s) , µ, τ )
i=1 dnorm(yi , θ
In many cases, computing the ratio r directly can be numerically unstable, a
problem that often can be remedied by computing the logarithm of r:
log r =

n
X

[log dnorm(yi , θ∗ , σ) − log dnorm(yi , θ(s) , σ)] +

i=1

log dnorm(θ∗ , µ, τ ) − log dnorm(θ(s) , µ, τ ).
Keeping things on the log scale, the proposal is accepted if log u < log r, where
u is a sample from the uniform distribution on (0, 1).
The R-code below generates 10,000 iterations of the Metropolis algorithm,
starting at θ(0) = 0 and using a normal proposal distribution, θ(s+1) ∼ normal
(θ(s) , δ 2 ) with δ 2 = 2 .
s2 <−1 ; t2 <−10 ; mu<−5
y<−c ( 9 . 3 7 , 1 0 . 1 8 , 9 . 1 6 , 1 1 . 6 0 , 1 0 . 3 3 )
t h e t a <−0 ; d e l t a 2 <−2 ; S<−10000 ; THETA<−NULL ; s e t . s e e d ( 1 )
for ( s in 1: S)
{
t h e t a . s t a r <−rnorm ( 1 , t h e t a , s q r t ( d e l t a 2 ) )
l o g . r <−( sum ( dnorm ( y , t h e t a . s t a r , s q r t ( s 2 ) , l o g=TRUE) ) +
dnorm ( t h e t a . s t a r , mu, s q r t ( t 2 ) , l o g=TRUE) )
( sum ( dnorm ( y , t h e t a , s q r t ( s 2 ) , l o g=TRUE) ) +
dnorm ( t h e t a , mu, s q r t ( t 2 ) , l o g=TRUE) )

−

i f ( l o g ( r u n i f (1)) < l o g . r ) { t h e t a <−t h e t a . s t a r }
THETA<−c (THETA, t h e t a )
}

The first panel of Figure 10.3 plots these 10,000 simulated values as a
function of iteration number. Although the value of θ starts nowhere near
the posterior mean of 10.03, it quickly arrives there after a few iterations. The
second panel gives a histogram of the 10,000 θ-values, and includes a plot of the
normal(10.03, 0.20) density for comparison. Clearly the empirical distribution

177

0.0

5

6

0.2

7

θ
8

9

density
0.4
0.6

10

0.8

11

10.2 The Metropolis algorithm

0

2000

4000 6000
iteration

8000

8.5 9.0 9.5

10.5

11.5

θ

Fig. 10.3. Results from the Metropolis algorithm for the normal model.

of the simulated values is very close to the true posterior distribution. Will
this similarity between {θ(1) , . . . , θ(S) } and p(θ|y) hold in general?
Output of the Metropolis algorithm
The Metropolis algorithm generates a dependent sequence {θ(1) , θ(2) , . . .} of
θ-values. Since our procedure for generating θ(s+1) depends only on θ(s) , the
conditional distribution of θ(s+1) given {θ(1) , . . . , θ(s) } also depends only on
θ(s) and so the sequence {θ(1) , θ(2) , . . .} is a Markov chain.
Under some mild conditions the marginal sampling distribution of θ(s) is
approximately p(θ|y) for large s. Additionally, for any given numerical value
θa of θ,
#{θ’s in the sequence < θa }
lim
= p(θ < θa |y).
S→∞
S
Just as with the Gibbs sampler, this suggests we can approximate posterior
means, quantiles and other posterior quantities of interest using the empirical
distribution of {θ(1) , . . . , θ(S) }. However, our approximation to these quantities will depend on how well our simulated sequence actually approximates
p(θ|y). Results from probability theory say that, in the limit as S → ∞, the
approximation will be exact, but in practice we cannot run the Markov chain
forever. Instead, the standard practice in MCMC approximation, using either
the Metropolis algorithm or the Gibbs sampler, is as follows:
1. run algorithm until some iteration B for which it looks like the Markov
chain has achieved stationarity;
2. run the algorithm S more times, generating {θ(B+1) , . . . , θ(B+S) };
3. discard {θ(1) , . . . , θ(B) } and use the empirical distribution of {θ(B+1) , . . .,
θ(B+S) } to approximate p(θ|y).

178

10 Nonconjugate priors and Metropolis-Hastings algorithms

15
10

15
10
0

100

300
iteration

500

5
0

5
0

0

5

θ

10

15

The iterations up to and including B are called the “burn-in” period, in which
the Markov chain moves from its initial value to a region of the parameter
space that has high posterior probability. If we have a good idea of where this
high probability region is, we can reduce the burn-in period by starting the
Markov chain there. For example, in the Metropolis algorithm above it would
have been better to start with θ(1) = y¯ as we know that the posterior mode
will be near y¯. However, starting with θ(1) = 0 illustrates that the Metropolis
algorithm is able to move from a low posterior probability region to one of
high probability.
The θ-values generated from an MCMC algorithm are statistically dependent. Recall from the discussion of MCMC diagnostics in Chapter 6 that the
higher the correlation, the longer it will take for the Markov chain to achieve
stationarity and the more iterations it will take to get a good approximation to
p(θ|y). Roughly speaking, the amount of information we obtain about E[θ|y]
from S positively correlated samples is less than the information we would obtain from S independent samples. The more correlated our Markov chain is,
the less information we get per iteration (recall the notion of “effective sample
size” from Section 6.6). In Gibbs sampling we do not have much control over
the correlation of the Markov chain, but with the Metropolis algorithm the
correlation can be adjusted by selecting an optimal value of δ in the proposal
distribution. By selecting δ carefully, we can decrease the correlation in the
Markov chain, leading to an increase in the rate of convergence, an increase
in the effective sample size of the Markov chain and an improvement in the
Monte Carlo approximation to the posterior distribution.

0

100

300
iteration

500

0

100

300
iteration

500

Fig. 10.4. Markov chains under three different proposal distributions. Going from
left to right, the values of δ 2 are 1/32, 2 and 64 respectively.

To illustrate this, we can rerun the Metropolis algorithm for the one-sample
normal problem using a range of δ values, including δ 2 ∈ {1/32, 1/2, 2, 32,
64 }. Doing so results in lag-1 autocorrelations of (0.98, 0.77, 0.69, 0.84, 0.86)
for these five different δ-values. Interestingly, the best δ-value among these
five occurs in the middle of the set of values, and not at the extremes. The

10.3 The Metropolis algorithm for Poisson regression

179

reason why can be understood by inspecting each sequence. Figure 10.4 plots
the first 500 values for the sequences corresponding to δ 2 ∈ {1/32, 2, 64}. In
the first panel where δ 2 = 1/32, the small proposal variance means that θ∗
will be very close to θ(s) , and so r ≈ 1 for most proposed values. As a result,
θ∗ is accepted as the value of θ(s+1) for 87% of the iterations. Although this
high acceptance rate keeps the chain moving, the moves are never very large
and so the Markov chain is highly correlated. One consequence of this is that
it takes a large number of iterations for the Markov chain to move from the
starting value of zero to the posterior mode of 10.03. At the other extreme,
the third plot in the figure shows the Markov chain for δ 2 = 64. In this case
the chain moves quickly to the posterior mode but once there it gets “stuck”
for long periods. This is because the variance of the proposal distribution is so
large that θ∗ is frequently very far away from the posterior mode. Proposals
in this Metropolis algorithm are accepted for only 5% of the iterations, and
so θ(s+1) is set equal to θ(s) 95% of the time, resulting in a highly correlated
Markov chain.
In order to construct a Markov chain with a low correlation we need a
proposal variance that is large enough so that the Markov chain can quickly
move around the parameter space, but not so large that the proposals end up
getting rejected most of the time. Among the proposal variances considered
for the data and normal model here, this balance was optimized with a δ 2 of
2, which gives an acceptance rate of 35%. In general, it is common practice to
first select a proposal distribution by implementing several short runs of the
Metropolis algorithm under different δ-values until one is found that gives an
acceptance rate roughly between 20 and 50%. Once a reasonable value of δ is
selected, a longer more efficient Markov chain can be run. Alternatively, modified versions of the Metropolis algorithm can be constructed that adaptively
change the value of δ at the beginning of the chain in order to automatically
find a good proposal distribution.

10.3 The Metropolis algorithm for Poisson regression
Let’s implement the Metropolis algorithm for the Poisson regression model
introduced at the beginning of the chapter. Recall that the model is that Yi is
a sample from a Poisson distribution with a log-mean given by log E[Yi |xi ] =
β1 + β2 xi + β3 x2i , where xi is the age of the sparrow i. We will abuse notation
slightly by writing xi = (1, xi , x2i ) so that log E[Yi |xi ] = β T xi . The prior
distribution we used in Section 10.1 was that the regression coefficients were
i.i.d. normal(0,100). Given a current value β (s) and a value β ∗ generated from
J(β ∗ |β (s) ), the acceptance ratio for the Metropolis algorithm is

180

10 Nonconjugate priors and Metropolis-Hastings algorithms

r=

p(β ∗ |X, y)

p(β (s) |X, y)
Q3
Qn
∗
T ∗
j=1 dnorm(βj , 0, 10)
i=1 dpois(yi , xi β )
= Qn
×
.
Q3
(s)
T (s) )
i=1 dpois(yi , xi β
j=1 dnorm(βj , 0, 10)

All that remains to implement the algorithm is to specify the proposal distribution for θ∗ . A convenient choice is a multivariate normal distribution with
mean β (s) . In many problems, the posterior variance can be an efficient choice
of a proposal variance. Although we do not know the posterior variance before we run the Metropolis algorithm, it is often sufficient just to use a rough
approximation. In a normal regression problem, the posterior variance of β
will be close to σ 2 (XT X)−1 , where σ 2 is the variance of Y . In our Poisson
regression, the model is that the log of Y has expectation equal to β T x, so
let’s try a proposal variance of σ
ˆ 2 (XT X)−1 where σ
ˆ 2 is the sample variance of
{log(y1 + 1/2), . . . , log(yn + 1/2)} (we use log(y + 1/2) instead of log y because
the latter would be −∞ if y = 0). If this results in an acceptance rate that is
too high or too low, we can always adjust the proposal variance accordingly.
R-code to implement the Metropolis algorithm for a Poisson regression of
y on X is as follows:
data ( c h a p t e r 1 0 ) ; y<−yX . sparrow [ , 1 ] ; X<−yX . sparrow [ , − 1 ]
n<−l e n g t h ( y ) ; p<−dim (X ) [ 2 ]
pmn . beta<−r e p ( 0 , p )
psd . beta<−r e p ( 1 0 , p )

#p r i o r e x p e c t a t i o n
#p r i o r var

var . prop<− var ( l o g ( y +1/2))∗ s o l v e ( t (X)%∗%X )
S<−10000
beta<−r e p ( 0 , p ) ; acs <−0
BETA<−m at r i x ( 0 , nrow=S , n c o l=p )
set . seed (1)

#p r o p o s a l var

for ( s in 1: S)
{
b e t a . p<− t ( rmvnorm ( 1 , beta , var . prop ) )
l h r <− sum ( d p o i s ( y , exp (X%∗%b e t a . p ) , l o g=T) ) −
sum ( d p o i s ( y , exp (X%∗%b e t a ) , l o g=T) ) +
sum ( dnorm ( b e t a . p , pmn . beta , psd . beta , l o g=T) ) −
sum ( dnorm ( beta , pmn . beta , psd . beta , l o g=T) )
i f ( l o g ( r u n i f (1)) < l h r ) { beta<−b e t a . p ; acs<−a c s+1 }
BETA[ s ,]<− b e t a
}

Applying this algorithm to the song sparrow data gives an acceptance
rate of about 43%. A plot of β3 versus iteration number appears in the first

0 2000

6000
iteration

10000

181

ACF
0.0 0.2 0.4 0.6 0.8 1.0

−0.3

−0.2

β3
−0.1

0.0

ACF
0.0 0.2 0.4 0.6 0.8 1.0

10.4 Metropolis, Metropolis-Hastings and Gibbs

0

10

20
lag

30

40

0

5 10
20
lag/10

30

Fig. 10.5. Plot of the Markov chain in β3 along with autocorrelation functions.

panel of Figure 10.5. The algorithm moves quickly from the starting value
of β3 = 0 to a region closer to the posterior mode. The second panel of the
figure shows the autocorrelation function for β3 . We could possibly reduce
the autocorrelation by modifying the proposal variance and obtaining a new
Markov chain, although this Markov chain is perhaps sufficient to obtain a
good approximation to p(β|X, y). For example, the third panel of Figure 10.5
plots the autocorrelation function of every 10th value of β3 from the Markov
chain. This “thinned” subsequence contains 1,000 of the 10,000 β3 values,
but these 1,000 values are nearly independent. This suggests we have nearly
the equivalent of 1,000 independent samples of β3 with which to approximate
the posterior distribution. To be more precise, we can calculate the effective
sample size as described in Section 6.6. The effective sample sizes for β1 ,
β2 and β3 are 818, 778 and 726 respectively. The adequacy of this Markov
chain is confirmed further in the first two panels of Figure 10.6, which plots
the MCMC approximations to the marginal posterior densities of β2 and β3 .
These densities are nearly identical to the ones obtained from the grid-based
approximation, which are shown in gray lines for comparison. Finally, the
third panel of the figure plots posterior quantiles of E[Y |x] for each age x,
which indicates the quadratic nature of reproductive success for this song
sparrow population.

10.4 Metropolis, Metropolis-Hastings and Gibbs
Recall that a Markov chain is a sequentially generated sequence {x(1) , x(2) , . . .}
such that the mechanism that generates x(s+1) can depend on the value of
x(s) but not on {x(s−1) , x(s−2) , . . . x(1) }. A more poetic way of putting this
is that for a Markov chain “the future depends on the present and not on
the past.” The Gibbs sampler and the Metropolis algorithm are both ways of
generating Markov chains that approximate a target probability distribution
p0 (x) for a potentially vector-valued random variable x. In Bayesian analysis,
x is typically a parameter or vector of parameters and p0 (x) is a posterior

10 Nonconjugate priors and Metropolis-Hastings algorithms

−1

0

β2

1

2

0

0

0.0

1

2

p( β2|y)
0.4
0.8

p( β3|y)
3 4 5

number of offspring
1
2
3

6

7

1.2

182

−0.6

−0.2
β3

0.2 0.4

1

2

3

4

5

6

age

Fig. 10.6. The first two panels give the MCMC approximations to the posterior
marginal distributions of β2 and β3 in black, with the grid-based approximations in
gray. The third panel gives 2.5%, 50% and 97.5% posterior quantiles of exp(β T x).

distribution, but the Gibbs sampler and Metropolis algorithm are both used
more broadly.
In this section we will show that these two algorithms are in fact special cases of a more general algorithm, called the Metropolis-Hastings algorithm. We will then describe why Markov chains generated by the MetropolisHastings algorithm are able to approximate a target probability distribution.
Since the Gibbs and Metropolis algorithms are special cases of MetropolisHastings, this implies that these two algorithms are also valid ways to approximate probability distributions.
10.4.1 The Metropolis-Hastings algorithm
We’ll first consider a simple example where our target probability distribution
is p0 (u, v), a bivariate distribution for two random variables U and V . In the
one-sample normal problem, for example, we would have U = θ, V = σ 2 and
p0 (u, v) = p(θ, σ 2 |y).
Recall that the Gibbs sampler proceeds by iteratively sampling values of
U and V from their conditional distributions: Given x(s) = (u(s) , v (s) ), a new
value of x(s+1) is generated as follows:
1. update U : sample u(s+1) ∼ p0 (u|v (s) );
2. update V : sample v (s+1) ∼ p0 (v|u(s+1) ).
Alternatively, we could have first sampled v (s+1) ∼ p0 (v|u(s) ) and then
u(s+1) ∼ p0 (u|v (s+1) ).
In contrast, the Metropolis algorithm proposes changes to X = (U, V ) and
then accepts or rejects those changes based on p0 . In the Poisson regression
example the proposed vector differed from its current value at each element
of the vector, but this is not necessary. An alternative way to implement the
Metropolis algorithm is to propose and then accept or reject changes to one
element at a time:

10.4 Metropolis, Metropolis-Hastings and Gibbs

183

1. update U :
a) sample u∗ ∼ Ju (u|u(s) );
b) compute r = p0 (u∗ , v (s) )/p0 (u(s) , v (s) );
c) set u(s+1) to u∗ or u(s) with probability min(1, r) and max(0, 1 − r).
2. update V :
a) sample v ∗ ∼ Jv (v|v (s) );
b) compute r = p0 (u(s+1) , v ∗ )/p0 (u(s+1) , v (s) );
c) set v (s+1) to v ∗ or v (s) with probability min(1, r) and max(0, 1 − r).
Here, Ju and Jv are separate symmetric proposal distributions for U and V .
This Metropolis algorithm generates proposals from Ju and Jv and accepts them with some probability min(1, r). Similarly, each step of the Gibbs
sampler can be seen as generating a proposal from a full conditional distribution and then accepting it with probability 1. The Metropolis-Hastings
algorithm generalizes both of these approaches by allowing arbitrary proposal
distributions. The proposal distributions can be symmetric around the current
values, full conditional distributions, or something else entirely. A MetropolisHastings algorithm for approximating p0 (u, v) runs as follows:
1. update U :
a) sample u∗ ∼ Ju (u|u(s) , v (s) );
b) compute the acceptance ratio
r=

p0 (u∗ , v (s) )
Ju (u(s) |u∗ , v (s) )
×
;
p0 (u(s) , v (s) ) Ju (u∗ |u(s) , v (s) )

c) set u(s+1) to u∗ or u(s) with probability min(1, r) and max(0, 1 − r).
2. update V :
a) sample v ∗ ∼ Jv (v|u(s+1) , v (s) );
b) compute the acceptance ratio
r=

p0 (u(s+1) , v ∗ )
Jv (v (s) |u(s+1) , v ∗ )
×
;
(s+1)
(s)
p0 (u
, v ) Jv (v ∗ |u(s+1) , v (s) )

c) set v (s+1) to v ∗ or v (s) with probability min(1, r) and max(0, 1 − r).
In this algorithm the proposal distributions Ju and Jv are not required to be
symmetric. In fact, the only requirement is that they do not depend on U or V
values in our sequence previous to the most current values. This requirement
ensures that the sequence is a Markov chain.
The Metropolis-Hastings algorithm looks a lot like the Metropolis algorithm, except that the acceptance ratio contains an extra factor, the ratio of
the probability of generating the current value from the proposed to the probability of generating the proposed from the current. This can be viewed as a
“correction factor:” If a value u∗ is much more likely to be proposed than the
current value u(s) , then we must down-weight the probability of accepting u∗
accordingly, otherwise the value u∗ will be overrepresented in our sequence.

184

10 Nonconjugate priors and Metropolis-Hastings algorithms

That the Metropolis algorithm is a special case of the Metropolis-Hastings
algorithm is easy to see: If Ju is symmetric, meaning that J(ua |ub , v) =
J(ub |ua , v) for all possible ua , ub and v, then the correction factor in the
Metropolis-Hastings acceptance ratio is equal to 1 and the acceptance probability is the same as in the Metropolis algorithm. That the Gibbs sampler is a
type of Metropolis-Hastings algorithm is almost as easy to see. In the Gibbs
sampler the proposal distribution for U is the full conditional distribution of
U given V = v. If we use the full conditionals as our proposal distributions
in the Metropolis-Hastings algorithm, we have Ju (u∗ |u(s) , v (s) ) = p0 (u∗ |v (s) ).
The Metropolis-Hastings acceptance ratio is then
r=

p0 (u∗ , v (s) )
Ju (u(s) |u∗ , v (s) )
×
p0 (u(s) , v (s) ) Ju (u∗ |u(s) , v (s) )

=

p0 (u∗ , v (s) ) p0 (u(s) |v (s) )
p0 (u(s) , v (s) ) p0 (u∗ |v (s) )

=

p0 (u∗ |v (s) )p0 (v (s) ) p0 (u(s) |v (s) )
p0 (u(s) |v (s) )p0 (v (s) ) p0 (u∗ |v (s) )

=

p0 (v (s) )
= 1,
p0 (v (s) )

and so if we propose a value from the full conditional distribution the acceptance probability is 1, and the algorithm is equivalent to the Gibbs sampler.
10.4.2 Why does the Metropolis-Hastings algorithm work?
A more general form of the Metropolis-Hastings algorithm is as follows: Given
a current value x(s) of X,
1. Generate x∗ from Js (x∗ |x(s) );
2. Compute the acceptance ratio
r=

p0 (x∗ )
Js (x(s) |x∗ )
×
;
p0 (x(s) ) Js (x∗ |x(s) )

3. Sample u ∼uniform(0, 1). If u < r set x(s+1) = x∗ , else set x(s+1) = x(s) .
Note that the proposal distribution may also depend on the iteration number
s. For example, the Metropolis-Hastings algorithm presented in the last section can be equivalently described by steps 1, 2 and 3 above by setting Js to
be equal to Ju for odd values of s and equal to Jv for even values. This makes
the algorithm alternately update values of U and V .
The primary restriction we place on Js (x∗ |x(s) ) is that it does not depend
on values in the sequence previous to x(s) . This restriction ensures that the
algorithm generates a Markov chain. We also want to choose Js so that the
Markov chain is able to converge to the target distribution p0 . For example,

10.4 Metropolis, Metropolis-Hastings and Gibbs

185

we want to make sure that every value of x such that p0 (x) > 0 will eventually
be proposed (and so accepted some fraction of the time), regardless of where
we start the Markov chain. An example in which this is not the case is where
the values of X having non-zero probability are the integers, and Js (x∗ |x(s) )
proposes x(s) ± 2 with equal probability. In this case the Metropolis-Hastings
algorithm produces a Markov chain, but the chain will only generate even
numbers if x(1) is even, and only odd number if x(1) is odd. This type of
Markov chain is called reducible, as the set of possible X-values can be divided
into non-overlapping sets (even and odd integers in this example), between
which the algorithm is unable to move. In contrast, we want our Markov chain
to be irreducible, that is, able to go from any one value of X to any other,
eventually.
Additionally, we will want Js to be such that the Markov chain is aperiodic
and recurrent. A value x is periodic with period k > 1 in a Markov chain if it
can only be visited every kth iteration. If x is periodic, then for every S there
are an infinite number of iterations s > S for which Pr(x(s) = x) = 0. Since
we want the distribution of x(s) to converge to p0 , we should make sure that if
p0 (x) > 0, then x is not periodic in our Markov chain. A Markov chain lacking
any periodic states is called aperiodic. Finally, if x(s) = x for some iteration
s, then this must mean that p0 (x) > 0. Therefore, we want our Markov chain
to be able to return to x from time to time as we run our chain (otherwise the
relative fraction of x’s in the chain will go to zero, even though p0 (x) > 0). A
value x is said to be recurrent if, when we continue to run the Markov chain
from x, we are guaranteed to eventually return to x. Clearly we want all of
the possible values of X to be recurrent in our Markov chain.
An irreducible, aperiodic and recurrent Markov chain is a very well behaved object. A theorem from probability theory says that the empirical distribution of samples generated from such a Markov chain will converge:
Theorem 2 (Ergodic Theorem) If {x(1) , x(2) , . . .} is an irreducible, aperiodic
and recurrent Markov chain, then there is a unique probability distribution π
such that as s → ∞,
(s)
• Pr(x
P ∈(s)A) →Rπ(A) for any set A;
1
• S
g(x ) → g(x)π(x) dx.

The distribution π is called the stationary distribution of the Markov chain.
It is called the stationary distribution because it has the following property:
If x(s) ∼ π,
and x(s+1) is generated from the Markov chain starting at x(s) ,
then Pr(x(s+1) ∈ A) = π(A).
In other words, if you sample x(s) from π and then generate x(s+1) conditional
on x(s) from the Markov chain, then the unconditional distribution of x(s+1)
is π. Once you are sampling from the stationary distribution, you are always
sampling from the stationary distribution.

186

10 Nonconjugate priors and Metropolis-Hastings algorithms

In most problems it is not too hard to construct Metropolis-Hastings algorithms that generate Markov chains that are irreducible, aperiodic and recurrent. For example, if p0 (x) is continuous, then using a normal proposal
distribution centered around the current value guarantees that Pr(x(s+1) ∈
A|x(s) = x) > 0 for every x, s and set A such that p0 (A) > 0. All of the
Metropolis-Hastings algorithms in this book generate Markov chains that are
irreducible, aperiodic and recurrent. As such, sequences of X-values generated from these algorithms can be used to approximate their stationary distributions. What is left to show is that the stationary distribution π for a
Metropolis-Hastings algorithm is equal to the distribution p0 we wish to approximate.
“Proof ” that π(x) = p0 (x)
The theorem above says that the stationary distribution of the MetropolisHastings algorithm is unique, and so if we show that p0 is a stationary distribution, we will have shown it is the stationary distribution. Our sketch of
a proof follows closely a proof from Gelman et al (2004) for the Metropolis
algorithm. In that proof and here, it is assumed for simplicity that X is a
discrete random variable. Suppose x(s) is sampled from the target distribution p0 , and then x(s+1) is generated from x(s) using the Metropolis-Hastings
algorithm. To show that p0 is the stationary distribution we need to show
that Pr(x(s+1) = x) = p0 (x).
Let xa and xb be any two values of X such that p0 (xa )Js (xb |xa ) ≥
p0 (xb )Js (xa |xb ). Then under the Metropolis-Hastings algorithm the probability that x(s) = xa and x(s+1) = xb is equal to the probability of
1. sampling x(s) = xa from p0 ;
2. proposing x∗ = xb from Js (x∗ |x(s) );
3. accepting x(s+1) = xb .
The probability of these three things occurring is their product:
Pr(x(s) = xa , x(s+1) = xb ) = p0 (xa ) × Js (xb |xa ) ×

p0 (xb ) Js (xa |xb )
p0 (xa ) Js (xb |xa )

= p0 (xb )Js (xa |xb ) .
On the other hand, the probability that x(s) = xb and x(s+1) = xa is the
probability that xb is sampled from p0 , that xa is proposed from Js (x∗ |x(s) )
and that xa is accepted as x(s+1) . But in this case the acceptance probability
is one because we assumed p0 (xa )Js (xb |xa ) ≥ p0 (xb )Js (xa |xb ). This means
that Pr(x(s) = xb , x(s+1) = xa ) = p0 (xb )Js (xa |xb ).
The above two calculations have shown that the probability of observing
x(s) and x(s+1) to be xa and xb , respectively, is the same as observing them
to be xb and xa respectively, for any two values xa and xb . The final step of
the proof is to use this fact to derive the marginal probability Pr(x(s+1) = x):

10.5 Combining the Metropolis and Gibbs algorithms

Pr(x(s+1) = x) =

X

=

X

187

Pr(x(s+1) = x, x(s) = xa )

xa

Pr(x(s+1) = xa , x(s) = x)

xa

= Pr(x(s) = x)
This completes the proof that Pr(x(s+1) = x) = p0 (x) if Pr(x(s) = x) = p0 (x).

10.5 Combining the Metropolis and Gibbs algorithms
In complex models it is often the case that conditional distributions are available for some parameters but not for others. In these situations we can combine
Gibbs and Metropolis-type proposal distributions to generate a Markov chain
to approximate the joint posterior distribution of all of the parameters. In this
section we do this in the context of estimating the parameters in a regression
model for time-series data where the errors are temporally correlated. In this
case, full conditional distributions are available for the regression parameters
but not the parameter describing the dependence among the observations.
Example: Historical CO2 and temperature data
Analyses of ice cores from East Antarctica have allowed scientists to deduce
historical atmospheric conditions of the last few hundred thousand years (Petit et al, 1999). The first plot of Figure 10.7 plots time-series of temperature
and carbon dioxide concentration on a standardized scale (centered and scaled
to have a mean of zero and a variance of one). The data include 200 values
of temperature measured at roughly equal time intervals, with time between
consecutive measurements being approximately 2,000 years. For each value of
temperature there is a CO2 concentration value corresponding to a date that
is roughly 1,000 years previous to the temperature value, on average. Temperature is recorded in terms of its difference from current present temperature
in degrees Celsius, and CO2 concentration is recorded in parts per million by
volume.
The plot indicates that the temporal history of temperature and CO2
follow very similar patterns. The second plot in Figure 10.7 indicates that CO2
concentration at a given time point is predictive of temperature following that
time point. One way to quantify this is by fitting a linear regression model for
temperature (Y ) as a function of CO2 (x). Ordinary least squares regression
ˆ |x] = −23.02+0.08x with a nominal standard
gives an estimated model of E[Y
error of 0.0038 for the slope term. The validity of this standard error relies
on the error terms in the regression model being independent and identically
distributed, and standard confidence intervals further rely on the errors being
normally distributed.

temp
CO2

−4e+05

−3e+05

−2e+05
year

−1e+05

temperature difference (deg C)
−8
−4
0 2

10 Nonconjugate priors and Metropolis-Hastings algorithms

standardized measurement
−2 −1 0
1
2
3

188

0e+00

●

●

●

●
●
●●
●●
●●● ●
●●
● ●●
●
●
●●
●
● ●
●
● ●
●●
●●
● ●●
●
●
●
●
●
●
●●
●●
●●●
●
●
● ● ●●
●●
●●
●
●
●
● ●
●
●
●●● ●
●
●
●
● ●● ●
●
●● ● ● ● ● ● ●●
●
●
● ●●●
●●
●
●●
●●
●●
●
● ●●●
●●●
●
●
● ●●
●
●●
● ●
●●●●
●●
●
●
●●●
●
●
●
●
●
●
●
●
●
●
●●
●●●
●●●
●
●
●
●
●
●●●
●●●
●●●
●
●
●
●
●
●
●●●●
●●●
● ● ● ●●
●
● ●● ●
●

180

220
260
CO2(ppmv)

0

−0.2

0.0

10

0.2

frequency
20
30

ACF
0.4 0.6

40

0.8

50

1.0

Fig. 10.7. Temperature and carbon dioxide data.

−4

−2

0
residual

2

4

0

5

10
lag

15

20

Fig. 10.8. Residual analysis for the least squares estimation.

These two assumptions are examined in the two residual diagnostic plots
in Figure 10.8. The first plot, a histogram of the residuals, indicates no serious deviation from non-normality. The second plot gives the autocorrelation
function of the residuals, and indicates a nontrivial correlation of 0.52 between residuals at consecutive time points. Such a positive correlation generally means that there is less information in the data, and less evidence for a
relationship between the two variables, than is assumed by the ordinary least
squares regression analysis.
10.5.1 A regression model with correlated errors
The ordinary regression model is

10.5 Combining the Metropolis and Gibbs algorithms



189



Y1
 .. 
Y =  .  ∼ multivariate normal(Xβ, σ 2 I).
Yn
The diagnostic plots suggest that a more appropriate model for the ice core
data is one in which the error terms are not independent, but temporally
correlated. This means we must replace the covariance matrix σ 2 I in the ordinary regression model with a matrix Σ that can represent positive correlation
between sequential observations. One simple, popular class of covariance matrices for temporally correlated data are those having first-order autoregressive
structure:


1
ρ ρ2 · · · ρn−1
 ρ
1 ρ · · · ρn−2 
 2



ρ 1
Σ = σ 2 Cρ = σ 2  ρ

 ..

..
..
 .

.
.
ρn−1 ρn−2

1

Under this covariance matrix the variance of {Yi |β, xi } is σ 2 but the correlation between Yi and Yi+t is ρt , which decreases to zero as the time difference
t becomes larger.
Having observed Y = y, the parameters to estimate in this model include β, σ 2 and ρ. Using the multivariate normal and inverse-gamma prior
distributions of Section 9.2.1 for β and σ 2 , it is left as an exercise to show
that
{β|X, y, σ 2 , ρ} ∼ multivariate normal(β n , Σn ) , where
−1 −1
2
Σn = (XT C−1
ρ X/σ + Σ0 )

(10.2)

−1
2
β n = Σn (XT C−1
ρ y/σ + Σ0 β 0 ) , and

{σ 2 |X, y, β, ρ} ∼ inverse-gamma([ν0 + n]/2, [ν0 σ02 + SSRρ ]/2) , where
SSRρ = (y − Xβ)T C−1
ρ (y − Xβ).
If β 0 = 0 and Σ0 has large diagonal entries, then β n is very close to
−1 T −1
(XT C−1
X Cρ y. If ρ were known this would be the generalized least
ρ X)
squares (GLS) estimate of β, a type of weighted least squares estimate that is
used when the error terms are not independent and identically distributed. In
such situations, both OLS and GLS provide unbiased estimates of β but the
GLS estimate has a lower variance. Bayesian analysis using a model that accounts for the correlated errors provides parameter estimates that are similar
to those of GLS, so for convenience we will refer to our analysis as “Bayesian
GLS.”
If we knew the value of ρ we could use the Gibbs sampler to approximate
p(β, σ 2 |X, y, ρ) by iteratively sampling from the full conditional distributions
given by the equations in 10.2. Of course ρ is unknown and so we will need to

190

10 Nonconjugate priors and Metropolis-Hastings algorithms

estimate it as well with our Markov chain. Unfortunately the full conditional
distribution for ρ will be nonstandard for most prior distributions, suggesting
that the Gibbs sampler is not applicable here and we may have to use a
Metropolis algorithm (although a discrete approximation to p(ρ|X, y, β, σ 2 )
could be used).
It is in situations like this that the generality of the Metropolis-Hastings
algorithm comes in handy. Recall that in this algorithm we are allowed to
use different proposal distributions at each step. We can iteratively update β,
σ 2 and ρ at different steps, making proposals with full conditional distributions for β and σ 2 (Gibbs proposals) and a symmetric proposal distribution
for ρ (a Metropolis proposal). Following the rules of the Metropolis-Hastings
algorithm, we accept with probability 1 any proposal coming from a full conditional distribution, whereas we have to calculate an acceptance probability
for proposals of ρ. Given {β (s) , σ 2(s) , ρ(s) }, a Metropolis-Hastings algorithm
to generate a new set of parameter values is as follows:
1. Update β: Sample β (s+1) ∼ multivariate normal(β n , Σn ), where β n and
Σn depend on σ 2(s) and ρ(s) .
2. Update σ 2 : Sample σ 2(s+1) ∼ inverse-gamma([ν0 + n]/2, [ν0 σ02 + SSRρ ]/2),
where SSRρ depends on β (s+1) and ρ(s) .
3. Update ρ:
a) Propose ρ∗ ∼ uniform(ρ(s) − δ, ρ(s) + δ). If ρ∗ < 0 then reassign it to
be |ρ∗ |. If ρ∗ > 1 reassign it to be 2 − ρ∗ .
b) Compute the acceptance ratio
r=

p(y|X, β (s+1) , σ 2(s+1) , ρ∗ )p(ρ∗ )
p(y|X, β (s+1) , σ 2(s+1) , ρ(s) )p(ρ(s) )

and sample u ∼ uniform(0,1). If u < r set ρ(s+1) = ρ∗ , otherwise set
ρ(s+1) = ρ(s) .
The proposal distribution used in Step 3.a is called a reflecting random walk ,
which ensures that 0 < ρ < 1. It is left as an exercise to show that this
proposal distribution is symmetric. We also leave it as an exercise to show
that the value of r given in Step 3.b is numerically equal to
p(β (s+1) , σ 2(s+1) , ρ∗ |y, X)
p(β (s+1) , σ 2(s+1) , ρ(s) |y, X)

,

the ratio as given in the definition of the Metropolis algorithm.
While technically the steps above constitute “three iterations” of the
Metropolis-Hastings algorithm, it is convenient to group them together as
one. A sequence of Metropolis-Hastings steps in which each parameter is updated is often referred to as a scan of the algorithm.

10.5 Combining the Metropolis and Gibbs algorithms

191

10.5.2 Analysis of the ice core data

0.55

0.0

0.2

0.65

ρ
0.75

ACF
0.4
0.6

0.8

0.85

1.0

We’ll use diffuse prior distributions for the parameters, with β 0 = 0, Σ0 =
diag(1000), ν0 = 1 and σ02 = 1. Our prior for ρ will be the uniform distribution on (0, 1). The first panel of Figure 10.9 plots the first 1,000 values
{ρ(1) , . . . , ρ(1000) } generated using the Metropolis-Hastings algorithm above.
The acceptance rate for these values is 0.322 which seems good, but the autocorrelation of the sequence, shown in the second panel, is very high. The
effective sample size for this correlated sequence of 1,000 ρ-values is only 23,
indicating that we will need many more iterations of the algorithm to obtain
a decent approximation to the posterior distribution.

0

200

400
600
scan

800

1000

0

5

10

15
lag

20

25

30

Fig. 10.9. The first 1,000 values of ρ generated from the Markov chain.

Suppose we were to generate 25,000 scans for a total of 25, 000 × 4 =
100, 000 parameter values. Storing and manipulating all of these values can
be tedious and somewhat unnecessary: Since the Markov chain is so highly
correlated, the values of ρ(s) and ρ(s+1) offer roughly the same information
about the posterior distribution. With this in mind, for highly correlated
Markov chains with moderate to large numbers of parameters we will often
only save a fraction of the scans of the Markov chain. This practice of throwing
away many iterations of a Markov chain is known as thinning. Figure 10.10
shows the thinned output of a 25,000-scan Markov chain for the ice core data,
in which only every 25th scan was saved. Thinning the output reduces it
down to a manageable 1,000 samples, having a much lower autocorrelation
than 1,000 sequential samples from an unthinned Markov chain.
The Monte Carlo approximation to the posterior density of β2 , the slope
parameter, appears in the first panel of Figure 10.11. The posterior mean of β2
is 0.028 and a posterior 95% quantile-based confidence interval is (0.01, 0.05),

10 Nonconjugate priors and Metropolis-Hastings algorithms

0.0

0.6

0.2

0.7

ρ

0.8

ACF
0.4
0.6

0.8

0.9

1.0

192

0

200

400
600
scan/25

800

1000

0

5

10

15 20
lag/25

25

30

Fig. 10.10. Every 25th value of ρ from a Markov chain of length 25,000.

indicating evidence that the relationship between CO2 and temperature is
positive. However, as indicated in the second plot this relationship seems
much weaker than that suggested by the OLS estimate of 0.08. For the OLS
estimation, the small number of data points with high y-values have a larger
amount of influence on the estimate of β. In contrast, the GLS model recognizes that many of these extreme points are highly correlated with one
another and down-weights their influence. We note that this “weaker” regression coefficient is a result of the temporally correlated data, and not of the
particular prior distribution we used or the Bayesian approach in general. The
reader is encouraged to repeat the analysis with different prior distributions,
or to perform a non-Bayesian GLS estimation for comparison. In any case,
the data analysis indicates evidence of a relationship between temperature
measurements and the CO2 measurements that precede them in time.

10.6 Discussion and further references
The Metropolis algorithm was introduced by Metropolis et al (1953) in an
application to a problem in statistical physics. The algorithm was generalized by Hastings (1970), but it was not until the publication of Gelfand and
Smith (1990) that MCMC became widely used in the statistics community.
See Robert and Casella (2008) for a brief history of Monte Carlo and MCMC
methods.
A number of modifications and extensions of MCMC methods have appeared since the 1990s. One technique that is broadly applicable is automatic,
adaptive tuning of the proposal distribution in order to achieve good mixing
(Gilks et al, 1998; Haario et al, 2001). Not all adaptive algorithms will result

10.6 Discussion and further references

193

●

GLS estimate
OLS estimate

0

−8

−6

temperature
−4 −2

0

posterior marginal density
10
20
30

2

●

0.00

0.02

β2

0.04

0.06

●

●
● ●
●● ● ●
●● ●
●● ●
● ● ●

● ●●
●
●●
●
●
●
●
●
●
● ● ● ●
●
●
●
●
●
●
●
●
● ●
● ●
●
●
●
●
●
●●
●
●
●
●●●
●
●
●
● ●●
●
●●●
●
●●
●
●●
●
● ●
● ● ●
●
●●
●
●
●
●
● ●
●● ●● ●
● ●●
●● ●
● ●●
●●
●
● ●●
●
●
●● ●
●
●
●
●
● ●
●●
●
●
●● ● ●
●
●
●
●●●
●●●
●● ●●
●● ● ● ●● ●●
● ●
●●
●
●●
● ●●
●●●● ● ●
●
●
●●
●
●
● ●
● ●
●
●●●●
●
●
●
●
●
●
●
●

180

200

220

240
CO2

260

280

Fig. 10.11. Posterior distribution of the slope parameter β2 , along with the posterior mean regression line.

in chains that converge to the target distribution, but there are known conditions under which convergence is guaranteed (Atchad´e and Rosenthal, 2005;
Roberts and Rosenthal, 2007).

11
Linear and generalized linear mixed effects
models

In Chapter 8 we learned about the concept of hierarchical modeling, a data
analysis approach that is appropriate when we have multiple measurements
within each of several groups. In that chapter, variation in the data was represented with a between-group sampling model for group-specific means, in
addition to a within-group sampling model to represent heterogeneity of observations within a group. In this chapter we extend the hierarchical model
to describe how relationships between variables may differ between groups.
This can be done with a regression model to describe within-group variation,
and a multivariate normal model to describe heterogeneity among regression
coefficients across the groups. We also cover estimation for hierarchical generalized linear models, which are hierarchical models that have a generalized
linear regression model representing within-group heterogeneity.

11.1 A hierarchical regression model
Let’s return to the math score data described in Section 8.4, which included
math scores of 10th grade children from 100 different large urban public high
schools. In Chapter 8 we estimated school-specific expected math scores, as
well as how these expected values varied from school to school. Now suppose we are interested in examining the relationship between math score
and another variable, socioeconomic status (SES), which was calculated from
parental income and education levels for each student in the dataset.
In Chapter 8 we quantified the between-school heterogeneity in expected
math score with a hierarchical model. Given the amount of variation we observed it seems possible that the relationship between math score and SES
might vary from school to school as well. A quick and easy way to assess this
possibility is to fit a linear regression model of math score as a function of
SES for each of the 100 schools in the dataset. To make the parameters more
interpretable we will center the SES scores within each school separately, so
that the sample average SES score within each school is zero. As a result, the
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 11,
c Springer Science+Business Media, LLC 2009


196

11 Linear and generalized linear mixed effects models

20
−2 −1

0
1
SES

2

10

●

●

●
●
●
●
●
●
●
●
●
●●
●
●
●●●●●
●●
● ●
●● ●
●
● ● ●
●
●
●●●●
● ● ●
●● ● ● ●
●●
●
●
●●
●
●
●
●
●● ●
●
●
●
●● ●
● ●
●
●
●
●
●●● ●
● ●
●
●
●
●
●

5

●
●●
●
●
● ●

10 15 20 25 30
sample size

slope
0
5

●

−5

math score
40
60

80

intercept
40 45 50 55 60 65

intercept of the regression line can be interpreted as the school-level average
math score.
●

●

●
● ● ●●
●
●
●
●
●
● ●
●
●
●
●
●
●●
●●
●
●
●
●
●●
●
●
●
●●●
●
●● ●●● ● ●
● ●
●● ●●
● ●● ●● ●
●
● ●
●
● ●
●● ●●
●
●
●
●●●
●
●
●● ●● ●
● ● ●
● ●
●
●
●
● ●●
●

5

10 15 20 25 30
sample size

Fig. 11.1. Least squares regression lines for the math score data, and plots of
estimates versus group sample size.

The first panel of Figure 11.1 plots least squares estimates of the regression
lines for the 100 schools, along with an average of these lines in black. A
large majority show an increase in expected math score with increasing SES,
although a few show a negative relationship. The second and third panels of
the figure relate the least squares estimates to sample size. Notice that schools
with the highest sample sizes have regression coefficients that are generally
close to the average, whereas schools with extreme coefficients are generally
those with low sample sizes. This phenomenon is reminiscent of what we
discussed in Section 8.4: The smaller the sample size for the group, the more
probable that unrepresentative data are sampled and an extreme least squares
estimate is produced. As in Chapter 8, our remedy to this problem will be
to stabilize the estimates for small sample size schools by sharing information
across groups, using a hierarchical model.
The hierarchical model in the linear regression setting is a conceptually
straightforward generalization of the normal hierarchical model from Chapter
8. We use an ordinary regression model to describe within-group heterogeneity
of observations, then describe between-group heterogeneity using a sampling
model for the group-specific regression parameters. Expressed symbolically,
our within-group sampling model is
Yi,j = β Tj xi,j + i,j , {i,j } ∼ i.i.d. normal(0, σ 2 ),

(11.1)

where xi,j is a p×1 vector of regressors for observation i in group j. Expressing
Y1,j , . . . , Ynj ,j as a vector Y j and combining x1,j , . . . , xnj ,j into an nj × p
matrix Xj , the within-group sampling model can be expressed equivalently
as Y j ∼ multivariate normal(Xj β j , σ 2 I), with the group-specific data vectors
Y 1 , . . . , Y m being conditionally independent given β 1 , . . . , β m and σ 2 .

11.1 A hierarchical regression model

197

The heterogeneity among the regression coefficients β 1 , . . . , β m will be described with a between-group sampling model. If we have no prior information
distinguishing the different groups we can model them as being exchangeable,
or (roughly) equivalently, as being i.i.d. from some distribution representing the sampling variability across groups. The normal hierarchical regression
model describes the across-group heterogeneity with a multivariate normal
model, so that
β 1 , . . . , β m ∼ i.i.d. multivariate normal(θ, Σ).

(11.2)

A graphical representation of the hierarchical model appears in Figure 11.2,
which makes clear that the multivariate normal distribution for β 1 , . . . , β m
is not a prior distribution representing uncertainty about a fixed but unknown quantity. Rather, it is a sampling distribution representing heterogeneity among a collection of objects. The values of θ and Σ are fixed but
unknown parameters to be estimated.
θ, Σ
β1

β2

···

β m−1

Y1

Y2

···

Y m−1 Y m

βm

σ2
Fig. 11.2. A graphical representation of the hierarchical normal regression model.

This hierarchical regression model is sometimes called a linear mixed effects model . This name is motivated by an alternative parameterization of
Equations 11.1 and 11.2. We can rewrite the between-group sampling model
as
βj = θ + γ j
γ 1 . . . , γ m ∼ i.i.d. multivariate normal(0, Σ).
Plugging this into our within-group regression model gives
Yi,j = β Tj xi,j + i,j
= θ T xi,j + γ Tj xi,j + i,j .
In this parameterization θ is referred to as a fixed effect as it is constant
across groups, whereas γ 1 , . . . , γ m are called random effects, as they vary.
The name “mixed effects model” comes from the fact that the regression
model contains both fixed and random effects. Although for our particular

198

11 Linear and generalized linear mixed effects models

example the regressors corresponding to the fixed and random effects are the
same, this does not have to be the case. A more general model would be
Yi,j = θ T xi,j + γ Tj z i,j + i,j , where xi,j and z i,j could be vectors of different
lengths which may or may not contain overlapping variables. In particular,
xi,j might contain regressors that are group specific, that is, constant across
all observations in the same group. Such variables are not generally included
in z i,j , as there would be no information in the data with which to estimate
the corresponding group-specific regression coefficients.
Given a prior distribution for (θ, Σ, σ 2 ) and having observed Y 1 =
y 1 , . . . , Y m = y m , a Bayesian analysis proceeds by computing the posterior
distribution p(β 1 , . . . , β m , θ, Σ, σ 2 |X1 , . . . , Xm , y 1 , . . . , y m ). If semiconjugate
prior distributions are used for θ, Σ and σ 2 , then the posterior distribution
can be approximated quite easily with Gibbs sampling. The classes of semiconjugate prior distributions for θ and Σ are as in the multivariate normal
model discussed in Chapter 7. The prior we will use for σ 2 is the usual inversegamma distribution.
θ ∼ multivariate normal(µ0 , Λ0 )
Σ ∼ inverse-Wishart(η0 , S−1
0 )
2
σ ∼ inverse-gamma(ν0 /2, ν0 σ02 /2)

11.2 Full conditional distributions
While computing the posterior distribution for so many parameters may seem
daunting, the calculations involved in computing the full conditional distributions have the same mathematical structure as models we have studied
in previous chapters. Once we have the full conditional distributions we can
iteratively sample from them to approximate the joint posterior distribution.
Full conditional distributions of β 1 , . . . , β m
Our hierarchical regression model shares information across groups via the
parameters θ, Σ and σ 2 . As a result, conditional on θ, Σ, σ 2 the regression
coefficients β 1 , . . . , β m are independent. Referring to the graph in Figure 11.2,
from the perspective of a given β j the model looks like an ordinary one-group
regression problem where the prior mean and variance for β j are θ and Σ.
This analogy is in fact correct, and the results of Section 9.2.1 show that
{β j |y j , Xj , θ, Σ, σ 2 } has a multivariate normal distribution with
Var[β j |y j , Xj , σ 2 , θ, Σ] = (Σ −1 + XTj Xj /σ 2 )−1
E[β j |y j , Xj , σ 2 , θ, Σ] = (Σ −1 + XTj Xj /σ 2 )−1 (Σ −1 θ + XTj y j /σ 2 ).

11.2 Full conditional distributions

199

Full conditional distributions of θ and Σ
Our sampling model for the β j ’s is that they are i.i.d. samples from a multivariate normal population with mean θ and variance Σ. Inference for the
population mean and variance of a multivariate normal population was covered in Chapter 7, in which we derived the full conditional distributions when
semiconjugate priors are used. There, we saw that the full conditional distribution of a population mean is multivariate normal with expectation equal to
a combination of the prior expectation and the sample mean, and precision
equal to the sum of the prior and data precisions. In the context of the hierarchical regression model, given Σ and our sample of regression coefficients
β 1 , . . . , β m , the full conditional distribution of θ is as follows:
{θ|β 1 , . . . , β m , Σ} ∼ multivariate normal(µm , Λm ) , where
−1 −1
Λm = (Λ−1
)
0 + mΣ
−1
¯
µm = Λm (Λ0 µ0 + mΣ −1 β)
¯ is the vector average 1 P β . In Chapter 7 we also saw that the full
where β
j
m
conditional distribution of a covariance matrix is an inverse-Wishart distribution, with sum of squares matrix equal to the prior sum of squares S0 plus
the sum of squares from the sample:
{Σ|θ, β 1 , . . . , β m } ∼ inverse-Wishart(η0 + m, [S0 + Sθ ]−1 ) , where
m
X
Sθ =
(β j − θ)(β j − θ)T .
j=1

Note that Sθ depends on θ and so must be recomputed each time θ is updated
in the Markov chain.
Full conditional distribution of σ 2
The parameter σ 2 represents the error variance, assumed to be common across
all groups. As such, conditional on β 1 , . . . , β m , the data provide information
about σ 2 via the sum of squared residuals from each group:
X
σ 2 ∼ inverse-gamma([ν0 +
nj ]/2, [ν0 σ02 + SSR]/2) , where
SSR =

nj
m X
X

(yi,j − β Tj xi,j )2 .

j=1 i=1

It is important to remember that SSR depends on the value of β j , and so SSR
must be recomputed in each scan of the Gibbs sampler before σ 2 is updated.

200

11 Linear and generalized linear mixed effects models

11.3 Posterior analysis of the math score data

posterior density
0.4 0.6 0.8 1.0

70

1.2

80

To analyze the math score data we will use a prior distribution that is similar
in spirit to the unit information priors that were discussed in Chapter 9. For
example, we’ll take µ0 , the prior expectation of θ, to be equal to the average of
the ordinary least squares regression estimates and the prior variance Λ0 to be
their sample covariance. Such a prior distribution represents the information
of someone with unbiased but weak prior information. For example, a 95%
prior confidence interval for the slope parameter θ2 under this prior is (3.86,8.60), which is quite a large range when considering what the extremes
of the interval imply in terms of average change in score per unit change in
SES score. Similarly, we will take the prior sum of squares matrix S0 to be
equal to the covariance of the least squares estimate, but we’ll take the prior
degrees of freedom η0 to be p + 2 = 4, so that the prior distribution of Σ
is reasonably diffuse but has an expectation equal to the sample covariance
of the least squares estimates. Finally, we’ll take σ02 to be the average of the
within-group sample variance but set ν0 = 1.

20

0.0

30

0.2

40

math score
50 60

θ2
~
β2

−6

−4

−2 0
2
4
slope parameter

6

8

−2

−1

0
SES

1

2

Fig. 11.3. Relationship between SES and math score. The first panel plots the
posterior density of the expected slope θ2 of a randomly sampled school, as well
as the posterior predictive distribution of a randomly sampled slope. The second
panel gives posterior expectations of the 100 school-specific regression lines, with
the average line given in black.

Running a Gibbs sampler for 10,000 scans and saving every 10th scan
produces a sequence of 1,000 values for each parameter, each sequence having
a fairly low autocorrelation. For example, the lag-10 autocorrelations of θ1 and
θ2 are -0.024 and 0.038. As usual, we can use these simulated values to make
Monte Carlo approximations to various posterior quantities of interest. For

11.4 Generalized linear mixed effects models

201

example, the first plot in Figure 11.3 shows the posterior distribution of θ2 ,
the expected within-school slope parameter. A 95% quantile-based posterior
confidence interval for this parameter is (1.83, 2.96), which, compared to our
prior interval of (-3.86, 8.60), indicates a strong alteration in our information
about θ2 .
The fact that θ2 is extremely unlikely to be negative only indicates that the
population average of school-level slopes is positive. It does not indicate that
any given within-school slope cannot be negative. To clarify this distinction,
the posterior predictive distribution of β˜2 , the slope for a to-be-sampled school,
is plotted in the same figure. Samples from this distribution can be generated
˜ (s) from a multivariate normal(θ (s) , Σ (s) ) distribution
by sampling a value β
for each scan s of the Gibbs sampler. Notice that this posterior predictive
distribution is much more spread out than the posterior distribution of θ2 ,
reflecting the heterogeneity in slopes across schools. Using the Monte Carlo
approximation, we have Pr(β˜2 < 0|y 1 , . . . , y m , X1 , . . . , Xm ) ≈ 0.07, which is
small but not negligible.
The second panel in Figure 11.3 plots posterior expectations of the 100
school-specific regression lines, with the line given by the posterior mean of θ
in black. Comparing this to the first panel of Figure 11.1 indicates how the
hierarchical model is able to share information across groups, shrinking extreme regression lines towards the across-group average. In particular, hardly
any of the slopes are negative when we share information across groups.

11.4 Generalized linear mixed effects models
As the name suggests, a generalized linear mixed effects model combines aspects of linear mixed effects models with those of generalized linear models
described in Chapter 10. Such models are useful when we have a hierarchical
data structure but the normal model for the within-group variation is not
appropriate. For example, if the variable Y were binary or a count, then more
appropriate models for within-group variation would be logistic or Poisson
regression models, respectively.
A basic generalized linear mixed model is as follows:
β 1 , . . . , β m ∼ i.i.d. multivariate normal(θ, Σ)
nj
Y
p(y j |Xj , β j , γ) =
p(yi,j |β Tj xi,j , γ),
i=1

with observations from different groups also being conditionally independent.
In this formulation p(y|β T x, γ) is a density whose mean depends on β T x, and
γ is an additional parameter often representing variance or scale. For example,
in the normal model p(y|β T x, γ) = dnorm(y, β T x, γ 1/2 ) where γ represents
the variance. In the Poisson model p(y|β T x) = dpois(exp{β T x}), and there
is no γ parameter.

202

11 Linear and generalized linear mixed effects models

11.4.1 A Metropolis-Gibbs algorithm for posterior approximation
Estimation for the linear mixed effects model was straightforward because
the full conditional distribution of each parameter was standard, allowing for
the easy implementation of a Gibbs sampling algorithm. In contrast, for nonnormal generalized linear mixed models, typically only θ and Σ have standard
full conditional distributions. This suggests we use a Metropolis-Hastings algorithm to approximate the posterior distribution of the parameters, using
a combination of Gibbs steps for updating (θ, Σ) with a Metropolis step for
updating each β j . In what follows we assume there is no γ parameter. If there
is such a parameter, it can be updated using a Gibbs step if a full conditional
distribution is available, and a Metropolis step if not.
Gibbs steps for (θ, Σ)
Just as in the linear mixed effects model, the full conditional distributions of θ
and Σ depend only on β 1 , . . . , β m . This means that the form of p(y|β T x) has
no effect on the full conditional distributions of θ and Σ. Whether p(y|β T x)
is a normal model, a Poisson model, or some other generalized linear model,
the full conditional distributions of θ and Σ will be the multivariate normal
and inverse-Wishart distributions described in Section 11.2.
Metropolis step for β j
Updating β j in a Markov chain can proceed by proposing a new value of β ∗j
based on the current parameter values and then accepting or rejecting it with
the appropriate probability. A standard proposal distribution in this situation
would be a multivariate normal distribution with mean equal to the current
(s)
(s)
value β j and with some proposal variance Vj . In this case the Metropolis
step is as follows:
(s)

(s)

1. Sample β ∗j ∼ multivariate normal(β j , Vj ).
2. Compute the acceptance ratio
r=

p(y j |Xj , β ∗j )p(β ∗j |θ (s) , Σ (s) )
(s)

(s)

p(y j |Xj , β j )p(β j |θ (s) , Σ (s) )
(s+1)

3. Sample u ∼ uniform(0,1). Set β j
(s)

.
(s)

to β ∗j if u < r and to β j

if u > r.

In many cases, setting Vj equal to a scaled version of Σ (s) produces a wellmixing Markov chain, although the task of finding the right scale might have
to proceed by trial and error.

11.4 Generalized linear mixed effects models

203

A Metropolis-Hastings approximation algorithm
Putting these steps together results in the following Metropolis-Hastings algorithm for approximating p(β 1 , . . . , β m , θ, Σ|X1 , . . . , Xm , y 1 , . . . , y m ): Given
current values at scan s of the Markov chain, we obtain new values as follows:
1. Sample θ (s+1) from its full conditional distribution.
2. Sample Σ (s+1) from its full conditional distribution.
3. For each j ∈ {1, . . . , m},
a) propose a new value β ∗j ;
(s+1)

b) set β j

(s)

equal to β ∗j or β j

with the appropriate probability.

11.4.2 Analysis of tumor location data
(From Haigis et al (2004)) A certain population of laboratory mice experiences
a high rate of intestinal tumor growth. One item of interest to researchers
is how the rate of tumor growth varies along the length of the intestine. To
study this, the intestine of each of 21 sample mice was divided into 20 sections
and the number of tumors occurring in each section was recorded. The first
panel of Figure 11.4 shows 21 lines, each one representing the observed tumor
counts of each of the mice plotted against the fraction of the length along their
intestine. Although it is hard to tell from the figure, the lines for some mice
are consistently below the average (given in black), and others are consistently
above. This suggests that tumor counts are more similar within a mouse than
between mice, and a hierarchical model with mouse-specific effects may be
appropriate.
A natural model for count data such as these is a Poisson distribution
with a log-link. Letting Yx,j be mouse j’s tumor count at location x of their
intestine, we will model Yx,j as Poisson(efj (x) ), where fj is a smoothly varying
function of x ∈ [0, 1]. A simple way to parameterize fj is as a polynomial, so
that fj (x) = β1,j + β2,j x + β3,j x2 + · · · + βp,j xp−1 for some maximum degree
p − 1. Such a parameterization allows us to represent each fj as a regression
on (1, x, x2 , . . . , xp−1 ).
Averaging across the 21 mice gives an observed average tumor count y¯x
at each of the 20 locations x ∈ (.05, .10, . . . , .95) along the intestine. This
average curve is plotted in the first panel of Figure 11.4 in black, and the log
of this curve is given in the second panel of the figure. Also in the second
panel are approximations of this curve using polynomials of degree 2, 3 and
4. The second- and third-degree approximations indicate substantial lack-offit, whereas the fourth-degree polynomial fits the log average tumor count
function rather well. For simplicity we’ll model each fj as a fourth-degree
polynomial, although it is possible that a particular fj may be better fit with
a higher degree.
Our between-group sampling model for the β j ’s will be as in the previous
section, so that β 1 , . . . , β m ∼ i.i.d. multivariate normal(θ, Σ). Unconditional

log average number of tumors
−1
0
1
2

11 Linear and generalized linear mixed effects models

number of tumors
5
10

15

204

3
4

44
4
3334
3

4
3
4222223
22
3
2
2
2
4
2
4
23
3
4
2
2 3
4
2 3
4
3
2 4
3
4
3
244
433
34
44
2
33
2

0

2
0.0

0.2

0.4
0.6
location

0.8

1.0

0.2

0.4
0.6
location

0.8

1.0

Fig. 11.4. Tumor count data. The first panel gives mouse-specific tumor counts as
a function of location in gray, with a population average in black. The second panel
gives quadratic, cubic and quartic polynomial fits to the log sample average tumor
count.

on β j , the observations coming from a given mouse are statistically dependent as determined by Σ. Estimating Σ in this mixed effects model allows us
to account for and describe potential within-mouse dependencies in the data.
The unknown parameters in this model are θ and Σ for which we need to
specify prior distributions. Using conjugate normal and inverse-Wishart prior
distributions, we need to specify µ and Λ0 for p(θ) and η0 and S0 for p(Σ).
Specifying reasonable values for this many parameters can be difficult, especially in the absence of explicit prior data. As an alternative, we’ll take an
approach based on unit information priors, in which the prior distributions
for the parameters are weakly centered around estimates derived from the observed data. As mentioned before, such prior distributions might represent the
prior information of someone with a small amount of unbiased information.
Our unit information prior requires estimates of θ and Σ, the population
mean and covariance of the β j ’s. For each mouse we can obtain a prelimi˜ by regressing {log(y1,j + 1/n), . . . , log(yn,j + 1/n)}
nary ad hoc estimate β
j
on {x1 , . . . , x20 }, where xi = (1, xi , x2i , x3i , x4i )T for xi ∈ (.05, .10, . . . , .95)
˜ using maximum likelihood estimates from
(alternatively, we could obtain β
j
a Poisson regression model). A unit-information type of prior distribution
for θ would
be a multivariate normal distribution with an expectation of
P
1
˜
µ= m
β
j=1 j and a prior covariance matrix equal to the sample covariance
˜
of the β j ’s. We also set S0 equal to this sample covariance matrix, but set
η0 = p + 2 = 7, so that the prior expectation of Σ is equal to S0 but the prior
distribution is relatively diffuse.

11.4 Generalized linear mixed effects models

205

In terms of MCMC posterior approximation, recall from the steps outlined in the previous subsection that values of θ and Σ can be sampled from
their full conditional distributions. The full conditional distributions of the
β j ’s, however, are not standard and so we’ll propose changes to these parameters from distributions centered around their current values. After a bit of
(s)
trial and error, it turns out that a multivariate normal(β j , Σ (s) /2) proposal
distribution yields an acceptance rate of about 31% and a reasonably wellmixing Markov chain. Running the Markov chain for 50,000 scans and saving
the values every 10th scan gives 5,000 approximate posterior samples for each
parameter. The effective sample sizes for the elements of Σ are all above 1,000
except for that of Σ11 , which was about 950. The effective sample sizes for the
five θ parameters are (674, 1003, 1092, 1129, 1145). This roughly means that
our Monte√Carlo standard error in approximating E[θ1 |y 1 , . . . , y m , X], for example, is 674 = 25.96 times smaller than the posterior standard error of θ1 .
Of course, we can reduce the Monte Carlo standard error to be as small as we
want by running the Markov chain for more iterations. R-code for generating
this Markov chain appears below:
## data
data ( c h a p t e r 1 1 )
Y<−XY. tumor$Y ; X<−XY. tumor$X ; m<−dim (Y ) [ 1 ] ; p<−dim (X ) [ 2 ]
## p r i o r s
BETA<−NULL
f o r ( j i n 1 :m)
{
BETA<−r b i n d (BETA, lm ( l o g (Y[ j ,]+1/20)˜ −1+X[ , , j ] ) $ c o e f )
}
mu0<−a p p ly (BETA, 2 , mean )
S0<−cov (BETA) ; eta0 <−p+2
iL0<−iSigma<−s o l v e ( S0 )
## MCMC
THETA. post <−NULL ; s e t . s e e d ( 1 )
for ( s in 1:50000)
{
##update t h e t a
Lm<−s o l v e ( i L 0 + m∗ iSigma )
mum<−Lm%∗%( i L 0%∗%mu0 + iSigma%∗%a pply (BETA, 2 , sum ) )
t h e t a <−t ( rmvnorm ( 1 ,mum,Lm) )
##
##update Sigma
mtheta<−m at r i x ( t h e t a ,m, p , byrow=TRUE)
iSigma<−r w i s h ( 1 , e t a 0+m,
s o l v e ( S0+t (BETA−mtheta)%∗%(BETA−mtheta ) ) )
##

206

11 Linear and generalized linear mixed effects models

##update b e t a
Sigma<−s o l v e ( iSigma ) ; dSigma<−d e t ( Sigma )
f o r ( j i n 1 :m)
{
b e t a . p<−t ( rmvnorm ( 1 ,BETA[ j , ] , . 5 ∗ Sigma ) )
l r <−sum ( d p o i s (Y[ j , ] , exp (X[ , , j ]%∗%b e t a . p ) , l o g=TRUE ) −
d p o i s (Y[ j , ] , exp (X[ , , j ]%∗%BETA[ j , ] ) , l o g=TRUE ) ) +
ldmvnorm ( t ( b e t a . p ) , t h e t a , Sigma ,
iSigma=iSigma , dSigma=dSigma ) −
ldmvnorm ( t (BETA[ j , ] ) , t h e t a , Sigma ,
iSigma=iSigma , dSigma=dSigma )
i f ( l o g ( r u n i f (1)) < l r ) { BETA[ j ,]<− b e t a . p }
}
##
##s t o r e some output
i f ( s%%10==0){THETA. post <−r b i n d (THETA. post , t ( t h e t a ) ) }
##

0.0 0.2 0.4 0.6 0.8 1.0
location

15
0

5

10

15
0

0

5

10

number of tumors
5
10
15

}

0.0 0.2 0.4 0.6 0.8 1.0
location

0.0 0.2 0.4 0.6 0.8 1.0
location

Fig. 11.5. 2.5, 50 and 97.5% quantiles for exp(θ T x), exp(β T x) and {Y |x}.

The three panels in Figure 11.5 show posterior distributions for a variety
of quantities. The first panel gives 2.5%, 50% and 97.5% posterior quantiles
for exp(θ T x). The second panel gives the same quantiles for the posterior
predictive distribution of exp(β T x). The difference in the width of the confidence bands is due to the estimated across-mouse heterogeneity. If there were
no across-mouse heterogeneity then Σ would be zero, each β j would be equal
to θ and the plots in the first two panels of the figure would be identical.
Finally, the third panel gives 2.5%, 50% and 97.5% quantiles of the posterior
predictive distribution of {Y |x} for each of the 20 values of x. The difference

11.5 Discussion and further references

207

between this plot and the one in the second panel is due to the variability
of a Poisson random variable Y around its expected value exp(β T x). The
widening confidence bands of the three plots in this figure describe cumulative sources of uncertainty: The first panel shows the uncertainty in the fixed
but unknown value of θ. The second panel shows this uncertainty in addition
to the uncertainty due to across-mouse heterogeneity. Finally, the third panel
includes both of these sources of uncertainty as well as that due to fluctuations of a mouse’s observed tumor counts around its own expected tumor
count function. Understanding these different sources of uncertainty can be
very relevant to inference and decision making: For example, if we want to
predict the observed tumor count distribution of a new mouse, we should use
the confidence bands in the third panel, whereas the bands in the first panel
would be appropriate if we just wanted to describe the uncertainty in the fixed
value of θ.

11.5 Discussion and further references
Posterior approximation via MCMC for hierarchical models can suffer from
poor mixing. One reason for this is that many of the parameters in the model
are highly correlated, and generating them one at a time in the Gibbs sampler
can lead to a high degree of autocorrelation. For example, θ and the β j ’s are
positively correlated, and so an extreme value of θ at one iteration can lead
to extreme values of the β j ’s when they get updated, especially if the amount
of within-group data is low. This in turn leads to an extreme value of θ at the
next iteration. Section 15.4 of Gelman et al (2004) provides a detailed discussion of several alternative Gibbs sampling strategies for improving mixing for
hierarchical models. Improvements also can be made by careful reparameterizations of the model (Gelfand et al, 1995; Papaspiliopoulos et al, 2007).

12
Latent variable methods for ordinal data

Many datasets include variables whose distributions cannot be represented
by the normal, binomial or Poisson distributions we have studied thus far.
For example, distributions of common survey variables such as age, education
level and income generally cannot be accurately described by any of the abovementioned sampling models. Additionally, such variables are often binned into
ordered categories, the number of which may vary from survey to survey. In
such situations, interest often lies not in the scale of each individual variable,
but rather in the associations between the variables: Is the relationship between two variables positive, negative or zero? What happens if we “account”
for a third variable? For normally distributed data these types of questions
can be addressed with the multivariate normal and linear regression models
of Chapters 7 and 9. In this chapter we extend these models to situations
where the data are not normal, by expressing non-normal random variables
as functions of unobserved, “latent” normally distributed random variables.
Multivariate normal and linear regression models then can be applied to the
latent data.

12.1 Ordered probit regression and the rank likelihood
Suppose we are interested in describing the relationship between the educational attainment and number of children of individuals in a population.
Additionally, we might suspect that an individual’s educational attainment
may be influenced by their parent’s education level. The 1994 General Social
Survey provides data on variables DEG, CHILD and PDEG for a sample of
individuals in the United States, where DEGi indicates the highest degree
obtained by individual i, CHILDi is their number of children and PDEGi is
the binary indicator of whether or not either parent of i obtained a college
degree. Using these data, we might be tempted to investigate the relationship
between the variables with a linear regression model:
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 12,
c Springer Science+Business Media, LLC 2009


210

12 Latent variable methods for ordinal data

DEGi = β1 + β2 × CHILDi + β3 × PDEGi + β4 × CHILDi × PDEGi + i ,

probability
0.20

0.0

0.00

0.1

0.10

probability
0.2
0.3

0.4

0.30

0.5

where we assume that 1 , . . . , n ∼ i.i.d. normal(0, σ 2 ). However, such a model
would be inappropriate for a couple of reasons. Empirical distributions of DEG
and CHILD for a sample of 1,002 males in the 1994 workforce are shown in
Figure 12.1. The value of DEG is recorded as taking a value in {1, 2, 3, 4, 5}
corresponding to the highest degree of the respondent being no degree, high
school degree, associate’s degree, bachelor’s degree, or graduate degree.

1

2

3
DEG

4

5

0

1

2

3

4 5
CHILD

6

7

8

Fig. 12.1. Two ordinal variables having non-normal distributions.

Since the variable DEG takes on only a small set of discrete values, the
normality assumption of the residuals will certainly be violated. But perhaps
more importantly, the regression model imposes a numerical scale to the data
that is not really present: A bachelor’s degree is not “twice as much” as a
high school degree, and an associate’s degree is not “two less” than a graduate
degree. There is an order to the categories in the sense that a graduate degree
is “higher” than a bachelor’s degree, but otherwise the scale of DEG is not
meaningful.
Variables for which there is a logical ordering of the sample space are
known as ordinal variables. With this definition, the discrete variables DEG
and CHILD are ordinal variables, as are “continuous” variables like height or
weight. However, CHILD, height and weight are variables that are measured
on meaningful numerical scales, whereas DEG is not. In this chapter we will
use the term “ordinal” to refer to any variable for which there is a logical
ordering of the sample space. We will use the term “numeric” to refer to
variables that have meaningful numerical scales, and “continuous” if a variable
can have a value that is (roughly) any real number in an interval. For example,

12.1 Ordered probit regression and the rank likelihood

211

DEG is ordinal but not numeric, whereas CHILD is ordinal, numeric and
discrete. Variables like height or weight are ordinal, numeric and continuous.
12.1.1 Probit regression
Linear or generalized linear regression models, which assume a numeric scale
to the data, may be appropriate for variables like CHILD, height or weight,
but are not appropriate for non-numeric ordinal variables like DEG. However,
it is natural to think of many ordinal, non-numeric variables as arising from
some underlying numeric process. For example, the severity of a disease might
be described “low”, “moderate” or “high”, although we imagine a patient’s
actual condition lies within a continuum. Similarly, the amount of effort a
person puts into formal education may lie within a continuum, but a survey
may only record a rough, categorized version of this variable, such as DEG.
This idea motivates a modeling technique known as ordered probit regression,
in which we relate a variable Y to a vector of predictors x via a regression in
terms of a latent variable Z. More precisely, the model is
1 , . . . , n ∼ i.i.d. normal(0, 1)
Zi = β T xi + i
Yi = g(Zi ),

(12.1)
(12.2)

where β and g are unknown parameters. For example, to model the conditional distribution of DEG given CHILD and PDEG we would let Yi be DEGi
and let xi = (CHILDi , PDEGi , CHILDi ×PDEGi ). The regression coefficients
β describe the relationship between the explanatory variables and the unobserved latent variable Z, and the function g relates the value of Z to the
observed variable Y . The function g is taken to be non-decreasing, so that
we can interpret small and large values of Z as corresponding to small and
large values of Y . This also means that the sign of a regression coefficient βj
indicates whether Y is increasing or decreasing in xj .
Notice that in this probit regression model we have taken the variance
of 1 , . . . , n to be one. This is because the scale of the distribution of Y can
already be represented by g, as g is allowed to be any non-decreasing function.
Similarly, g can represent the location of the distribution of Y , and so we do
not need to include an intercept term in the model.
If the sample space for Y takes on K values, say {1, . . . , K}, then the
function g can be described with only K − 1 ordered parameters g1 < g2 <
· · · < gk−1 as follows:
y = g(z) = 1 if −∞ = g0 < z < g1
= 2 if
g1 < z < g2
..
.
= K if

gK−1 < z < gK = ∞ .

(12.3)

212

12 Latent variable methods for ordinal data

The values {g1 , . . . , gK−1 } can be thought of as “thresholds,” so that moving z past a threshold moves y into the next highest category. The unknown parameters in the model include the regression coefficients β and the
thresholds g1 , . . . , gK−1 . If we use normal prior distributions for these quantities, the joint posterior distribution of {β, g1 , . . . , gK−1 , Z1 , . . . , Zn } given
Y = y = (y1 , . . . , yn ) can be approximated using a Gibbs sampler.
Full conditional distribution of β
Given Y = y, Z = z, and g = (g1 . . . , gK−1 ), the full conditional distribution of β depends only on z and satisfies p(β|y, z, g) ∝ p(β)p(z|β).
Just as in ordinary regression, a multivariate normal prior distribution for
β gives a multivariate normal posterior distribution. For example, if we use
β ∼ multivariate normal(0, n(XT X)−1 ), then p(β|z) is multivariate normal
with
n
Var[β|z] =
(XT X)−1 , and
n+1
n
E[β|z] =
(XT X)−1 XT z.
n+1
Full conditional distribution of Z
The full conditional distributions of the Zi ’s are only slightly more complicated. Under the sampling model, the conditional distribution of Zi given β
is Zi ∼ normal(β T xi , 1). Given g, observing Yi = yi tells us that Zi must lie
in the interval (gyi −1 , gyi ). Letting a = gyi −1 and b = gyi , the full conditional
distribution of Zi given {β, y, g} is then
p(zi |β, y, g) ∝ dnorm(zi , β T xi , 1) × δ(a,b) (zi ).
This is the density of a constrained normal distribution. To sample a value x
from a normal(µ, σ 2 ) distribution constrained to the interval (a, b), we perform
the following two steps:
1. sample u ∼ uniform(Φ[(a − µ)/σ], Φ[(b − µ)/σ])
2. set x = µ + σΦ−1 (u)
where Φ and Φ−1 are the cdf and inverse-cdf of the standard normal distribution (given by pnorm and qnorm in R). Code to sample from the full
conditional distribution of Zi is as follows:
ez<− t ( b e t a)%∗%X[ i , ]
a<−max(− I n f , g [ y [ i ] − 1 ] , na . rm=TRUE)
b<−min ( g [ y [ i ] ] , I n f , na . rm=TRUE)
u<−r u n i f ( 1 , pnorm ( a−e z ) , pnorm ( b−e z ) )
z [ i ]<− e z + qnorm ( u )

The added complexity in assigning a and b in the above code is to deal with
the special cases g0 = −∞ and gK = ∞.

12.1 Ordered probit regression and the rank likelihood

213

Full conditional distribution of g
Suppose the prior distribution for g is some arbitrary density p(g). Given
Y = y and Z = z, we know from Equation 12.3 that gk must be higher
than all zi ’s for which yi = k and lower than all zi ’s for which yi = k + 1.
Letting ak = max{zi : yi = k} and bk = min{zi : yi = k + 1} the full
conditional distribution of g is then proportional to p(g) but constrained to
the set {g : ak < gk < bk }. For example, if p(g) is proportional to the product
QK−1
k=1 dnorm(gk , µk , σk ) but constrained so that g1 < · · · < gk−1 , then the
full conditional density of gk is a normal(µk , σk2 ) density constrained to the
interval (ak , bk ). R-code to sample from the full conditional distribution of gk
is given below:
a<−max( z [ y==k ] )
b<−min ( z [ y==k +1])
u<−r u n i f ( 1 , pnorm ( ( a−mu [ k ] ) / s i g [ k ] ) , pnorm ( ( b−mu [ k ] ) / s i g [ k ] ) )
g [ k]<− mu [ k ] + s i g [ k ] ∗ qnorm ( u )

Example: Educational attainment

●

●
●
●
●
●

6

7
●
●
●
●
●
●
●

●
●

prior
posterior

5

●
●

PDEG=0
PDEG=1

●

density
3
4

2
1
z

●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

●

●

●

0

−3

0

●
●
●
●

2

●
●

●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

1

●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●

3
−1

●
●

−2

4

Some researchers suggest that having children reduces opportunities for educational attainment (Moore and Waite, 1977). Here we examine this hypothesis in a sample of males in the labor force (meaning not retired, not
in school and not in an institution), obtained from the 1994 General Social
Survey. For 959 of the 1,002 survey respondents we have complete data on
the variables DEG, CHILD and PDEG described above. Letting Yi = DEGi

0

2

4
6
number of children

8

−0.4

−0.2

0.0
β3

Fig. 12.2. Results from the probit regression analysis.

0.2

0.4

214

12 Latent variable methods for ordinal data

and xi = (CHILDi , PDEGi , CHILDi × PDEGi ), we will estimate the parameters in the ordered probit regression model using
prior distributions of β ∼
QK−1
multivariate normal(0, n(XT X)−1 ) and p(g) ∝ k=1 dnorm(gk , 0, 100) but
constrained so that g1 < · · · < gK−1 . We’ll approximate the corresponding
posterior distribution of {β, Z, g} with a Gibbs sampler consisting of 25,000
scans. Saving parameter values every 25th scan results in 1,000 values for each
parameter with which to approximate the posterior distribution. The posterior
mean regression line for people without a college-educated parent (xi,2 = 0)
is E[Z|y, x1 , x2 = 0] = −0.024 × x1 while the regression line for people with a
college-educated parent is E[Z|y, x1 , x2 = 1] = 0.818 + 0.054 × x1 . These lines
are shown in the first panel of Figure 12.2, along with the value of Z that
was obtained in the last scan of the Gibbs sampler. The lines suggest that
for people whose parents did not go to college, the number of children they
have is indeed weakly negatively associated with their educational outcome.
However, the opposite seems to be true among people whose parents went to
college. The posterior distribution of β3 is given in the second panel of the figure, along with the prior distribution for comparison. The 95% quantile-based
posterior confidence interval for β3 is (-0.026,0.178), which contains zero but
still represents a reasonable amount of evidence that the slope for the x2 = 1
group is larger than that of the x2 = 0 group.
12.1.2 Transformation models and the rank likelihood
The analysis of the educational attainment data above required us to specify a
prior distribution for β and the transformation g(z), as specified by the vector
g of K − 1 threshold parameters. While simple default prior distributions for
β exist (such as Zellner’s g-prior), the same is not true for g. Coming up with
a prior distribution for g that represents actual prior information seems like a
difficult task. Of course, this task is much harder if the number of categories
K is large. For example, the incomes (INC) of the subjects in the 1994 GSS
dataset were each recorded as belonging to one of 21 ordered categories, so that
a regression in which Yi = INCi would require that g includes 20 parameters.
Estimation and prior specification for such a large number of parameters can
be difficult.
Fortunately there is an alternative approach to estimating β that does not
require us to estimate the function g(z). Note that if the Zi ’s were observed
directly, then we could ignore Equation (12.2) of the model and we would
be left with an ordinary regression problem without having to estimate the
transformation g(z). Unfortunately we do not observe the Zi ’s directly, but
there is information in the data about the Zi ’s that does not require us to
specify g(z): Since we know that g is non-decreasing, we do know something
about the order of the Zi ’s. For example, if our observed data are such that
y1 > y2 , then since yi = g(Zi ), we know that g(Z1 ) > g(Z2 ). Since g is
non-decreasing, this means that we know Z1 > Z2 . In other words, having
observed Y = y, we know that the Zi ’s must lie in the set

12.1 Ordered probit regression and the rank likelihood

215

R(y) = {z ∈ Rn : zi1 < zi2 if yi1 < yi2 }.
Since the distribution of the Zi ’s does not depend on g, the probability that
Z ∈ R(y) for a given y also does not depend on the unknown function g. This
suggests that we base our posterior inference on the knowledge that Z ∈ R(y).
Our posterior distribution for β in this case is given by
p(β|Z ∈ R(y)) ∝ p(β) × Pr(Z ∈ R(y)|β)
Z
n
Y
= p(β) ×
dnorm(zi , β T xi , 1) dzi .
R(y) i=1

As a function of β, the probability Pr(Z ∈ R(y)|β) is known as the rank
likelihood . For continuous y-variables this likelihood was introduced by Pettitt
(1982) and its theoretical properties were studied by Bickel and Ritov (1997).
It is called a rank likelihood because for continuous data it contains the same
information about y as knowing the ranks of {y1 , . . . , yn }, i.e. which one has
the highest value, which one has the second highest value, etc. If Y is discrete
then observing R(y) is not exactly the same as knowing the ranks, but for
simplicity we will still refer to Pr(Z ∈ R(y)|β) as the rank likelihood, whether
or not Y is discrete or continuous. The important thing to note is that for any
ordinal outcome variable Y (non-numeric, numeric, discrete or continuous),
information about β can be obtained from Pr(Z ∈ R(y)|β) without having
to specify g(z).
For any given β the value of Pr(Z ∈ R(y)|β) involves a very complicated
integral that is difficult to compute. However, by estimating Z simultaneously
with β we can obtain an estimate of β without ever having to numerically
compute Pr(Z ∈ R(y)|β). The joint posterior distribution of {β, Z} can be
approximated by using Gibbs sampling, alternately sampling from full conditional distributions. The full conditional distribution of β is very easy: Given
a current value z of Z, the full conditional density p(β|Z = z, Z ∈ R(y)) reduces to p(β|Z = z) because knowing the value of Z is more informative than
knowing just that Z lies in the set R(y). A multivariate normal prior distribution for β then results in a multivariate normal full conditional distribution,
as before. The full conditional distributions of the Zi ’s are also straightforward to derive. Let’s consider the full conditional distribution of Zi given
{β, Z ∈ R(y), z −i }, where z −i denotes the values of all of the Z’s except Zi .
Conditional on β, Zi is normal(β T xi , 1). Conditional on {β, Z ∈ R(y), z −i },
the density of Zi is proportional to a normal density but constrained by the
fact that Z ∈ R(y). Let’s recall the nature of this constraint: yi < yj implies
Zi < Zj , and yi > yj implies Zi > Zj . This means that Zi must lie in the
following interval:
max{zj : yj < yi } < Zi < min{zj : yi < yj } .
Letting a and b denote the numerical values of the lower and upper endpoints
of this interval, the full conditional distribution of Zi is then

216

12 Latent variable methods for ordinal data

p(zi |β, Z ∈ R(y), z −i ) ∝ dnorm(zi , β T xi , 1) × δ(a,b) (zi ).
This full conditional distribution is exactly the same as that of Zi in the ordered probit model, except that now the constraints on Zi are determined
directly by the current value Z −i , instead of on the threshold variables. As
such, sampling from this full conditional distribution is very similar to sampling from the analogous distribution in the probit regression model:
ez<− t ( b e t a)%∗%X[ i , ]
a<−max( z [ y<y [ i ] ] )
b<−min ( z [ y [ i ]<y ] )
u<−r u n i f ( 1 , pnorm ( a−e z ) , pnorm ( b−e z ) )
z [ i ]<− e z + qnorm ( u )

−0.15

−0.05 0.05
β1

2
0

0

0.0

2

4

1.0

4

density
6 8

2.0

6

3.0

10 12

Not surprisingly, for the educational attainment data the posterior distribution of β based on the rank likelihood is very similar to the one based on
the full ordered probit model. The three panels of Figure 12.3 indicate that
the marginal posterior densities of β1 , β2 and β3 are nearly identical under
the two models. In general, if K is small and n is large, we expect the two
methods to behave similarly. However, the rank likelihood approach is applicable to a wider array of datasets since with this approach, Y is allowed to be
any type of ordinal variable, discrete or continuous. The drawback to using
the rank likelihood is that it does not provide us with inference about g(z),
which describes the relationship between the latent and observed variables. If
this parameter is of interest, then the rank likelihood is not appropriate, but
if interest lies only in β, then the rank likelihood provides a simple alternative
to the ordered probit model.

0.4

0.8
β2

1.2

−0.1

0.1
β3

0.2

0.3

Fig. 12.3. Marginal posterior distributions of (β1 , β2 , β3 ), under the ordinal probit
regression model (in gray) and the rank likelihood (in black).

12.2 The Gaussian copula model

217

12.2 The Gaussian copula model
The regression model above is somewhat limiting because it only describes
the conditional distribution of one variable given the others. In general, we
may be interested in the relationships among all of the variables in a dataset.
If the variables were approximately jointly normally distributed, or at least
were all measured on a meaningful numerical scale, then we could describe
the relationships among the variables with the sample covariance matrix or a
multivariate normal model. However, such a model is inappropriate for nonnumeric ordinal variables like INC, DEG and PDEG. To accommodate variables such as these we can extend the ordered probit model above to a latent,
multivariate normal model that is appropriate for all types of ordinal data,
both numeric and non-numeric. Letting Y 1 , . . . , Y n be i.i.d. random samples
from a p-variate population, our latent normal model is
Z 1 , . . . , Z n ∼ i.i.d. multivariate normal(0, Ψ )
Yi,j = gj (Zi,j ) ,

(12.4)
(12.5)

where g1 , . . . , gp are non-decreasing functions and Ψ is a correlation matrix,
having diagonal entries equal to 1. In this model, the matrix Ψ represents the
joint dependencies among the variables and the functions g1 , . . . , gp represent
their marginal distributions. To see how the gj ’s represent the margins, let’s
calculate the marginal cdf Fj (y) of a continuous random variable Yi,j under
the model given by Equations 12.4 and 12.5. Recalling the definition of the
cdf, we have
Fj (y) = Pr(Yi,j ≤ y)
= Pr(gj (Zi,j ) ≤ y) , since Yi,j = gj (Zi,j )
= Pr(Zi,j ≤ gj−1 (y))
= Φ(gj−1 (y)),
where Φ(z) is the cdf of the standard normal distribution. The last line holds
because the diagonal entries of Ψ are all equal to 1, and so the marginal
distribution of each Zi,j is a standard normal distribution with cdf Φ(z).
The above calculations show that Fj (y) = Φ(gj−1 (y)), indicating that the
marginal distributions of the Yj ’s are fully determined by the gj ’s and do
not depend on the matrix Ψ . A model having separate parameters for the
univariate marginal distributions and the multivariate dependencies is generally called a copula model . The model given by Equations 12.4 and 12.5,
where the dependence is described by a multivariate normal distribution, is
called the multivariate normal copula model . The term “copula” refers to the
method of “coupling” a model for multivariate dependence (such as the multivariate normal distribution) to a model for the marginal distributions of
the data. As shown above, a copula model separates the parameters for the
dependencies among the variables (Ψ ) from the parameters describing their

218

12 Latent variable methods for ordinal data

univariate marginal distributions (g1 , . . . , gp ). This separation comes in handy
if we are primarily interested in the dependencies among the variables and not
the univariate scales on which they were measured. In this case, the functions
g1 , . . . , gp are nuisance parameters and the parameter of interest is Ψ . Using
an extension of the rank likelihood described in the previous section, we will
be able to obtain a posterior distribution for Ψ without having to estimate or
specify prior distributions for the nuisance parameters g1 , . . . , gp .
12.2.1 Rank likelihood for copula estimation
The unknown parameters in the copula model are the matrix Ψ and the nondecreasing functions g1 , . . . , gp . Bayesian inference for all of these parameters
would require that we specify a prior for Ψ as well as p prior distributions
over the complicated space of arbitrary non-decreasing functions. If we are
not interested in g1 , . . . , gp then we can use a version of the rank likelihood
which quantifies information about Z 1 , . . . , Z n without having to specify these
nuisance parameters. Recall that since each gj is non-decreasing, observing the
n × p data matrix Y tells us that the matrix of latent variables Z must lie in
the set
R(Y) = {Z : zi1 ,j < zi2 ,j if yi1 ,j < yi2 ,j }.
(12.6)
The probability of this event, Pr(Z ∈ R(Y)|Ψ ), does not depend on g1 , . . . , gp .
As a function of Ψ , Pr(Z ∈ R(Y)|Ψ ) is called the rank likelihood for the
multivariate normal copula model. Computing the likelihood for a given value
of Ψ is very difficult, but as with the regression model in Section 12.1.2 we can
make an MCMC approximation to p(Ψ, Z|Z ∈ R(Y)) using Gibbs sampling,
provided we use a prior for Ψ based on the inverse-Wishart distribution.
A parameter-expanded prior distribution for Ψ
Unfortunately there is no simple conjugate class of prior distributions for our
correlation matrix Ψ . As an alternative, let’s consider altering Equation 12.4
to be
Z 1 , . . . , Z n ∼ i.i.d. multivariate normal(0, Σ),
where Σ is an arbitrary covariance matrix, not restricted to be a correlation
matrix like Ψ . In this case a natural prior distribution for Σ would be an
inverse-Wishart distribution, which would give an inverse-Wishart full conditional distribution and thus make posterior inference available via Gibbs
sampling. However, careful inspection of the rank likelihood indicates that
it does not provide us with a complete estimate of Σ. Specifically, the rank
likelihood contains only information about the relative ordering among the
Zi,j ’s, and no information about their scale. For example, if Z1,j and Z2,j
are two i.i.d. samples from a normal(0, σj2 ) distribution, then the probability
that Z1,j < Z2,j does not depend on σj2 . For this reason we say that the diagonal entries of Σ are non-identifiable in this model, meaning that the rank

12.2 The Gaussian copula model

219

likelihood provides no information about what the diagonal should be. In a
Bayesian analysis, the posterior distribution of any non-identifiable parameter
is determined by the prior distribution, and so in some sense the posterior distribution of such a parameter is not of interest. However, to each covariance
matrix Σ there corresponds a unique correlation matrix Ψ , obtained by the
function
q
Ψ = h(Σ) = {σi,j / σi2 σj2 }.
The value of Ψ is identifiable from the rank likelihood, and so one estimation approach for the Gaussian copula model is to reparameterize the model
in terms of a non-identifiable covariance matrix Σ, but focus our posterior
inference on the identifiable correlation matrix Ψ = h(Σ). This technique of
modeling in terms of a non-identifiable parameter in order to simplify calculations is referred to as parameter expansion (Liu and Wu, 1999), and has been
used in the context of modeling multivariate ordinal data by Hoff (2007) and
Lawrence et al (2008).
To summarize, we will base our posterior distribution on
Σ ∼ inverse-Wishart(ν0 , S−1
0 )
Z 1 , . . . , Z n ∼ i.i.d. multivariate normal(0, Σ)
Yi,j = gj (Zi,j ),

(12.7)

but our estimation and inference will be restricted to Ψ = h(Σ). Interestingly,
the posterior distribution for Ψ obtained from this prior and model is exactly
the same as that which would be obtained from the following:
Σ
Ψ
Z 1, . . . , Z n
Yi,j

∼ inverse-Wishart(ν0 , S−1
0 )
= h(Σ)
∼ i.i.d. multivariate normal(0, Ψ )
= gj (Zi,j ).

(12.8)

In other words, the non-identifiable model described in Equation 12.7 gives the
same posterior distribution for Ψ as the identifiable model in Equation 12.8 in
which the prior distribution for Ψ is defined by {Σ ∼ inverse-Wishart(ν0 , S−1
0 ) ,
Ψ = h(Σ)}. The only difference is that the Gibbs sampling scheme for Equation 12.7 is easier to formulate. The equivalence of these two models relies on
the scale invariance of the rank likelihood, and so will not generally hold for
other types of models involving correlation matrices.
Full conditional distribution of Σ
If the prior distribution for Σ is inverse-Wishart(ν0 , S−1
0 ), then, as described
in Section 7.3, the full conditional distribution of Σ is inverse-Wishart as well.
We review this fact here by first noting that the probability density of the n×p
matrix Z can be written as

220

12 Latent variable methods for ordinal data

p(Z|Σ) =

n
Y

1
(2π)−p/2 |Σ|−1/2 exp{− z i Σ −1 z i }
2
i=1

= (2π)−np/2 |Σ|−n/2 exp{−tr(ZT ZΣ −1 )/2},
where “tr(A)” stands for the trace of matrix A, which is the sum of the
diagonal elements of A. The full conditional distribution p(Σ|Z, Z ∈ R(Y)) =
p(Σ|Z) is then given by
p(Σ|Z) ∝ p(Σ) × p(Z|Σ)
∝ |Σ|−(ν0 +p+1)/2 exp{−tr(S0 Σ −1 )/2} × |Σ|−n/2 exp{−tr(ZT ZΣ −1 )/2}
= |Σ|−([ν0 +n]+p+1)/2 exp{−tr([S0 + ZT Z]Σ −1 /2}
which is proportional to an inverse-Wishart(ν0 + n, [S0 + ZT Z]−1 ) density.
Full conditional distribution of Z
Recall from Section 5 of Chapter 7 that if Z is a random multivariate
normal(0, Σ) vector, then the conditional distribution of Zj , given the other
elements Z −j = z −j , is a univariate normal distribution with mean and variance given by
E[Zj |Σ, z −j ] = Σj,−j (Σ−j,−j )−1 z −j
Var[Zj |Σ, z −j ] = Σj,j − Σj,−j (Σ−j,−j )−1 Σ−j,j ,
where Σj,−j refers to the jth row of Σ with the jth column removed, and
Σ−j,−j refers to Σ with both the jth row and column removed. If in addition
we condition on the information that Z ∈ R(Y), then we know that
max{zk,j : yk,j < yi,j } < Zi,j < min{zk,j : yi,j < yk,j }.
These two pieces of information imply that the full conditional distribution
of Zi,j is a constrained normal distribution, which can be sampled from using
the procedure described in the previous section and in the following R-code:
Sz<− Sigma [ j ,− j ]%∗% s o l v e ( Sigma[− j ,− j ] )
sz<− s q r t ( Sigma [ j , j ] − S j c%∗%Sigma[− j , j ] )
ez<− Z [ i ,− j ]%∗%t ( S j c )
a<−max( Z [ Y[ i , j ]>Y[ , j ]
b<−min ( Z [ Y[ i , j ]<Y[ , j ]

, j ] , na . rm=TRUE)
, j ] , na . rm=TRUE)

u<−r u n i f ( 1 , pnorm ( ( a−e z ) / s z ) ,
Z [ i , j ]<− e z + s z ∗qnorm ( u )

pnorm ( ( b−e z ) / s z )

)

12.2 The Gaussian copula model

221

Missing data
The expression na.rm=TRUE in the above code allows for the possibility
of missing data. Instead of throwing out the rows of the data matrix that
contain some missing values, we would like to use all of the data we can. If
the values are missing-at-random as described in Section 7.5, then they can
simply be treated as unknown parameters and their values imputed using the
Gibbs sampler. For the Gaussian copula model, this imputation happens at
the level of the latent variables. For example, suppose that variable j for case
i is not recorded, i.e. yi,j is not available. As described above, the full conditional distribution of Zi,j given Z i,−j is normal. If yi,j were observed then the
conditional distribution of Zi,j would be a constrained normal, as observing
yi,j imposes a constraint on the allowable values of Zi,j . But if yi,j is missing then no such constraint is imposed, and the full conditional distribution
of Zi,j is simply the original unconstrained normal distribution. The R-code
above handles this as follows: If Yi,j is missing, then Z[ Y[i , j]>Y[,j ] , j ]
is a vector of missing values. The option na.rm=TRUE removes all of these
missing values, so a is the maximum of an empty set, which is defined to be
−∞. Similarly, b will be set to ∞.
Example: Social mobility data
The results of the probit regression of DEG on the variables PDEG and
CHILD in the last section indicate that the educational level of an individual
is related to that of their parents. In this section we analyze this further, by
examining the joint relationships among respondent-specific variables DEG,
CHILD, INC along with analogous parent-specific variables PDEG, PCHILD
and PINC. In this data analysis PDEG is a five-level categorical variable with
the same levels as DEG, recording the highest degree of the respondent’s
mother or father. PCHILD is the number of siblings of the respondent, and
so is roughly the number of children of the respondent’s parents. The variable
PINC is a five-level ordered categorical variable recording the respondent’s
parent’s financial status when the respondent was 16 years of age. Finally,
we also include AGE, the respondent’s age in years. Although not of primary
interest, heterogeneity in a person’s income, number of children and degree
category is likely to be related to age.
Using an inverse-Wishart(p + 2, (p + 2) × I) prior distribution for Σ having
a prior mean of E[Σ] = I, we can implement a Gibbs sampling algorithm using
the full conditional distributions described above. Iterating the algorithm for
25,000 scans, saving parameter values every 25th scan, gives a total of 1,000
values of each parameter with which to approximate the posterior distribution
of Ψ = h(Σ). The Monte Carlo estimate of the posterior mean of Ψ is

222

12 Latent variable methods for ordinal data




1.00 0.48 0.29 0.13 0.17 −0.05 0.34
 0.48 1.00 −0.04 0.20 0.46 −0.21 0.05 


 0.29 −0.04 1.00 −0.15 −0.25 0.22 0.59 



E[Ψ |y 1 , . . . , y n ] = 
 0.13 0.20 −0.15 1.00 0.44 −0.22 −0.13  ,
 0.17 0.46 −0.25 0.44 1.00 −0.29 −0.23 


 −0.05 −0.21 0.22 −0.22 −0.29 1.00 0.12 
0.34 0.05 0.59 −0.13 −0.23 0.12 1.00
where the columns and rows are, in order, INC, DEG, CHILD, PINC, PDEG,
PCHILD and AGE. We also may be interested in the “regression coefficients”
β j|−j = Ψj,−j (Ψ−j,−j )−1 , which for each variable j is a vector of length j − 1
that describes how the conditional mean of Zj depends on the remaining
variables Z−j . Figure 12.4 summarizes the posterior distributions of each β j|−j
(except for that of AGE) as follows: A 95% quantile-based confidence interval
is obtained for each β j,k . If the confidence interval does not contain zero, a
line between variables j and k is drawn, with a “+” or a “−” indicating the
sign of the posterior median. If the interval does contain zero, no line is drawn
between the variables.
Such a graph is sometimes referred to as a dependence graph, which summarizes the conditional dependencies among the variables. Roughly speaking,
two variables in the graph are conditionally independent given the other variables if there is no line between them. More precisely, the absence of a line
indicates the lack of strong evidence of a conditional dependence. For example, although there is a positive marginal dependence between INC and PINC,
the graph indicates that there is little evidence of any conditional dependence,
given the other variables.

+
DEG

PDEG

+

+
−
−

−

PINC

−

INC

+
+

CHILD

PCHILD

Fig. 12.4. Reduced conditional dependence graph for the GSS data.

12.3 Discussion and further references

223

12.3 Discussion and further references
Normally distributed latent variables are often used to induce dependence
among a set of non-normal observed variables. For example, Chib and Winkelmann (2001) present a model for a vector of correlated count data in which
each component is a Poisson random variable with a mean depending on a
component-specific latent variable. Dependence among the count variables is
induced by modeling the vector of latent variables with a multivariate normal
distribution. Similar approaches are proposed by Dunson (2000) and described
in Chapter 8 of Congdon (2003). Pitt et al (2006) discuss Bayesian inference
for Gaussian copula models when the margins are known parametric families,
and Quinn (2004) presents a factor analysis model for mixed continuous and
discrete outcomes, in which the continuous variables are treated parametrically.
Pettitt (1982) develops the rank likelihood to estimate parameters in a
latent normal regression model, allowing the transformation from the latent
data to continuous observed data to be treated nonparametrically. Hoff (2007)
extends this type of likelihood to accommodate both continuous and discrete
ordinal data, and provides a Gibbs sampler for parameter estimation in a
semiparametric Gaussian copula model.
The rank likelihood is based on the marginal distribution of the ranks,
and so is called a marginal likelihood. Marginal likelihoods are typically constructed so that they use the information in the data that depends only on
the parameters of interest, and do not use any information that depends on
nuisance parameters. Marginal likelihoods do not generally provide efficient
estimation, as they throw away part of the information in the data. However, they can turn a very difficult semiparametric estimation problem into
essentially a parametric one. The use of marginal likelihoods in the context
of Bayesian estimation is discussed in Monahan and Boos (1992).

Exercises

Chapter 2
2.1 Marginal and conditional probability: The social mobility data from Section 2.5 gives a joint probability distribution on (Y1 , Y2 )= (father’s occupation, son’s occupation). Using this joint distribution, calculate the
following distributions:
a) the marginal probability distribution of a father’s occupation;
b) the marginal probability distribution of a son’s occupation;
c) the conditional distribution of a son’s occupation, given that the father
is a farmer;
d) the conditional distribution of a father’s occupation, given that the
son is a farmer.
2.2 Expectations and variances: Let Y1 and Y2 be two independent random
variables, such that E[Yi ] = µi and Var[Yi ] = σi2 . Using the definition of
expectation and variance, compute the following quantities, where a1 and
a2 are given constants:
a) E[a1 Y1 + a2 Y2 ] , Var[a1 Y1 + a2 Y2 ];
b) E[a1 Y1 − a2 Y2 ] , Var[a1 Y1 − a2 Y2 ].
2.3 Full conditionals: Let X, Y, Z be random variables with joint density (discrete or continuous) p(x, y, z) ∝ f (x, z)g(y, z)h(z). Show that
a) p(x|y, z) ∝ f (x, z), i.e. p(x|y, z) is a function of x and z;
b) p(y|x, z) ∝ g(y, z), i.e. p(y|x, z) is a function of y and z;
c) X and Y are conditionally independent given Z.
2.4 Symbolic manipulation: Prove the following form of Bayes’ rule:
Pr(E|Hj ) Pr(Hj )
Pr(Hj |E) = PK
k=1 Pr(E|Hk ) Pr(Hk )
where E is any event and {H1 , . . . , HK } form a partition. Prove this using
only axioms P1-P3 from this chapter, by following steps a)-d) below:
a) Show that Pr(Hj |E) Pr(E) = Pr(E|Hj ) Pr(Hj ).
P.D. Hoff, A First Course in Bayesian Statistical Methods,
Springer Texts in Statistics, DOI 10.1007/978-0-387-92407-6 BM2,
c Springer Science+Business Media, LLC 2009


226

2.5

2.6

2.7

2.8

Exercises

b) Show that Pr(E) = Pr(E ∩ H1 ) + Pr(E ∩ {∪K
k=2 Hk }).
PK
c) Show that Pr(E) = k=1 Pr(E ∩ Hk ).
d) Put it all together to show Bayes’ rule, as described above.
Urns: Suppose urn H is filled with 40% green balls and 60% red balls, and
urn T is filled with 60% green balls and 40% red balls. Someone will flip
a coin and then select a ball from urn H or urn T depending on whether
the coin lands heads or tails, respectively. Let X be 1 or 0 if the coin lands
heads or tails, and let Y be 1 or 0 if the ball is green or red.
a) Write out the joint distribution of X and Y in a table.
b) Find E[Y ]. What is the probability that the ball is green?
c) Find Var[Y |X = 0], Var[Y |X = 1] and Var[Y ]. Thinking of variance as
measuring uncertainty, explain intuitively why one of these variances
is larger than the others.
d) Suppose you see that the ball is green. What is the probability that
the coin turned up tails?
Conditional independence: Suppose events A and B are conditionally independent given C, which is written A⊥B|C. Show that this implies that
Ac ⊥B|C, A⊥B c |C, and Ac ⊥B c |C, where Ac means “not A.” Find an
example where A⊥B|C holds but A⊥B|C c does not hold.
Coherence of bets: de Finetti thought of subjective probability as follows:
Your probability p(E) for event E is the amount you would be willing to
pay or charge in exchange for a dollar on the occurrence of E. In other
words, you must be willing to
• give p(E) to someone, provided they give you $1 if E occurs;
• take p(E) from someone, and give them $1 if E occurs.
Your probability for the event E c =“not E” is defined similarly.
a) Show that it is a good idea to have p(E) ≤ 1.
b) Show that it is a good idea to have p(E) + p(E c ) = 1.
Interpretations of probability: One abstract way to define probability is
via measure theory, in that Pr(·) is simply a “measure” that assigns mass
to various events. For example, we can “measure” the number of times a
particular event occurs in a potentially infinite sequence, or we can “measure” our information about the outcome of an unknown event. The above
two types of measures are combined in de Finetti’s theorem, which tells
us that an exchangeable model for an infinite binary sequence Y1 , Y2 , . . .
is equivalent to modeling the sequence as conditionally i.i.d. given a parameter θ, where Pr(θ < c) represents our information that the long-run
frequency of 1’s is less than c. With this in mind, discuss the different
ways in which probability could be interpreted in each of the following
scenarios. Avoid using the word “probable” or “likely” when describing
probability. Also discuss the different ways in which the events can be
thought of as random.
a) The distribution of religions in Sri Lanka is 70% Buddhist, 15% Hindu,
8% Christian, and 7% Muslim. Suppose each person can be identified

Exercises

227

by a number from 1 to K on a census roll. A number x is to be
sampled from {1, . . . , K} using a pseudo-random number generator
on a computer. Interpret the meaning of the following probabilities:
i. Pr(person x is Hindu);
ii. Pr(x = 6452859);
iii. Pr(Person x is Hindu|x=6452859).
b) A quarter which you got as change is to be flipped many times. Interpret the meaning of the following probabilities:
i. Pr(θ, the long-run relative frequency of heads, equals 1/3);
ii. Pr(the first coin flip will result in a heads);
iii. Pr(the first coin flip will result in a heads | θ = 1/3).
c) The quarter above has been flipped, but you have not seen the outcome. Interpret Pr(the flip has resulted in a heads).

Chapter 3
3.1 Sample survey: Suppose we are going to sample 100 individuals from
a county (of size much larger than 100) and ask each sampled person
whether they support policy Z or not. Let Yi = 1 if person i in the sample
supports the policy, and Yi = 0 otherwise.
a) Assume Y1 , . . . , Y100 are, conditional on θ, i.i.d. binary random variables with expectation θ. Write down the joint distribution of Pr(Y1 =
y1 , .P
. . , Y100 = y100 |θ) in a compact form. Also write down the form of
Pr( Yi = y|θ).
b) For the moment, suppose you believed that θ ∈ {0.0, 0.1, . . . , 0.9, 1.0}.
P100
Given
i=1 Yi = 57, compute
P that the results of the survey were
Pr( Yi = 57|θ) for each of these 11 values of θ and plot these probabilities as a function of θ.
c) Now suppose you originally had no prior information to believe one of
these θ-values over another, and so Pr(θ = 0.0) = Pr(θ = 0.1)
Pn= · · · =
Pr(θ = 0.9) = Pr(θ = 1.0). Use Bayes’ rule to compute p(θ| i=1 Yi =
57) for each θ-value. Make a plot of this posterior distribution as a
function of θ.
d) Now suppose you allow θ to be any value in the interval [0, 1]. Using
the uniform prior P
density for θ, so that p(θ) = 1, plot the posterior
n
density p(θ) × Pr( i=1 Yi = 57|θ) as a function of θ.
e) As discussed in this chapter, the posterior distribution of θ is beta(1 +
57, 1 + 100 − 57). Plot the posterior density as a function of θ. Discuss
the relationships among all of the plots you have made for this exercise.
3.2 Sensitivity analysis: It is sometimes useful to express the parameters a
and b in a beta distribution in terms of θ0 = a/(a + b) and n0 = a + b,
so that a = θ0 n0 and b = (1 − θ0 )n0 . Reconsidering the sample survey
data in Exercise 3.1, for each combination of θ0 ∈ {0.1, 0.2, . . . , 0.9} and
n0 ∈ {1, 2, 8, 16, 32} find the corresponding a, b values and compute Pr(θ >

228

Exercises

P
0.5| Yi = 57) using a beta(a, b) prior distribution for θ. Display the
results with a contour plot, and discuss how the plot could be used to
explain to someone whether
P100 or not they should believe that θ > 0.5,
based on the data that i=1 Yi = 57.
3.3 Tumor counts: A cancer laboratory is estimating the rate of tumorigenesis
in two strains of mice, A and B. They have tumor count data for 10 mice
in strain A and 13 mice in strain B. Type A mice have been well studied,
and information from other laboratories suggests that type A mice have
tumor counts that are approximately Poisson-distributed with a mean of
12. Tumor count rates for type B mice are unknown, but type B mice are
related to type A mice. The observed tumor counts for the two populations
are
y A = (12, 9, 12, 14, 13, 13, 15, 8, 15, 6);
y B = (11, 11, 10, 9, 9, 8, 7, 10, 6, 8, 8, 9, 7).
a) Find the posterior distributions, means, variances and 95% quantilebased confidence intervals for θA and θB , assuming a Poisson sampling
distribution for each group and the following prior distribution:
θA ∼ gamma(120,10), θB ∼ gamma(12,1), p(θA , θB ) = p(θA )×p(θB ).
b) Compute and plot the posterior expectation of θB under the prior distribution θB ∼ gamma(12×n0 , n0 ) for each value of n0 ∈ {1, 2, . . . , 50}.
Describe what sort of prior beliefs about θB would be necessary in order for the posterior expectation of θB to be close to that of θA .
c) Should knowledge about population A tell us anything about population B? Discuss whether or not it makes sense to have p(θA , θB ) =
p(θA ) × p(θB ).
3.4 Mixtures of beta priors: Estimate the probability θ of teen recidivism
based on a study in which there were n = 43 individuals released from
incarceration and y = 15 re-offenders within 36 months.
a) Using a beta(2,8) prior for θ, plot p(θ), p(y|θ) and p(θ|y) as functions
of θ. Find the posterior mean, mode, and standard deviation of θ.
Find a 95% quantile-based confidence interval.
b) Repeat a), but using a beta(8,2) prior for θ.
c) Consider the following prior distribution for θ:
p(θ) =

1 Γ (10)
[3θ(1 − θ)7 + θ7 (1 − θ)],
4 Γ (2)Γ (8)

which is a 75-25% mixture of a beta(2,8) and a beta(8,2) prior distribution. Plot this prior distribution and compare it to the priors in a)
and b). Describe what sort of prior opinion this may represent.
d) For the prior in c):
i. Write out mathematically p(θ) × p(y|θ) and simplify as much as
possible.

Exercises

229

ii. The posterior distribution is a mixture of two distributions you
know. Identify these distributions.
iii. On a computer, calculate and plot p(θ) × p(y|θ) for a variety of θ
values. Also find (approximately) the posterior mode, and discuss
its relation to the modes in a) and b).
e) Find a general formula for the weights of the mixture distribution in
d)ii, and provide an interpretation for their values.
3.5 Mixtures of conjugate priors: Let p(y|φ) = c(φ)h(y) exp{φt(y)} be an
exponential family model and let p1 (φ), . . . pK (φ) be K different members
of the conjugate class of prior densities
PKgiven in Section 3.3. A mixture of
conjugate priors is given
by
p
˜
(θ)
=
k=1 wk pk (θ), where the wk ’s are all
P
greater than zero and
wk = 1 (see also Diaconis and Ylvisaker (1985)).
a) Identify the general form of the posterior distribution of θ, based on
n i.i.d. samples from p(y|θ) and the prior distribution given by p˜.
b) Repeat a) but in the special case that p(y|θ) = dpois(y, θ) and
p1 , . . . , pK are gamma densities.
3.6 Exponential family expectations: Let p(y|φ) = c(φ)h(y) exp{φt(y)} be an
exponential family model.
a) Take
derivatives with respect to φ of both sides of the equation
R
p(y|φ) dy = 1 to show that E[t(Y )|φ] = −c0 (φ)/c(φ).
b) Let p(φ) ∝ c(φ)n0 en0 t0 φ be the prior distribution for φ. Calculate
dp(φ)/dφ and, using the fundamental theorem of calculus, discuss
what must be true so that E[−c(φ)/c(φ)] = t0 .
3.7 Posterior prediction: Consider a pilot study in which n1 = 15 children
enrolled in special education classes were randomly selected and tested
for a certain type of learning disability. In the pilot study, y1 = 2 children
tested positive for the disability.
a) Using a uniform prior distribution, find the posterior distribution of
θ, the fraction of students in special education classes who have the
disability. Find the posterior mean, mode and standard deviation of
θ, and plot the posterior density.
Researchers would like to recruit students with the disability to participate in a long-term study, but first they need to make sure they can recruit
enough students. Let n2 = 278 be the number of children in special education classes in this particular school district, and let Y2 be the number
of students with the disability.
b) Find Pr(Y2 = y2 |Y1 = 2), the posterior predictive distribution of Y2 ,
as follows:
i. Discuss what assumptions are needed about the joint distribution
of (Y1 , Y2 ) such that the following is true:
Z 1
Pr(Y2 = y2 |Y1 = 2) =
Pr(Y2 = y2 |θ)p(θ|Y1 = 2) dθ .
0

ii. Now plug in the forms for Pr(Y2 = y2 |θ) and p(θ|Y1 = 2) in the
above integral.

230

Exercises

iii. Figure out what the above integral must be by using the calculus
result discussed in Section 3.1.
c) Plot the function Pr(Y2 = y2 |Y1 = 2) as a function of y2 . Obtain the
mean and standard deviation of Y2 , given Y1 = 2.
d) The posterior mode and the MLE (maximum likelihood estimate; see
Exercise 3.14) of θ, based on data from the pilot study, are both
ˆ and find the mean
θˆ = 2/15. Plot the distribution Pr(Y2 = y2 |θ = θ),
ˆ Compare these results to
and standard deviation of Y2 given θ = θ.
the plots and calculations in c) and discuss any differences. Which
distribution for Y2 would you use to make predictions, and why?
3.8 Coins: Diaconis and Ylvisaker (1985) suggest that coins spun on a flat
surface display long-run frequencies of heads that vary from coin to coin.
About 20% of the coins behave symmetrically, whereas the remaining
coins tend to give frequencies of 1/3 or 2/3.
a) Based on the observations of Diaconis and Ylvisaker, use an appropriate mixture of beta distributions as a prior distribution for θ, the
long-run frequency of heads for a particular coin. Plot your prior.
b) Choose a single coin and spin it at least 50 times. Record the number
of heads obtained. Report the year and denomination of the coin.
c) Compute your posterior for θ, based on the information obtained in
b).
d) Repeat b) and c) for a different coin, but possibly using a prior for
θ that includes some information from the first coin. Your choice of
a new prior may be informal, but needs to be justified. How the results from the first experiment influence your prior for the θ of the
second coin may depend on whether or not the two coins have the
same denomination, have a similar year, etc. Report the year and
denomination of this coin.
3.9 Galenshore distribution: An unknown quantity Y has a Galenshore(a, θ)
distribution if its density is given by
p(y) =

2 2a 2a−1 −θ2 y2
θ y
e
Γ (a)

for y > 0, θ > 0 and a > 0. Assume for now that a is known. For this
density,
Γ (a + 1/2)
a
E[Y ] =
, E[Y 2 ] = 2 .
θΓ (a)
θ
a) Identify a class of conjugate prior densities for θ. Plot a few members
of this class of densities.
b) Let Y1 , . . . , Yn ∼ i.i.d. Galenshore(a, θ). Find the posterior distribution
of θ given Y1 , . . . , Yn , using a prior from your conjugate class.
c) Write down p(θa |Y1 , . . . , Yn )/p(θb |Y1 , . . . , Yn ) and simplify. Identify a
sufficient statistic.
d) Determine E[θ|y1 , . . . , yn ].

Exercises

231

e) Determine the form of the posterior predictive density p(˜
y |y1 . . . , yn ).
3.10 Change of variables: Let ψ = g(θ), where g is a monotone function of θ,
and let h be the inverse of g so that θ = h(ψ). If pθ (θ) is the probability
density of θ, then the probability density of ψ induced by pθ is given by
dh
pψ (ψ) = pθ (h(ψ)) × | dψ
|.
a) Let θ ∼ beta(a, b) and let ψ = log[θ/(1 − θ)]. Obtain the form of pψ
and plot it for the case that a = b = 1.
b) Let θ ∼ gamma(a, b) and let ψ = log θ. Obtain the form of pψ and
plot it for the case that a = b = 1.
3.12 Jeffreys’ prior: Jeffreys (1961) suggested a default rule for generating a
prior distribution of a parameter
θ in a sampling model p(y|θ). Jeffreys’
p
prior is given by pJ (θ) ∝ I(θ) , where I(θ) = −E[∂ 2 log p(Y |θ)/∂θ2 |θ]
is the Fisher information.
a) Let Y ∼ binomial(n, θ). Obtain Jeffreys’ prior distribution pJ (θ) for
this model.
b) Reparameterize the binomial sampling model with ψ = log θ/(1 − θ),
so that p(y|ψ) = ny eψy (1 + eψ )−n . Obtain Jeffreys’ prior distribution
pJ (ψ) for this model.
c) Take the prior distribution from a) and apply the change of variables
formula from Exercise 3.10 to obtain the induced prior density on ψ.
This density should be the same as the one derived in part b) of this
exercise. This consistency under reparameterization is the defining
characteristic of Jeffrey’s’ prior.
3.13 Improper Jeffreys’ prior: Let Y ∼ Poisson(θ).
a) Apply Jeffreys’ procedure to this model, and compare the result to the
family of gamma densities. Does Jeffreys’ procedure
p produce an actual
probability density for θ? In other words, can I(θ) be proportional
to an actual probability density for θ ∈ (0, ∞)?
p
b) Obtain the form of the function f (θ, y) =
I(θ) × p(y|θ). What
probability
density
for
θ
is
f
(θ,
y)
proportional
to? Can we think of
R
f (θ, y)/ f (θ, y)dθ as a posterior density of θ given Y = y?
3.14 Unit information prior: Let Y1 , . . . , Yn ∼ i.i.d. p(y|θ). Having observed
the values Y1 = y1 , . . . , Yn = yn , the log likelihood is given by l(θ|y) =
P
log p(yi |θ), and the value θˆ of θ that maximizes l(θ|y) is called the
maximum likelihood estimator . The negative of the curvature of the loglikelihood, J(θ) = −∂ 2 l(θ|y)/∂θ2 , describes the precision of the MLE θˆ
and is called the observed Fisher information. For situations in which it
is difficult to quantify prior information in terms of a probability distribution, some have suggested that the “prior” distribution be based on
the likelihood, for example, by centering the prior distribution around the
ˆ To deal with the fact that the MLE is not really prior information,
MLE θ.
the curvature of the prior is chosen so that it has only “one nth” as much
information as the likelihood, so that −∂ 2 log p(θ)/∂θ2 = J(θ)/n. Such a
prior is called a unit information prior (Kass and Wasserman, 1995; Kass

232

Exercises

and Raftery, 1995), as it has as much information as the average amount
of information from a single observation. The unit information prior is
not really a prior distribution, as it is computed from the observed data.
However, it can be roughly viewed as the prior information of someone
with weak but accurate prior information.
ˆ
a) Let Y1 , . . . , Yn ∼ i.i.d. binary(θ). Obtain the MLE θˆ and J(θ)/n.
b) Find a probability density pU (θ) such that log pU (θ) = l(θ|y)/n +
c, where c is a constant that does not depend on θ. Compute the
information −∂ 2 log pU (θ)/∂θ2 of this density.
c) Obtain a probability density for θ that is proportional to pU (θ) ×
p(y1 , . . . , yn |θ). Can this be considered a posterior distribution for θ?
d) Repeat a), b) and c) but with p(y|θ) being the Poisson distribution.

Chapter 4
4.1 Posterior comparisons: Reconsider the sample survey in Exercise 3.1. Suppose you are interested in comparing the rate of support in that county to
the rate in another county. Suppose that a survey of sample size 50 was
done in the second county, and the total number of people in the sample
who supported the policy was 30. Identify the posterior distribution of θ2
assuming a uniform prior. Sample 5,000 values of each of θ1 and θ2 from
their posterior distributions and estimate Pr(θ1 < θ2 |the data and prior).
4.2 Tumor count comparisons: Reconsider the tumor count data in Exercise
3.3:
a) For the prior distribution given in part a) of that exercise, obtain
Pr(θB < θA |y A , y B ) via Monte Carlo sampling.
b) For a range of values of n0 , obtain Pr(θB < θA |y A , y B ) for θA ∼
gamma(120, 10) and θB ∼ gamma(12×n0 , n0 ). Describe how sensitive
the conclusions about the event {θB < θA } are to the prior distribution
on θB .
c) Repeat parts a) and b), replacing the event {θB < θA } with the event
{Y˜B < Y˜A }, where Y˜A and Y˜B are samples from the posterior predictive distribution.
4.3 Posterior predictive checks: Let’s investigate the adequacy of the Poisson model for the tumor count data. Following the example in Section
(1)
(1000)
(s)
4.4, generate posterior predictive datasets y A , . . . , y A
. Each y A is a
(s)
sample of size nA = 10 from the Poisson distribution with parameter θA ,
(s)
θA is itself a sample from the posterior distribution p(θA |y A ), and y A is
the observed data.
(s)
a) For each s, let t(s) be the sample average of the 10 values of y A ,
(s)
divided by the sample standard deviation of y A . Make a histogram
(s)
of t and compare to the observed value of this statistic. Based on
this statistic, assess the fit of the Poisson model for these data.

Exercises

233

b) Repeat the above goodness of fit evaluation for the data in population
B.
4.4 Mixtures of conjugate priors: For the posterior density from Exercise 3.4:
a) Make a plot of p(θ|y) or p(y|θ)p(θ) using the mixture prior distribution
and a dense sequence of θ-values. Can you think of a way to obtain
a 95% quantile-based posterior confidence interval for θ? You might
want to try some sort of discrete approximation.
b) To sample a random variable z from the mixture distribution wp1 (z)+
(1 − w)p0 (z), first toss a w-coin and let x be the outcome (this can be
done in R with x<−rbinom(1,1,w) ). Then if x = 1 sample z from p1 ,
and if x = 0 sample z from p0 . Using this technique, obtain a Monte
Carlo approximation of the posterior distribution p(θ|y) and a 95%
quantile-based confidence interval, and compare them to the results
in part a).
4.5 Cancer deaths: Suppose for a set of counties i ∈ {1, . . . , n} we have information on the population size Xi = number of people in 10,000s, and Yi =
number of cancer fatalities. One model for the distribution of cancer fatalities is that, given the cancer rate θ, they are independently distributed
with Yi ∼ Poisson(θXi ).
a) Identify the posterior distribution of θ given data (Y1 , X1 ), . . . , (Yn , Xn )
and a gamma(a, b) prior distribution.
The file cancer_react.dat contains 1990 population sizes (in 10,000s)
and number of cancer fatalities for 10 counties in a Midwestern state
that are near nuclear reactors. The file cancer_noreact.dat contains the
same data on counties in the same state that are not near nuclear reactors.
Consider these data as samples from two populations of counties: one is
the population of counties with no neighboring reactors and a fatality rate
of θ1 deaths per 10,000, and the other is a population of counties having
nearby reactors and a fatality rate of θ2 . In this exercise we will model
beliefs about the rates as independent and such that θ1 ∼ gamma(a1 , b1 )
and θ2 ∼ gamma(a2 , b2 ).
b) Using the numerical values of the data, identify the posterior distributions for θ1 and θ2 for any values of (a1 , b1 , a2 , b2 ).
c) Suppose cancer rates from previous years have been roughly θ˜ = 2.2
per 10,000 (and note that most counties are not near reactors).
For each of the following three prior opinions, compute E[θ1 |data],
E[θ2 |data], 95% quantile-based posterior intervals for θ1 and θ2 , and
Pr(θ2 > θ1 |data). Also plot the posterior densities (try to put p(θ1 |data)
and p(θ2 |data) on the same plot). Comment on the differences across
posterior opinions.
i. Opinion 1: (a1 = a2 = 2.2 × 100, b1 = b2 = 100). Cancer rates for
both types of counties are similar to the average rates across all
counties from previous years.

234

Exercises

ii. Opinion 2: (a1 = 2.2 × 100, b1 = 100, a2 = 2.2, b1 = 1). Cancer
rates in this year for nonreactor counties are similar to rates in
previous years in nonreactor counties. We don’t have much information on reactor counties, but perhaps the rates are close to
those observed previously in nonreactor counties.
iii. Opinion 3: (a1 = a2 = 2.2, b1 = b2 = 1). Cancer rates in this year
could be different from rates in previous years, for both reactor
and nonreactor counties.
d) In the above analysis we assumed that population size gives no information about fatality rate. Is this reasonable? How would the analysis
have to change if this is not reasonable?
e) We encoded our beliefs about θ1 and θ2 such that they gave no information about each other (they were a priori independent). Think
about why and how you might encode beliefs such that they were a
priori dependent.
4.6 Non-informative prior distributions: Suppose for a binary sampling problem we plan on using a uniform, or beta(1,1), prior for the population
proportion θ. Perhaps our reasoning is that this represents “no prior information about θ.” However, some people like to look at proportions on
θ
the log-odds scale, that is, they are interested in γ = log 1−θ
. Via Monte
Carlo sampling or otherwise, find the prior distribution for γ that is induced by the uniform prior for θ. Is the prior informative about γ?
4.7 Mixture models: After a posterior analysis on data from a population of
squash plants, it was determined that the total vegetable weight of a given
plant could be modeled with the following distribution:
p(y|θ, σ 2 ) = .31dnorm(y, θ, σ) + .46dnorm(2θ1 , 2σ) + .23dnorm(y, 3θ1 , 3σ)
where the posterior distributions of the parameters have been calculated
as 1/σ 2 ∼ gamma(10, 2.5), and θ|σ 2 ∼ normal(4.1, σ 2 /20).
a) Sample at least 5,000 y values from the posterior predictive distribution.
b) Form a 75% quantile-based confidence interval for a new value of Y .
c) Form a 75% HPD region for a new Y as follows:
i. Compute estimates of the posterior density of Y using the density
command in R, and then normalize the density values so they sum
to 1.
ii. Sort these discrete probabilities in decreasing order.
iii. Find the first probability value such that the cumulative sum of
the sorted values exceeds 0.75. Your HPD region includes all values
of y which have a discretized probability greater than this cutoff.
Describe your HPD region, and compare it to your quantile-based
region.
d) Can you think of a physical justification for the mixture sampling
distribution of Y ?

Exercises

235

4.8 More posterior predictive checks: Let θA and θB be the average number of children of men in their 30s with and without bachelor’s degrees,
respectively.
a) Using a Poisson sampling model, a gamma(2,1) prior for each θ and the
data in the files menchild30bach.dat and menchild30nobach.dat,
obtain 5,000 samples of Y˜A and Y˜B from the posterior predictive distribution of the two samples. Plot the Monte Carlo approximations to
these two posterior predictive distributions.
b) Find 95% quantile-based posterior confidence intervals for θB −θA and
Y˜B −Y˜A . Describe in words the differences between the two populations
using these quantities and the plots in a), along with any other results
that may be of interest to you.
c) Obtain the empirical distribution of the data in group B. Compare
this to the Poisson distribution with mean θˆ = 1.4. Do you think the
Poisson model is a good fit? Why or why not?
d) For each of the 5,000 θB -values you sampled, sample nB = 218 Poisson
random variables and count the number of 0s and the number of 1s
in each of the 5,000 simulated datasets. You should now have two
sequences of length 5,000 each, one sequence counting the number of
people having zero children for each of the 5,000 posterior predictive
datasets, the other counting the number of people with one child.
Plot the two sequences against one another (one on the x-axis, one
on the y-axis). Add to the plot a point marking how many people in
the observed dataset had zero children and one child. Using this plot,
describe the adequacy of the Poisson model.

Chapter 5
5.1 Studying: The files school1.dat, school2.dat and school3.dat contain
data on the amount of time students from three high schools spent on
studying or homework during an exam period. Analyze data from each of
these schools separately, using the normal model with a conjugate prior
distribution, in which {µ0 = 5, σ02 = 4, κ0 = 1, ν0 = 2} and compute or
approximate the following:
a) posterior means and 95% confidence intervals for the mean θ and
standard deviation σ from each school;
b) the posterior probability that θi < θj < θk for all six permutations
{i, j, k} of {1, 2, 3};
c) the posterior probability that Y˜i < Y˜j < Y˜k for all six permutations
{i, j, k} of {1, 2, 3}, where Y˜i is a sample from the posterior predictive
distribution of school i.
d) Compute the posterior probability that θ1 is bigger than both θ2 and
θ3 , and the posterior probability that Y˜1 is bigger than both Y˜2 and
Y˜3 .

236

Exercises

5.2 Sensitivity analysis: Thirty-two students in a science classroom were
randomly assigned to one of two study methods, A and B, so that
nA = nB = 16 students were assigned to each method. After several
weeks of study, students were examined on the course material with an
exam designed to give an average score of 75 with a standard deviation of
10. The scores for the two groups are summarized by {¯
yA = 75.2, sA = 7.3}
and {¯
yB = 77.5, sb = 8.1}. Consider independent, conjugate normal prior
distributions for each of θA and θB , with µ0 = 75 and σ02 = 100 for
both groups. For each (κ0 , ν0 ) ∈ {(1,1),(2,2),(4,4),(8,8),(16,16),(32,32)}
(or more values), obtain Pr(θA < θB |y A , y B ) via Monte Carlo sampling.
Plot this probability as a function of (κ0 = ν0 ). Describe how you might
use this plot to convey the evidence that θA < θB to people of a variety
of prior opinions.
5.3 Marginal distributions: Given observations Y1 , . . . , Yn ∼ i.i.d. normal(θ, σ 2 )
and using the conjugate prior distribution for θ and σ 2 , derive the formula
for p(θ|y1 , . . . , yn ), the marginal posterior distribution of θ, conditional
on the data but marginal over σ 2 . Check your work by comparing your
formula to a Monte Carlo estimate of the marginal distribution, using
some values of Y1 , . . . , Yn , µ0 , σ02 , ν0 and κ0 that you choose. Also derive
p(˜
σ 2 |y1 , . . . , yn ), where σ
˜ 2 = 1/σ 2 is the precision.
5.4 Jeffreys’ prior: For sampling models expressed in terms of a p-dimensional
p
vector ψ, Jeffreys’ prior (Exercise 3.11) is defined as pJ (ψ) ∝ |I(ψ)|,
where |I(ψ)| is the determinant of the p × p matrix I(ψ) having entries
I(ψ)k,l = −E[∂ 2 log p(Y |ψ)/∂ψk ∂ψl ].
a) Show that Jeffreys’ prior for the normal model is pJ (θ, σ 2 ) ∝ (σ 2 )−3/2 .
b) Let y = (y1 , . . . , yn ) be the observed values of an i.i.d. sample from a
normal(θ, σ 2 ) population. Find a probability density pJ (θ, σ 2 |y) such
that pJ (θ, σ 2 |y) ∝ pJ (θ, σ 2 )p(y|θ, σ 2 ). It may be convenient to write
this joint density as pJ (θ|σ 2 , y) × pJ (σ 2 |y). Can this joint density be
considered a posterior density?
5.5 Unit information prior: Obtain a unit information prior for the normal
model as follows:
a) Reparameterize the normal modelP
as p(y|θ, ψ), where ψ = 1/σ 2 . Write
out the log likelihood l(θ, ψ|y) = log p(yi |θ, ψ) in terms of θ and ψ.
b) Find a probability density pU (θ, ψ) so that log pU (θ, ψ) = l(θ, ψ|y)/n
+
a constant that does P
not depend on θ or ψ. Hint: Write
Pc, where2 c isP
(yi − θ) as (yi − y¯ + y¯ − θ)2 = (yi − y¯)2 + n(θ − y¯)2 , and recall
that log pU (θ, ψ) = log pU (θ|ψ) + log pU (ψ).
c) Find a probability density pU (θ, ψ|y) that is proportional to pU (θ, ψ)×
p(y1 , . . . , yn |θ, ψ). It may be convenient to write this joint density as
pU (θ|ψ, y) × pU (ψ|y). Can this joint density be considered a posterior
density?

Exercises

237

Chapter 6
6.1 Poisson population comparisons: Let’s reconsider the number of children
data of Exercise 4.8. We’ll assume Poisson sampling models for the two
groups as before, but now we’ll parameterize θA and θB as θA = θ, θB =
θ × γ. In this parameterization, γ represents the relative rate θB /θA . Let
θ ∼ gamma(aθ , bθ ) and let γ ∼ gamma(aγ , bγ ).
a) Are θA and θB independent or dependent under this prior distribution? In what situations is such a joint prior distribution justified?
b) Obtain the form of the full conditional distribution of θ given y A , y B
and γ.
c) Obtain the form of the full conditional distribution of γ given y A , y B
and θ.
d) Set aθ = 2 and bθ = 1. Let aγ = bγ ∈ {8, 16, 32, 64, 128}. For each of
these five values, run a Gibbs sampler of at least 5,000 iterations and
obtain E[θB −θA |y A , y B ]. Describe the effects of the prior distribution
for γ on the results.
6.2 Mixture model: The file glucose.dat contains the plasma glucose concentration of 532 females from a study on diabetes (see Exercise 7.6).
a) Make a histogram or kernel density estimate of the data. Describe
how this empirical distribution deviates from the shape of a normal
distribution.
b) Consider the following mixture model for these data: For each study
participant there is an unobserved group membership variable Xi
which is equal to 1 or 2 with probability p and 1 − p. If Xi = 1
then Yi ∼ normal(θ1 , σ12 ), and if Xi = 2 then Yi ∼ normal(θ2 , σ22 ). Let
p ∼ beta(a, b), θj ∼ normal(µ0 , τ02 ) and 1/σj ∼ gamma(ν0 /2, ν0 σ02 /2)
for both j = 1 and j = 2. Obtain the full conditional distributions of
(X1 , . . . , Xn ), p, θ1 , θ2 , σ12 and σ22 .
c) Setting a = b = 1, µ0 = 120, τ02 = 200, σ02 = 1000 and ν0 = 10,
implement the Gibbs sampler for at least 10,000 iterations. Let
(s)
(s) (s)
(s)
(s) (s)
θ(1) = min{θ1 , θ2 } and θ(2) = max{θ1 , θ2 }. Compute and plot
(s)

(s)

the autocorrelation functions of θ(1) and θ(2) , as well as their effective
sample sizes.
d) For each iteration s of the Gibbs sampler, sample a value x ∼
(s)
2(s)
binary(p(s) ), then sample Y˜ (s) ∼ normal(θx , σx ). Plot a histogram or kernel density estimate for the empirical distribution of
Y˜ (1) , . . . , Y˜ (S) , and compare to the distribution in part a). Discuss
the adequacy of this two-component mixture model for the glucose
data.
6.3 Probit regression: A panel study followed 25 married couples over a period of five years. One item of interest is the relationship between divorce
rates and the various characteristics of the couples. For example, the researchers would like to model the probability of divorce as a function of

238

Exercises

age differential, recorded as the man’s age minus the woman’s age. The
data can be found in the file divorce.dat. We will model these data with
probit regression, in which a binary variable Yi is described in terms of
an explanatory variable xi via the following latent variable model:
Zi = βxi + i
Yi = δ(c,∞) (Zi ),
where β and c are unknown coefficients, 1 , . . . , n ∼ i.i.d. normal(0, 1)
and δ(c,∞) (z) = 1 if z > c and equals zero otherwise.
a) Assuming β ∼ normal(0, τβ2 ) obtain the full conditional distribution
p(β|y, x, z, c).
b) Assuming c ∼ normal(0, τc2 ), show that p(c|y, x, z, β) is a constrained
normal density, i.e. proportional to a normal density but constrained
to lie in an interval. Similarly, show that p(zi |y, x, z −i , β, c) is proportional to a normal density but constrained to be either above c or
below c, depending on yi .
c) Letting τβ2 = τc2 = 16 , implement a Gibbs sampling scheme that approximates the joint posterior distribution of Z, β, and c (a method
for sampling from constrained normal distributions is outlined in Section 12.1.1). Run the Gibbs sampler long enough so that the effective
sample sizes of all unknown parameters are greater than 1,000 (including the Zi ’s). Compute the autocorrelation function of the parameters
and discuss the mixing of the Markov chain.
d) Obtain a 95% posterior confidence interval for β, as well as Pr(β >
0|y, x).

Chapter 7
7.1 Jeffreys’ prior: For the multivariate normal model, Jeffreys’ rule for generating a prior distribution on (θ, Σ) gives pJ (θ, Σ) ∝ |Σ|−(p+2)/2 .
a) Explain why the function pJ cannot actually be a probability density
for (θ, Σ).
b) Let pJ (θ, Σ|y 1 , . . . , y n ) be the probability density that is proportional
to pJ (θ, Σ)×p(y 1 , . . . , y n |θ, Σ). Obtain the form of pJ (θ, Σ|y 1 , . . . , y n ),
pJ (θ|Σ, y 1 , . . . , y n ) and pJ (Σ|y 1 , . . . , y n ).
7.2 Unit information prior: Letting Ψ = Σ −1 , show that a unit information
prior for (θ, Ψ ) is given by θ|Ψ P
∼ multivariate normal(¯
y , Ψ −1 ) and Ψ ∼
−1
T
Wishart(p + 1, S ), where S = (y i − y¯)(y i − y¯) /n. This can be done
by mimicking the procedure outlined in Exercise 5.6 as follows:
a) Reparameterize the multivariate normal model in terms of the precision matrix Ψ = Σ −1 . Write out the resulting log likelihood,
and find a probability density pU (θ, Ψ ) = pU (θ|Ψ )pU (Ψ ) such that
log p(θ, Ψ ) = l(θ, Ψ |Y)/n + c, where c does not depend on θ or Ψ .

Exercises

239

P T
Hint: Write (y i − θ) as (y i − y¯ + y¯P
− θ), and note that
ai Bai can
be written as tr(AB), where A = ai aTi .
b) Let pU (Σ) be the inverse-Wishart density induced by pU (Ψ ). Obtain a
density pU (θ, Σ|y 1 , . . . , y n ) ∝ pU (θ|Σ)pU (Σ)p(y 1 , . . . , y n |θ, Σ). Can
this be interpreted as a posterior distribution for θ and Σ?
7.3 Australian crab data: The files bluecrab.dat and orangecrab.dat contain measurements of body depth (Y1 ) and rear width (Y2 ), in millimeters,
made on 50 male crabs from each of two species, blue and orange. We will
model these data using a bivariate normal distribution.
a) For each of the two species, obtain posterior distributions of the population mean θ and covariance matrix Σ as follows: Using the semiconjugate prior distributions for θ and Σ, set µ0 equal to the sample
mean of the data, Λ0 and S0 equal to the sample covariance matrix
and ν0 = 4. Obtain 10,000 posterior samples of θ and Σ. Note that
this “prior” distribution loosely centers the parameters around empirical estimates based on the observed data (and is very similar to the
unit information prior described in the previous exercise). It cannot
be considered as our true prior distribution, as it was derived from
the observed data. However, it can be roughly considered as the prior
distribution of someone with weak but unbiased information.
b) Plot values of θ = (θ1 , θ2 )0 for each group and compare. Describe any
size differences between the two groups.
c) From each covariance matrix obtained from the Gibbs sampler, obtain the corresponding correlation coefficient. From these values, plot
posterior densities of the correlations ρblue and ρorange for the two
groups. Evaluate differences between the two species by comparing
these posterior distributions. In particular, obtain an approximation
to Pr(ρblue < ρorange |y blue , y orange ). What do the results suggest about
differences between the two populations?
7.4 Marriage data: The file agehw.dat contains data on the ages of 100 married couples sampled from the U.S. population.
a) Before you look at the data, use your own knowledge to formulate a
semiconjugate prior distribution for θ = (θh , θw )T and Σ, where θh , θw
are mean husband and wife ages, and Σ is the covariance matrix.
b) Generate a prior predictive dataset of size n = 100, by sampling (θ, Σ)
from your prior distribution and then simulating Y 1 , . . . , Y n ∼ i.i.d.
multivariate normal(θ, Σ). Generate several such datasets, make bivariate scatterplots for each dataset, and make sure they roughly represent your prior beliefs about what such a dataset would actually
look like. If your prior predictive datasets do not conform to your beliefs, go back to part a) and formulate a new prior. Report the prior
that you eventually decide upon, and provide scatterplots for at least
three prior predictive datasets.
c) Using your prior distribution and the 100 values in the dataset, obtain an MCMC approximation to p(θ, Σ|y 1 , . . . , y 100 ). Plot the joint

240

Exercises

posterior distribution of θh and θw , and also the marginal posterior
density of the correlation between Yh and Yw , the ages of a husband
and wife. Obtain 95% posterior confidence intervals for θh , θw and the
correlation coefficient.
d) Obtain 95% posterior confidence intervals for θh , θw and the correlation coefficient using the following prior distributions:
i. Jeffreys’ prior, described in Exercise 7.1;
ii. the unit information prior, described in Exercise 7.2;
iii. a “diffuse prior” with µ0 = 0, Λ0 = 105 × I, S0 = 1000 × I and
ν0 = 3.
e) Compare the confidence intervals from d) to those obtained in c).
Discuss whether or not you think that your prior information is helpful
in estimating θ and Σ, or if you think one of the alternatives in d)
is preferable. What about if the sample size were much smaller, say
n = 25?
7.5 Imputation: The file interexp.dat contains data from an experiment that
was interrupted before all the data could be gathered. Of interest was the
difference in reaction times of experimental subjects when they were given
stimulus A versus stimulus B. Each subject is tested under one of the two
stimuli on their first day of participation in the study, and is tested under
the other stimulus at some later date. Unfortunately the experiment was
interrupted before it was finished, leaving the researchers with 26 subjects
with both A and B responses, 15 subjects with only A responses and 17
subjects with only B responses.
2
2
a) Calculate empirical estimates of θA , θB , ρ, σA
, σB
from the data using
the commands mean , cor and var . Use all the A responses to get
2
2
θˆA and σ
ˆA
, and use all the B responses to get θˆB and σ
ˆB
. Use only
the complete data cases to get ρˆ.
b) For each person i with only an A response, impute a B response as
q
2 /ˆ
2.
yˆi,B = θˆB + (yi,A − θˆA )ˆ
ρ σ
ˆB
σA
For each person i with only a B response, impute an A response as
q
2 /ˆ
2.
yˆi,A = θˆA + (yi,B − θˆB )ˆ
ρ σ
ˆA
σB
You now have two “observations” for each individual. Do a paired
sample t-test and obtain a 95% confidence interval for θA − θB .
c) Using either Jeffreys’ prior or a unit information prior distribution for
the parameters, implement a Gibbs sampler that approximates the
joint distribution of the parameters and the missing data. Compute
a posterior mean for θA − θB as well as a 95% posterior confidence
interval for θA − θB . Compare these results with the results from b)
and discuss.

Exercises

241

7.6 Diabetes data: A population of 532 women living near Phoenix, Arizona were tested for diabetes. Other information was gathered from these
women at the time of testing, including number of pregnancies, glucose
level, blood pressure, skin fold thickness, body mass index, diabetes pedigree and age. This information appears in the file azdiabetes.dat. Model
the joint distribution of these variables for the diabetics and non-diabetics
separately, using a multivariate normal distribution:
a) For both groups separately, use the following type of unit information
ˆ is the sample covariance matrix.
prior, where Σ
ˆ
¯ , Λ0 = Σ;
i. µ0 = y
ˆ
ii. S0 = Σ, ν0 = p + 2 = 9 .
Generate at least 10,000 Monte Carlo samples for {θ d , Σd } and
{θ n , Σn }, the model parameters for diabetics and non-diabetics respectively. For each of the seven variables j ∈ {1, . . . , 7}, compare the
marginal posterior distributions of θd,j and θn,j . Which variables seem
to differ between the two groups? Also obtain Pr(θd,j > θn,j |Y) for
each j ∈ {1, . . . , 7}.
b) Obtain the posterior means of Σd and Σn , and plot the entries versus
each other. What are the main differences, if any?

Chapter 8
8.1 Components of variance: Consider the hierarchical model where
θ1 , . . . , θm |µ, τ 2 ∼ i.i.d. normal(µ, τ 2 )
y1,j , . . . , ynj ,j |θj , σ 2 ∼ i.i.d. normal(θj , σ 2 ) .
For this problem, we will eventually compute the following:
Var[yi,j |θi , σ 2 ], Var[¯
y·,j |θi , σ 2 ], Cov[yi1 ,j , yi2 ,j |θj , σ 2 ]
2
Var[yi,j |µ, τ ], Var[¯
y·,j |µ, τ 2 ], Cov[yi1 ,j , yi2 ,j |µ, τ 2 ]
First, lets use our intuition to guess at the answers:
a) Which do you think is bigger, Var[yi,j |θi , σ 2 ] or Var[yi,j |µ, τ 2 ]? To
guide your intuition, you can interpret the first as the variability of
the Y ’s when sampling from a fixed group, and the second as the
variability in first sampling a group, then sampling a unit from within
the group.
b) Do you think Cov[yi1 ,j , yi2 ,j |θj , σ 2 ] is negative, positive, or zero? Answer the same for Cov[yi1 ,j , yi2 ,j |µ, τ ]. You may want to think about
what yi2 ,j tells you about yi1 ,j if θj is known, and what it tells you
when θj is unknown.
c) Now compute each of the six quantities above and compare to your
answers in a) and b).
d) Now assume we have a prior p(µ) for µ. Using Bayes’ rule, show that
p(µ|θ1 , . . . , θm , σ 2 , τ 2 , y 1 , . . . , y m ) = p(µ|θ1 , . . . , θm , τ 2 ).

242

Exercises

Interpret in words what this means.
8.2 Sensitivity analysis: In this exercise we will revisit the study from Exercise
5.2, in which 32 students in a science classroom were randomly assigned
to one of two study methods, A and B, with nA = nB = 16. After several
weeks of study, students were examined on the course material, and the
scores are summarized by {¯
yA = 75.2, sA = 7.3}, {¯
yB = 77.5, sb = 8.1}.
We will estimate θA = µ + δ and θB = µ − δ using the two-sample model
and prior distributions of Section 8.1.
a) Let µ ∼ normal(75, 100), 1/σ 2 ∼ gamma(1, 100) and δ ∼ normal(δ0 , τ02 ).
For each combination of δ0 ∈ {−4, −2, 0, 2, 4} and τ02 ∈ {10, 50, 100, 500},
obtain the posterior distribution of µ, δ and σ 2 and compute
i. Pr(δ < 0|Y);
ii. a 95% posterior confidence interval for δ;
iii. the prior and posterior correlation of θA and θB .
b) Describe how you might use these results to convey evidence that
θA < θB to people of a variety of prior opinions.
8.3 Hierarchical modeling: The files school1.dat through school8.dat give
weekly hours spent on homework for students sampled from eight different
schools. Obtain posterior distributions for the true means for the eight
different schools using a hierarchical normal model with the following
prior parameters:
µ0 = 7, γ02 = 5, τ02 = 10, η0 = 2, σ02 = 15, ν0 = 2 .
a) Run a Gibbs sampling algorithm to approximate the posterior distribution of {θ, σ 2 , µ, τ 2 }. Assess the convergence of the Markov chain,
and find the effective sample size for {σ 2 , µ, τ 2 }. Run the chain long
enough so that the effective sample sizes are all above 1,000.
b) Compute posterior means and 95% confidence regions for {σ 2 , µ, τ 2 }.
Also, compare the posterior densities to the prior densities, and discuss
what was learned from the data.
2
c) Plot the posterior density of R = σ2τ+τ 2 and compare it to a plot of the
prior density of R. Describe the evidence for between-school variation.
d) Obtain the posterior probability that θ7 is smaller than θ6 , as well as
the posterior probability that θ7 is the smallest of all the θ’s.
e) Plot the sample averages y¯1 , . . . , y¯8 against the posterior expectations
of θ1 , . . . , θ8 , and describe the relationship. Also compute the sample
mean of all observations and compare it to the posterior mean of µ.

Chapter 9
9.1 Extrapolation: The file swim.dat contains data on the amount of time,
in seconds, it takes each of four high school swimmers to swim 50 yards.
Each swimmer has six times, taken on a biweekly basis.

Exercises

243

a) Perform the following data analysis for each swimmer separately:
i. Fit a linear regression model of swimming time as the response and
week as the explanatory variable. To formulate your prior, use the
information that competitive times for this age group generally
range from 22 to 24 seconds.
ii. For each swimmer j, obtain a posterior predictive distribution
for Yj∗ , their time if they were to swim two weeks from the last
recorded time.
b) The coach of the team has to decide which of the four swimmers will
compete in a swimming meet in two weeks. Using your predictive distributions, compute Pr(Yj∗ = max{Y1∗ , . . . , Y4∗ }|Y)) for each swimmer
j, and based on this make a recommendation to the coach.
9.2 Model selection: As described in Example 6 of Chapter 7, The file
azdiabetes.dat contains data on health-related variables of a population of 532 women. In this exercise we will be modeling the conditional
distribution of glucose level (glu) as a linear combination of the other
variables, excluding the variable diabetes.
a) Fit a regression model using the g-prior with g = n, ν0 = 2 and σ02 = 1.
Obtain posterior confidence intervals for all of the parameters.
b) Perform the model selection and averaging procedure described in Section 9.3. Obtain Pr(βj 6= 0|y), as well as posterior confidence intervals
for all of the parameters. Compare to the results in part a).
9.3 Crime: The file crime.dat contains crime rates and data on 15 explanatory variables for 47 U.S. states, in which both the crime rates
and the explanatory variables have been centered and scaled to have
variance 1. A description of the variables can be obtained by typing
library (MASS);?UScrime in R.
a) Fit a regression model y = Xβ+ using the g-prior with g = n, ν0 = 2
and σ02 = 1. Obtain marginal posterior means and 95% confidence
intervals for β, and compare to the least squares estimates. Describe
the relationships between crime and the explanatory variables. Which
variables seem strongly predictive of crime rates?
b) Lets see how well regression models can predict crime rates based on
the X-variables. Randomly divide the crime roughly in half, into a
training set {y tr , Xtr } and a test set {y te , Xte }
i. Using only the training set, obtain least squares regression coeffiˆ . Obtain predicted values for the test data by computing
cients β
ols
ˆ
ˆ ols = XP
ˆ ols versus y te and compute the prediction
y
te β ols . Plot y
1
error nte (yi,te − yˆi,ols )2 .
ˆ
ii. Now obtain the posterior mean β
Bayes = E[β|y tr ] using the g-prior
described above and the training data only. Obtain predictions
ˆ
ˆ Bayes = Xtest β
for the test set y
Bayes . Plot versus the test data,
compute the prediction error, and compare to the OLS prediction
error. Explain the results.

244

Exercises

c) Repeat the procedures in b) many times with different randomly generated test and training sets. Compute the average prediction error
for both the OLS and Bayesian methods.

Chapter 10
10.1 Reflecting random walks: It is often useful in MCMC to have a proposal
distribution which is both symmetric and has support only on a certain
region. For example, if we know θ > 0, we would like our proposal distribution J(θ1 |θ0 ) to have support on positive θ values. Consider the following
proposal algorithm:
• sample θ˜ ∼ uniform(θ0 − δ, θ0 + δ);
˜
• if θ˜ < 0, set θ1 = −θ;
˜
˜
• if θ ≥ 0, set θ1 = θ.
˜ Show that the above algorithm draws samples
In other words, θ1 = |θ|.
from a symmetric proposal distribution which has support on positive
values of θ. It may be helpful to write out the associated proposal density
J(θ1 |θ0 ) under the two conditions θ0 ≤ δ and θ0 > δ separately.
10.2 Nesting success: Younger male sparrows may or may not nest during a
mating season, perhaps depending on their physical characteristics. Researchers have recorded the nesting success of 43 young male sparrows
of the same age, as well as their wingspan, and the data appear in the
file msparrownest.dat. Let Yi be the binary indicator that sparrow i
successfully nests, and let xi denote their wingspan. Our model for Yi is
logit Pr(Yi = 1|α, β, xi ) = α + βxi , where the logit function is given by
logit θ = log[θ/(1 − θ)].
Qn
a) Write out the joint sampling distribution i=1 p(yi |α, β, xi ) and simplify as much as possible.
b) Formulate a prior probability distribution over α and β by considering the range of Pr(Y = 1|α, β, x) as x ranges over 10 to 15, the
approximate range of the observed wingspans.
c) Implement a Metropolis algorithm that approximates p(α, β|y, x).
Adjust the proposal distribution to achieve a reasonable acceptance
rate, and run the algorithm long enough so that the effective sample
size is at least 1,000 for each parameter.
d) Compare the posterior densities of α and β to their prior densities.
e) Using output from the Metropolis algorithm, come up with a way to
make a confidence band for the following function fαβ (x) of wingspan:
fαβ (x) =

eα+βx
,
1 + eα+βx

where α and β are the parameters in your sampling model. Make a
plot of such a band.

Exercises

245

10.3 Tomato plants: The file tplant.dat contains data on the heights of ten
tomato plants, grown under a variety of soil pH conditions. Each plant
was measured twice. During the first measurement, each plant’s height
was recorded and a reading of soil pH was taken. During the second measurement only plant height was measured, although it is assumed that pH
levels did not vary much from measurement to measurement.
a) Using ordinary least squares, fit a linear regression to the data, modeling plant height as a function of time (measurement period) and pH
level. Interpret your model parameters.
b) Perform model diagnostics. In particular, carefully analyze the residuals and comment on possible violations of assumptions. In particular,
assess (graphically or otherwise) whether or not the residuals within a
plant are independent. What parts of your ordinary linear regression
model do you think are sensitive to any violations of assumptions you
may have detected?
c) Hypothesize a new model for your data which allows for observations
within a plant to be correlated. Fit the model using a MCMC approximation to the posterior distribution, and present diagnostics for your
approximation.
d) Discuss the results of your data analysis. In particular, discuss similarities and differences between the ordinary linear regression and the
model fit with correlated responses. Are the conclusions different?
10.4 Gibbs sampling: Consider the general Gibbs sampler for a vector of parameters φ. Suppose φ(s) is sampled from the target distribution p(φ)
and then φ(s+1) is generated using the Gibbs sampler by iteratively updating each component of the parameter vector. Show that
R the marginal
probability Pr(φ(s+1) ∈ A) equals the target distribution A p(φ) dφ.
10.5 Logistic regression variable selection: Consider a logistic regression model
for predicting diabetes as a function of x1 = number of pregnancies, x2 =
blood pressure, x3 = body mass index, x4 = diabetes pedigree and x5 =
age. Using the data in azdiabetes.dat, center and scale each of the xvariables by subtracting the sample average and dividing by the sample
standard deviation for each variable. Consider a logistic regression model
of the form Pr(Yi = 1|xi , β, z) = eθi /(1 + eθi ) where
θi = β0 + β1 γ1 xi,1 + β2 γ2 xi,2 + β3 γ3 xi,3 + β4 γ4 xi,4 + β5 γ5 xi,5 .
In this model, each γj is either 0 or 1, indicating whether or not variable
j is a predictor of diabetes. For example, if it were the case that γ =
(1, 1, 0, 0, 0), then θi = β0 + β1 xi,1 + β2 xi,2 . Obtain posterior distributions
for β and γ, using independent prior distributions for the parameters,
such that γj ∼ binary(1/2), β0 ∼ normal(0, 16) and βj ∼ normal(0, 4) for
each j > 0.

246

Exercises

a) Implement a Metropolis-Hastings algorithm for approximating the
(s)
posterior distribution of β and γ. Examine the sequences βj and
(s)

(s)

βj × γj for each j and discuss the mixing of the chain.
b) Approximate the posterior probability of the top five most frequently
occurring values of γ. How good do you think the MCMC estimates
of these posterior probabilities are?
c) For each j, plot posterior densities and obtain posterior means for
βj γj . Also obtain Pr(γj = 1|x, y).

Chapter 11
11.1 Full conditionals: Derive formally the full conditional distributions of
θ, Σ, σ 2 and the β j ’s as given in Section 11.2.
11.2 Randomized block design: Researchers interested in identifying the optimal planting density for a type of perennial grass performed the following
randomized experiment: Ten different plots of land were each divided into
eight subplots, and planting densities of 2, 4, 6 and 8 plants per square meter were randomly assigned to the subplots, so that there are two subplots
at each density in each plot. At the end of the growing season the amount
of plant matter yield was recorded in metric tons per hectare. These data
appear in the file pdensity.dat. The researchers want to fit a model like
y = β1 + β2 x + β3 x2 + , where y is yield and x is planting density, but
worry that since soil conditions vary across plots they should allow for
some across-plot heterogeneity in this relationship. To accommodate this
possibility we will analyze these data using the hierarchical linear model
described in Section 11.1.
a) Before we do a Bayesian analysis we will get some ad hoc estimates
of these parameters via least squares regression. Fit the model y =
β1 +β2 x+β3 x2 + using OLS for each group, and make a plot showing
the heterogeneity of the least squares regression lines. From the least
squares coefficients find ad hoc estimates of θ and Σ. Also obtain an
estimate of σ 2 by combining the information from the residuals across
the groups.
b) Now we will perform an analysis of the data using the following distributions as prior distributions:
ˆ −1 )
Σ −1 ∼ Wishart(4, Σ
ˆ Σ)
ˆ
θ ∼ multivariate normal(θ,
2
2
σ ∼ inverse − gamma(1, σ
ˆ )
ˆ Σ,
ˆ σ
where θ,
ˆ 2 are the estimates you obtained in a). Note that this
analysis is not combining prior information with information from
the data, as the“prior” distribution is based on the observed data.

Exercises

247

However, such an analysis can be roughly interpreted as the Bayesian
analysis of an individual who has weak but unbiased prior information.
c) Use a Gibbs sampler to approximate posterior expectations of β for
each group j, and plot the resulting regression lines. Compare to the
regression lines in a) above and describe why you see any differences
between the two sets of regression lines.
d) From your posterior samples, plot marginal posterior and prior densities of θ and the elements of Σ. Discuss the evidence that the slopes
or intercepts vary across groups.
e) Suppose we want to identify the planting density that maximizes average yield over a random sample of plots. Find the value xmax of x
that maximizes expected yield, and provide a 95% posterior predictive interval for the yield of a randomly sampled plot having planting
density xmax .
11.3 Hierarchical variances:. The researchers in Exercise 11.2 are worried that
the plots are not just heterogeneous in their regression lines, but also
in their variances. In this exercise we will consider the same hierarchical model as above except that the sampling variability within a group
is given by yi,j ∼ normal(β1,j + β2,j xi,j + β3,j x2i,j , σj2 ), that is, the variances are allowed to differ across groups. As in Section 8.5, we will model
2
σ12 , . . . , σm
∼ i.i.d. inverse gamma(ν0 /2, ν0 σ02 /2), with σ02 ∼ gamma(2, 2)
and p(ν0 ) uniform on the integers {1, 2, . . . , 100}.
a) Obtain the full conditional distribution of σ02 .
b) Obtain the full conditional distribution of σj2 .
c) Obtain the full conditional distribution of β j .
(s)

2
d) For two values ν0 and ν0∗ of ν0 , obtain the ratio p(ν0∗ |σ02 , σ12 , . . . , σm
)
(s) 2
2
2
divided by p(ν0 |σ0 , σ1 , . . . , σm ), and simplify as much as possible.
e) Implement a Metropolis-Hastings algorithm for obtaining the joint
posterior distribution of all of the unknown parameters. Plot values
of σ02 and ν0 versus iteration number and describe the mixing of the
Markov chain in terms of these parameters.
f) Compare the prior and posterior distributions of ν0 . Comment on any
evidence there is that the variances differ across the groups.
11.4 Hierarchical logistic regression: The Washington Assessment of Student
Learning (WASL) is a standardized test given to students in the state of
Washington. Letting j index the counties within the state of Washington
and i index schools within counties, the file mathstandard.dat includes
data on the following variables:
yi,j = the indicator that more than half the 10th graders in school i, j
passed the WASL math exam;
xi,j = the percentage of teachers in school i, j who have a masters
degree.
In this exercise we will construct an algorithm to approximate the posterior distribution of the parameters in a generalized linear mixed-effects

248

Exercises

model for these data. The model is a mixed effects version of logistic
regression:
yi,j ∼ binomial(eγi,j /[1 + eγi,j ]), where γi,j = β0,j + β1,j xi,j
β 1 , . . . , β J ∼ i.i.d. multivariate normal (θ, Σ), where β j = (β0,j , β1,j )
a) The unknown parameters in the model include population-level parameters {θ, Σ} and the group-level parameters {β 1 , . . . , β m }. Draw
a diagram that describes the relationships between these parameters,
the data {yi,j , xi,j , i = 1 . . . , nj , j = 1, . . . , m}, and prior distributions.
b) Before we do a Bayesian analysis, we will get some ad hoc estimates
of these parameters via maximum likelihood: Fit a separate logistic
regression model for each group, possibly using the glm command
in R via beta. j <− glm(y.j˜X.j,family=binomial)$coef . Explain any
problems you have with obtaining estimates for each county. Plot
exp{βˆ0,j + βˆ1,j x}/(1 + exp{βˆ0,j + βˆ1,j x}) as a function of x for each
county and describe what you see. Using maximum likelihood estimates only from those counties with 10 or more schools, obtain ad
ˆ and Σ
ˆ of θ and Σ. Note that these estimates may not
hoc estimates θ
be representative of patterns from schools with small sample sizes.
c) Formulate a unit information prior distribution for θ and Σ based on
ˆ Σ)
ˆ and
the observed data. Specifically, let θ ∼ multivariate normal(θ,
−1
−1
ˆ
let Σ ∼ Wishart(4, Σ ). Use a Metropolis-Hastings algorithm to
approximate the joint posterior distribution of all parameters.
d) Make plots of the samples of θ and Σ (5 parameters) versus MCMC
iteration number. Make sure you run the chain long enough so that
your MCMC samples are likely to be a reasonable approximation to
the posterior distribution.
e) Obtain posterior expectations of β j for each group j, plot E[β0,j |y] +
E[β1,j |y]x as a function of x for each county, compare to the plot in
b) and describe why you see any differences between the two sets of
regression lines.
f) From your posterior samples, plot marginal posterior and prior densities of θ and the elements of Σ. Include your ad hoc estimates from
b) in the plots. Discuss the evidence that the slopes or intercepts vary
across groups.
11.5 Disease rates: The number of occurrences of a rare, nongenetic birth defect
in a five-year period for six neighboring counties is y = (1, 3, 2, 12, 1, 1).
The counties have populations of x = (33, 14, 27, 90, 12, 17), given in thousands. The second county has higher rates of toxic chemicals (PCBs)
present in soil samples, and it is of interest to know if this town has a
high disease rate as well. We will use the following hierarchical model to
analyze these data:
• Yi |θi , xi ∼ Poisson(θi xi );
• θ1 , . . . , θ6 |a, b ∼ gamma(a, b);
• a ∼ gamma(1,1) ; b ∼ gamma(10,1).

Exercises

249

a) Describe in words what the various components of the hierarchical
model represent in terms of observed and expected disease rates.
b) Identify the form of the conditional distribution of p(θ1 , . . . , θ6 |a, b, x,
y), and from this identify the full conditional distribution of the rate
for each county p(θi |θ −i , a, b, x, y).
c) Write out the ratio of the posterior densities comparing a set of proposal values (a∗ , b∗ , θ) to values (a, b, θ). Note the value of θ, the
vector of county-specific rates, is unchanged.
d) Construct a Metropolis-Hastings algorithm which generates samples
of (a, b, θ) from the posterior. Do this by iterating the following steps:
1. Given a current value (a, b, θ), generate a proposal (a∗ , b∗ , θ) by
sampling a∗ and b∗ from a symmetric proposal distribution centered around a and b, but making sure all proposals are positive (see Exercise 10.1). Accept the proposal with the appropriate
probability.
2. Sample new values of the θj ’s from their full conditional distributions.
Perform diagnostic tests on your chain and modify if necessary.
e) Make posterior inference on the infection rates using the samples from
the Markov chain. In particular,
i. Compute marginal posterior distributions of θ1 , . . . , θ6 and compare them to y1 /x1 , . . . y6 /x6 .
ii. Examine the posterior distribution of a/b, and compare it to the
corresponding prior distribution as well as to the average of yi /xi
across the six counties.
iii. Plot samples of θ2 versus θj for each j 6= 2, and draw a 45 degree line on the plot as well. Also estimate Pr(θ2 > θj |x, y) for
each j and Pr(θ2 = max{θ1 , . . . , θ6 }|x, y). Interpret the results
of these calculations, and compare them to the conclusions one
might obtain if they just examined yj /xj for each county j.

Chapter 12
12.1 Rank regression: The 1996 General Social Survey gathered a wide variety of information on the adult U.S. population, including each survey
respondent’s sex, their self-reported frequency of religious prayer (on a
six-level ordinal scale), and the number of items correct out of 10 on a
short vocabulary test. These data appear in the file prayer.dat. Using
the rank regression procedure described in Section 12.1.2, estimate the
parameters in a regression model for Yi = prayer as a function of xi,1 =
sex of respondent (0-1 indicator of being female) and xi,2 = vocabulary
score, as well as their interaction xi,3 = xi,1 × xi,2 . Compare marginal
prior distributions of the three regression parameters to their posterior

250

Exercises

distributions, and comment on the evidence that the relationship between
prayer and score differs across the sexes.
12.2 Copula modeling: The file azdiabetes_alldata.dat contains data on
eight variables for 632 women in a study on diabetes (see Exercise 7.6
for a description of the variables). Data on subjects labeled 201-300 have
missing values for some variables, mostly for the skin fold thickness measurement.
a) Using only the data from subjects 1-200, implement the Gaussian
copula model for the eight variables in this dataset. Obtain
posterior

means and 95% posterior confidence intervals for all 82 = 28 parameters.
b) Now use the data from subjects 1-300, thus including data from subjects who are missing some variables. Implement the Gaussian copula
model and obtain posterior means and 95% posterior confidence intervals for all parameters. How do the results differ from those in a)?
12.3 Constrained normal: Let p(z) ∝ dnorm(z, θ, σ)×δ(a,b) (z), the normal density constrained to the interval (a, b). Prove that the inverse-cdf method
outlined in Section 12.1.1 generates a sample from this distribution.
12.4 Categorical data and the Dirichlet distribution: Consider again the data
on the number of children of men in their 30s from Exercise 4.8. These
data could be considered as categorical data, as each sample Y lies in the
discrete set {1, . . . , 8} (8 here actually denotes “8 or more” children). Let
θ A = (θA,1 , . . . , θA,8 ) be the proportion in each of the eight categories
from the population of men with bachelor’s degrees, and let the vector θ B
be defined similarly for the population of men without bachelor’s degrees.
a) Write in a compact form the conditional probability given θ A of observing a particular sequence {yA,1 , . . . , yA,n1 } for a random sample
from the A population.
b) Identify the sufficient statistic. Show that the Dirichlet family of disaK −1
tributions, with densities of the form p(θ|a) ∝ θ1a1 −1 × · · · θK
, are
a conjugate class of prior distributions for this sampling model.
c) The function rdir () below samples from the Dirichlet distribution:
r d i r <−f u n c t i o n ( nsamp=1 , a ) # a i s a v e c t o r
{
Z<−m at r i x ( rgamma ( l e n g t h ( a ) ∗ nsamp , a , 1 ) ,
nsamp , l e n g t h ( a ) , byrow=T)
Z/ a p p ly ( Z , 1 , sum )
}

Using this function, generate 5,000 or more samples of θ A and θ B from
their posterior distributions. Using a Monte Carlo approximation, obtain and plot the posterior distributions of E[YA |θ A ] and E[YB |θ B ],
as well as of Y˜A and Y˜B .

Exercises

251

d) Compare the results above to those in Exercise 4.8. Perform the goodness of fit test from that exercise on this model, and compare to the
fit of the Poisson model.

Common distributions

The binomial distribution
A random variable X ∈ {0, 1, . . . , n} has a binomial(n, θ) distribution if θ ∈
[0, 1] and
 
n x
Pr(X = x|θ, n) =
θ (1 − θ)n−x for x ∈ {0, 1, . . . , n}.
x
For this distribution,
E[X|θ] = nθ,
Var[X|θ] = nθ(1 − θ),
mode[X|θ] = b(n + 1)θc,
p(x|θ, n) =

dbinom(x,n,theta) .

If X1 ∼ binomial(n1 , θ) and X2 ∼ binomial(n2 , θ) are independent, then
X = X1 +X2 ∼ binomial(n1 +n2 , θ). When n = 1 this distribution is called the
binary or Bernoulli distribution. The binomial(n, θ) model assumes that X is
(equal in distribution to) a sum of independent binary(θ) random variables.

The beta distribution
A random variable X ∈ [0, 1] has a beta(a, b) distribution if a > 0, b > 0 and
p(x|a, b) =

Γ (a + b) a−1
x
(1 − x)b−1
Γ (a)Γ (b)

for 0 ≤ x ≤ 1.

254

Common distributions

For this distribution,
E[X|a, b] =

a
,
a+b

ab
1
= E[X] × E[1 − X] ×
,
2
(a + b + 1)(a + b)
a+b+1
a−1
mode[X|a, b] =
if a > 1 and b > 1,
(a − 1) + (b − 1)
Var[X|a, b] =

p(x|a, b) = dbeta(x,a,b) .
The beta distribution is closely related to the gamma distribution. See the
paragraph on the gamma distribution below for details. A multivariate version
of the beta distribution is the Dirichlet distribution, described in Exercise 12.4.

The Poisson distribution
A random variable X ∈ {0, 1, 2, . . .} has a Poisson(θ) distribution if θ > 0 and
Pr(X = x|θ) = θx e−θ /x! for x ∈ {0, 1, 2, . . .}.
For this distribution,
E[X|θ] = θ,
Var[X|θ] = θ,
mode[X|θ] = bθc,
p(x|θ) = dpois(x,theta) .
If X1 ∼ Poisson(θ1 ) and X2 ∼ Poisson(θ2 ) are independent, then X1 + X2 ∼
Poisson(θ1 +θ2 ). The Poisson family has a “mean-variance relationship,” which
describes the fact that E[X|θ] = Var[X|θ] = θ. If it is observed that a sample
mean is very different than the sample variance, then the Poisson model may
not be appropriate. If the variance is larger than the sample mean, then a
negative binomial model (Section 3.2.1) might be a better fit.

The gamma and inverse-gamma distributions
A random variable X ∈ (0, ∞) has a gamma(a, b) distribution if a > 0, b > 0
and
ba a−1 −bx
p(x|a, b) =
x
e
for x > 0.
Γ (a)
For this distribution,

Common distributions

255

E[X|a, b] = a/b,
Var[X|a, b] = a/b2 ,
mode[X|a, b] = (a − 1)/b if a ≥ 1, 0 if 0 < a < 1 ,
p(x|a, b) = dgamma(x,a,b) .
If X1 ∼ gamma(a1 , b) and X1 ∼ gamma(a2 , b) are independent, then X1 +
X2 ∼ gamma(a1 +a2 , b) and X1 /(X1 +X2 ) ∼ beta(a1 , a2 ). If X ∼ normal(0, σ 2 )
then X 2 ∼ gamma(1/2, 1/[2σ 2 ]). The chi-square distribution with ν degrees
of freedom is the same as a gamma(ν/2, 1/2) distribution.
A random variable X ∈ (0, ∞) has an inverse-gamma(a, b) distribution if
1/X has a gamma(a, b) distribution. In other words, if Y ∼ gamma(a, b) and
X = 1/Y , then X ∼ inverse-gamma(a, b). The density of X is
p(x|a, b) =

ba −a−1 −b/x
x
e
Γ (a)

for x > 0.

For this distribution,
E[X|a, b] = b/(a − 1) if a ≥ 1, ∞ if 0 < a < 1,
Var[X|a, b] = b2 /[(a − 1)2 (a − 2)] if a ≥ 2, ∞ if 0 < a < 2,
mode[X|a, b] = b/(a + 1).
Note that the inverse-gamma density is not simply the gamma density with
x replaced by 1/x: There is an additional factor of x−2 due to the Jacobian
in the change-of-variables formula (see Exercise 10.3).

The univariate normal distribution
A random variable X ∈ R has a normal(θ, σ 2 ) distribution if σ 2 > 0 and
p(x|θ, σ 2 ) = √

1
2πσ 2

1

e− 2 (x−θ)

2

/σ 2

for −∞ < x < ∞.

For this distribution,
E[X|θ, σ 2 ] = θ,
Var[X|θ, σ 2 ] = σ 2 ,
mode[X|θ, σ 2 ] = θ,
p(x|θ, σ 2 ) = dnorm(x,theta,sigma) .
Remember that R parameterizes things in terms of the standard deviation
σ, and not the variance σ 2 . If X1 ∼ normal(θ1 , σ12 ) and X2 ∼ normal(θ2 , σ22 )
are independent, then aX1 + bX2 + c ∼ normal(aθ1 + bθ2 + c, a2 σ12 + b2 σ22 ).

256

Common distributions

A normal sampling model is often useful even if the underlying population
does not have a normal distribution. This is because statistical procedures
that assume a normal model will generally provide good estimates of the
population mean and variance, regardless of whether or not the population is
normal (see Section 5.5 for a discussion).

The multivariate normal distribution
A random vector X ∈ Rp has a multivariate normal(θ, Σ) distribution if Σ
is a positive definite p × p matrix and


1
p(x|θ, Σ) = (2π)−p/2 |Σ|−1/2 exp − (x − θ)T Σ −1 (x − θ)
for x ∈ Rp .
2
For this distribution,
E[X|θ, Σ] = θ,
Var[X|θ, Σ] = Σ,
mode[X|θ, Σ] = θ.
Just like the univariate normal distribution, if X 1 ∼ normal(θ 1 , Σ1 ) and
X 2 ∼ normal(θ 2 , Σ2 ) are independent, then aX 1 + bX 2 + c ∼ normal(aθ 1 +
bθ 2 + c, a2 Σ1 + b2 Σ2 ). Marginal and conditional distributions of subvectors of X also have multivariate normal distributions: Let a ⊂ {1, . . . , p}
be a subset of variable indices, and let b = ac be the remaining indices.
Then X [a] ∼ multivariate normal(θ [a] , Σ[a,a] ) and {X [b] |X [a] } ∼ multivariate
normal(θ b|a ,Σb|a ), where
θ b|a = θ [b] + Σ[b,a] (Σ[a,a] )−1 (X [a] − θ [a] )
Σb|a = Σ[b,b] − Σ[b,a] (Σ[a,a] )−1 Σ[a,b] .
Simulating a multivariate normal random variable can be achieved by a linear
transformation of a vector of i.i.d. standard normal random variables. If Z
is the vector with elements Z1 , . . . , Zp ∼ i.i.d. normal(0, 1) and AAT = Σ,
then X = θ + AZ ∼ multivariate normal(θ, Σ). Usually A is the Choleski
factorization of Σ. The following R-code will generate an n × p matrix such
that the rows are i.i.d. samples from a multivariate normal distribution:
Z<−m at r i x ( rnorm ( n∗p ) , nrow=n , n c o l=p )
X<−t ( t ( Z%∗%c h o l ( Sigma ) ) + c ( t h e t a ) )

Common distributions

257

The Wishart and inverse-Wishart distributions
A random p × p symmetric positive definite matrix X has a Wishart(ν, M)
distribution if the integer ν ≥ p, M is a p × p symmetric positive definite
matrix and
p(X|ν, M) = [2νp/2 Γp (ν/2)|M|ν/2 ]−1 × |X|(ν−p−1)/2 etr(−M−1 X/2),
where
Qp
Γp (ν/2) = π p(p−1)/4
j=1 Γ [(ν + 1 − j)/2], and
P
etr(A) = exp( aj,j ), the exponent of the sum of the diagonal elements.
For this distribution,
E[X|ν, M] = νM,
Var[Xi,j |ν, M] = ν × (m2i,j + mi,i mj,j ),
mode[X|ν, M] = (ν − p − 1)M.
The Wishart distribution is a multivariate version of the gamma distribution. Just as the sum of squares of i.i.d. univariate normal variables has a
gamma distribution, the sums of squares of i.i.d. multivariate normal vectors
has a Wishart distribution.
Specifically, if Y 1 , . . . , Y ν ∼ i.i.d. multivariate
P
normal(0, M), then Y i Y Ti ∼ Wishart(ν, M). This relationship can be used
to generate a Wishart-distributed random matrix:
Z<−m at r i x ( rnorm ( nu∗p ) , nrow=nu , n c o l=p )
Y<−Z%∗%c h o l (M)
X<−t (Y)%∗%Y

# s t a n d a r d normal
# rows have cov=M
# Wishart matrix

A random p × p symmetric positive definite matrix X has an inverseWishart(ν, M) distribution if X−1 has a Wishart(ν, M) distribution. In other
words, if Y ∼ Wishart(ν, M) and X = Y−1 , then X ∼ inverse-Wishart(ν, M).
The density of X is
p(X|ν, M) = [2νp/2 Γp (ν/2)|M|ν/2 ]−1 × |X|−(ν+p+1)/2 etr(−M−1 X−1 /2).
For this distribution,
E[X|ν, M] = (ν − p − 1)−1 M−1 ,
mode[X|ν, M] = (ν + p + 1)−1 M−1 .
The second moments (i.e. the variances) of the elements of X are given in
Press (1972). Since we often use the inverse-Wishart distribution as a prior
distribution for a covariance matrix Σ, it is sometimes useful to parameterize
the distribution in terms of S = M−1 . Then if Σ ∼ inverse-Wishart(ν, S−1 ),
we have mode[X|ν, S] = (ν + p + 1)−1 S. If Σ0 were the most probable value

258

Common distributions

of Σ a priori, then we would set S = (ν0 + p + 1)Σ0 , so that Σ ∼ inverseWishart(ν, [(ν + p − 1)Σ0 ]−1 ) and mode[Σ|ν, S] = Σ0 .
For more on the Wishart distribution and its relationship to the multivariate
normal distribution, see Press (1972) or Mardia et al (1979).

References

Agresti A, Coull BA (1998) Approximate is better than “exact” for interval
estimation of binomial proportions. Amer Statist 52(2):119–126
´
Aldous DJ (1985) Exchangeability and related topics. In: Ecole
d’´et´e de
probabilit´es de Saint-Flour, XIII—1983, Lecture Notes in Math., vol 1117,
Springer, Berlin, pp 1–198
Arcese P, Smith JNM, Hochachka WM, Rogers CM, Ludwig D (1992) Stability, regulation, and the determination of abundance in an insular song
sparrow population. Ecology 73(3):805–822
Atchad´e YF, Rosenthal JS (2005) On adaptive Markov chain Monte Carlo
algorithms. Bernoulli 11(5):815–828
Bayarri MJ, Berger JO (2000) p values for composite null models. J Amer
Statist Assoc 95(452):1127–1142, 1157–1170, with comments and a rejoinder
by the authors
Bayes T (1763) An essay towards solving a problem in the doctrine of chances.
R Soc Lond Philos Trans 5(3):370–418
Berger JO (1980) Statistical decision theory: foundations, concepts, and methods. Springer-Verlag, New York, springer Series in Statistics
Berk KN (1978) Comparing subset regression procedures. Technometrics 20:1–
6
Bernardo JM, Smith AFM (1994) Bayesian theory. Wiley Series in Probability
and Mathematical Statistics: Probability and Mathematical Statistics, John
Wiley & Sons Ltd., Chichester
Besag J (1974) Spatial interaction and the statistical analysis of lattice systems. J Roy Statist Soc Ser B 36:192–236, with discussion by D. R. Cox, A.
G. Hawkes, P. Clifford, P. Whittle, K. Ord, R. Mead, J. M. Hammersley,
and M. S. Bartlett and with a reply by the author
Bickel PJ, Ritov Y (1997) Local asymptotic normality of ranks and covariates
in transformation models. In: Festschrift for Lucien Le Cam, Springer, New
York, pp 43–54

260

References

Box GEP, Draper NR (1987) Empirical model-building and response surfaces.
Wiley Series in Probability and Mathematical Statistics: Applied Probability and Statistics, John Wiley & Sons Inc., New York
Bunke O, Milhaud X (1998) Asymptotic behavior of Bayes estimates under
possibly incorrect models. Ann Statist 26(2):617–644
Carlin BP, Louis TA (1996) Bayes and empirical Bayes methods for data analysis, Monographs on Statistics and Applied Probability, vol 69. Chapman
& Hall, London
Casella G (1985) An introduction to empirical Bayes data analysis. Amer
Statist 39(2):83–87
Chib S, Winkelmann R (2001) Markov chain Monte Carlo analysis of correlated count data. J Bus Econom Statist 19(4):428–435
Congdon P (2003) Applied Bayesian modelling. Wiley Series in Probability
and Statistics, John Wiley & Sons Ltd., Chichester
Cox RT (1946) Probability, frequency and reasonable expectation. Amer J
Phys 14:1–13
Cox RT (1961) The algebra of probable inference. The Johns Hopkins Press,
Baltimore, Md
Dawid AP, Lauritzen SL (1993) Hyper-Markov laws in the statistical analysis
of decomposable graphical models. Ann Statist 21(3):1272–1317
Diaconis P (1988) Recent progress on de Finetti’s notions of exchangeability.
In: Bayesian statistics, 3 (Valencia, 1987), Oxford Sci. Publ., Oxford Univ.
Press, New York, pp 111–125
Diaconis P, Freedman D (1980) Finite exchangeable sequences. Ann Probab
8(4):745–764
Diaconis P, Ylvisaker D (1979) Conjugate priors for exponential families. Ann
Statist 7(2):269–281
Diaconis P, Ylvisaker D (1985) Quantifying prior opinion. In: Bayesian statistics, 2 (Valencia, 1983), North-Holland, Amsterdam, pp 133–156, with discussion and a reply by Diaconis
Dunson DB (2000) Bayesian latent variable models for clustered mixed outcomes. J R Stat Soc Ser B Stat Methodol 62(2):355–366
Efron B (2005) Bayesians, frequentists, and scientists. J Amer Statist Assoc
100(469):1–5
Efron B, Morris C (1973) Stein’s estimation rule and its competitors—an
empirical Bayes approach. J Amer Statist Assoc 68:117–130
de Finetti B (1931) Funzione caratteristica di un fenomeno aleatorio. Atti
della R Academia Nazionale dei Lincei, Serie 6 Memorie, Classe di Scienze
Fisiche, Mathematice e Naturale 4:251–299
de Finetti B (1937) La pr´evision : ses lois logiques, ses sources subjectives.
Ann Inst H Poincar´e 7(1):1–68
Gelfand AE, Smith AFM (1990) Sampling-based approaches to calculating
marginal densities. J Amer Statist Assoc 85(410):398–409
Gelfand AE, Sahu SK, Carlin BP (1995) Efficient parameterisations for normal
linear mixed models. Biometrika 82(3):479–488

References

261

Gelman A, Hill J (2007) Data Analysis using Regression and Multilevel/Hierarchical Models. Cambridge University Press, New York
Gelman A, Rubin DB (1992) Inference from iterative simulation using multiple
sequences (Disc: P483-501, 503-511). Statistical Science 7:457–472
Gelman A, Meng XL, Stern H (1996) Posterior predictive assessment of model
fitness via realized discrepancies. Statist Sinica 6(4):733–807, with comments and a rejoinder by the authors
Gelman A, Carlin JB, Stern HS, Rubin DB (2004) Bayesian data analysis,
2nd edn. Texts in Statistical Science Series, Chapman & Hall/CRC, Boca
Raton, FL
Geman S, Geman D (1984) Stochastic relaxation, Gibbs distributions, and
the Bayesian restoration of images. IEEE Transactions on Pattern Analysis
and Machine Intelligence 6:721–741
George EI, McCulloch RE (1993) Variable selection via Gibbs sampling. Journal of the American Statistical Association 88:881–889
Geweke J (1992) Evaluating the accuracy of sampling-based approaches to the
calculation of posterior moments (Disc: P189-193). In: Bernardo JM, Berger
JO, Dawid AP, Smith AFM (eds) Bayesian Statistics 4. Proceedings of the
Fourth Valencia International Meeting, Clarendon Press [Oxford University
Press], pp 169–188
Geyer CJ (1992) Practical Markov chain Monte Carlo (Disc: P483-503). Statistical Science 7:473–483
Gilks WR, Roberts GO, Sahu SK (1998) Adaptive Markov chain Monte Carlo
through regeneration. J Amer Statist Assoc 93(443):1045–1054
Grogan W, Wirth W (1981) A new American genus of predaceous midges
related to Palpomyia and Bezzia (Diptera: Ceratopogonidae). Proceedings
of the Biological Society of Washington 94:1279–1305
Guttman I (1967) The use of the concept of a future observation in goodnessof-fit problems. J Roy Statist Soc Ser B 29:83–100
Haario H, Saksman E, Tamminen J (2001) An adaptive metropolis algorithm.
Bernoulli 7(2):223–242
Haigis KM, Hoff PD, White A, Shoemaker AR, Halberg RB, Dove WF (2004)
Tumor regionality in the mouse intestine reflects the mechanism of loss of
apc function. PNAS 101(26):9769–9773
Hartigan JA (1966) Note on the confidence-prior of Welch and Peers. J Roy
Statist Soc Ser B 28:55–56
Hastings WK (1970) Monte Carlo sampling methods using Markov chains and
their applications. Biometrika 57:97–109
Hewitt E, Savage LJ (1955) Symmetric measures on Cartesian products. Trans
Amer Math Soc 80:470–501
Hoff PD (2007) Extending the rank likelihood for semiparametric copula estimation. Ann Appl Statist 1(1):265–283
Jaynes ET (2003) Probability theory. Cambridge University Press, Cambridge, the logic of science, Edited and with a foreword by G. Larry Bretthorst

262

References

Jeffreys H (1961) Theory of probability. Third edition, Clarendon Press, Oxford
Johnson VE (2007) Bayesian model assessment using pivotal quantities.
Bayesian Anal 2(4):719–733
Jordan MIe (1998) Learning in Graphical Models. Kluwer Academic Publishers Group
Kass RE, Raftery AE (1995) Bayes factors. Journal of the American Statistical
Association 90:773–795
Kass RE, Wasserman L (1995) A reference Bayesian test for nested hypotheses and its relationship to the Schwarz criterion. J Amer Statist Assoc
90(431):928–934
Kass RE, Wasserman L (1996) The selection of prior distributions by formal
rules (Corr: 1998V93 p412). Journal of the American Statistical Association
91:1343–1370
Kelley TL (1927) The Interpretation of Educational Measurement. World
Book Company, New York
Key JT, Pericchi LR, Smith AFM (1999) Bayesian model choice: what and
why? In: Bayesian statistics, 6 (Alcoceber, 1998), Oxford Univ. Press, New
York, pp 343–370
Kleijn BJK, van der Vaart AW (2006) Misspecification in infinite-dimensional
Bayesian statistics. Ann Statist 34(2):837–877
Kuehl RO (2000) Design of Experiments: Statistical Principles of Research
Design and Analysis. Duxbury Press
Laplace PS (1995) A philosophical essay on probabilities, english edn. Dover
Publications Inc., New York, translated from the sixth French edition by
Frederick William Truscott and Frederick Lincoln Emory, With an introductory note by E. T. Bell
Lauritzen SL (1996) Graphical models, Oxford Statistical Science Series,
vol 17. The Clarendon Press Oxford University Press, New York, oxford
Science Publications
Lawrence E, Bingham D, Liu C, Nair V (2008) Bayesian inference for multivariate ordinal data using parameter expansion. Technometrics 50(2):182–
191
Leamer EE (1978) Specification searches. Wiley-Interscience [John Wiley &
Sons], New York, ad hoc inference with nonexperimental data, Wiley Series
in Probability and Mathematical Statistics
Letac G, Massam H (2007) Wishart distributions for decomposable graphs.
Ann Statist 35(3):1278–1323
Liang F, Paulo R, Molina G, Clyde MA, Berger JO (2008) Mixtures of g
Priors for Bayesian Variable Selection. Journal of the American Statistical
Association 103(481):410–423
Lindley DV, Smith AFM (1972) Bayes estimates for the linear model. J Roy
Statist Soc Ser B 34:1–41, with discussions by J. A. Nelder, V. D. Barnett,
C. A. B. Smith, T. Leonard, M. R. Novick, D. R. Cox, R. L. Plackett,
P. Sprent, J. B. Copas, D. V. Hinkley, E. F. Harding, A. P. Dawid, C.

References

263

Chatfield, S. E. Fienberg, B. M. Hill, R. Thompson, B. de Finetti, and O.
Kempthorne
Little RJ (2006) Calibrated Bayes: a Bayes/frequentist roadmap. Amer Statist
60(3):213–223
Liu JS, Wu YN (1999) Parameter expansion for data augmentation. J Amer
Statist Assoc 94(448):1264–1274
Logan JA (1983) A multivariate model for mobility tables. The American
Journal of Sociology 89(2):324–349
Lukacs E (1942) A characterization of the normal distribution. Ann Math
Statistics 13:91–93
Madigan D, Raftery AE (1994) Model selection and accounting for model uncertainty in graphical models using Occam’s window. Journal of the American Statistical Association 89:1535–1546
Mardia KV, Kent JT, Bibby JM (1979) Multivariate analysis. Academic Press
[Harcourt Brace Jovanovich Publishers], London, probability and Mathematical Statistics: A Series of Monographs and Textbooks
Metropolis N, Rosenbluth AW, Rosenbluth MN, Teller AH, Teller E (1953)
Equation of state calculations by fast computing machines. Journal of
Chemical Physics 21(6):1087–1092
Monahan JF, Boos DD (1992) Proper likelihoods for Bayesian analysis.
Biometrika 79(2):271–278
Moore KA, Waite LJ (1977) Early childbearing and educational attainment.
Family Planning Perspectives 9(5):220–225
Papaspiliopoulos O, Roberts GO, Sk¨
old M (2007) A general framework for
the parametrization of hierarchical models. Statist Sci 22(1):59–73
Petit J, , Jouzel J, Raynaud D, Barkov N, Barnola JM, Basile I, Bender M,
Chappellaz J, Davis M, Delayque G, Delmotte M, Kotlyakov V, Legrand M,
Lipenkov V, Lorius C, Pepin L, Ritz C, Saltzman E, Stievenard M (1999)
Climate and atmospheric history of the past 420,000 years from the vostok
ice core, antarctica. Nature 399:429–436
Pettitt AN (1982) Inference for the linear model using a likelihood based on
ranks. J Roy Statist Soc Ser B 44(2):234–243
Pitt M, Chan D, Kohn R (2006) Efficient Bayesian inference for Gaussian
copula regression models. Biometrika 93(3):537–554
Press SJ (1972) Applied multivariate analysis. Holt, Rinehart and Winston,
Inc., New York, series in Quantitative Methods for Decision-Making, International Series in Decision Processes
Press SJ (1982) Applied Multivariate Analysis: Using Bayesian and Frequentist Methods of Inference. Krieger Publishing Company, Inc.
Quinn K (2004) Bayesian Factor Analysis for Mixed Ordinal and Continuous
Responses. Political Analysis 12(4):338–353
Raftery AE, Lewis SM (1992) How many iterations in the Gibbs sampler? In:
Bernardo JM, Berger JO, Dawid AP, Smith AFM (eds) Bayesian Statistics
4. Proceedings of the Fourth Valencia International Meeting, Clarendon
Press [Oxford University Press], pp 763–773

264

References

Raftery AE, Madigan D, Hoeting JA (1997) Bayesian model averaging for
linear regression models. J Amer Statist Assoc 92(437):179–191
Raiffa H, Schlaifer R (1961) Applied statistical decision theory. Studies in
Managerial Economics, Division of Research, Graduate School of Business
Administration, Harvard University, Boston, Mass.
Rao JNK (1958) A characterization of the normal distribution. Ann Math
Statist 29:914–919
Ripley BD (1979) [Algorithm AS 137] Simulating spatial patterns: Dependent
samples from a multivariate density. Applied Statistics 28:109–112
Robert C, Casella G (2008) A history of markov chain monte carlo–subjective
recollections from incomplete data arXiv:0808.2902 [stat.CO], arxiv:
0808.2902
Robert CP, Casella G (2004) Monte Carlo statistical methods, 2nd edn.
Springer Texts in Statistics, Springer-Verlag, New York
Roberts GO, Rosenthal JS (2007) Coupling and ergodicity of adaptive Markov
chain Monte Carlo algorithms. J Appl Probab 44(2):458–475
Rubin DB (1984) Bayesianly justifiable and relevant frequency calculations
for the applied statistician. Ann Statist 12(4):1151–1172
Rubinstein RY, Kroese DP (2008) Simulation and the Monte Carlo method,
2nd edn. Wiley Series in Probability and Statistics, Wiley-Interscience [John
Wiley & Sons], Hoboken, NJ
Savage LJ (1954) The foundations of statistics. John Wiley & Sons Inc., New
York
Savage LJ (1962) The foundations of statistical inference. Methuen & Co.
Ltd., London
Savage LJ (1972) The foundations of statistics, revised edn. Dover Publications Inc., New York
Severini TA (1991) On the relationship between Bayesian and non-Bayesian
interval estimates. J Roy Statist Soc Ser B 53(3):611–618
Smith JW, Everhart JE, Dickson WC, Knowler WC, Johannes RS (1988) Using the adap learning algorithm to forecast the onset of diabetes mellitus.
In: Greenes RA (ed) Proceedings of the Symposium on Computer Applications in Medical Care (Washington, 1988), IEEE Computer Society Press,
pp 261–265
Stein C (1955) A necessary and sufficient condition for admissibility. Ann
Math Statist 26:518–522
Stein C (1956) Inadmissibility of the usual estimator for the mean of a multivariate normal distribution. In: Proceedings of the Third Berkeley Symposium on Mathematical Statistics and Probability, 1954–1955, vol. I, University of California Press, Berkeley and Los Angeles, pp 197–206
Stein CM (1981) Estimation of the mean of a multivariate normal distribution.
Ann Statist 9(6):1135–1151
Sweeting TJ (1999) On the construction of Bayes-confidence regions. J R Stat
Soc Ser B Stat Methodol 61(4):849–861

References

265

Sweeting TJ (2001) Coverage probability bias, objective Bayes and the likelihood principle. Biometrika 88(3):657–675
Tibshirani R (1989) Noninformative priors for one parameter of many.
Biometrika 76(3):604–608
Tibshirani R (1996) Regression shrinkage and selection via the lasso. J Roy
Statist Soc Ser B 58(1):267–288
Welch BL, Peers HW (1963) On formulae for confidence points based on
integrals of weighted likelihoods. J Roy Statist Soc Ser B 25:318–329
White H (1982) Maximum likelihood estimation of misspecified models.
Econometrica 50(1):1–25
Zellner A (1986) On assessing prior distributions and Bayesian regression
analysis with g-prior distributions. In: Bayesian inference and decision techniques, Stud. Bayesian Econometrics Statist., vol 6, North-Holland, Amsterdam, pp 233–243

Index

admissible, 79
asymptotic coverage, 7, 41
autoregressive model, 189
backwards elimination, 162
Bayes factor, 16, 164
Bayes’ rule, 2, 15, 225
Bayesian
coverage, 41
inference, 1
methods, 1
belief function, 13
beta distribution, 34, 253
bias, 80
binomial distribution, 18, 35, 253
categorical data, 250
central limit theorem, 68
change of variables, 231
Choleski factorization, 256
coherence of bets, 226
confidence regions and intervals, 7, 41
coverage, 41
highest posterior density, 42, 234
quantile-based, 42
conjugate prior distribution, 38, 51, 83
constrained normal distribution, 212,
238
copula model, 217
for missing data, 221
correlation, 106
correlation matrix, 120
covariance matrix
population, 105

sample, 109, 111
credible intervals, 52
cumulative distribution function (cdf),
19
de Finetti’s theorem, 29
density, 18
conditional, 23
joint, 23
marginal, 23
dependence graph, 222
Dirichlet distribution, 250
distribution
beta, 34, 253
binomial, 18, 35, 253
conditional, 23, 225
constrained normal, 212, 238
Dirichlet, 250
full conditional, 93, 225
gamma, 45, 254
inverse-gamma, 74, 254
inverse-Wishart, 110, 257
joint, 23
marginal, 23, 225
multivariate normal, 106, 256
negative binomial, 48
normal, 20, 67, 255
Poisson, 19, 43, 254
posterior, 2, 25
predictive, 40
prior, 2
uniform, 32
Wishart, 257

268

Index

effective sample size, 103
empirical Bayes, 146
Ergodic theorem, 185
exchangeability, 27
in hierarchical models, 131
random variables, 27
expectation, 21
exponential family, 51, 83, 229
Fisher information, 231
observed, 231
fixed effect, 147, 197
frequentist coverage, 41
full conditional distribution, 93, 225
gamma distribution, 45, 254
gamma function, 33
generalized least squares, 189
generalized linear model, 171
linear predictor, 172
link function
log link, 172
logit link, 173
logistic regression, 172
mixed effects model, 247
variable selection, 245
Poisson regression, 172
mixed effects model, 203
Gibbs sampler, 93
properties, 96, 245
with Metropolis algorithm, 187
graphical model, 123, 222
group comparisons
multiple groups, 130
two groups, 125
hierarchical data, 130
hierarchical model
fixed effect, 197
for population means, 132
for population variances, 143
logistic regression, 247
mixed effects model, 195
normal model, 132
normal regression, 197
Poisson regression, 203
Poisson-gamma model, 248
random effect, 197

highest posterior density (HPD)
region, see confidence regions and
intervals
i.i.d., 26
identifiability, lack of, 218
imputation, 115
independence
events, 17
random variables, 26
interquartile range, 22
inverse, of a matrix, 106
inverse-gamma distribution, 74, 254
inverse-Wishart distribution, 110, 257
Jeffreys’ prior, see prior distribution
joint distribution, 23
lasso, 10
latent variable model, 211
likelihood, 231
maximum likelihood estimator, 231
rank, 214
linear mixed effects model, 197
linear regression, 149
g-prior, 157
Bayesian estimation, 154
complexity penalty, 166
generalized least squares, 189
hierarchical, 195, 197
model averaged estimate, 169
model averaging, 167
model selection, 160, 243
normal model, 151
ordinary least squares, 153
polynomial regression, 203
relationship to multivariate normal
model, 121
unit information prior, 156
weakly informative prior, 155
log-odds, 57
logistic regression, 172
mixed effects model, 247
variable selection, 245
logit function, 173
marginal likelihood, 223
Markov chain, 96
aperiodic, 185

Index

269

Ergodic theorem, 185
irreducible, 185
recurrent, 185
Markov chain Monte Carlo (MCMC),
97
autocorrelation, 100, 178, 237, 238
burn-in, 178
comparison to Monte Carlo, 99
convergence, 101
effective sample size, 103
mixing, 102
stationarity, 101
thinned chain, 181, 191
matrix inverse, 106
matrix trace, 110
matrix transpose, 106
matrix, positive definite, 109
maximum likelihood, 231
mean, 21
mean squared error (MSE), 81
median, 21
Metropolis algorithm, 175
acceptance ratio, 175
with Gibbs sampler, 187
Metropolis-Hastings algorithm, 181
acceptance ratio, 183
combining Gibbs and Metropolis, 187
stationary distribution, 186
missing data, 115
missing at random, 116, 221
mixed effects model, see hierarchical
model
mixture model, 234, 237
mode, 21
model, see distribution
model averaging, 167
model checking, 62, 232, 235
model selection
linear regression, 160, 243
logistic regression, 245
model, sampling, 2
Monte Carlo approximation, 54
Monte Carlo standard error, 56
multilevel data, 130
multivariate normal distribution, 106,
256

odds, 57
ordered probit regression, 211
ordinal variables, 210
ordinary least squares (OLS), 153
out-of-sample validation, 122, 161, 243

negative binomial distribution, 48
normal distribution, 20, 67, 255

random effect, 147, 197
random variable, 17

p-value, 126
parameter expansion, 219
parameter space, 2
partition, 14
point estimator, 79
Poisson distribution, 19, 43, 254
Poisson regression, 172
mixed effects model, 203
polynomial regression, 203
positive definite matrix, 109
posterior approximation, see Markov
chain Monte Carlo (MCMC)
discrete approximation, 90, 173
posterior distribution, 2
precision, 71
precision matrix, 110
predictive distribution, 40
posterior, 61
prior, 61, 239
sampling from, 60
prior distribution, 2
conjugate, 38, 51, 83
mixtures of, 228, 229, 233
improper, 78, 231
Jeffreys’, 231, 236, 238
unit information, 156, 200, 231, 236,
238, 248
weakly informative, 52, 84
probability
axioms of, 14
density, 18
distribution, 18
interpretations of, 226
probability density function (pdf), 18
probit regression, 237
ordered, 211
proposal distribution, 175
reflecting random walk, 190, 244
quantile, 22

270

Index

continuous, 19
discrete, 18
randomized block design, 246
rank likelihood, 214
reflecting random walk, 190, 244
sample autocorrelation function, 103
sample space, 2
sampling model, 2
sampling properties, 80
sensitivity analysis, 5, 227, 236, 242
shrinkage, 140
standard deviation, 22
sufficient statistic, 35, 83
binomial model, 35
exponential family, 51, 83
normal model, 70
Poisson model, 45
sum of squares matrix, 109
t-statistic

relationship to an improper prior
distribution, 79
two sample, 125
trace of a matrix, 110
training and test sets, 161
transformation model, 211, 214
transformation of variables, see change
of variables
transpose, of a matrix, 106
unbiased, 80
uniform distribution, 32
unit information prior, see prior
distribution
variable selection, see model selection
variance, 22
Wald interval, 7
weakly informative prior, see prior
distribution
Wishart distribution, 109, 257

